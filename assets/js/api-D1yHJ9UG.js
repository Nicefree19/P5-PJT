var e,t,n=Object.getOwnPropertyNames,r=(e={"assets/js/api-D1yHJ9UG.js"(e,t){const n=function(){const e={CLIENT_ID:"",ALLOWED_DOMAINS:["samsung.com","samoo.com"],TOKEN_KEY:"p5_id_token",USER_KEY:"p5_user_info"};let t=null,n=null;function r(r){try{const n=r.credential,s=o(n);if(e.ALLOWED_DOMAINS.length>0&&!e.ALLOWED_DOMAINS.includes(s.hd))throw new Error("Unauthorized domain: "+s.hd);sessionStorage.setItem(e.TOKEN_KEY,n),sessionStorage.setItem(e.USER_KEY,JSON.stringify({email:s.email,name:s.name,picture:s.picture,domain:s.hd})),t&&t({token:n,user:s}),window.dispatchEvent(new CustomEvent("auth:success",{detail:{email:s.email,name:s.name}}))}catch(s){n&&n(s)}}function o(e){const t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(atob(t).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(n)}function s(){return sessionStorage.getItem(e.TOKEN_KEY)}return{init:function(o){o.clientId&&(e.CLIENT_ID=o.clientId),o.allowedDomains&&(e.ALLOWED_DOMAINS=o.allowedDomains),o.onSuccess&&(t=o.onSuccess),o.onError&&(n=o.onError),"undefined"!=typeof google&&google.accounts&&google.accounts.id.initialize({client_id:e.CLIENT_ID,callback:r,auto_select:!0})},renderButton:function(e){const t=document.getElementById(e);t&&google.accounts.id.renderButton(t,{theme:"filled_blue",size:"large",text:"signin_with",shape:"rectangular"})},getToken:s,getUser:function(){const t=sessionStorage.getItem(e.USER_KEY);return t?JSON.parse(t):null},isAuthenticated:function(){const e=s();if(!e)return!1;try{return 1e3*o(e).exp>Date.now()}catch{return!1}},logout:function(){sessionStorage.removeItem(e.TOKEN_KEY),sessionStorage.removeItem(e.USER_KEY),google.accounts&&google.accounts.id&&google.accounts.id.disableAutoSelect(),window.dispatchEvent(new CustomEvent("auth:logout"))}}}();window.AuthModule=n;const r=function(){const e={BASE_URL:"",TIMEOUT:3e4,RETRY_COUNT:3,RETRY_DELAY:1e3,CIRCUIT_BREAKER_ENABLED:!0,CIRCUIT_NAME_PREFIX:"api_"},t={canExecute:t=>!e.CIRCUIT_BREAKER_ENABLED||"undefined"==typeof ErrorHandler||ErrorHandler.circuit.canExecute(t),recordSuccess(t){e.CIRCUIT_BREAKER_ENABLED&&"undefined"!=typeof ErrorHandler&&ErrorHandler.circuit.recordSuccess(t)},recordFailure(t){e.CIRCUIT_BREAKER_ENABLED&&"undefined"!=typeof ErrorHandler&&ErrorHandler.circuit.recordFailure(t)},logError(e,t){"undefined"!=typeof ErrorHandler&&ErrorHandler.log.add({type:"api",message:e.message||String(e),source:t,stack:e.stack||null})},markStart:e=>"undefined"!=typeof ErrorHandler?ErrorHandler.perf.markStart(e):null,markEnd:(e,t)=>"undefined"!=typeof ErrorHandler?ErrorHandler.perf.markEnd(e,t):null,notify(e,t){"undefined"!=typeof ErrorHandler&&ErrorHandler.notify(e,t)},getCircuitState:e=>"undefined"!=typeof ErrorHandler?ErrorHandler.circuit.getState(e):"CLOSED"};async function n(s,i,c=null,a=0,u="unknown"){const l=e.CIRCUIT_NAME_PREFIX+u;if(!t.canExecute(l)){const e=t.getCircuitState(l),n=new r(`Service temporarily unavailable (Circuit ${e})`,503,{circuitState:e,action:u});throw n.circuitOpen=!0,0===a&&t.notify("서비스가 일시적으로 불안정합니다. 잠시 후 다시 시도해주세요.","warning"),n}const d={"Content-Type":"application/json"};let f=null;window.AuthModule&&window.AuthModule.isAuthenticated()&&(f=window.AuthModule.getToken(),d["X-Authorization"]="Bearer "+f);const E={method:s,headers:d,mode:"cors"};if(c&&"GET"!==s){const e=f?{...c,authorization:"Bearer "+f}:c;E.body=JSON.stringify(e)}const h=t.markStart(l);try{const n=new AbortController,o=setTimeout(()=>n.abort(),e.TIMEOUT);E.signal=n.signal;const s=await fetch(i,E);if(clearTimeout(o),429===s.status){const e=s.headers.get("Retry-After")||60;throw new r("Rate limit exceeded",429,{retryAfter:e})}if(401===s.status)throw window.dispatchEvent(new CustomEvent("auth:expired")),new r("Authentication required",401);if(403===s.status)throw new r("Access denied",403);if(s.status>=500)throw new r(`Server error: ${s.status}`,s.status);const c=await s.json();if(!c.success&&c.error)throw new r(c.error,s.status,c);return t.recordSuccess(l),t.markEnd(l,h),c}catch(g){if(t.markEnd(l,h),g.circuitOpen)throw g;if(("AbortError"===g.name||"TypeError"===g.name)&&a<e.RETRY_COUNT)return await o(e.RETRY_DELAY*(a+1)),n(s,i,c,a+1,u);if(g instanceof r&&g.status>=500&&a<e.RETRY_COUNT)return await o(e.RETRY_DELAY*(a+1)),n(s,i,c,a+1,u);throw t.recordFailure(l),t.logError(g,`ApiClient.${u}`),g}}class r extends Error{constructor(e,t,n={}){super(e),this.name="ApiError",this.status=t,this.data=n}}function o(e){return new Promise(t=>setTimeout(t,e))}return{configure:function(t){t.baseUrl&&(e.BASE_URL=t.baseUrl),t.timeout&&(e.TIMEOUT=t.timeout),void 0!==t.circuitBreakerEnabled&&(e.CIRCUIT_BREAKER_ENABLED=t.circuitBreakerEnabled)},get:async function(t,r={}){const o=new URL(e.BASE_URL);return o.searchParams.append("action",t),Object.entries(r).forEach(([e,t])=>{null!=t&&o.searchParams.append(e,t)}),window.AuthModule&&window.AuthModule.isAuthenticated()&&o.searchParams.append("token",window.AuthModule.getToken()),n("GET",o.toString(),null,0,t)},post:async function(t,r={}){return n("POST",e.BASE_URL,{action:t,...r},0,t)},ApiError:r,getCircuitState:function(n){const r=e.CIRCUIT_NAME_PREFIX+n;return t.getCircuitState(r)},resetCircuit:function(t){if("undefined"!=typeof ErrorHandler)if(t){const n=e.CIRCUIT_NAME_PREFIX+t;ErrorHandler.circuit.reset(n)}else ErrorHandler.circuit.reset()},getAllCircuitStates:function(){return"undefined"==typeof ErrorHandler?{}:ErrorHandler.getCircuitStates()}}}();window.ApiClient=r;const o=function(){const e={API_URL:"",API_KEY:"",SYNC_INTERVAL:3e4,RETRY_DELAY:5e3,MAX_RETRIES:3,QUEUE_KEY:"p5_sync_queue",LAST_SYNC_KEY:"p5_last_sync",CHUNK_SIZE:500,CHUNK_DELAY:1e3,TIMEOUT_BUFFER:3e5};let t=[],n=!1,r=null,o=null,s=null,i=null,c=null;async function a(t,n,r,o){const s={action:"syncChunk",chunk:t,chunkIndex:n,totalChunks:r,timestamp:o,user:"dashboard"};return e.API_KEY&&(s.apiKey=e.API_KEY),(await fetch(e.API_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json()}function u(e){return new Promise(t=>setTimeout(t,e))}async function l(){if(n||0===t.length)return{success:!0,processed:0};n=!0;const r={success:0,failed:0,conflicts:0};for(const n of t.filter(e=>"pending"===e.status))try{const e=await d(n.action,n.payload);if(e.success)n.status="completed",r.success++;else{if(!e.isLocked&&!e.conflict)throw new Error(e.error||"Unknown error");n.status="conflict",r.conflicts++,o&&o(n,e)}}catch(c){n.retries++,n.retries>=e.MAX_RETRIES&&(n.status="failed",r.failed++,i&&i(n,c))}return t=t.filter(e=>"completed"!==e.status),f(),n=!1,s&&s(r),r}async function d(t,n){const r={action:t,...n};return e.API_KEY&&(r.apiKey=e.API_KEY),(await fetch(e.API_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})).json()}function f(){try{localStorage.setItem(e.QUEUE_KEY,JSON.stringify(t))}catch(n){}}return{configure:function(n){n.apiUrl&&(e.API_URL=n.apiUrl),n.apiKey&&(e.API_KEY=n.apiKey),n.syncInterval&&(e.SYNC_INTERVAL=n.syncInterval),n.chunkSize&&(e.CHUNK_SIZE=n.chunkSize),n.onConflict&&(o=n.onConflict),n.onSyncComplete&&(s=n.onSyncComplete),n.onSyncError&&(i=n.onSyncError),n.onProgress&&(c=n.onProgress),function(){try{const n=localStorage.getItem(e.QUEUE_KEY);n&&(t=JSON.parse(n),t.forEach(e=>{"syncing"===e.status&&(e.status="pending")}))}catch(n){t=[]}}()},startAutoSync:function(){r||(r=setInterval(()=>{l()},e.SYNC_INTERVAL))},stopAutoSync:function(){r&&(clearInterval(r),r=null)},queueChange:function(e,n){const r={id:"sync_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),action:e,payload:n,timestamp:(new Date).toISOString(),retries:0,status:"pending"};return t.push(r),f(),r},syncNow:async function(){return e.API_URL?l():{success:!1,error:"API not configured"}},fetchFromServer:async function(){if(!e.API_URL)return{success:!1,error:"API not configured"};try{const t=await fetch(`${e.API_URL}?action=getFullData`),n=await t.json();return n.success&&localStorage.setItem(e.LAST_SYNC_KEY,n.timestamp),n}catch(t){return{success:!1,error:t.message}}},getQueueStatus:function(){return{pending:t.filter(e=>"pending"===e.status).length,failed:t.filter(e=>"failed"===e.status).length,total:t.length,isSyncing:n,lastSync:localStorage.getItem(e.LAST_SYNC_KEY)}},clearQueue:function(){t=[],f()},syncColumnsChunked:async function(t){if(!e.API_URL)return{success:!1,error:"API not configured"};const n=Object.entries(t),r=Math.ceil(n.length/e.CHUNK_SIZE),o=(new Date).toISOString(),i={success:!0,totalColumns:n.length,totalChunks:r,processed:0,failed:0,conflicts:[],startTime:Date.now()};for(let s=0;s<r;s++){const t=s*e.CHUNK_SIZE,d=Math.min(t+e.CHUNK_SIZE,n.length),f=Object.fromEntries(n.slice(t,d));try{const t=await a(f,s+1,r,o);t.success?i.processed+=Object.keys(f).length:t.conflicts?i.conflicts.push(...t.conflicts):i.failed+=Object.keys(f).length;const n=Math.round((s+1)/r*100);c&&c({current:s+1,total:r,percent:n,processed:i.processed}),s<r-1&&await u(e.CHUNK_DELAY)}catch(l){i.failed+=Object.keys(f).length,i.success=!1}}return i.endTime=Date.now(),i.duration=i.endTime-i.startTime,s&&s(i),i},resolveConflicts:function(e,t){const n=[],r={};for(const[o,s]of Object.entries(e)){const e=t[o];if(!e){r[o]=s;continue}const i=new Date(s.updatedAt||0).getTime(),c=new Date(e.updatedAt||0).getTime();Math.abs(i-c)<1e3?r[o]=e:c>i?(n.push({key:o,resolution:"server_wins",localValue:s,serverValue:e,reason:"Server data is newer"}),r[o]=e):(n.push({key:o,resolution:"local_wins",localValue:s,serverValue:e,reason:"Local data is newer"}),r[o]=s)}for(const[o,s]of Object.entries(t))e[o]||(r[o]=s);return{resolved:r,conflicts:n}}}}(),s=function(){return{showDialog:function(e,t,n){t.isLocked?n("server",t):n("local",e)},mergeChanges:function(e,t){return{...t,status:{...t.status,code:e.status.code,isLocked:t.status.isLocked}}}}}(),i={...P5Store,isOnline:!0,apiConfigured:!1,async initWithApi(e){o.configure({apiUrl:e,onSyncComplete:e=>{this.showSyncStatus(e)},onConflict:(e,t)=>{},onSyncError:(e,t)=>{}}),this.apiConfigured=!0;try{const e=await o.fetchFromServer();if(e.success)return e}catch(t){}return this.load()},saveWithSync(e){this.save(e),this.apiConfigured&&this.isOnline&&o.queueChange("syncFromLocal",{data:{columns:e.columns},user:"dashboard"})},updateColumnWithSync(e,t){const n=this.load();n.columns[e]&&(Object.assign(n.columns[e].status,t),n.columns[e].status.updatedAt=(new Date).toISOString(),n.columns[e].status.source="admin",this.save(n)),this.apiConfigured&&this.isOnline&&o.queueChange("updateColumn",{uid:e,data:t,user:"dashboard"})},bulkUpdateWithSync(e,t){const n=this.load();for(const r of e)n.columns[r]&&(Object.assign(n.columns[r].status,t),n.columns[r].status.updatedAt=(new Date).toISOString(),n.columns[r].status.source="admin");this.save(n),this.apiConfigured&&this.isOnline&&o.queueChange("bulkUpdate",{uids:e,data:t,user:"dashboard"})},forceSyncNow:async()=>o.syncNow(),getSyncStatus:()=>o.getQueueStatus(),showSyncStatus(e){}};"undefined"!=typeof window&&(window.SyncModule=o,window.ConflictResolver=s,window.P5SyncStore=i),void 0!==t&&t.exports&&(t.exports={SyncModule:o,ConflictResolver:s,_internal:{resolveConflicts:o.resolveConflicts,syncColumnsChunked:o.syncColumnsChunked,configure:o.configure,queueChange:o.queueChange,getQueueStatus:o.getQueueStatus,clearQueue:o.clearQueue}})}},function(){return t||(0,e[n(e)[0]])((t={exports:{}}).exports,t),t.exports});export default r();
