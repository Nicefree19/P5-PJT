<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P5 Live Grid Dashboard v2.3</title>
    
    <!-- Security: Content Security Policy (Updated for GIS + SheetJS + jsPDF) -->
    <meta http-equiv="Content-Security-Policy"
          content="default-src 'self';
                   script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://accounts.google.com https://cdn.sheetjs.com https://cdnjs.cloudflare.com;
                   style-src 'self' 'unsafe-inline';
                   img-src 'self' data: blob: https://*.googleusercontent.com;
                   connect-src 'self' https://script.google.com https://*.googleusercontent.com https://oauth2.googleapis.com;
                   font-src 'self' https://fonts.gstatic.com;
                   frame-src https://accounts.google.com;">
    
    <!-- Security: Referrer Policy -->
    <meta name="referrer" content="strict-origin-when-cross-origin">
    
    <!-- Google Identity Services (GIS) SDK -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    
    <!-- Alpine.js (Core) -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.1/dist/cdn.min.js"></script>

    <!-- SheetJS for Excel Export -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>

    <!-- jsPDF for PDF Report Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>

    <!-- P5 Modules -->
    <script type="module" src="./js/auth.js"></script>
    <script type="module" src="./js/api.js"></script>
    <script type="module" src="./js/sync-module.js"></script>
    
    <!-- Production Status Data (PSRC Ï†úÏûëÌòÑÌô©) -->
    <script src="./data/production_status_import.js"></script>
    
    <!-- Column Data Generator (Ï†ÑÏàò Í∏∞Îë• Îç∞Ïù¥ÌÑ∞) -->
    <script src="./data/column_data_generator.js"></script>
    
    <!-- Phase 7: Modular CSS (WP-1 Refactoring) -->
    <link rel="stylesheet" href="./css/main.css">
    <link rel="stylesheet" href="./css/reports.css">

    <style>
        /* === Design System: High-Tech Fab Theme === */
        :root {
            --bg-color: #0d1117;
            --panel-bg: #161b22;
            --border-color: #30363d;
            --grid-line: #21262d;
            --text-main: #c9d1d9;
            --text-sub: #8b949e;
            
            /* Status Colors */
            --status-ok: #238636;
            --status-active: #1f6feb;
            --status-tc-hold: #da3633;
            --status-design: #d29922;
            --status-shipping: #8957e5;
            --status-pending: #484f58;
        }

        /* === Accessibility: Focus Indicators === */
        *:focus-visible {
            outline: 3px solid #58a6ff;
            outline-offset: 2px;
        }

        .btn:focus-visible {
            outline: 3px solid #58a6ff;
            outline-offset: 2px;
            box-shadow: 0 0 0 4px rgba(88, 166, 255, 0.3);
        }

        .grid-cell:focus-visible {
            outline: 2px solid #58a6ff;
            outline-offset: -2px;
            z-index: 5;
        }

        input:focus-visible,
        select:focus-visible,
        textarea:focus-visible {
            outline: 2px solid var(--status-active);
            border-color: var(--status-active);
        }

        /* Screen reader only - hidden but accessible */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .sr-only-focusable:focus {
            position: static;
            width: auto;
            height: auto;
            padding: inherit;
            margin: inherit;
            overflow: visible;
            clip: auto;
            white-space: normal;
        }

        /* === Accessibility: Skip Link === */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--status-active);
            color: white;
            padding: 8px 16px;
            z-index: 1000;
            text-decoration: none;
            border-radius: 0 0 4px 0;
            transition: top 0.3s;
        }
        .skip-link:focus {
            top: 0;
        }

        * { box-sizing: border-box; }
        
        body {
            margin: 0;
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* === Header === */
        header {
            height: 55px;
            background-color: var(--panel-bg);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 20;
            flex-shrink: 0;
        }

        .brand { display: flex; align-items: center; gap: 12px; }
        .brand h1 { margin: 0; font-size: 16px; font-weight: 700; color: #fff; }
        .project-tag {
            background: #238636; color: #fff; padding: 2px 8px; 
            border-radius: 12px; font-size: 11px; font-weight: 600;
        }

        .controls { display: flex; align-items: center; gap: 15px; }
        .stat-box { display: flex; flex-direction: column; align-items: flex-end; }
        .stat-label { font-size: 10px; color: var(--text-sub); }
        .stat-val { font-size: 12px; font-weight: bold; color: var(--text-main); }
        
        .btn {
            background: var(--border-color); color: var(--text-main); 
            border: 1px solid var(--border-color);
            padding: 6px 12px; border-radius: 6px; font-size: 12px; 
            cursor: pointer; transition: 0.2s;
        }
        .btn:hover { background: #30363d; }
        .btn-primary { background: var(--status-active); border-color: var(--status-active); }
        .btn-primary:hover { background: #1a5fd9; }
        .btn-success { background: var(--status-ok); border-color: var(--status-ok); }

        /* === Phase 7: Ï∏µ ÏÑ†ÌÉùÍ∏∞ === */
        .floor-selector {
            position: relative;
            z-index: 100;
        }

        .floor-selector-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, #1f6feb 0%, #238636 100%);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            padding: 6px 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #fff;
            font-size: 13px;
            font-weight: 600;
        }

        .floor-selector-btn:hover {
            background: linear-gradient(135deg, #2d7ff9 0%, #2ea043 100%);
            border-color: rgba(255, 255, 255, 0.25);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(31, 111, 235, 0.3);
        }

        .floor-icon { font-size: 16px; }
        .floor-label { min-width: 50px; text-align: left; }
        .floor-arrow {
            font-size: 10px;
            transition: transform 0.2s ease;
            opacity: 0.8;
        }
        .floor-arrow.open { transform: rotate(180deg); }

        .floor-dropdown {
            position: absolute;
            top: calc(100% + 8px);
            left: 0;
            min-width: 180px;
            background: var(--panel-bg);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
            overflow: hidden;
            z-index: 101;
        }

        .floor-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 14px;
            font-size: 13px;
            color: var(--text-sub);
            cursor: pointer;
            transition: all 0.15s ease;
            border-bottom: 1px solid var(--border-color);
        }

        .floor-item:last-child { border-bottom: none; }

        .floor-item:hover {
            background: rgba(31, 111, 235, 0.1);
            color: var(--text-main);
        }

        .floor-item.active {
            background: rgba(31, 111, 235, 0.2);
            color: #58a6ff;
        }

        .floor-item.has-variation .floor-item-label {
            color: var(--status-design);
        }

        .floor-item-label { flex: 1; font-weight: 500; }

        .floor-item-badge {
            font-size: 12px;
            padding: 2px 6px;
            background: rgba(210, 153, 34, 0.2);
            border-radius: 4px;
            color: var(--status-design);
        }

        .floor-item-check {
            color: var(--status-ok);
            font-weight: bold;
            font-size: 14px;
        }

        /* === Phase 7: Ï†àÏ£º ÏûÖÎ©¥ Î∑∞Ïñ¥ === */
        .elevation-viewer {
            background: #0d1117;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
        }

        .elevation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .elevation-header h3 {
            margin: 0;
            font-size: 11px;
            color: #fff;
            text-transform: uppercase;
        }

        .elevation-toggle {
            width: 22px;
            height: 22px;
            border-radius: 4px;
            background: var(--border-color);
            border: none;
            color: var(--text-sub);
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .elevation-toggle:hover {
            background: var(--status-active);
            color: #fff;
        }

        .elevation-grid {
            display: flex;
            flex-direction: column; /* Ensure rows stack vertically */
            gap: 2px;
            height: auto; /* Allow dynamic height based on floors */
            min-height: 80px;
            margin-bottom: 10px;
        }

        .elevation-row {
            display: flex;
            gap: 2px;
            height: 18px; /* Fixed height for rows */
            align-items: center;
        }
        
        .elevation-floor-label {
            width: 25px;
            font-size: 9px;
            color: var(--text-sub);
            text-align: right;
            padding-right: 4px;
        }

        .elevation-cell {
            flex: 1;
            background: #161b22;
            border: 1px solid var(--border-color);
            border-radius: 2px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .elevation-cell:hover { border-color: var(--text-sub); }
        .elevation-cell.active { background: rgba(31, 111, 235, 0.2); border-color: #58a6ff; }
        
        .jeolju-bar {
            flex: 1;
            background: #161b22;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            position: relative;
            cursor: pointer;
            overflow: hidden;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            height: 60px; /* Explicit height for bar chart */
        }

        .jeolju-bar:hover {
            border-color: var(--status-active);
            transform: translateY(-2px);
        }

        .jeolju-bar.active {
            border-color: var(--status-active);
            box-shadow: 0 0 8px rgba(31, 111, 235, 0.4);
        }

        .jeolju-bar.has-issues {
            border-color: var(--status-tc-hold);
        }

        .jeolju-progress-fill {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(180deg, var(--status-ok) 0%, #1a4223 100%);
            transition: height 0.3s ease;
            z-index: 1;
        }

        .jeolju-label {
            position: relative;
            z-index: 2;
            text-align: center;
            font-size: 9px;
            font-weight: 600;
            color: var(--text-sub);
            padding: 4px 2px;
            background: rgba(0, 0, 0, 0.5);
        }

        .jeolju-bar.active .jeolju-label {
            color: #58a6ff;
        }

        .jeolju-issue-badge {
            position: absolute;
            top: 4px;
            right: 4px;
            z-index: 3;
            background: var(--status-tc-hold);
            color: #fff;
            font-size: 8px;
            font-weight: bold;
            min-width: 14px;
            height: 14px;
            border-radius: 7px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 3px;
        }

        .elevation-info {
            background: #161b22;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 10px;
            margin-top: 8px;
        }

        .elevation-info-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 12px;
            font-weight: 600;
            color: #58a6ff;
        }

        .btn-small {
            padding: 3px 8px !important;
            font-size: 10px !important;
        }

        .elevation-stats {
            display: flex;
            justify-content: space-around;
        }

        .elevation-stats .stat {
            text-align: center;
        }

        .elevation-stats .stat-number {
            display: block;
            font-size: 16px;
            font-weight: bold;
            color: var(--text-main);
        }

        .elevation-stats .stat-label {
            font-size: 10px;
            color: var(--text-sub);
        }

        .elevation-collapsed {
            background: #0d1117;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            font-size: 11px;
            color: var(--text-sub);
            cursor: pointer;
            transition: all 0.2s;
        }

        .elevation-collapsed:hover {
            border-color: var(--status-active);
            color: var(--text-main);
        }

        /* === Main Layout === */
        .main-container { display: flex; flex: 1; overflow: hidden; }

        /* === Sidebar === */
        .sidebar {
            width: 260px;
            background: var(--panel-bg);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            padding: 15px;
            gap: 15px;
            flex-shrink: 0;
            overflow-y: auto;
        }

        .sidebar h3 { font-size: 11px; color: #fff; margin: 0 0 10px 0; text-transform: uppercase; }
        
        .zone-legend { display: flex; flex-direction: column; gap: 8px; }
        .legend-item { 
            display: flex; align-items: center; gap: 10px; 
            font-size: 12px; color: var(--text-sub); cursor: pointer; 
        }
        .legend-item:hover { color: var(--text-main); }
        .color-dot { width: 10px; height: 10px; border-radius: 50%; }

        .zone-summary {
            background: #0d1117; border: 1px solid var(--border-color); 
            border-radius: 6px; padding: 10px;
        }
        .zone-title { 
            font-size: 11px; font-weight: bold; color: #fff; 
            margin-bottom: 5px; display: flex; justify-content: space-between; 
        }
        .progress-bar { height: 4px; background: #30363d; border-radius: 2px; overflow: hidden; margin-top: 4px; }
        .progress-fill { height: 100%; transition: width 0.3s; }

        /* === Canvas Area === */
        .canvas-area {
            flex: 1;
            overflow: hidden;
            position: relative;
            background: var(--bg-color);
            display: flex;
            flex-direction: column;
        }

        /* Zone Indicator Bar */
        .zone-indicator-bar {
            height: 30px;
            display: flex;
            border-bottom: 1px solid var(--border-color);
            background: #0d1117;
            flex-shrink: 0;
        }
        .zone-segment {
            display: flex; align-items: center; justify-content: center;
            font-size: 11px; font-weight: bold; color: var(--text-sub);
            border-right: 1px solid var(--border-color);
            flex: 1;
        }

        /* Selection Mode Banner */
        .selection-banner {
            background: rgba(31, 111, 235, 0.2);
            border-bottom: 1px solid var(--status-active);
            padding: 8px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 12px;
        }
        .selection-banner .count { color: #58a6ff; font-weight: bold; }

        /* Bulk Edit Panel */
        .bulk-edit-panel {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--panel-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 16px 24px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            z-index: 900;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .bulk-edit-panel .bulk-count {
            font-size: 14px;
            color: #58a6ff;
            font-weight: 600;
        }

        .bulk-edit-panel .bulk-actions {
            display: flex;
            gap: 8px;
        }

        .bulk-edit-panel .bulk-status-btn {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            border: 1px solid var(--border-color);
            background: transparent;
            color: var(--text-sub);
            transition: all 0.2s;
        }

        .bulk-edit-panel .bulk-status-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-main);
        }

        .bulk-edit-panel .bulk-status-btn.installed { border-color: #238636; color: #238636; }
        .bulk-edit-panel .bulk-status-btn.active { border-color: #1f6feb; color: #1f6feb; }
        .bulk-edit-panel .bulk-status-btn.pending { border-color: #484f58; color: #8b949e; }
        .bulk-edit-panel .bulk-status-btn.hold { border-color: #da3633; color: #f85149; }

        /* Grid Container */
        .grid-scroll-view {
            flex: 1;
            overflow: auto;
            padding: 30px;
            cursor: grab;
            position: relative; /* Required for virtual spacer positioning */
        }
        .grid-scroll-view:active { cursor: grabbing; }

        /* === Virtual Scrolling System === */
        .virtual-grid-container {
            position: relative;
            overflow: auto;
            background: var(--bg-dark);
        }
        .virtual-grid-spacer {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
        }
        .virtual-grid-content {
            position: sticky;
            top: 0;
            left: 0;
            display: grid;
            gap: 2px;
            width: fit-content;
        }
        .virtual-header-row {
            display: contents;
        }
        .virtual-header-col {
            position: sticky;
            left: 0;
            z-index: 2;
            background: var(--bg-dark);
        }
        .virtual-corner-cell {
            position: sticky;
            top: 0;
            left: 0;
            z-index: 3;
            background: var(--bg-dark);
        }
        .virtual-scroll-indicator {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            color: #8b949e;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 11px;
            font-family: monospace;
            z-index: 100;
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: none;
        }
        .virtual-scroll-indicator.visible {
            opacity: 1;
        }

        .grid-container {
            display: grid;
            grid-template-columns: 35px repeat(var(--cols), 26px);
            grid-template-rows: 25px repeat(var(--rows), 26px);
            gap: 2px;
            width: fit-content;
            user-select: none;
        }

        .grid-cell-header {
            display: flex; align-items: center; justify-content: center;
            font-size: 9px; color: #484f58; font-family: monospace;
        }

        .grid-cell {
            position: relative;
            border: 1px solid var(--grid-line);
            display: flex; align-items: center; justify-content: center;
            background: #10141a;
            transition: background 0.15s;
        }
        .grid-cell.selected {
            background: rgba(31, 111, 235, 0.3);
            border-color: var(--status-active);
        }
        .grid-cell.in-selection-rect {
            background: rgba(31, 111, 235, 0.15);
        }

        .dot {
            width: 10px; height: 10px; border-radius: 50%;
            transition: transform 0.1s; cursor: pointer;
        }
        .dot:hover { transform: scale(1.8); z-index: 10; border: 1px solid #fff; }
        .dot.active { transform: scale(1.5); border: 1px solid #fff; box-shadow: 0 0 8px rgba(255,255,255,0.3); }

        /* Status Dot Styles */
        .st-pending { background: var(--status-pending); opacity: 0.5; }
        .st-active { background: var(--status-active); }
        .st-installed { background: var(--status-ok); }
        .st-hold_tc { background: var(--status-tc-hold); border-radius: 2px; }
        .st-hold_design { background: var(--status-design); border: 2px solid #fff; }
        .st-hold_material { background: var(--status-shipping); }

        /* WP-2: Issue Pin Styles */
        .issue-pin {
            position: absolute;
            top: -6px;
            right: -6px;
            font-size: 12px;
            z-index: 10;
            animation: issue-pulse 2s ease-in-out infinite;
            pointer-events: auto;
            cursor: pointer;
            filter: drop-shadow(0 1px 2px rgba(0,0,0,0.5));
        }

        .issue-pin-critical {
            filter: drop-shadow(0 0 6px #ff0000) drop-shadow(0 0 12px #ff0000);
            animation: issue-pulse-critical 1s ease-in-out infinite;
            will-change: transform, opacity;
            transform: translateZ(0);
        }
        .issue-pin-high {
            filter: drop-shadow(0 0 4px #ff6600) drop-shadow(0 0 8px #ff6600);
            animation: issue-pulse-high 1.5s ease-in-out infinite;
            will-change: transform, opacity;
            transform: translateZ(0);
        }
        .issue-pin-medium {
            filter: drop-shadow(0 0 3px #ffaa00);
            transform: translateZ(0);
        }
        .issue-pin-low {
            filter: drop-shadow(0 0 2px #00cc00);
            animation: none;
        }

        /* GPU-accelerated pulse animations */
        @keyframes issue-pulse {
            0%, 100% { transform: scale(1) translateZ(0); opacity: 1; }
            50% { transform: scale(1.2) translateZ(0); opacity: 0.85; }
        }

        @keyframes issue-pulse-critical {
            0%, 100% { transform: scale(1) translateZ(0); opacity: 1; }
            25% { transform: scale(1.4) translateZ(0); opacity: 0.9; }
            50% { transform: scale(1.1) translateZ(0); opacity: 1; }
            75% { transform: scale(1.4) translateZ(0); opacity: 0.9; }
        }

        @keyframes issue-pulse-high {
            0%, 100% { transform: scale(1) translateZ(0); opacity: 1; }
            50% { transform: scale(1.3) translateZ(0); opacity: 0.85; }
        }

        .grid-cell.has-issue,
        .stage-grid.has-issue {
            box-shadow: inset 0 0 0 1px rgba(255, 0, 0, 0.4);
            background: rgba(255, 0, 0, 0.05);
        }

        .grid-cell.has-issue-critical,
        .stage-grid.has-issue-critical {
            box-shadow: inset 0 0 0 2px rgba(255, 0, 0, 0.7);
            background: rgba(255, 0, 0, 0.1);
            animation: cell-pulse-critical 2s ease-in-out infinite;
            will-change: background-color;
            transform: translateZ(0);
        }

        @keyframes cell-pulse-critical {
            0%, 100% { background-color: rgba(255, 0, 0, 0.1); }
            50% { background-color: rgba(255, 0, 0, 0.2); }
        }

        /* Issue count badge for multiple issues */
        .issue-count-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            min-width: 16px;
            height: 16px;
            background: #da3633;
            color: #fff;
            font-size: 9px;
            font-weight: bold;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 11;
            border: 1px solid #fff;
        }

        /* Locked indicator */
        .dot.locked::after {
            content: 'üîí';
            position: absolute;
            font-size: 6px;
            top: -4px;
            right: -4px;
        }

        /* Lock Badge (Detail Panel Header) */
        .lock-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #f0b429 0%, #d4a41d 100%);
            color: #000;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
            animation: lock-pulse 2s infinite;
        }
        @keyframes lock-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Enhanced locked grid cell */
        .stage-grid.locked {
            box-shadow: 0 0 0 2px #f0b429, 0 0 6px rgba(240, 180, 41, 0.5);
        }

        /* === Phase 6: 2x3 Mini Stage Grid === */
        .stage-grid {
            display: grid;
            grid-template-columns: repeat(3, 6px);
            grid-template-rows: repeat(2, 6px);
            gap: 1px;
            width: fit-content;
            cursor: pointer;
        }
        .stage-grid:hover {
            transform: scale(1.5);
            z-index: 10;
            background: rgba(0,0,0,0.5);
            padding: 2px;
            border-radius: 2px;
        }
        .stage-grid.locked::after {
            content: 'üîí';
            position: absolute;
            font-size: 5px;
            top: -3px;
            right: -3px;
        }
        .stage-grid.workflow-filtered {
            opacity: 0.15;
            filter: grayscale(80%);
        }

        /* Phase 7: Ï†àÏ£º ÌïÑÌÑ∞ÎßÅ Ïä§ÌÉÄÏùº */
        .stage-grid.jeolju-filtered {
            opacity: 0.25;
            filter: grayscale(60%);
            pointer-events: none;
        }
        .stage-grid.jeolju-filtered::after {
            content: '';
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 2px;
        }

        .stage-cell {
            width: 6px;
            height: 6px;
            border-radius: 1px;
            transition: background 0.15s;
        }

        /* Stage States */
        .stage-cell.st-pending { background: var(--status-pending); opacity: 0.4; }
        .stage-cell.st-active { background: var(--status-active); }
        .stage-cell.st-installed { background: var(--status-ok); }
        .stage-cell.st-hold { background: var(--status-tc-hold); }

        /* Stage-specific colors (matches productionStages config) */
        .stage-cell[data-stage="hmb_fab"].st-active { background: #1f6feb; }
        .stage-cell[data-stage="pre_assem"].st-active { background: #8957e5; }
        .stage-cell[data-stage="main_assem"].st-active { background: #d29922; }
        .stage-cell[data-stage="hmb_psrc"].st-active { background: #238636; }
        .stage-cell[data-stage="form"].st-active { background: #da3633; }
        .stage-cell[data-stage="embed"].st-active { background: #f85149; }

        /* Installed shows green for all stages */
        .stage-cell.st-installed { background: var(--status-ok) !important; }

        /* Stage Grid Tooltip */
        .stage-grid[title]:hover::before {
            content: attr(title);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #21262d;
            color: #fff;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 9px;
            white-space: nowrap;
            z-index: 100;
            border: 1px solid var(--border-color);
        }

        /* === Phase 6: Progress Summary Header === */
        .progress-summary {
            display: flex;
            gap: 4px;
            padding: 4px 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 6px;
            align-items: center;
        }
        .progress-summary .stage-mini {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
            padding: 0 6px;
            border-right: 1px solid var(--border-color);
        }
        .progress-summary .stage-mini:last-child {
            border-right: none;
        }
        .progress-summary .stage-label {
            font-size: 8px;
            color: var(--text-sub);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .progress-summary .stage-progress {
            font-size: 11px;
            font-weight: bold;
            color: var(--text-main);
        }
        .progress-summary .stage-bar {
            width: 40px;
            height: 3px;
            background: #30363d;
            border-radius: 1px;
            overflow: hidden;
        }
        .progress-summary .stage-bar-fill {
            height: 100%;
            transition: width 0.3s;
        }

        /* === Phase 6: Workflow Footer === */
        .workflow-footer {
            height: 70px;
            background: var(--panel-bg);
            border-top: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 20px;
            flex-shrink: 0;
            gap: 8px;
        }
        .workflow-footer .workflow-title {
            font-size: 10px;
            color: var(--text-sub);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-right: 15px;
        }
        .workflow-svg {
            height: 50px;
            flex: 1;
            max-width: 900px;
        }
        .workflow-node {
            cursor: pointer;
            transition: all 0.2s;
        }
        .workflow-node:hover {
            filter: brightness(1.3);
        }
        .workflow-node.active {
            filter: drop-shadow(0 0 6px currentColor);
        }
        .workflow-node.filtered {
            opacity: 0.3;
        }
        .workflow-node rect {
            rx: 4;
            ry: 4;
            stroke-width: 2;
        }
        .workflow-node text {
            font-size: 10px;
            font-weight: 600;
            fill: #fff;
            text-anchor: middle;
            dominant-baseline: central;
            pointer-events: none;
        }
        .workflow-node .node-count {
            font-size: 8px;
            fill: rgba(255,255,255,0.7);
        }
        .workflow-arrow {
            fill: none;
            stroke: var(--border-color);
            stroke-width: 2;
            marker-end: url(#arrowhead);
        }
        .workflow-legend {
            display: flex;
            flex-direction: column;
            gap: 4px;
            margin-left: 15px;
            font-size: 10px;
            color: var(--text-sub);
        }
        .workflow-legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .workflow-legend-item:hover {
            color: var(--text-main);
        }
        .workflow-legend-item.active {
            color: #fff;
        }
        .workflow-legend-dot {
            width: 8px;
            height: 8px;
            border-radius: 2px;
        }

        /* === Detail Panel === */
        .detail-panel {
            width: 340px;
            background: var(--panel-bg);
            border-left: 1px solid var(--border-color);
            display: flex; flex-direction: column;
            transform: translateX(100%);
            transition: transform 0.3s;
            position: absolute; right: 0; top: 0; bottom: 0; z-index: 30;
            box-shadow: -5px 0 20px rgba(0,0,0,0.5);
        }
        .detail-panel.open { transform: translateX(0); }

        .panel-header {
            padding: 15px; border-bottom: 1px solid var(--border-color);
            display: flex; justify-content: space-between; align-items: center;
            background: #21262d;
        }
        .panel-header h2 { margin: 0; font-size: 14px; color: #fff; }

        .panel-content { padding: 15px; overflow-y: auto; flex: 1; }

        .prop-row { 
            display: flex; justify-content: space-between; 
            font-size: 12px; margin-bottom: 8px; color: var(--text-sub); 
        }
        .prop-val { color: var(--text-main); font-weight: 500; }

        .form-group { margin-bottom: 12px; }
        .form-group label { display: block; font-size: 11px; color: var(--text-sub); margin-bottom: 4px; }
        .form-group select, .form-group input {
            width: 100%; padding: 8px; 
            background: #0d1117; border: 1px solid var(--border-color);
            border-radius: 4px; color: var(--text-main); font-size: 12px;
        }
        .form-group select:focus, .form-group input:focus {
            border-color: var(--status-active);
        }

        .checkbox-row {
            display: flex; align-items: center; gap: 8px;
            font-size: 12px; color: var(--text-sub); margin-bottom: 8px;
        }
        .checkbox-row input[type="checkbox"] {
            width: 16px; height: 16px; accent-color: var(--status-active);
        }

        /* Toast Notification */
        .toast {
            position: fixed; bottom: 20px; right: 20px;
            background: #21262d; border: 1px solid var(--border-color);
            border-radius: 8px; padding: 12px 20px;
            display: flex; align-items: center; gap: 10px;
            font-size: 13px; z-index: 100;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
            animation: slideIn 0.3s ease;
        }
        .toast.success { border-left: 3px solid var(--status-ok); }
        .toast.error { border-left: 3px solid var(--status-tc-hold); }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Bulk Edit Panel */
        .bulk-edit-panel {
            position: fixed; bottom: 0; left: 260px; right: 0;
            background: var(--panel-bg);
            border-top: 2px solid var(--status-active);
            padding: 15px 25px;
            display: flex; align-items: center; gap: 20px;
            z-index: 25;
            box-shadow: 0 -4px 12px rgba(0,0,0,0.3);
        }
        .bulk-edit-panel .label { font-size: 13px; color: var(--text-sub); }
        .bulk-edit-panel select {
            padding: 8px 12px; background: #0d1117;
            border: 1px solid var(--border-color);
            border-radius: 4px; color: var(--text-main); font-size: 12px;
        }

        /* === Issue Overlay Zones === */
        .issue-overlay {
            position: absolute;
            pointer-events: none;
            border: 2px dashed;
            z-index: 5;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            text-align: center;
            line-height: 1.2;
            color: #fff;
            text-shadow: 0 0 4px rgba(0,0,0,0.8);
            animation: overlayPulse 2s infinite;
        }
        .issue-overlay.tc { border-color: var(--status-tc-hold); background: rgba(218,54,51,0.15); }
        .issue-overlay.design { border-color: var(--status-design); background: rgba(210,153,34,0.1); }
        .issue-overlay.material { border-color: var(--status-shipping); background: rgba(137,87,229,0.1); }
        
        @keyframes overlayPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* === Issue Panel (Right Sidebar) === */
        .issue-panel {
            width: 320px;
            background: var(--panel-bg);
            border-left: 1px solid var(--border-color);
            display: flex; flex-direction: column;
            transform: translateX(100%);
            transition: transform 0.3s;
            position: fixed; right: 0; top: 55px; bottom: 0; z-index: 28;
            box-shadow: -5px 0 20px rgba(0,0,0,0.5);
        }
        .issue-panel.open { transform: translateX(0); }

        .issue-panel-header {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #21262d;
        }
        .issue-panel-header h3 { margin: 0; font-size: 14px; color: #fff; }

        .issue-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        /* Issue Card */
        .issue-card {
            background: #0d1117;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: border-color 0.2s, transform 0.1s;
        }
        .issue-card:hover {
            border-color: #484f58;
            transform: translateX(2px);
        }
        .issue-card.active {
            border-color: var(--status-active);
            background: rgba(31,111,235,0.1);
        }

        .issue-card-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }
        .issue-severity {
            width: 8px; height: 8px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        .issue-severity.critical { background: var(--status-tc-hold); }
        .issue-severity.high { background: var(--status-design); }
        .issue-severity.medium { background: var(--status-active); }
        .issue-severity.low { background: var(--status-ok); }

        .issue-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-main);
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .issue-type-badge {
            font-size: 9px;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }
        .issue-type-badge.tc { background: var(--status-tc-hold); color: #fff; }
        .issue-type-badge.design { background: var(--status-design); color: #000; }
        .issue-type-badge.material { background: var(--status-shipping); color: #fff; }

        .issue-meta {
            font-size: 10px;
            color: var(--text-sub);
            display: flex;
            justify-content: space-between;
        }

        .issue-affected {
            font-size: 10px;
            color: var(--text-sub);
            margin-top: 6px;
        }

        /* Issue Status Badge */
        .issue-status-badge {
            font-size: 9px;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 500;
        }
        .issue-status-badge.open { background: rgba(218,54,51,0.2); color: #f85149; }
        .issue-status-badge.in_progress { background: rgba(210,153,34,0.2); color: #d29922; }
        .issue-status-badge.resolved { background: rgba(35,134,54,0.2); color: #3fb950; }

        /* Issue Form Modal */
        .issue-modal {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
        }
        .issue-modal-content {
            background: var(--panel-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            width: 450px;
            max-height: 80vh;
            overflow-y: auto;
        }
        .issue-modal-header {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .issue-modal-header h3 { margin: 0; font-size: 14px; color: #fff; }
        .issue-modal-body { padding: 15px; }
        .issue-modal-footer {
            padding: 15px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* === Admin Modal === */
        .admin-modal {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 60;
        }
        .admin-modal-content {
            background: var(--panel-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            width: 700px;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .admin-modal-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #21262d;
        }
        .admin-modal-header h2 { margin: 0; font-size: 16px; color: #fff; }
        
        /* Admin Tabs */
        .admin-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            background: #0d1117;
        }
        .admin-tab {
            padding: 12px 20px;
            font-size: 12px;
            color: var(--text-sub);
            background: none;
            border: none;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }
        .admin-tab:hover { color: var(--text-main); }
        .admin-tab.active {
            color: #fff;
            border-bottom-color: var(--status-active);
        }
        
        .admin-modal-body {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        /* Zone Manager */
        .zone-manager-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .zone-item {
            background: #0d1117;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .zone-color-preview {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        .zone-info { flex: 1; }
        .zone-info h4 { margin: 0 0 4px 0; font-size: 13px; color: #fff; }
        .zone-info p { margin: 0; font-size: 11px; color: var(--text-sub); }
        .zone-range {
            font-size: 11px;
            color: var(--text-sub);
            background: #161b22;
            padding: 4px 8px;
            border-radius: 4px;
        }
        .zone-actions { display: flex; gap: 8px; }

        /* Status Code Manager */
        .status-code-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        .status-code-item {
            background: #0d1117;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .status-dot-preview {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }
        .status-info { flex: 1; }
        .status-info input {
            width: 100%;
            background: transparent;
            border: none;
            color: var(--text-main);
            font-size: 12px;
        }
        .status-info input:focus {
            background: #161b22;
            border-radius: 4px;
            padding: 4px;
        }
        .status-color-input {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        /* Import/Export Section */
        .import-export-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .import-box {
            border: 2px dashed var(--border-color);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .import-box:hover {
            border-color: var(--status-active);
            background: rgba(31,111,235,0.05);
        }
        .import-box.dragover {
            border-color: var(--status-ok);
            background: rgba(35,134,54,0.1);
        }
        .import-box-icon { font-size: 40px; margin-bottom: 10px; }
        .import-box-text { font-size: 13px; color: var(--text-sub); }
        .import-box-hint { font-size: 11px; color: #484f58; margin-top: 8px; }
        
        .export-options {
            display: flex;
            gap: 12px;
        }
        .export-btn {
            flex: 1;
            padding: 15px;
            background: #0d1117;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-main);
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }
        .export-btn:hover {
            border-color: var(--status-active);
            background: rgba(31,111,235,0.1);
        }
        .export-btn-icon { font-size: 24px; display: block; margin-bottom: 8px; }
        .export-btn-label { font-size: 12px; font-weight: 600; }
        .export-btn-hint { font-size: 10px; color: var(--text-sub); margin-top: 4px; }

        /* Excel Export Dropdown Menu */
        .export-btn-wrapper {
            position: relative;
            flex: 1;
        }
        .excel-export-menu {
            position: absolute;
            top: calc(100% + 8px);
            left: 0;
            right: 0;
            min-width: 220px;
            background: var(--panel-bg);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
            z-index: 200;
            overflow: hidden;
        }
        .excel-menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 14px;
            cursor: pointer;
            transition: all 0.15s ease;
            border-bottom: 1px solid var(--border-color);
        }
        .excel-menu-item:last-child { border-bottom: none; }
        .excel-menu-item:hover {
            background: rgba(31, 111, 235, 0.1);
        }
        .excel-menu-item.disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        .excel-menu-item.disabled:hover {
            background: transparent;
        }
        .excel-menu-icon {
            font-size: 16px;
            width: 24px;
            text-align: center;
        }
        .excel-menu-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        .excel-menu-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-main);
        }
        .excel-menu-hint {
            font-size: 10px;
            color: var(--text-sub);
        }
        .excel-menu-divider {
            height: 1px;
            background: var(--border-color);
            margin: 4px 0;
        }

        /* Header Excel Export Button */
        .header-export-btn {
            position: relative;
        }
        .header-export-dropdown {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            min-width: 200px;
            background: var(--panel-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
            z-index: 200;
            overflow: hidden;
        }
        .header-export-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 14px;
            font-size: 12px;
            color: var(--text-sub);
            cursor: pointer;
            transition: all 0.15s ease;
            border-bottom: 1px solid var(--border-color);
        }
        .header-export-item:last-child { border-bottom: none; }
        .header-export-item:hover {
            background: rgba(31, 111, 235, 0.1);
            color: var(--text-main);
        }
        .header-export-item.disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        /* Phase 8: Import Preview Modal */
        .import-preview-modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1100;
        }
        .import-preview-content {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            width: 90%;
            max-width: 900px;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
        }
        .import-preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-color);
        }
        .import-preview-header h2 { margin: 0; font-size: 16px; color: var(--text-main); }
        .import-preview-body {
            flex: 1;
            overflow: auto;
            padding: 20px;
        }
        .import-stats {
            display: flex;
            gap: 16px;
            margin-bottom: 20px;
        }
        .import-stat-item {
            flex: 1;
            background: var(--bg-secondary);
            padding: 12px 16px;
            border-radius: 8px;
            text-align: center;
        }
        .import-stat-value { font-size: 24px; font-weight: 700; color: var(--text-main); }
        .import-stat-label { font-size: 11px; color: var(--text-sub); margin-top: 4px; }
        .import-stat-item.new .import-stat-value { color: #238636; }
        .import-stat-item.update .import-stat-value { color: #1f6feb; }
        .import-stat-item.error .import-stat-value { color: #da3633; }
        .import-preview-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        .import-preview-table th,
        .import-preview-table td {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            text-align: left;
        }
        .import-preview-table th {
            background: var(--bg-secondary);
            color: var(--text-sub);
            font-weight: 600;
            position: sticky;
            top: 0;
        }
        .import-preview-table tr:hover { background: rgba(31,111,235,0.05); }
        .import-row-new { background: rgba(35,134,54,0.1) !important; }
        .import-row-update { background: rgba(31,111,235,0.1) !important; }
        .import-row-error { background: rgba(218,54,51,0.1) !important; }
        .import-mode-select {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }
        .import-mode-btn {
            flex: 1;
            padding: 12px;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-main);
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }
        .import-mode-btn:hover { border-color: var(--status-active); }
        .import-mode-btn.active { border-color: #238636; background: rgba(35,134,54,0.1); }
        .import-mode-icon { font-size: 20px; margin-bottom: 4px; }
        .import-mode-label { font-size: 12px; font-weight: 600; }
        .import-mode-hint { font-size: 10px; color: var(--text-sub); margin-top: 2px; }
        .import-errors {
            background: rgba(218,54,51,0.1);
            border: 1px solid #da3633;
            border-radius: 8px;
            padding: 12px;
            margin-top: 16px;
        }
        .import-errors h4 { margin: 0 0 8px 0; color: #f85149; font-size: 13px; }
        .import-errors ul { margin: 0; padding-left: 20px; font-size: 12px; color: var(--text-sub); }
        .import-preview-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            padding: 16px 20px;
            border-top: 1px solid var(--border-color);
        }
        .import-mapping {
            margin-bottom: 20px;
            padding: 16px;
            background: var(--bg-secondary);
            border-radius: 8px;
        }
        .import-mapping h4 { margin: 0 0 12px 0; font-size: 13px; color: var(--text-main); }
        .import-mapping-row {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }
        .import-mapping-row label { width: 120px; font-size: 12px; color: var(--text-sub); }
        .import-mapping-row select { flex: 1; }

        /* === Phase 9: Import UX Enhancement === */

        /* Drag & Drop Visual Feedback */
        .drop-zone {
            position: relative;
            transition: all 0.25s ease;
        }
        .drop-zone::after {
            content: '';
            position: absolute;
            inset: 0;
            border: 2px dashed transparent;
            border-radius: 8px;
            pointer-events: none;
            transition: all 0.25s ease;
        }
        .drop-zone.dragover {
            background: rgba(31, 111, 235, 0.1) !important;
        }
        .drop-zone.dragover::after {
            border-color: #1f6feb;
            animation: dropzone-pulse 1s infinite;
        }
        @keyframes dropzone-pulse {
            0%, 100% { border-color: #1f6feb; }
            50% { border-color: #58a6ff; }
        }

        /* Drop Zone Icon Animation */
        .drop-zone.dragover .drop-icon {
            animation: drop-bounce 0.5s infinite;
        }
        @keyframes drop-bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }

        /* Loading Overlay for Import */
        .import-loading-overlay {
            position: absolute;
            inset: 0;
            background: rgba(13, 17, 23, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 16px;
            z-index: 10;
            border-radius: 12px;
        }
        .import-spinner {
            width: 48px;
            height: 48px;
            border: 3px solid rgba(31, 111, 235, 0.2);
            border-top-color: #1f6feb;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .import-loading-text {
            font-size: 14px;
            color: #c9d1d9;
        }
        .import-loading-progress {
            font-size: 24px;
            font-weight: bold;
            color: #58a6ff;
        }

        /* File Type Badge */
        .file-type-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        .file-type-badge.csv {
            background: rgba(46, 160, 67, 0.2);
            color: #3fb950;
        }
        .file-type-badge.json {
            background: rgba(210, 153, 34, 0.2);
            color: #d29922;
        }
        .file-type-badge.excel {
            background: rgba(35, 134, 54, 0.2);
            color: #238636;
        }

        /* Drop Zone Enhanced Hint */
        .drop-hint {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 40px 20px;
            border: 2px dashed var(--border-color);
            border-radius: 12px;
            background: rgba(0,0,0,0.2);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .drop-hint:hover {
            border-color: #1f6feb;
            background: rgba(31, 111, 235, 0.05);
        }
        .drop-hint.dragover {
            border-color: #58a6ff;
            background: rgba(31, 111, 235, 0.15);
            transform: scale(1.02);
        }
        .drop-hint-icon {
            font-size: 48px;
            opacity: 0.6;
        }
        .drop-hint-text {
            font-size: 14px;
            color: var(--text-sub);
        }
        .drop-hint-text strong {
            color: #58a6ff;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .bulk-edit-panel { left: 0; }
            .admin-modal-content { width: 95%; margin: 10px; }
            .status-code-grid { grid-template-columns: 1fr; }
        }

        /* === Phase 7: Ïã§ÏãúÍ∞Ñ ÏïåÎ¶º ÏãúÏä§ÌÖú === */
        
        /* ÏïåÎ¶º Ïª®ÌÖåÏù¥ÎÑà */
        .notification-container {
            position: fixed;
            top: 70px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 380px;
            pointer-events: none;
        }

        /* Í∞úÎ≥Ñ ÏïåÎ¶º Toast */
        .notification-toast {
            background: linear-gradient(135deg, #161b22 0%, #0d1117 100%);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 14px 18px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
            display: flex;
            align-items: flex-start;
            gap: 12px;
            pointer-events: auto;
            animation: slideInRight 0.3s ease-out;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .notification-toast:hover {
            transform: translateX(-5px);
            border-color: #484f58;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        .notification-toast.closing {
            animation: slideOutRight 0.3s ease-in forwards;
        }

        /* ÏïåÎ¶º ÏïÑÏù¥ÏΩò */
        .notification-icon {
            font-size: 20px;
            flex-shrink: 0;
        }

        /* ÏïåÎ¶º Î≥∏Î¨∏ */
        .notification-content {
            flex: 1;
            min-width: 0;
        }
        .notification-title {
            font-size: 13px;
            font-weight: 600;
            color: #fff;
            margin-bottom: 4px;
        }
        .notification-message {
            font-size: 12px;
            color: var(--text-sub);
            line-height: 1.4;
            word-break: keep-all;
        }
        .notification-time {
            font-size: 10px;
            color: #484f58;
            margin-top: 6px;
        }

        /* ÏïåÎ¶º Îã´Í∏∞ Î≤ÑÌäº */
        .notification-close {
            background: none;
            border: none;
            color: #484f58;
            cursor: pointer;
            font-size: 16px;
            padding: 0;
            opacity: 0.6;
            transition: opacity 0.2s;
        }
        .notification-close:hover {
            opacity: 1;
            color: #f85149;
        }

        /* Í∏¥Í∏âÎèÑÎ≥Ñ Ïä§ÌÉÄÏùº */
        .notification-toast.success {
            border-left: 4px solid #238636;
        }
        .notification-toast.success .notification-icon { color: #238636; }

        .notification-toast.info {
            border-left: 4px solid #1f6feb;
        }
        .notification-toast.info .notification-icon { color: #1f6feb; }

        .notification-toast.warning {
            border-left: 4px solid #d29922;
        }
        .notification-toast.warning .notification-icon { color: #d29922; }

        .notification-toast.error {
            border-left: 4px solid #da3633;
        }
        .notification-toast.error .notification-icon { color: #da3633; }

        .notification-toast.critical {
            border-left: 4px solid #f85149;
            background: linear-gradient(135deg, #2d1f1f 0%, #1a0d0d 100%);
            animation: slideInRight 0.3s ease-out, urgentPulse 1s infinite;
        }
        .notification-toast.critical .notification-icon { color: #f85149; }

        @keyframes urgentPulse {
            0%, 100% { box-shadow: 0 8px 32px rgba(248,81,73,0.2); }
            50% { box-shadow: 0 8px 32px rgba(248,81,73,0.5); }
        }

        /* ÏïåÎ¶º ÌûàÏä§ÌÜ†Î¶¨ Î≤ÑÌäº */
        .notification-bell {
            position: relative;
            cursor: pointer;
        }
        .notification-badge {
            position: absolute;
            top: -6px;
            right: -6px;
            background: #da3633;
            color: #fff;
            font-size: 10px;
            font-weight: bold;
            min-width: 18px;
            height: 18px;
            border-radius: 9px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: badgePop 0.3s ease;
        }
        @keyframes badgePop {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        /* ÏïåÎ¶º ÌûàÏä§ÌÜ†Î¶¨ Ìå®ÎÑê */
        .notification-history-panel {
            position: fixed;
            top: 55px;
            right: 0;
            width: 360px;
            max-height: calc(100vh - 60px);
            background: var(--panel-bg);
            border-left: 1px solid var(--border-color);
            z-index: 30;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
            box-shadow: -5px 0 25px rgba(0,0,0,0.3);
        }
        .notification-history-panel.open {
            transform: translateX(0);
        }
        .notification-history-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #21262d;
        }
        .notification-history-header h3 {
            margin: 0;
            font-size: 14px;
            color: #fff;
        }
        .notification-history-actions {
            display: flex;
            gap: 10px;
        }
        .notification-history-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }
        .notification-history-item {
            padding: 12px;
            border-radius: 8px;
            background: #0d1117;
            border: 1px solid var(--border-color);
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .notification-history-item:hover {
            border-color: #484f58;
            transform: translateX(3px);
        }
        .notification-history-item.unread {
            border-left: 3px solid #1f6feb;
            background: rgba(31,111,235,0.05);
        }
        .notification-history-empty {
            text-align: center;
            padding: 40px 20px;
            color: #484f58;
        }

        /* === Phase 9: ÏûÖÎ©¥ Î∑∞Ïñ¥ (Elevation Viewer) === */
        .elevation-viewer {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }
        .elevation-viewer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        .elevation-viewer-header h3 {
            margin: 0;
            font-size: 14px;
            font-weight: 600;
            color: #c9d1d9;
        }
        .elevation-viewer-toggle {
            font-size: 11px;
            padding: 4px 10px;
            cursor: pointer;
        }
        .elevation-grid {
            display: grid;
            grid-template-columns: 50px repeat(8, 1fr);
            gap: 2px;
            font-size: 10px;
        }
        .elevation-row {
            display: contents;
        }
        .elevation-floor-label {
            background: #21262d;
            color: #8b949e;
            padding: 8px 4px;
            text-align: center;
            font-weight: 600;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .elevation-floor-label.selected {
            background: #1f6feb;
            color: #fff;
        }
        .elevation-cell {
            background: #161b22;
            border: 1px solid var(--border-color);
            padding: 6px 4px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 3px;
            min-height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .elevation-cell:hover {
            border-color: #1f6feb;
            background: rgba(31, 111, 235, 0.1);
        }
        .elevation-cell.has-issue {
            background: rgba(218, 54, 51, 0.15);
            border-color: #da3633;
        }
        .elevation-cell.complete {
            background: rgba(35, 134, 54, 0.15);
            border-color: #238636;
        }
        .elevation-cell.in-progress {
            background: rgba(31, 111, 235, 0.15);
            border-color: #1f6feb;
        }
        .elevation-cell.selected {
            box-shadow: 0 0 0 2px #1f6feb;
        }
        .elevation-jeolju-header {
            background: #21262d;
            color: #8b949e;
            padding: 6px 4px;
            text-align: center;
            font-weight: 600;
            font-size: 9px;
            border-radius: 4px;
        }
        .elevation-legend {
            display: flex;
            gap: 16px;
            margin-top: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .elevation-legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 10px;
            color: #8b949e;
        }
        .elevation-legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 2px;
        }
        .elevation-legend-dot.complete { background: #238636; }
        .elevation-legend-dot.in-progress { background: #1f6feb; }
        .elevation-legend-dot.has-issue { background: #da3633; }
        .elevation-legend-dot.pending { background: #484f58; }

        /* === Phase 7: Î™®Î∞îÏùº ÏµúÏ†ÅÌôî === */

        /* ÌÑ∞Ïπò ÏπúÌôîÏ†Å Î≤ÑÌäº (ÏµúÏÜå 44x44px) */
        .touch-target {
            min-width: 44px;
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Î™®Î∞îÏùº Ï†ÑÏö© Ïä§ÌÉÄÏùº */
        @media (max-width: 768px) {
            /* Ìó§Îçî ÏµúÏ†ÅÌôî */
            header {
                flex-wrap: wrap;
                padding: 10px 12px;
                gap: 8px;
            }
            header .brand h1 {
                font-size: 14px;
            }
            header .brand .project-tag {
                font-size: 9px;
                padding: 2px 6px;
            }
            
            /* ÏßÑÌñâÎ•† ÏöîÏïΩ Ïà®ÍπÄ (Î™®Î∞îÏùºÏóêÏÑú Í≥µÍ∞Ñ Ï†àÏïΩ) */
            .progress-summary {
                display: none !important;
            }
            
            /* Î≤ÑÌäº ÏµúÏ†ÅÌôî */
            header .controls {
                width: 100%;
                justify-content: flex-start;
                flex-wrap: wrap;
                gap: 6px;
            }
            header .controls .btn {
                min-height: 40px;
                padding: 8px 12px;
                font-size: 12px;
            }
            
            /* ÌÜµÍ≥Ñ Î∞ïÏä§ Ïà®ÍπÄ */
            header .stat-box {
                display: none;
            }
            
            /* Í∑∏Î¶¨Îìú Î∑∞ ÏµúÏ†ÅÌôî */
            .grid-scroll-view {
                padding: 15px;
            }
            .grid-container {
                gap: 3px;
            }
            .grid-cell {
                width: 28px !important;
                height: 28px !important;
            }
            .grid-cell-header {
                font-size: 8px;
            }
            
            /* ÏÇ¨Ïù¥ÎìúÎ∞î Ïä¨ÎùºÏù¥Îìú Ïò§Î≤ÑÎ†àÏù¥ */
            .sidebar {
                position: fixed;
                top: 55px;
                left: 0;
                bottom: 60px;
                width: 280px;
                z-index: 45;
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                box-shadow: 5px 0 25px rgba(0,0,0,0.5);
            }
            .sidebar.open {
                transform: translateX(0);
            }
            
            /* Ïù¥Ïäà Ìå®ÎÑê ÌíÄÏä§ÌÅ¨Î¶∞ */
            .issue-panel {
                width: 100vw !important;
                border-radius: 0;
            }
            .issue-panel .panel-header h3 {
                font-size: 14px;
            }
            .issue-card {
                padding: 12px;
            }
            
            /* ÏïåÎ¶º Ìå®ÎÑê ÌíÄÏä§ÌÅ¨Î¶∞ */
            .notification-history-panel {
                width: 100vw;
            }
            
            /* Í¥ÄÎ¶¨Ïûê Î™®Îã¨ ÌíÄÏä§ÌÅ¨Î¶∞ */
            .admin-modal-content {
                width: 100vw !important;
                height: 100vh !important;
                max-height: 100vh !important;
                border-radius: 0;
                margin: 0;
            }
            
            /* Î™®Î∞îÏùº Ï†ÑÏö© ÌïòÎã® ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò */
            .mobile-nav {
                display: flex !important;
            }
            
            /* Zone ÌëúÏãúÏ§Ñ ÌÑ∞Ïπò ÏµúÏ†ÅÌôî */
            .zone-segment {
                min-height: 36px;
                font-size: 12px;
            }

            /* Import Preview Modal Î™®Î∞îÏùº Î∞òÏùëÌòï */
            .import-preview-content {
                width: 100vw !important;
                height: 100vh !important;
                max-height: 100% !important;
                border-radius: 0;
                margin: 0;
            }
            .import-mode-select {
                flex-direction: column;
                gap: 8px;
            }
            .import-mode-btn {
                flex: none;
                width: 100%;
            }
            .import-preview-table {
                font-size: 11px;
            }
            .import-stats {
                flex-wrap: wrap;
                gap: 8px;
            }
            .import-stat-item {
                flex: 1 1 22%;
                min-width: 70px;
            }

            /* ÌûàÏä§ÌÜ†Î¶¨ Ìå®ÎÑê Î™®Î∞îÏùº */
            .history-panel {
                width: 100vw;
            }

            /* === Touch Target Optimization === */
            .btn {
                min-height: 44px;
                min-width: 44px;
                padding: 10px 16px;
                font-size: 14px;
            }

            .floor-item,
            .jeolju-item,
            .status-item {
                min-height: 44px;
                padding: 12px;
            }

            input, select, textarea {
                min-height: 44px;
                font-size: 16px; /* Prevents iOS zoom */
            }

            .grid-cell {
                min-height: 36px;
            }

            .notification-item,
            .history-item {
                min-height: 48px;
                padding: 12px;
            }
        }

        /* Touch Target Base Class */
        .touch-target {
            min-height: 44px;
            min-width: 44px;
        }

        /* Prevent hover states on touch devices */
        @media (hover: none) {
            .btn:hover {
                background: var(--border-color);
            }
            .grid-cell:hover {
                transform: none;
            }
        }

        /* ÏÇ¨Ïù¥ÎìúÎ∞î Î∞±ÎìúÎ°≠ Ïò§Î≤ÑÎ†àÏù¥ */
        .sidebar-backdrop {
            display: none;
            position: fixed;
            inset: 0;
            top: 55px;
            bottom: 60px;
            background: rgba(0,0,0,0.5);
            z-index: 44;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .sidebar-backdrop.open {
            display: block;
            opacity: 1;
        }
        @media (min-width: 769px) {
            .sidebar-backdrop {
                display: none !important;
            }
        }

        /* === Phase 9: History Panel === */
        .history-panel {
            position: fixed;
            top: 55px;
            right: 0;
            width: 380px;
            height: calc(100vh - 55px);
            background: var(--panel-bg);
            border-left: 1px solid var(--border-color);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 35;
            display: flex;
            flex-direction: column;
            box-shadow: -5px 0 25px rgba(0,0,0,0.4);
        }
        .history-panel.open {
            transform: translateX(0);
        }
        .history-panel-header {
            padding: 16px;
            background: #21262d;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .history-panel-header h3 {
            margin: 0;
            font-size: 14px;
            color: #fff;
        }
        .history-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        .history-filter-select {
            padding: 4px 8px;
            background: #0d1117;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-main);
            font-size: 11px;
        }
        .history-panel-body {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
        }
        .history-date-group {
            margin-bottom: 16px;
        }
        .history-date-label {
            font-size: 11px;
            color: #8b949e;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            padding: 4px 8px;
            background: rgba(0,0,0,0.2);
            border-radius: 4px;
        }
        .history-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #0d1117;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .history-item:hover {
            border-color: #484f58;
            transform: translateX(3px);
        }
        .history-item-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }
        .history-item-icon.status { background: rgba(31, 111, 235, 0.2); }
        .history-item-icon.issue { background: rgba(218, 54, 51, 0.2); }
        .history-item-icon.lock { background: rgba(210, 153, 34, 0.2); }
        .history-item-icon.import { background: rgba(35, 134, 54, 0.2); }
        .history-item-content {
            flex: 1;
            min-width: 0;
        }
        .history-item-title {
            font-size: 13px;
            color: #c9d1d9;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .history-item-meta {
            font-size: 11px;
            color: #8b949e;
            display: flex;
            gap: 6px;
            margin-top: 2px;
        }
        .history-item-badge {
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
        }
        .history-item-badge.status { background: rgba(31, 111, 235, 0.3); color: #58a6ff; }
        .history-item-badge.issue { background: rgba(218, 54, 51, 0.3); color: #f85149; }
        .history-item-badge.lock { background: rgba(210, 153, 34, 0.3); color: #d29922; }
        .history-item-badge.import { background: rgba(35, 134, 54, 0.3); color: #3fb950; }
        .history-empty {
            text-align: center;
            padding: 60px 20px;
            color: #8b949e;
        }
        .history-empty span {
            font-size: 48px;
            display: block;
            margin-bottom: 16px;
            opacity: 0.5;
        }
        .history-panel-footer {
            padding: 12px 16px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }

        /* ÌÉúÎ∏îÎ¶ø ÏµúÏ†ÅÌôî (768px ~ 1024px) */
        @media (min-width: 769px) and (max-width: 1024px) {
            header .brand h1 {
                font-size: 16px;
            }
            .progress-summary .stage-mini {
                min-width: 50px;
            }
            .grid-cell {
                width: 24px !important;
                height: 24px !important;
            }
        }

        /* ÌÑ∞Ïπò Ïù∏ÌÑ∞ÎûôÏÖò ÌûåÌä∏ */
        .swipe-hint {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: #fff;
            padding: 12px 20px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 100;
            animation: fadeInOut 3s ease-in-out forwards;
        }
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateX(-50%) translateY(20px); }
            20% { opacity: 1; transform: translateX(-50%) translateY(0); }
            80% { opacity: 1; }
            100% { opacity: 0; }
        }

        /* === WP-1: FAB (Floating Action Button) === */
        .fab-container {
            position: fixed;
            right: 20px;
            bottom: 80px;
            z-index: 90;
            display: flex;
            flex-direction: column-reverse;
            align-items: center;
            gap: 12px;
        }

        @media (max-width: 768px) {
            .fab-container {
                bottom: 130px; /* Above mobile nav */
            }
        }

        .fab-main {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, #1f6feb 0%, #238636 100%);
            border: none;
            color: #fff;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(31, 111, 235, 0.4);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fab-main:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(31, 111, 235, 0.5);
        }

        .fab-main:active {
            transform: scale(0.95);
        }

        .fab-main.open {
            transform: rotate(45deg);
            background: linear-gradient(135deg, #da3633 0%, #d29922 100%);
        }

        .fab-actions {
            display: flex;
            flex-direction: column-reverse;
            gap: 10px;
            opacity: 0;
            pointer-events: none;
            transform: translateY(20px);
            transition: all 0.3s ease;
        }

        .fab-actions.open {
            opacity: 1;
            pointer-events: auto;
            transform: translateY(0);
        }

        .fab-action {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .fab-action-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--panel-bg);
            border: 1px solid var(--border-color);
            color: var(--text-main);
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fab-action-btn:hover {
            background: var(--status-active);
            border-color: var(--status-active);
            transform: scale(1.1);
        }

        .fab-action-btn.success:hover {
            background: var(--status-ok);
            border-color: var(--status-ok);
        }

        .fab-action-btn.warning:hover {
            background: var(--status-design);
            border-color: var(--status-design);
        }

        .fab-action-label {
            background: rgba(0, 0, 0, 0.8);
            color: #fff;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        /* === WP-1: Touch Drag Selection Overlay === */
        .touch-drag-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 50;
        }

        .touch-drag-rect {
            position: absolute;
            background: rgba(31, 111, 235, 0.2);
            border: 2px dashed #1f6feb;
            border-radius: 4px;
            pointer-events: none;
        }

        .touch-select-hint {
            position: fixed;
            bottom: 140px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(31, 111, 235, 0.9);
            color: #fff;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 13px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 60;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        @media (max-width: 768px) {
            .touch-select-hint {
                bottom: 190px;
            }
        }

        /* Î™®Î∞îÏùº ÌïòÎã® ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò Î∞î */
        .mobile-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 56px;
            background: #161b22;
            border-top: 1px solid var(--border-color);
            z-index: 50;
            justify-content: space-around;
            align-items: center;
            padding-bottom: env(safe-area-inset-bottom);
        }
        .mobile-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 16px;
            color: #8b949e;
            font-size: 10px;
            cursor: pointer;
            transition: color 0.2s;
            min-width: 60px;
        }
        .mobile-nav-item.active {
            color: #1f6feb;
        }
        .mobile-nav-item .nav-icon {
            font-size: 20px;
        }
        .mobile-nav-item .nav-badge {
            position: absolute;
            top: 2px;
            right: 8px;
            background: #da3633;
            color: #fff;
            font-size: 9px;
            min-width: 14px;
            height: 14px;
            border-radius: 7px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* ÌïÄÏπò Ï§å ÌûåÌä∏ */
        .pinch-zoom-container {
            touch-action: pinch-zoom pan-x pan-y;
        }

        /* Î™®Î∞îÏùºÏóêÏÑú Î≥∏Î¨∏ ÌïòÎã® Ïó¨Î∞± (ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò Î∞î ÎÜíÏù¥) */
        @media (max-width: 768px) {
            body {
                padding-bottom: 60px;
            }
        }

        /* === Phase 7: Ïã§ÏãúÍ∞Ñ ÏïåÎ¶º ÏãúÏä§ÌÖú === */
        
        .notification-container {
            position: fixed;
            top: 70px;
            right: 20px;
            width: 320px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none;
        }

        .notification-toast {
            background: #161b22;
            border: 1px solid var(--border-color);
            border-left: 4px solid var(--status-active);
            border-radius: 6px;
            padding: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            display: flex;
            gap: 12px;
            pointer-events: auto;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .notification-toast.closing {
            opacity: 0;
            transform: translateX(100%);
        }
        
        .notification-toast.success { border-left-color: var(--status-ok); }
        .notification-toast.warning { border-left-color: var(--status-design); }
        .notification-toast.error { border-left-color: var(--status-tc-hold); }
        .notification-toast.critical { 
            border-left-color: #f85149; 
            background: #2a0f0f; 
            animation: pulse-border 2s infinite;
        }
        
        @keyframes pulse-border {
            0% { box-shadow: 0 0 0 0 rgba(248, 81, 73, 0.4); }
            70% { box-shadow: 0 0 0 6px rgba(248, 81, 73, 0); }
            100% { box-shadow: 0 0 0 0 rgba(248, 81, 73, 0); }
        }

        .notification-icon { font-size: 16px; flex-shrink: 0; margin-top: 2px; }
        .notification-content { flex: 1; min-width: 0; }
        .notification-title { font-size: 13px; font-weight: bold; margin-bottom: 4px; color: #c9d1d9; }
        .notification-message { font-size: 12px; color: #8b949e; line-height: 1.4; }
        .notification-time { font-size: 10px; color: #484f58; margin-top: 6px; }
        
        .notification-close {
            background: none; border: none; color: #484f58; cursor: pointer;
            padding: 4px; position: absolute; top: 8px; right: 8px;
            transition: color 0.2s;
        }
        .notification-close:hover { color: #f85149; }

        /* ÏïåÎ¶º ÌûàÏä§ÌÜ†Î¶¨ Ìå®ÎÑê */
        .notification-history-panel {
            position: fixed;
            top: 55px;
            right: 0;
            width: 320px;
            height: calc(100vh - 55px);
            background: var(--panel-bg);
            border-left: 1px solid var(--border-color);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 90;
            display: flex;
            flex-direction: column;
        }
        .notification-history-panel.open {
            transform: translateX(0);
        }

        .notification-history-header {
            padding: 16px;
            background: #21262d;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .notification-history-header h3 { margin: 0; font-size: 14px; color: #fff; }
        .notification-history-actions { display: flex; gap: 8px; }

        .notification-history-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .notification-history-item {
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
            background: #0d1117;
            margin-bottom: 8px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .notification-history-item:hover { background: #161b22; }
        .notification-history-item.unread { border-left: 3px solid #1f6feb; }
        
        .notification-history-empty {
            text-align: center;
            padding: 40px 20px;
            color: #484f58;
            font-size: 13px;
        }
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #da3633;
            color: #fff;
            font-size: 10px;
            font-weight: bold;
            padding: 2px 5px;
            border-radius: 10px;
            border: 2px solid #161b22;
        }
        .notification-bell {
            position: relative;
            cursor: pointer;
        }

        /* === Phase 7: Ïä§ÎßàÌä∏ Í≤ÄÏÉâ & ÌïÑÌÑ∞ === */

        /* Í≤ÄÏÉâ Ìå®ÎÑê */
        .search-panel {
            position: relative;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .search-input-wrapper {
            position: relative;
            flex: 1;
        }

        .search-input {
            width: 100%;
            background: #0d1117;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 10px 40px 10px 38px;
            color: #c9d1d9;
            font-size: 13px;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .search-input:focus {
            outline: none;
            border-color: #1f6feb;
            box-shadow: 0 0 0 3px rgba(31,111,235,0.2);
        }
        .search-input::placeholder {
            color: #484f58;
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 14px;
            color: #484f58;
        }

        .search-clear-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #484f58;
            cursor: pointer;
            font-size: 14px;
            padding: 4px;
            border-radius: 4px;
            transition: color 0.2s;
        }
        .search-clear-btn:hover {
            color: #f85149;
        }

        /* Í≤ÄÏÉâ Í≤∞Í≥º ÎìúÎ°≠Îã§Ïö¥ */
        .search-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #161b22;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-top: 4px;
            max-height: 320px;
            overflow-y: auto;
            z-index: 100;
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
        }

        .search-dropdown-section {
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }
        .search-dropdown-section:last-child {
            border-bottom: none;
        }

        .search-dropdown-label {
            font-size: 10px;
            color: #8b949e;
            text-transform: uppercase;
            padding: 4px 12px;
            letter-spacing: 0.5px;
        }

        .search-dropdown-item {
            padding: 10px 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: background 0.2s;
        }
        .search-dropdown-item:hover {
            background: rgba(31,111,235,0.1);
        }
        .search-dropdown-item.selected {
            background: rgba(31,111,235,0.2);
        }

        .search-item-icon {
            font-size: 14px;
            width: 24px;
            text-align: center;
        }
        .search-item-text {
            flex: 1;
            font-size: 12px;
            color: #c9d1d9;
        }
        .search-item-hint {
            font-size: 11px;
            color: #484f58;
        }

        /* ÌïÑÌÑ∞ Ïπ© */
        .filter-chips {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-top: 8px;
        }

        .filter-chip {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: rgba(31,111,235,0.15);
            border: 1px solid rgba(31,111,235,0.3);
            color: #58a6ff;
            padding: 4px 10px;
            border-radius: 16px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .filter-chip:hover {
            background: rgba(31,111,235,0.25);
        }
        .filter-chip.active {
            background: #1f6feb;
            color: #fff;
            border-color: #1f6feb;
        }
        .filter-chip .chip-remove {
            font-size: 12px;
            opacity: 0.7;
        }
        .filter-chip .chip-remove:hover {
            opacity: 1;
            color: #f85149;
        }

        /* ÏµúÍ∑º Í≤ÄÏÉâ */
        .recent-searches {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }
        .recent-search-tag {
            background: #21262d;
            border: 1px solid var(--border-color);
            color: #8b949e;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .recent-search-tag:hover {
            background: #30363d;
            color: #c9d1d9;
        }

        /* Í≤ÄÏÉâ Í≤∞Í≥º ÌïòÏù¥ÎùºÏù¥Ìä∏ */
        .search-highlight {
            background: rgba(210,153,34,0.3);
            padding: 0 2px;
            border-radius: 2px;
        }

        /* Í≤ÄÏÉâ Í≤∞Í≥º Ïπ¥Ïö¥Ìä∏ */
        .search-results-count {
            font-size: 11px;
            color: #8b949e;
            padding: 8px 12px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
        }

        /* === Phase 7: ÎåÄÏãúÎ≥¥Îìú ÏöîÏïΩ Ìå®ÎÑê === */

        /* ÏöîÏïΩ Ìå®ÎÑê ÌÜ†Í∏Ä Î≤ÑÌäº */
        .summary-toggle-btn {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, #238636 0%, #1a6e2e 100%);
            border: none;
            color: #fff;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(35,134,54,0.4);
            z-index: 40;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .summary-toggle-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 28px rgba(35,134,54,0.5);
        }
        @media (max-width: 768px) {
            .summary-toggle-btn {
                bottom: 70px;
                right: 15px;
                width: 48px;
                height: 48px;
                font-size: 20px;
            }
        }

        /* ÏöîÏïΩ Ìå®ÎÑê Ïò§Î≤ÑÎ†àÏù¥ */
        .summary-panel-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 45;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        .summary-panel-overlay.open {
            opacity: 1;
            visibility: visible;
        }

        /* ÏöîÏïΩ Ìå®ÎÑê */
        .summary-panel {
            position: fixed;
            top: 55px;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            width: 90%;
            max-width: 900px;
            max-height: calc(100vh - 100px);
            background: var(--panel-bg);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            z-index: 50;
            overflow: hidden;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }
        .summary-panel.open {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(0);
        }

        .summary-panel-header {
            padding: 16px 20px;
            background: #21262d;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .summary-panel-header h2 {
            margin: 0;
            font-size: 16px;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .summary-panel-body {
            padding: 20px;
            overflow-y: auto;
            max-height: calc(100vh - 200px);
        }

        /* ÏöîÏïΩ Í∑∏Î¶¨Îìú */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
        }

        /* ÏöîÏïΩ Ïπ¥Îìú */
        .summary-card {
            background: #0d1117;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 16px;
        }
        .summary-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        .summary-card-title {
            font-size: 12px;
            color: #8b949e;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .summary-card-icon {
            font-size: 18px;
        }

        /* ÏßÑÌñâÎ•† ÎèÑÎÑõ Ï∞®Ìä∏ */
        .donut-chart {
            position: relative;
            width: 120px;
            height: 120px;
            margin: 0 auto 12px;
        }
        .donut-chart svg {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }
        .donut-chart circle {
            fill: none;
            stroke-width: 12;
        }
        .donut-chart .bg {
            stroke: #21262d;
        }
        .donut-chart .progress {
            stroke: #238636;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.5s ease;
        }
        .donut-chart .center-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
        .donut-center-value {
            font-size: 28px;
            font-weight: bold;
            color: #fff;
        }
        .donut-center-label {
            font-size: 10px;
            color: #8b949e;
        }

        /* Í≥µÏ†ïÎ≥Ñ ÏßÑÌñâÎ•† Î∞î */
        .stage-progress-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .stage-progress-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .stage-progress-label {
            font-size: 11px;
            color: #8b949e;
            width: 60px;
            flex-shrink: 0;
        }
        .stage-progress-bar {
            flex: 1;
            height: 8px;
            background: #21262d;
            border-radius: 4px;
            overflow: hidden;
        }
        .stage-progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        .stage-progress-value {
            font-size: 11px;
            font-weight: bold;
            color: #fff;
            width: 40px;
            text-align: right;
        }

        /* Ïò§Îäò ÌÉÄÏûÑÎùºÏù∏ */
        .today-timeline {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .timeline-item {
            display: flex;
            gap: 12px;
            padding: 10px;
            background: rgba(31,111,235,0.05);
            border-radius: 8px;
            border-left: 3px solid #1f6feb;
        }
        .timeline-time {
            font-size: 10px;
            color: #8b949e;
            width: 50px;
            flex-shrink: 0;
        }
        .timeline-content {
            flex: 1;
            font-size: 12px;
            color: #c9d1d9;
        }
        .timeline-empty {
            text-align: center;
            padding: 20px;
            color: #484f58;
            font-size: 12px;
        }

        /* TOP Ïù¥Ïäà Î™©Î°ù */
        .top-issues-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .top-issue-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(218,54,51,0.05);
            border-radius: 8px;
            border-left: 3px solid #da3633;
            cursor: pointer;
            transition: background 0.2s;
        }
        .top-issue-item:hover {
            background: rgba(218,54,51,0.1);
        }
        .top-issue-severity {
            font-size: 12px;
        }
        .top-issue-title {
            flex: 1;
            font-size: 12px;
            color: #c9d1d9;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .top-issue-count {
            font-size: 10px;
            color: #8b949e;
            background: #21262d;
            padding: 2px 8px;
            border-radius: 10px;
        }

        /* Zone ÎπÑÍµê Ï∞®Ìä∏ */
        .zone-compare-chart {
            display: flex;
            align-items: flex-end;
            gap: 8px;
            height: 100px;
            padding-top: 10px;
        }
        .zone-bar-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
        }
        .zone-bar {
            width: 100%;
            background: #21262d;
            border-radius: 4px 4px 0 0;
            position: relative;
            min-height: 10px;
            transition: height 0.5s ease;
        }
        .zone-bar-fill {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            border-radius: 4px 4px 0 0;
            transition: height 0.5s ease;
        }
        .zone-bar-label {
            font-size: 9px;
            color: #8b949e;
        }
        .zone-bar-value {
            font-size: 10px;
            font-weight: bold;
            color: #fff;
        }

        @media (max-width: 768px) {
            .summary-panel {
                width: 95%;
                top: 10px;
                max-height: calc(100vh - 80px);
            }
            .summary-grid {
                grid-template-columns: 1fr;
            }
        }

        /* === Phase 7: Îπ†Î•∏ ÏÉÅÌÉú Î≥ÄÍ≤Ω (Quick Actions) === */

        /* ÏÑ†ÌÉùÎêú Í∏∞Îë•Ïö© ÌîåÎ°úÌåÖ Ïï°ÏÖò Î∞î */
        .quick-action-bar {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: linear-gradient(135deg, #21262d 0%, #161b22 100%);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 45;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        .quick-action-bar.visible {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
            visibility: visible;
        }

        .quick-action-info {
            display: flex;
            align-items: center;
            gap: 8px;
            padding-right: 12px;
            border-right: 1px solid var(--border-color);
        }
        .quick-action-count {
            background: #1f6feb;
            color: #fff;
            font-size: 12px;
            font-weight: bold;
            padding: 4px 10px;
            border-radius: 12px;
        }
        .quick-action-label {
            font-size: 12px;
            color: #8b949e;
        }

        .quick-action-buttons {
            display: flex;
            gap: 8px;
        }

        .quick-action-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background: #0d1117;
            color: #c9d1d9;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .quick-action-btn:hover {
            background: #21262d;
            border-color: #484f58;
        }
        .quick-action-btn.primary {
            background: #238636;
            border-color: #238636;
            color: #fff;
        }
        .quick-action-btn.primary:hover {
            background: #2ea043;
        }
        .quick-action-btn.danger {
            border-color: #da3633;
            color: #f85149;
        }
        .quick-action-btn.danger:hover {
            background: rgba(218,54,51,0.1);
        }

        .quick-action-dropdown {
            position: relative;
        }
        .quick-action-menu {
            position: absolute;
            bottom: 100%;
            left: 0;
            margin-bottom: 8px;
            background: #161b22;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            min-width: 180px;
            overflow: hidden;
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
            transition: all 0.2s ease;
            box-shadow: 0 8px 24px rgba(0,0,0,0.4);
        }
        .quick-action-dropdown:hover .quick-action-menu {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        .quick-action-menu-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 14px;
            font-size: 12px;
            color: #c9d1d9;
            cursor: pointer;
            transition: background 0.2s;
        }
        .quick-action-menu-item:hover {
            background: rgba(31,111,235,0.1);
        }
        .quick-action-menu-divider {
            height: 1px;
            background: var(--border-color);
            margin: 4px 0;
        }

        /* Í≥µÏ†ï ÏÑ†ÌÉù Î©îÎâ¥ */
        .stage-select-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
            padding: 10px;
        }
        .stage-select-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 10px 8px;
            background: #0d1117;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .stage-select-item:hover {
            border-color: #484f58;
            transform: translateY(-2px);
        }
        .stage-select-item .stage-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        .stage-select-item .stage-name {
            font-size: 10px;
            color: #8b949e;
            text-align: center;
        }

        /* ÌÇ§Î≥¥Îìú Îã®Ï∂ïÌÇ§ ÌûåÌä∏ */
        .keyboard-hint {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 18px;
            height: 18px;
            padding: 0 4px;
            background: #21262d;
            border: 1px solid #484f58;
            border-radius: 4px;
            font-size: 10px;
            color: #8b949e;
            font-family: monospace;
        }

        @media (max-width: 768px) {
            .quick-action-bar {
                width: 95%;
                padding: 10px 15px;
                bottom: 65px;
                flex-wrap: wrap;
                justify-content: center;
            }
            .quick-action-info {
                border-right: none;
                padding-right: 0;
                width: 100%;
                justify-content: center;
                margin-bottom: 8px;
            }
            .quick-action-buttons {
                flex-wrap: wrap;
                justify-content: center;
            }
            .keyboard-hint {
                display: none;
            }
        }

        /* === Phase 7: Îç∞Ïù¥ÌÑ∞ ÌûàÏä§ÌÜ†Î¶¨ Î∑∞Ïñ¥ === */

        /* ÌûàÏä§ÌÜ†Î¶¨ Ìå®ÎÑê ÌÜ†Í∏Ä Î≤ÑÌäº */
        .history-toggle-btn {
            position: fixed;
            bottom: 150px;
            right: 20px;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, #1f6feb 0%, #1158c7 100%);
            border: none;
            color: #fff;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 4px 16px rgba(31,111,235,0.4);
            z-index: 40;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .history-toggle-btn:hover {
            transform: scale(1.1);
        }
        @media (max-width: 768px) {
            .history-toggle-btn {
                bottom: 130px;
                right: 15px;
                width: 44px;
                height: 44px;
                font-size: 18px;
            }
        }

        /* ÌûàÏä§ÌÜ†Î¶¨ Ìå®ÎÑê (ÏÇ¨Ïù¥ÎìúÎ∞î) */
        .history-panel {
            position: fixed;
            top: 55px;
            right: 0;
            width: 380px;
            max-width: 100%;
            height: calc(100vh - 55px);
            background: var(--panel-bg);
            border-left: 1px solid var(--border-color);
            z-index: 48;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        .history-panel.open {
            transform: translateX(0);
        }

        .history-panel-header {
            padding: 16px;
            background: #21262d;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .history-panel-header h3 {
            margin: 0;
            font-size: 14px;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* ÌûàÏä§ÌÜ†Î¶¨ ÌïÑÌÑ∞ */
        .history-filters {
            padding: 12px 16px;
            background: #161b22;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        .history-filter-btn {
            padding: 6px 12px;
            background: #0d1117;
            border: 1px solid var(--border-color);
            border-radius: 16px;
            color: #8b949e;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .history-filter-btn:hover {
            border-color: #484f58;
        }
        .history-filter-btn.active {
            background: #1f6feb;
            border-color: #1f6feb;
            color: #fff;
        }

        /* ÌûàÏä§ÌÜ†Î¶¨ Î™©Î°ù */
        .history-list {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        .history-date-group {
            margin-bottom: 16px;
        }
        .history-date-label {
            font-size: 11px;
            color: #8b949e;
            text-transform: uppercase;
            margin-bottom: 8px;
            padding-left: 24px;
            position: relative;
        }
        .history-date-label::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            width: 16px;
            height: 1px;
            background: var(--border-color);
        }

        .history-item {
            display: flex;
            gap: 12px;
            padding: 12px;
            background: #0d1117;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 8px;
            transition: border-color 0.2s;
            cursor: pointer;
        }
        .history-item:hover {
            border-color: #1f6feb;
        }

        .history-item-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
        }
        .history-item-icon.status { background: rgba(35,134,54,0.2); }
        .history-item-icon.stage { background: rgba(31,111,235,0.2); }
        .history-item-icon.issue { background: rgba(218,54,51,0.2); }
        .history-item-icon.create { background: rgba(163,113,247,0.2); }

        .history-item-content {
            flex: 1;
            min-width: 0;
        }
        .history-item-title {
            font-size: 12px;
            color: #c9d1d9;
            margin-bottom: 4px;
        }
        .history-item-meta {
            font-size: 10px;
            color: #8b949e;
            display: flex;
            gap: 8px;
        }

        .history-item-column {
            color: #58a6ff;
            font-weight: 500;
        }

        .history-empty {
            text-align: center;
            padding: 40px 20px;
            color: #484f58;
        }
        .history-empty-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        /* ÎÇ†Ïßú ÏÑ†ÌÉù */
        .history-date-picker {
            display: flex;
            gap: 8px;
            padding: 0 16px 12px;
        }
        .history-date-input {
            flex: 1;
            background: #0d1117;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 8px 12px;
            color: #c9d1d9;
            font-size: 12px;
        }
        .history-date-input:focus {
            outline: none;
            border-color: #1f6feb;
        }

        @media (max-width: 768px) {
            .history-panel {
                width: 100%;
                top: 0;
                height: 100vh;
            }
        }

        /* === Phase 7: ÌÇ§Î≥¥Îìú Îã®Ï∂ïÌÇ§ Î™®Îã¨ === */
        .shortcuts-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.75);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .shortcuts-modal {
            background: linear-gradient(135deg, #161b22 0%, #0d1117 100%);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            width: 100%;
            max-width: 700px;
            max-height: 85vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .shortcuts-modal-header {
            padding: 16px 20px;
            background: #21262d;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .shortcuts-modal-header h2 {
            margin: 0;
            font-size: 16px;
            font-weight: 600;
            color: #fff;
        }

        .modal-close-btn {
            background: none;
            border: none;
            color: #8b949e;
            font-size: 18px;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .modal-close-btn:hover {
            background: rgba(248, 81, 73, 0.1);
            color: #f85149;
        }

        .shortcuts-modal-body {
            padding: 20px;
            overflow-y: auto;
            max-height: calc(85vh - 120px);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .shortcuts-section {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 14px;
        }

        .shortcuts-section h3 {
            margin: 0 0 12px 0;
            font-size: 12px;
            font-weight: 600;
            color: #8b949e;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .shortcuts-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .shortcut-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
        }

        .shortcut-keys {
            display: flex;
            align-items: center;
            gap: 4px;
            flex-shrink: 0;
        }

        .shortcut-keys kbd {
            background: linear-gradient(180deg, #30363d 0%, #21262d 100%);
            border: 1px solid #484f58;
            border-radius: 6px;
            padding: 3px 8px;
            font-size: 11px;
            font-family: ui-monospace, monospace;
            color: #c9d1d9;
            box-shadow: 0 2px 0 #21262d;
            min-width: 24px;
            text-align: center;
        }

        .shortcut-desc {
            font-size: 12px;
            color: #8b949e;
            text-align: right;
        }

        .shortcuts-modal-footer {
            padding: 12px 20px;
            background: #21262d;
            border-top: 1px solid var(--border-color);
            text-align: center;
        }

        .shortcuts-hint {
            font-size: 11px;
            color: #8b949e;
        }

        @media (max-width: 600px) {
            .shortcuts-modal-body {
                grid-template-columns: 1fr;
            }
            .shortcuts-modal {
                max-height: 90vh;
            }
        }

        /* === Admin Panel === */
        .admin-panel-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .admin-panel {
            background: var(--panel-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            width: 90%;
            max-width: 900px;
            max-height: 85vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .admin-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-color);
            background: linear-gradient(135deg, #1f6feb20 0%, #23863620 100%);
        }

        .admin-panel-header h2 {
            margin: 0;
            font-size: 18px;
            color: #fff;
        }

        .admin-tabs {
            display: flex;
            gap: 4px;
            padding: 12px 20px;
            background: #0d1117;
            border-bottom: 1px solid var(--border-color);
        }

        .admin-tab {
            padding: 8px 16px;
            border: none;
            background: transparent;
            color: var(--text-sub);
            cursor: pointer;
            border-radius: 6px;
            font-size: 13px;
            transition: all 0.2s;
        }

        .admin-tab:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-main);
        }

        .admin-tab.active {
            background: var(--status-active);
            color: #fff;
        }

        .admin-content {
            padding: 20px;
            overflow-y: auto;
            max-height: calc(85vh - 140px);
        }

        /* Zone Manager */
        .zone-card {
            background: #0d1117;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .zone-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .zone-card-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .zone-color-dot {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        .zone-card-actions {
            display: flex;
            gap: 8px;
        }

        .zone-progress-bar {
            height: 6px;
            background: #21262d;
            border-radius: 3px;
            overflow: hidden;
        }

        .zone-progress-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s;
        }

        /* Issue Card */
        .issue-card {
            background: #0d1117;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .issue-card.critical { border-left: 3px solid #da3633; }
        .issue-card.high { border-left: 3px solid #d29922; }
        .issue-card.medium { border-left: 3px solid #1f6feb; }
        .issue-card.low { border-left: 3px solid #8b949e; }

        .issue-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .issue-title {
            font-weight: 600;
            color: var(--text-main);
        }

        .issue-badge {
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
        }

        .issue-badge.open { background: #da3633; color: #fff; }
        .issue-badge.resolved { background: #238636; color: #fff; }

        .issue-meta {
            font-size: 12px;
            color: var(--text-sub);
        }

        /* Modal Form */
        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-size: 12px;
            color: var(--text-sub);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 8px 12px;
            background: #0d1117;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-main);
            font-size: 13px;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--status-active);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 20px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
        }

        /* === Loading States & Animations === */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        .spinner {
            width: 24px;
            height: 24px;
            border: 3px solid var(--border-color);
            border-top-color: var(--status-active);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        .spinner-lg {
            width: 48px;
            height: 48px;
            border-width: 4px;
        }

        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(13, 17, 23, 0.8);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 16px;
            z-index: 1000;
        }

        .loading-overlay span {
            color: var(--text-main);
            font-size: 14px;
        }

        .skeleton {
            background: linear-gradient(90deg, var(--border-color) 25%, var(--panel-bg) 50%, var(--border-color) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 4px;
        }

        .skeleton-row {
            height: 40px;
            margin-bottom: 8px;
        }

        .skeleton-cell {
            height: 26px;
            width: 100%;
        }

        .pulse {
            animation: pulse 2s ease-in-out infinite;
        }

        /* Button loading state */
        .btn.loading {
            position: relative;
            color: transparent;
            pointer-events: none;
        }

        .btn.loading::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            top: 50%;
            left: 50%;
            margin: -8px 0 0 -8px;
            border: 2px solid currentColor;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }

        /* === Mobile Bottom Navigation === */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 64px;
            background: var(--panel-bg);
            border-top: 1px solid var(--border-color);
            display: none;
            z-index: 100;
            padding-bottom: env(safe-area-inset-bottom, 0);
        }

        @media (max-width: 768px) {
            .bottom-nav {
                display: grid;
                grid-template-columns: repeat(5, 1fr);
            }

            /* Add padding to main content to avoid overlap */
            .main-container {
                padding-bottom: 80px;
            }
        }

        .bottom-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            color: var(--text-sub);
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 8px 4px;
            transition: color 0.2s;
        }

        .bottom-nav-item.active {
            color: var(--status-active);
        }

        .bottom-nav-item svg {
            width: 24px;
            height: 24px;
        }

        .bottom-nav-item span {
            font-size: 10px;
            font-weight: 500;
        }
    </style>

</head>
<body x-data="dashboard()" x-init="init()">

<!-- Skip Link for Accessibility -->
<a href="#main-content" class="skip-link">Î©îÏù∏ ÏΩòÌÖêÏ∏†Î°ú Í±¥ÎÑàÎõ∞Í∏∞</a>

<!-- Screen Reader Announcements -->
<div id="sr-announcements" aria-live="polite" aria-atomic="true" class="sr-only"></div>
<div id="sr-errors" aria-live="assertive" aria-atomic="true" class="sr-only"></div>

<!-- Loading Overlay -->
<div x-show="isLoading" x-cloak class="loading-overlay" role="status" aria-live="polite">
    <div class="spinner spinner-lg"></div>
    <span x-text="loadingMessage || 'Î°úÎî© Ï§ë...'"></span>
</div>

<!-- Phase 7: Ïã§ÏãúÍ∞Ñ ÏïåÎ¶º Toast Ïª®ÌÖåÏù¥ÎÑà -->
<div class="notification-container">
    <template x-for="notification in activeNotifications" :key="notification.id">
        <div class="notification-toast" 
             :class="[notification.type, notification.closing ? 'closing' : '']"
             @click="handleNotificationClick(notification)">
            <span class="notification-icon" x-text="getNotificationIcon(notification.type)"></span>
            <div class="notification-content">
                <div class="notification-title" x-text="notification.title"></div>
                <div class="notification-message" x-text="notification.message"></div>
                <div class="notification-time" x-text="formatNotificationTime(notification.timestamp)"></div>
            </div>
            <button class="notification-close" @click.stop="dismissNotification(notification.id)">‚úï</button>
        </div>
    </template>
</div>

<!-- Phase 7: ÏïåÎ¶º ÌûàÏä§ÌÜ†Î¶¨ Ìå®ÎÑê -->
<div class="notification-history-panel" :class="notificationPanelOpen ? 'open' : ''">
    <div class="notification-history-header">
        <h3>üìã ÏïåÎ¶º ÌûàÏä§ÌÜ†Î¶¨</h3>
        <div class="notification-history-actions">
            <button class="btn" @click="markAllNotificationsRead()" style="font-size:11px; padding:4px 8px;">
                Î™®Îëê ÏùΩÏùå
            </button>
            <button class="btn" @click="clearNotificationHistory()" style="font-size:11px; padding:4px 8px;">
                Ï†ÑÏ≤¥ ÏÇ≠Ï†ú
            </button>
            <button class="notification-close" @click="toggleNotificationPanel()" style="font-size:18px;">‚úï</button>
        </div>
    </div>
    <div class="notification-history-list">
        <template x-if="notificationHistory.length === 0">
            <div class="notification-history-empty">
                <div style="font-size:40px; margin-bottom:10px;">üîî</div>
                <div>ÏïåÎ¶ºÏù¥ ÏóÜÏäµÎãàÎã§</div>
            </div>
        </template>
        <template x-for="notification in notificationHistory" :key="notification.id">
            <div class="notification-history-item" 
                 :class="notification.read ? '' : 'unread'"
                 @click="handleHistoryItemClick(notification)">
                <div style="display:flex; align-items:flex-start; gap:10px;">
                    <span x-text="getNotificationIcon(notification.type)" style="font-size:16px;"></span>
                    <div style="flex:1; min-width:0;">
                        <div style="font-size:12px; font-weight:600; color:#fff;" x-text="notification.title"></div>
                        <div style="font-size:11px; color:#8b949e; margin-top:4px; line-height:1.4;" x-text="notification.message"></div>
                        <div style="font-size:10px; color:#484f58; margin-top:6px;" x-text="formatNotificationTime(notification.timestamp)"></div>
                    </div>
                </div>
            </div>
        </template>
    </div>
</div>

<!-- Header -->
<header role="banner">
    <div class="brand">
        <h1>P5 Live Grid</h1>
        <span class="project-tag">v2.0 Admin</span>

        <!-- Phase 7: Ï∏µ ÏÑ†ÌÉùÍ∏∞ -->
        <div class="floor-selector" @click.outside="floorSelectorOpen = false">
            <button class="floor-selector-btn" @click="floorSelectorOpen = !floorSelectorOpen"
                    aria-label="Ï∏µ ÏÑ†ÌÉù"
                    :aria-expanded="floorSelectorOpen"
                    aria-haspopup="listbox">
                <span class="floor-icon">üè¢</span>
                <span class="floor-label" x-text="currentFloorLabel"></span>
                <span class="floor-arrow" :class="{'open': floorSelectorOpen}">‚ñº</span>
            </button>

            <!-- Ï∏µ ÎìúÎ°≠Îã§Ïö¥ -->
            <div class="floor-dropdown" x-show="floorSelectorOpen" x-transition style="display: none;"
                 role="listbox" aria-label="Ï∏µ Î™©Î°ù">
                <template x-for="floor in floors" :key="floor.floorId">
                    <div class="floor-item"
                         :class="{'active': selectedFloor === floor.floorId, 'has-variation': floor.hasVariation}"
                         @click="selectFloor(floor.floorId)"
                         role="option"
                         :aria-selected="selectedFloor === floor.floorId">
                        <span class="floor-item-label" x-text="floor.label"></span>
                        <span class="floor-item-badge" x-show="floor.hasVariation" title="ÌëúÏ§ÄÏ∏µÍ≥º Ï∞®Ïù¥">‚ö†</span>
                        <span class="floor-item-check" x-show="selectedFloor === floor.floorId">‚úì</span>
                    </div>
                </template>
            </div>
        </div>

        <!-- Phase 6: Progress Summary -->
        <div class="progress-summary" style="margin-left: 15px;">
            <template x-for="stage in stageConfigs" :key="stage.code">
                <div class="stage-mini">
                    <span class="stage-label" x-text="stage.label"></span>
                    <span class="stage-progress"
                          :style="'color:' + stage.color"
                          x-text="getStageProgress(stage.code) + '%'"></span>
                    <div class="stage-bar">
                        <div class="stage-bar-fill"
                             :style="'width:' + getStageProgress(stage.code) + '%; background:' + stage.color">
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </div>
    <div class="controls">
        <div class="stat-box">
            <span class="stat-label">Ï†ÑÏ≤¥ Í∏∞Îë•</span>
            <span class="stat-val" x-text="totalColumns + 'Í∞ú'"></span>
        </div>
        <div class="stat-box">
            <span class="stat-label">ÏÑ†ÌÉùÎê®</span>
            <span class="stat-val" style="color:#58a6ff" x-text="selectedCells.length + 'Í∞ú'"></span>
        </div>
        <!-- Sync Status Indicator -->
        <div class="stat-box" x-show="syncEnabled">
            <span class="stat-label">ÎèôÍ∏∞Ìôî ÎåÄÍ∏∞</span>
            <span class="stat-val" :style="syncStatus.pending > 0 ? 'color:#d29922' : 'color:#238636'" 
                  x-text="syncStatus.pending + 'Í∞ú ÎåÄÍ∏∞Ï§ë'"></span>
        </div>
        <button class="btn" @click="clearSelection()" aria-label="ÏÑ†ÌÉù Ìï¥Ï†ú">ÏÑ†ÌÉù Ìï¥Ï†ú</button>
        <button class="btn" @click="syncNow()" x-show="syncEnabled" :disabled="syncStatus.pending === 0" aria-label="ÏßÄÍ∏à ÎèôÍ∏∞Ìôî">
            üîÑ ÏßÄÍ∏à ÎèôÍ∏∞Ìôî
        </button>
        <!-- Phase 5: AI Î∂ÑÏÑù Î≤ÑÌäº -->
        <button class="btn" @click="triggerAnalysis()"
                :disabled="analysisJob.status === 'pending' || analysisJob.status === 'running'"
                :style="analysisJob.status === 'running' ? 'border-color:#d29922; color:#d29922;' : ''"
                aria-label="AI Î∂ÑÏÑù Ïã§Ìñâ">
            <span x-show="analysisJob.status !== 'running'">üîç Î∂ÑÏÑù</span>
            <span x-show="analysisJob.status === 'running'">‚è≥ Î∂ÑÏÑù Ï§ë...</span>
        </button>
        <div class="controls">
            <!-- Phase 7: Ïä§ÎßàÌä∏ Í≤ÄÏÉâ -->
            <div class="search-panel" @click.outside="searchDropdownOpen = false" role="search">
                <div class="search-input-wrapper">
                    <span class="search-icon" aria-hidden="true">üîç</span>
                    <input type="text"
                           class="search-input"
                           placeholder="Í∏∞Îë•/Zone/ÏÉÅÌÉú Í≤ÄÏÉâ (Ïòà: A-1)"
                           x-model="searchQuery"
                           @focus="if(searchQuery) searchDropdownOpen = true"
                           @input="performSearch()"
                           @keydown.escape="clearSearch()"
                           @keydown="handleSearchKeydown($event)"
                           aria-label="Í∏∞Îë•, Zone, ÏÉÅÌÉú Í≤ÄÏÉâ"
                           :aria-expanded="searchDropdownOpen"
                           aria-autocomplete="list"
                           aria-controls="search-results-dropdown">
                    <button class="search-clear-btn" x-show="searchQuery" @click="clearSearch()" aria-label="Í≤ÄÏÉâÏñ¥ ÏßÄÏö∞Í∏∞">‚úï</button>

                    <!-- Í≤ÄÏÉâ Í≤∞Í≥º ÎìúÎ°≠Îã§Ïö¥ -->
                    <div class="search-dropdown" x-show="searchDropdownOpen && searchResults.length > 0" x-transition style="display: none;"
                         id="search-results-dropdown" role="listbox" aria-label="Í≤ÄÏÉâ Í≤∞Í≥º">
                        <template x-if="searchResults.length === 0">
                            <div class="search-dropdown-section" style="padding: 16px; text-align: center; color: #8b949e;">
                                Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§
                            </div>
                        </template>

                        <div class="search-dropdown-section" x-show="searchResults.some(r => r.type === 'column')">
                            <div class="search-section-title" style="padding: 4px 12px; font-size: 10px; color: #8b949e;">Í∏∞Îë•</div>
                            <template x-for="result in searchResults.filter(r => r.type === 'column')" :key="result.id">
                                <div class="quick-action-menu-item" @click="selectSearchResult(result)">
                                    <span x-text="result.icon"></span>
                                    <span x-text="result.text"></span>
                                    <span style="margin-left: auto; font-size: 10px; color: #8b949e;" x-text="result.hint"></span>
                                </div>
                            </template>
                        </div>
                        
                        <div class="search-dropdown-section" x-show="searchResults.some(r => r.type === 'zone')">
                            <div class="search-section-title" style="padding: 4px 12px; font-size: 10px; color: #8b949e;">Zone</div>
                            <template x-for="result in searchResults.filter(r => r.type === 'zone')" :key="result.id">
                                <div class="quick-action-menu-item" @click="selectSearchResult(result)">
                                    <span x-text="result.icon"></span>
                                    <span x-text="result.text"></span>
                                </div>
                            </template>
                        </div>

                         <div class="search-dropdown-section" x-show="searchResults.some(r => r.type === 'issue')">
                            <div class="search-section-title" style="padding: 4px 12px; font-size: 10px; color: #8b949e;">Ïù¥Ïäà</div>
                            <template x-for="result in searchResults.filter(r => r.type === 'issue')" :key="result.id">
                                <div class="quick-action-menu-item" @click="selectSearchResult(result)">
                                    <span x-text="result.icon"></span>
                                    <span x-text="result.text"></span>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
            </div>

            <div class="stat-box" style="min-width: 100px;">
                <span class="stat-label">Ï∏µ ÏÑ†ÌÉù</span>
                <select class="floor-select" x-model="currentFloor" @change="loadFloorDataLegacy()"
                        style="background:#161b22; color:#c9d1d9; border:1px solid #30363d; border-radius:4px; padding:4px 8px; font-size:12px; cursor:pointer;">
                    <option value="F1">1Ï∏µ</option>
                    <option value="F2">2Ï∏µ</option>
                    <option value="ALL">Ï†ÑÏ≤¥</option>
                </select>
            </div>
        <!-- Excel Export Dropdown -->
        <div class="header-export-btn" x-data="{ headerExportOpen: false }" @click.outside="headerExportOpen = false">
            <button class="btn btn-primary" @click="headerExportOpen = !headerExportOpen">
                üì• ÎÇ¥Î≥¥ÎÇ¥Í∏∞ <span style="font-size:10px;">‚ñº</span>
            </button>
            <div class="header-export-dropdown" x-show="headerExportOpen" x-transition style="display:none;">
                <div class="header-export-item" @click="exportData(); headerExportOpen = false;">
                    üìÑ JSON (Ï†ÑÏ≤¥ Î∞±ÏóÖ)
                </div>
                <div class="header-export-item" @click="exportToCSV(); headerExportOpen = false;">
                    üìä CSV (Í∏∞Îë• Îç∞Ïù¥ÌÑ∞)
                </div>
                <div class="header-export-item" @click="exportToExcel({ scope: 'all' }); headerExportOpen = false;">
                    üìó Excel (Ï†ÑÏ≤¥)
                </div>
                <div class="header-export-item" @click="exportToExcel({ scope: 'filtered' }); headerExportOpen = false;">
                    üîç Excel (ÌïÑÌÑ∞Îê®)
                </div>
                <div class="header-export-item"
                     :class="{ 'disabled': selectedCells.length === 0 }"
                     @click="selectedCells.length > 0 && (exportToExcel({ scope: 'selected' }), headerExportOpen = false)">
                    ‚úì Excel (ÏÑ†ÌÉù: <span x-text="selectedCells.length"></span>Í∞ú)
                </div>
                <div style="border-top: 1px solid var(--border-color); margin: 4px 0;"></div>
                <div class="header-export-item" @click="generatePDFReport('summary'); headerExportOpen = false;">
                    üìï PDF ÏöîÏïΩ Î≥¥Í≥†ÏÑú
                </div>
                <div class="header-export-item" @click="generatePDFReport('detailed'); headerExportOpen = false;">
                    üìò PDF ÏÉÅÏÑ∏ Î≥¥Í≥†ÏÑú
                </div>
                <div class="header-export-item" @click="generatePDFReport('issues'); headerExportOpen = false;">
                    üìô PDF Ïù¥Ïäà Î≥¥Í≥†ÏÑú
                </div>
            </div>
        </div>
        <!-- WP-4: Report Panel Button -->
        <button class="btn" @click="openReportPanel()" style="background:#238636; border-color:#238636;">
            üìä Î¶¨Ìè¨Ìä∏
        </button>
        <button class="btn" @click="toggleIssuePanel()" :style="openIssues.length > 0 ? 'border-color:#da3633; color:#f85149;' : ''">
            üö® Ïù¥Ïäà <span x-show="openIssues.length > 0" x-text="`(${openIssues.length})`" style="font-weight:bold;"></span>
        </button>
        <!-- Phase 7: ÏïåÎ¶º Î≤ÑÌäº -->
        <div class="notification-bell" @click="toggleNotificationPanel()">
            <button class="btn">üîî</button>
            <template x-if="unreadNotificationCount > 0">
                <span class="notification-badge" x-text="unreadNotificationCount > 9 ? '9+' : unreadNotificationCount"></span>
            </template>
        </div>
        <button class="btn" @click="showAdminPanel = true">‚öôÔ∏è Í¥ÄÎ¶¨Ïûê</button>
    </div>
</header>

<!-- Admin Panel Overlay -->
<div class="admin-panel-overlay" x-show="showAdminPanel" x-cloak @click.self="showAdminPanel = false"
     role="dialog" aria-modal="true" aria-labelledby="admin-panel-title">
    <div class="admin-panel">
        <div class="admin-panel-header">
            <h2 id="admin-panel-title">‚öôÔ∏è P5 Í¥ÄÎ¶¨Ïûê Ìå®ÎÑê</h2>
            <button class="btn" @click="showAdminPanel = false" aria-label="Í¥ÄÎ¶¨Ïûê Ìå®ÎÑê Îã´Í∏∞">‚úï</button>
        </div>

        <div class="admin-tabs" role="tablist" aria-label="Í¥ÄÎ¶¨Ïûê ÏÑ§Ï†ï ÌÉ≠">
            <button class="admin-tab" :class="adminTab === 'zones' && 'active'" @click="adminTab = 'zones'" role="tab" :aria-selected="adminTab === 'zones'" aria-controls="tab-zones">üóÇÔ∏è Zone</button>
            <button class="admin-tab" :class="adminTab === 'issues' && 'active'" @click="adminTab = 'issues'" role="tab" :aria-selected="adminTab === 'issues'" aria-controls="tab-issues">üö® Ïù¥Ïäà</button>
            <button class="admin-tab" :class="adminTab === 'project' && 'active'" @click="adminTab = 'project'" role="tab" :aria-selected="adminTab === 'project'" aria-controls="tab-project">üìÅ ÌîÑÎ°úÏ†ùÌä∏</button>
            <button class="admin-tab" :class="adminTab === 'settings' && 'active'" @click="adminTab = 'settings'" role="tab" :aria-selected="adminTab === 'settings'" aria-controls="tab-settings">üîß ÏÑ§Ï†ï</button>
        </div>
        
        <div class="admin-content">
            <!-- Zone Manager Tab -->
            <template x-if="adminTab === 'zones'">
                <div>
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
                        <h3 style="margin:0; color:#fff;">Zone Î™©Î°ù</h3>
                        <button class="btn btn-primary" @click="openZoneEditor(null)">+ ÏÉà Zone</button>
                    </div>
                    <template x-for="zone in zones" :key="zone.id">
                        <div class="zone-card">
                            <div class="zone-card-header">
                                <div class="zone-card-title">
                                    <div class="zone-color-dot" :style="'background:' + zone.color"></div>
                                    <span style="font-weight:600; color:#fff;" x-text="zone.name"></span>
                                </div>
                                <div class="zone-card-actions">
                                    <button class="btn" style="padding:4px 8px; font-size:11px;" @click="openZoneEditor(zone)">Ìé∏Ïßë</button>
                                    <button class="btn" style="padding:4px 8px; font-size:11px; color:#f85149;" @click="deleteZone(zone.id)">ÏÇ≠Ï†ú</button>
                                </div>
                            </div>
                            <div style="font-size:12px; color:#8b949e; margin-bottom:8px;">
                                X<span x-text="zone.startColumn"></span> ~ X<span x-text="zone.endColumn"></span>
                            </div>
                            <div class="zone-progress-bar">
                                <div class="zone-progress-fill" :style="'width:' + getZoneProgress(zone.id) + '%; background:' + zone.color"></div>
                            </div>
                        </div>
                    </template>
                </div>
            </template>
            
            <!-- Issue Tracker Tab -->
            <template x-if="adminTab === 'issues'">
                <div>
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
                        <h3 style="margin:0; color:#fff;">Ïù¥Ïäà Î™©Î°ù</h3>
                        <button class="btn btn-primary" @click="openNewIssueModal()">+ ÏÉà Ïù¥Ïäà</button>
                    </div>
                    <template x-for="issue in filteredIssues" :key="issue.id">
                        <div class="issue-card" :class="issue.severity">
                            <div class="issue-header">
                                <div class="issue-title" x-text="issue.title"></div>
                                <span class="issue-badge" :class="issue.status" x-text="issue.status === 'open' ? 'Ïó¥Î¶º' : 'Ìï¥Í≤∞Îê®'"></span>
                            </div>
                            <div class="issue-meta" x-text="issue.type + ' ¬∑ ' + (issue.affectedColumns?.length || 0) + 'Í∞ú Í∏∞Îë•'"></div>
                            <template x-if="issue.status === 'open'">
                                <button class="btn btn-success" style="margin-top:8px; padding:4px 8px; font-size:11px;" @click="resolveIssue(issue.id)">Ìï¥Í≤∞</button>
                            </template>
                        </div>
                    </template>
                </div>
            </template>
            
            <!-- Project Manager Tab -->
            <template x-if="adminTab === 'project'">
                <div>
                    <h3 style="margin:0 0 16px 0; color:#fff;">üìÅ ÌîÑÎ°úÏ†ùÌä∏ Ïä§ÎÉÖÏÉ∑ Í¥ÄÎ¶¨</h3>
                    <p style="font-size:12px; color:#8b949e; margin-bottom:20px;">
                        ÌòÑÏû¨ ÎåÄÏãúÎ≥¥ÎìúÏùò Î™®Îì† ÏÑ§Ï†ï(Ï∏µ, Ï†àÏ£º, Íµ¨Í∞Ñ, Zone)Í≥º Îç∞Ïù¥ÌÑ∞(Í∏∞Îë• ÏÉÅÌÉú, Ïù¥Ïäà)Î•º ÌïòÎÇòÏùò ÌååÏùºÎ°ú Ï†ÄÏû•ÌïòÍ±∞ÎÇò Î∂àÎü¨ÏòµÎãàÎã§.
                    </p>
                    
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px;">
                        <div style="padding:20px; background:#0d1117; border:1px solid var(--border-color); border-radius:12px; text-align:center;">
                            <div style="font-size:32px; margin-bottom:12px;">üì§</div>
                            <h4 style="margin:0 0 8px 0; font-size:14px; color:#fff;">Ïä§ÎÉÖÏÉ∑ ÎÇ¥Î≥¥ÎÇ¥Í∏∞</h4>
                            <p style="font-size:11px; color:#8b949e; margin-bottom:16px;">ÌòÑÏû¨ ÏÉÅÌÉúÎ•º JSON ÌååÏùºÎ°ú Îã§Ïö¥Î°úÎìúÌï©ÎãàÎã§.</p>
                            <button class="btn btn-primary" style="width:100%;" @click="exportProjectSnapshot()">Ïä§ÎÉÖÏÉ∑ Ï†ÄÏû•</button>
                        </div>
                        
                        <div style="padding:20px; background:#0d1117; border:1px solid var(--border-color); border-radius:12px; text-align:center;">
                            <div style="font-size:32px; margin-bottom:12px;">üì•</div>
                            <h4 style="margin:0 0 8px 0; font-size:14px; color:#fff;">Ïä§ÎÉÖÏÉ∑ Î∂àÎü¨Ïò§Í∏∞</h4>
                            <p style="font-size:11px; color:#8b949e; margin-bottom:16px;">Ï†ÄÏû•Îêú Ïä§ÎÉÖÏÉ∑ ÌååÏùºÏùÑ ÏÑ†ÌÉùÌïòÏó¨ Î≥µÏõêÌï©ÎãàÎã§.</p>
                            <label class="btn btn-success" style="width:100%; display:inline-block; cursor:pointer;">
                                ÌååÏùº ÏÑ†ÌÉù
                                <input type="file" style="display:none;" @change="importProjectSnapshot($event)" accept=".json">
                            </label>
                        </div>
                    </div>

                    <div style="margin-top:24px; padding:16px; background:rgba(210,153,34,0.1); border:1px solid rgba(210,153,34,0.3); border-radius:8px;">
                        <h4 style="margin:0 0 8px 0; font-size:12px; color:#d29922;">‚ö†Ô∏è Ï£ºÏùòÏÇ¨Ìï≠</h4>
                        <ul style="margin:0; padding-left:18px; font-size:11px; color:#8b949e; line-height:1.6;">
                            <li>Ïä§ÎÉÖÏÉ∑ÏùÑ Î∂àÎü¨Ïò§Î©¥ ÌòÑÏû¨ Î∏åÎùºÏö∞Ï†ÄÏóê Ï†ÄÏû•Îêú Îç∞Ïù¥ÌÑ∞Í∞Ä Î™®Îëê ÎçÆÏñ¥ÏîåÏõåÏßëÎãàÎã§.</li>
                            <li>Î∂àÎü¨Ïò§Í∏∞ ÏôÑÎ£å ÌõÑ ÌéòÏù¥ÏßÄÍ∞Ä ÏûêÎèôÏúºÎ°ú ÏÉàÎ°úÍ≥†Ïπ®Îê©ÎãàÎã§.</li>
                            <li>ÎåÄÎüâÏùò Îç∞Ïù¥ÌÑ∞(8,000Í∞ú Ïù¥ÏÉÅ)Í∞Ä Ìè¨Ìï®Îêú Í≤ΩÏö∞ Ï≤òÎ¶¨ Ïãú ÏïΩÍ∞ÑÏùò ÏßÄÏó∞Ïù¥ Î∞úÏÉùÌï† Ïàò ÏûàÏäµÎãàÎã§.</li>
                        </ul>
                    </div>
                </div>
            </template>
            
            <!-- Settings Tab -->
            <template x-if="adminTab === 'settings'">
                <div>
                    <h3 style="margin:0 0 16px 0; color:#fff;">ÏãúÏä§ÌÖú ÏÑ§Ï†ï</h3>
                    <div class="form-group">
                        <label>Google Sheet ÎèôÍ∏∞Ìôî</label>
                        <div style="display:flex; align-items:center; gap:12px;">
                            <input type="checkbox" x-model="syncEnabled" style="width:auto;">
                            <span x-text="syncEnabled ? 'ÌôúÏÑ±Ìôî' : 'ÎπÑÌôúÏÑ±Ìôî'"></span>
                        </div>
                    </div>
                    <div class="form-group" x-show="syncEnabled">
                        <label>API URL</label>
                        <input type="text" x-model="apiUrl" placeholder="https://script.google.com/macros/s/...">
                    </div>
                    <div class="form-group">
                        <label>Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨</label>
                        <div style="display:flex; gap:8px;">
                            <button class="btn" @click="exportData()">üì• ÎÇ¥Î≥¥ÎÇ¥Í∏∞</button>
                            <button class="btn" style="color:#f85149;" @click="clearAllData()">üóëÔ∏è Ï¥àÍ∏∞Ìôî</button>
                        </div>
                    </div>

                    <hr style="border-color:#30363d; margin: 20px 0;">

                    <!-- Virtual Scrolling Settings -->
                    <h3 style="margin:0 0 16px 0; color:#fff;">üöÄ Virtual Scrolling</h3>
                    <div class="form-group">
                        <label>Virtual Scrolling ÌôúÏÑ±Ìôî</label>
                        <div style="display:flex; align-items:center; gap:12px;">
                            <input type="checkbox" x-model="virtualScroll.enabled" style="width:auto;">
                            <span x-text="virtualScroll.enabled ? 'ÌôúÏÑ±Ìôî (ÎåÄÍ∑úÎ™® Í∑∏Î¶¨Îìú ÏµúÏ†ÅÌôî)' : 'ÎπÑÌôúÏÑ±Ìôî'"></span>
                        </div>
                        <small style="color:#8b949e; display:block; margin-top:8px;">
                            1,000ÏÖÄ Ïù¥ÏÉÅ Í∑∏Î¶¨ÎìúÏóêÏÑú ÏûêÎèô ÌôúÏÑ±ÌôîÎê©ÎãàÎã§.
                            ÌòÑÏû¨ Í∑∏Î¶¨Îìú: <strong x-text="gridConfig.cols * gridConfig.rows"></strong>ÏÖÄ
                        </small>
                    </div>
                    <div class="form-group" x-show="virtualScroll.enabled">
                        <label>Î≤ÑÌçº ÏÖÄ Ïàò</label>
                        <input type="number" x-model.number="virtualScroll.bufferCells" min="0" max="20" style="width:80px;">
                        <small style="color:#8b949e; display:block; margin-top:4px;">
                            Î∑∞Ìè¨Ìä∏ Ïô∏Î∂ÄÏóê ÎØ∏Î¶¨ Î†åÎçîÎßÅÌï† ÏÖÄ Ïàò (Í∏∞Î≥∏: 5)
                        </small>
                    </div>
                    <div class="form-group" x-show="virtualScroll.enabled">
                        <label>ÌòÑÏû¨ Î†åÎçîÎßÅ</label>
                        <div style="font-family: monospace; color: #58a6ff; font-size: 12px;">
                            <span x-text="visibleCells.length"></span>ÏÖÄ Î†åÎçîÎßÅ Ï§ë
                            (Ï†ÑÏ≤¥ <span x-text="gridCells.length"></span>ÏÖÄ Ï§ë)
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </div>
</div>

<!-- Zone Editor Modal -->
<div class="admin-panel-overlay" x-show="showZoneEditor" x-cloak @click.self="showZoneEditor = false"
     role="dialog" aria-modal="true" aria-labelledby="zone-editor-title">
    <div class="admin-panel" style="max-width:500px;">
        <div class="admin-panel-header">
            <h2 id="zone-editor-title" x-text="editingZone ? 'üóÇÔ∏è Zone Ìé∏Ïßë' : 'üóÇÔ∏è ÏÉà Zone Ï∂îÍ∞Ä'"></h2>
            <button class="btn" @click="showZoneEditor = false" aria-label="Zone Ìé∏ÏßëÍ∏∞ Îã´Í∏∞">‚úï</button>
        </div>
        <div class="admin-content">
            <div class="form-group">
                <label>Zone ID</label>
                <input type="text" x-model="zoneForm.id" :disabled="editingZone" placeholder="zone_d">
            </div>
            <div class="form-group">
                <label>Zone Ïù¥Î¶Ñ</label>
                <input type="text" x-model="zoneForm.name" placeholder="ZONE D">
            </div>
            <div class="form-group">
                <label>ÌëúÏãú Ïù¥Î¶Ñ</label>
                <input type="text" x-model="zoneForm.displayName" placeholder="Ïã†Í∑ú">
            </div>
            <div class="form-group">
                <label>ÏÑ§Î™Ö</label>
                <input type="text" x-model="zoneForm.description" placeholder="Zone ÏÑ§Î™Ö (ÏÑ†ÌÉù)">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>ÏãúÏûë Ïª¨Îüº (X)</label>
                    <input type="number" x-model.number="zoneForm.startColumn" min="1" max="69">
                </div>
                <div class="form-group">
                    <label>ÎÅù Ïª¨Îüº (X)</label>
                    <input type="number" x-model.number="zoneForm.endColumn" min="1" max="69">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>ÏãúÏûë Ìñâ (Y)</label>
                    <select x-model="zoneForm.startRow">
                        <template x-for="(label, idx) in rowLabels" :key="idx">
                            <option :value="idx" x-text="label"></option>
                        </template>
                    </select>
                </div>
                <div class="form-group">
                    <label>ÎÅù Ìñâ (Y)</label>
                    <select x-model="zoneForm.endRow">
                        <template x-for="(label, idx) in rowLabels" :key="idx">
                            <option :value="idx" x-text="label"></option>
                        </template>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>ÏÉâÏÉÅ</label>
                <div style="display:flex; gap:8px; align-items:center;">
                    <input type="color" x-model="zoneForm.color" style="width:60px; height:32px; padding:0; border:none; cursor:pointer;">
                    <input type="text" x-model="zoneForm.color" style="width:100px;" placeholder="#238636">
                </div>
            </div>

            <hr style="border-color:#30363d; margin:15px 0;">
            <h4 style="color:#8b949e; font-size:12px; margin-bottom:10px;">üìã Í¥ÄÎ¶¨ Ï†ïÎ≥¥</h4>

            <div class="form-row">
                <div class="form-group">
                    <label>Îã¥Îãπ ÏóÖÏ≤¥</label>
                    <input type="text" x-model="zoneForm.contractor" placeholder="Ïòà: ÏÇºÏÑ±E&A">
                </div>
                <div class="form-group">
                    <label>Í¥ÄÎ¶¨ Îã¥ÎãπÏûê</label>
                    <input type="text" x-model="zoneForm.supervisor" placeholder="Ïòà: ÌôçÍ∏∏Îèô">
                </div>
            </div>
            <div class="form-group">
                <label>Î™©Ìëú ÏôÑÍ≥µÏùº</label>
                <input type="date" x-model="zoneForm.targetDate">
            </div>

            <div class="form-actions">
                <button class="btn" @click="showZoneEditor = false">Ï∑®ÏÜå</button>
                <button class="btn btn-primary" @click="saveZone()">üíæ Ï†ÄÏû•</button>
            </div>
        </div>
    </div>
</div>

<!-- Issue Create Modal -->
<div class="admin-panel-overlay" x-show="showIssueEditor" x-cloak @click.self="showIssueEditor = false">
    <div class="admin-panel" style="max-width:550px;">
        <div class="admin-panel-header">
            <h2>üö® ÏÉà Ïù¥Ïäà Îì±Î°ù</h2>
            <button class="btn" @click="showIssueEditor = false">‚úï</button>
        </div>
        <div class="admin-content">
            <div class="form-row">
                <div class="form-group">
                    <label>Ïù¥Ïäà Ïú†Ìòï</label>
                    <select x-model="issueForm.type">
                        <option value="tc">T/C Í∞ÑÏÑ≠</option>
                        <option value="design">ÏÑ§Í≥Ñ Î≥ÄÍ≤Ω</option>
                        <option value="material">ÏûêÏû¨ ÎåÄÍ∏∞</option>
                        <option value="safety">ÏïàÏ†Ñ Ï†êÍ≤Ä</option>
                        <option value="quality">ÌíàÏßà Ïù¥Ïäà</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ïã¨Í∞ÅÎèÑ</label>
                    <select x-model="issueForm.severity">
                        <option value="critical">üî¥ Critical</option>
                        <option value="high">üü† High</option>
                        <option value="medium">üü° Medium</option>
                        <option value="low">üü¢ Low</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>Ïù¥Ïäà Ï†úÎ™©</label>
                <input type="text" x-model="issueForm.title" placeholder="Ïòà: T/C #5 Í∞ÑÏÑ≠">
            </div>
            <div class="form-group">
                <label>ÏÑ§Î™Ö</label>
                <textarea x-model="issueForm.description" rows="3" placeholder="Ïù¥Ïäà ÏÉÅÏÑ∏ ÏÑ§Î™Ö"></textarea>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>ÏòÅÌñ• Ïª¨Îüº Î≤îÏúÑ (ÏãúÏûë)</label>
                    <input type="number" x-model.number="issueForm.startColumn" min="1" max="69">
                </div>
                <div class="form-group">
                    <label>ÏòÅÌñ• Ïª¨Îüº Î≤îÏúÑ (ÎÅù)</label>
                    <input type="number" x-model.number="issueForm.endColumn" min="1" max="69">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>ÏòÅÌñ• Ìñâ Î≤îÏúÑ (ÏãúÏûë)</label>
                    <select x-model="issueForm.startRow">
                        <template x-for="(label, idx) in rowLabels" :key="idx">
                            <option :value="label" x-text="label"></option>
                        </template>
                    </select>
                </div>
                <div class="form-group">
                    <label>ÏòÅÌñ• Ìñâ Î≤îÏúÑ (ÎÅù)</label>
                    <select x-model="issueForm.endRow">
                        <template x-for="(label, idx) in rowLabels" :key="idx">
                            <option :value="label" x-text="label"></option>
                        </template>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Îã¥ÎãπÏûê</label>
                    <input type="text" x-model="issueForm.assignedTo" placeholder="Îã¥ÎãπÏûê Ïù¥Î¶Ñ">
                </div>
                <div class="form-group">
                    <label>ÏòàÏÉÅ Ìï¥Í≤∞Ïùº</label>
                    <input type="date" x-model="issueForm.expectedResolution">
                </div>
            </div>
            <div class="form-group" style="border-top:1px solid #30363d; padding-top:12px; margin-top:8px;">
                <label style="display:flex; align-items:center; gap:8px;">
                    <input type="checkbox" x-model="issueForm.showOverlay" style="width:auto;">
                    Í∑∏Î¶¨ÎìúÏóê Ïò§Î≤ÑÎ†àÏù¥ ÌëúÏãú
                </label>
            </div>
            <div x-show="issueForm.showOverlay" style="margin-left:20px;">
                <div class="form-row">
                    <div class="form-group">
                        <label>Ïò§Î≤ÑÎ†àÏù¥ ÎùºÎ≤®</label>
                        <input type="text" x-model="issueForm.overlayLabel" placeholder="‚õî T/C #5">
                    </div>
                    <div class="form-group">
                        <label>ÌÖåÎëêÎ¶¨ ÏÉâÏÉÅ</label>
                        <input type="color" x-model="issueForm.overlayColor" style="width:60px; height:32px;">
                    </div>
                </div>
            </div>

            <hr style="border-color:#30363d; margin:15px 0;">
            <h4 style="color:#8b949e; font-size:12px; margin-bottom:10px;">üìã ÏÉÅÏÑ∏ Ï†ïÎ≥¥ (ÏÑ†ÌÉù)</h4>

            <div class="form-group">
                <label>Í∑ºÎ≥∏ ÏõêÏù∏</label>
                <textarea x-model="issueForm.rootCause" rows="2" placeholder="Ïòà: T/C ÏûëÏóÖÎ∞òÍ≤Ω ÎÇ¥ Í∏∞Îë• ÏúÑÏπò"></textarea>
            </div>
            <div class="form-group">
                <label>ÏôÑÌôî Í≥ÑÌöç</label>
                <textarea x-model="issueForm.mitigationPlan" rows="2" placeholder="Ïòà: X40 ÎùºÏù∏ Ïö∞ÏÑ† ÏãúÍ≥µ ÌõÑ Î≥µÍ∑Ä"></textarea>
            </div>
            <div class="form-group">
                <label>Î≥¥Í≥†Ïûê</label>
                <input type="text" x-model="issueForm.reportedBy" placeholder="Ïòà: ÌòÑÏû•ÏÜåÏû•">
            </div>

            <div class="form-actions">
                <button class="btn" @click="showIssueEditor = false">Ï∑®ÏÜå</button>
                <button class="btn btn-primary" @click="saveIssue()">üö® Ïù¥Ïäà Îì±Î°ù</button>
            </div>
        </div>
    </div>
</div>

<!-- Phase 8: Import Preview Modal -->
<div class="import-preview-modal" x-show="showImportPreview" x-cloak @click.self="showImportPreview = false"
     role="dialog" aria-modal="true" aria-labelledby="import-preview-title">
    <div class="import-preview-content">
        <div class="import-preview-header">
            <h2 id="import-preview-title">üì• Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞ ÎØ∏Î¶¨Î≥¥Í∏∞</h2>
            <button class="btn" @click="showImportPreview = false" aria-label="ÎØ∏Î¶¨Î≥¥Í∏∞ Ï∞Ω Îã´Í∏∞">‚úï</button>
        </div>
        <div class="import-preview-body">
            <!-- File Info -->
            <div style="margin-bottom:16px; padding:12px; background:var(--bg-secondary); border-radius:8px;">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <span style="font-size:13px; color:var(--text-main);">
                        üìÑ <strong x-text="importPreview.fileName"></strong>
                        <span style="color:var(--text-sub); margin-left:8px;" x-text="'(' + importPreview.fileType.toUpperCase() + ')'"></span>
                    </span>
                    <span style="font-size:12px; color:var(--text-sub);" x-text="importPreview.stats.total + 'Í∞ú Ìñâ'"></span>
                </div>
            </div>

            <!-- Import Mode Selection -->
            <div class="import-mode-select">
                <button class="import-mode-btn" :class="importPreview.mode === 'update' && 'active'" @click="importPreview.mode = 'update'">
                    <div class="import-mode-icon">üîÑ</div>
                    <div class="import-mode-label">ÏóÖÎç∞Ïù¥Ìä∏</div>
                    <div class="import-mode-hint">Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞Îßå Í∞±Ïã†</div>
                </button>
                <button class="import-mode-btn" :class="importPreview.mode === 'merge' && 'active'" @click="importPreview.mode = 'merge'">
                    <div class="import-mode-icon">‚ûï</div>
                    <div class="import-mode-label">Î≥ëÌï©</div>
                    <div class="import-mode-hint">ÏÉà Ìï≠Î™© Ï∂îÍ∞Ä + Í∏∞Ï°¥ Í∞±Ïã†</div>
                </button>
                <button class="import-mode-btn" :class="importPreview.mode === 'replace' && 'active'" @click="importPreview.mode = 'replace'">
                    <div class="import-mode-icon">‚ôªÔ∏è</div>
                    <div class="import-mode-label">ÎåÄÏ≤¥</div>
                    <div class="import-mode-hint">Î™®Îì† Îç∞Ïù¥ÌÑ∞ ÍµêÏ≤¥</div>
                </button>
            </div>

            <!-- Stats -->
            <div class="import-stats">
                <div class="import-stat-item">
                    <div class="import-stat-value" x-text="importPreview.stats.total"></div>
                    <div class="import-stat-label">Ï†ÑÏ≤¥</div>
                </div>
                <div class="import-stat-item new">
                    <div class="import-stat-value" x-text="importPreview.stats.new"></div>
                    <div class="import-stat-label">Ïã†Í∑ú</div>
                </div>
                <div class="import-stat-item update">
                    <div class="import-stat-value" x-text="importPreview.stats.update"></div>
                    <div class="import-stat-label">ÏóÖÎç∞Ïù¥Ìä∏</div>
                </div>
                <div class="import-stat-item error">
                    <div class="import-stat-value" x-text="importPreview.stats.errors"></div>
                    <div class="import-stat-label">Ïò§Î•ò</div>
                </div>
            </div>

            <!-- CSV Column Mapping (only for CSV) -->
            <template x-if="importPreview.fileType === 'csv' && importPreview.headers.length > 0">
                <div class="import-mapping">
                    <h4>üìã Ïª¨Îüº Îß§Ìïë</h4>
                    <div class="import-mapping-row">
                        <label>UID (ÌïÑÏàò)</label>
                        <select x-model="importPreview.columnMapping.uid" @change="recalculateImportStats()">
                            <option value="">-- ÏÑ†ÌÉù --</option>
                            <template x-for="h in importPreview.headers" :key="h">
                                <option :value="h" x-text="h"></option>
                            </template>
                        </select>
                    </div>
                    <div class="import-mapping-row">
                        <label>ÏÉÅÌÉú (Status)</label>
                        <select x-model="importPreview.columnMapping.status" @change="recalculateImportStats()">
                            <option value="">-- ÏÑ†ÌÉù --</option>
                            <template x-for="h in importPreview.headers" :key="h">
                                <option :value="h" x-text="h"></option>
                            </template>
                        </select>
                    </div>
                    <div class="import-mapping-row">
                        <label>Ïû†Í∏à (IsLocked)</label>
                        <select x-model="importPreview.columnMapping.isLocked" @change="recalculateImportStats()">
                            <option value="">-- ÏÑ†ÌÉù --</option>
                            <template x-for="h in importPreview.headers" :key="h">
                                <option :value="h" x-text="h"></option>
                            </template>
                        </select>
                    </div>
                </div>
            </template>

            <!-- Data Preview Table -->
            <div style="max-height:300px; overflow:auto; border:1px solid var(--border-color); border-radius:8px;">
                <table class="import-preview-table">
                    <thead>
                        <tr>
                            <th style="width:60px;">ÏÉÅÌÉú</th>
                            <template x-for="h in (importPreview.fileType === 'csv' ? importPreview.headers : ['UID', 'Status', 'Zone'])" :key="h">
                                <th x-text="h"></th>
                            </template>
                        </tr>
                    </thead>
                    <tbody>
                        <template x-for="(row, idx) in importPreview.parsedData.slice(0, 50)" :key="idx">
                            <tr :class="row._importStatus === 'new' ? 'import-row-new' : (row._importStatus === 'error' ? 'import-row-error' : 'import-row-update')">
                                <td>
                                    <span x-show="row._importStatus === 'new'" style="color:#238636;">üÜï</span>
                                    <span x-show="row._importStatus === 'update'" style="color:#1f6feb;">üîÑ</span>
                                    <span x-show="row._importStatus === 'error'" style="color:#da3633;">‚ùå</span>
                                </td>
                                <template x-for="(val, key) in (importPreview.fileType === 'csv' ? row : {uid: row.uid, status: row.status?.code, zone: row.zone?.name})" :key="key">
                                    <td x-show="key !== '_importStatus'" x-text="val"></td>
                                </template>
                            </tr>
                        </template>
                    </tbody>
                </table>
                <template x-if="importPreview.parsedData.length > 50">
                    <div style="padding:12px; text-align:center; color:var(--text-sub); font-size:12px;">
                        ... Ïô∏ <span x-text="importPreview.parsedData.length - 50"></span>Í∞ú Ìñâ
                    </div>
                </template>
            </div>

            <!-- Errors -->
            <template x-if="importPreview.errors.length > 0">
                <div class="import-errors">
                    <h4>‚ö†Ô∏è Í∞ÄÏ†∏Ïò§Í∏∞ Ïò§Î•ò (<span x-text="importPreview.errors.length"></span>Í±¥)</h4>
                    <ul>
                        <template x-for="err in importPreview.errors.slice(0, 5)" :key="err">
                            <li x-text="err"></li>
                        </template>
                        <template x-if="importPreview.errors.length > 5">
                            <li style="color:#8b949e;">... Ïô∏ <span x-text="importPreview.errors.length - 5"></span>Í±¥</li>
                        </template>
                    </ul>
                </div>
            </template>
        </div>
        <div class="import-preview-footer">
            <button class="btn" @click="showImportPreview = false">Ï∑®ÏÜå</button>
            <button class="btn btn-primary" @click="executeImport()" :disabled="importPreview.stats.errors > 0 && importPreview.stats.update + importPreview.stats.new === 0">
                ‚úÖ Í∞ÄÏ†∏Ïò§Í∏∞ Ïã§Ìñâ (<span x-text="importPreview.mode === 'merge' ? importPreview.stats.new + importPreview.stats.update : importPreview.stats.update"></span>Í±¥)
            </button>
        </div>
    </div>
</div>

<div class="main-container">




    <!-- Sidebar -->
    <aside class="sidebar" :class="{'open': sidebarOpen}" role="navigation" aria-label="ÏÇ¨Ïù¥ÎìúÎ∞î ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò">
        <div>
            <h3>ÏÉÅÌÉú Î≤îÎ°Ä</h3>
            <div class="zone-legend">
                <template x-for="(status, code) in statusCodes" :key="code">
                    <div class="legend-item">
                        <div class="color-dot" :style="`background: ${status.color}`"></div>
                        <span x-text="status.label"></span>
                    </div>
                </template>
            </div>
        </div>

        <hr style="border-color:#30363d; margin: 15px 0;">

        <div>
            <h3>Í≥µÍ∞Ñ Íµ¨Ïó≠</h3>
            <template x-for="zone in zones" :key="zone.id">
                <div class="zone-summary" style="margin-bottom: 10px;">
                    <div class="zone-title">
                        <span x-text="zone.name + ': ' + zone.displayName"></span>
                        <span :style="`color: ${zone.style.primaryColor}`" 
                              x-text="getZoneProgress(zone.id) + '%'"></span>
                    </div>
                    <div style="font-size:10px; color:#8b949e;" 
                         x-text="`X${zone.range.startColumn} ~ X${zone.range.endColumn}`"></div>
                    <div class="progress-bar">
                        <div class="progress-fill" 
                             :style="`width: ${getZoneProgress(zone.id)}%; background: ${zone.style.primaryColor}`">
                        </div>
                    </div>
                </div>
            </template>
        </div>

        <hr style="border-color:#30363d; margin: 15px 0;">

        <div>
            <h3>Îπ†Î•∏ Ïã§Ìñâ</h3>
            <button class="btn" style="width:100%; margin-bottom:8px;"
                    @click="selectByStatus('pending')">ÎåÄÍ∏∞ Ï§ë Ï†ÑÏ≤¥ ÏÑ†ÌÉù</button>
            <button class="btn" style="width:100%; margin-bottom:8px;"
                    @click="selectByZone(zones[0]?.id)">Zone A ÏÑ†ÌÉù</button>
            <button class="btn btn-success" style="width:100%;"
                    @click="saveToLocalStorage()">üíæ Î°úÏª¨ Ï†ÄÏû•</button>
        </div>

        <hr style="border-color:#30363d; margin: 15px 0;">

        <!-- Phase 9: Ï∏µ-Ï†àÏ£º ÏûÖÎ©¥ Î∑∞Ïñ¥ (Enhanced) -->
        <div class="elevation-viewer" x-show="elevationViewOpen">
            <div class="elevation-viewer-header">
                <h3>üèóÔ∏è Ï∏µ-Ï†àÏ£º ÏûÖÎ©¥ Î∑∞Ïñ¥</h3>
                <button class="btn elevation-viewer-toggle" @click="elevationViewOpen = false" title="Ï†ëÍ∏∞">‚àí</button>
            </div>

            <!-- Ï∏µ-Ï†àÏ£º 2D Í∑∏Î¶¨Îìú -->
            <div class="elevation-grid">
                <!-- Ï†àÏ£º Ìó§Îçî Ìñâ -->
                <div class="elevation-floor-label" style="background:transparent;"></div>
                <template x-for="jeolju in jeoljuList" :key="'header-' + jeolju.jeoljuId">
                    <div class="elevation-jeolju-header" 
                         :class="{'selected': selectedJeolju === jeolju.jeoljuId}"
                         @click="filterByJeolju(jeolju.jeoljuId)"
                         :title="'X' + jeolju.startColumn + '~X' + jeolju.endColumn"
                         x-text="jeolju.label">
                    </div>
                </template>

                <!-- Ï∏µÎ≥Ñ Ìñâ (RFÎ∂ÄÌÑ∞ 1FÍπåÏßÄ Ïó≠Ïàú) -->
                <template x-for="floor in [...floors].reverse()" :key="'row-' + floor.floorId">
                    <div class="elevation-row">
                        <!-- Ï∏µ ÎùºÎ≤® -->
                        <div class="elevation-floor-label"
                             :class="{'selected': selectedFloor === floor.floorId}"
                             @click="selectFloor(floor.floorId)"
                             :title="floor.columnSize || ''"
                             x-text="floor.label">
                        </div>

                        <!-- Ï†àÏ£ºÎ≥Ñ ÏÖÄ -->
                        <template x-for="jeolju in jeoljuList" :key="floor.floorId + '-' + jeolju.jeoljuId">
                            <div class="elevation-cell"
                                 :class="getElevationCellClass(floor.floorId, jeolju.jeoljuId)"
                                 @click="selectFloorAndJeolju(floor.floorId, jeolju.jeoljuId)"
                                 :title="floor.label + ' / ' + jeolju.label">
                                <span x-text="getFloorJeoljuProgress(floor.floorId, jeolju.jeoljuId) + '%'" 
                                      style="font-size:9px;"></span>
                            </div>
                        </template>
                    </div>
                </template>
            </div>

            <!-- Î≤îÎ°Ä -->
            <div class="elevation-legend">
                <div class="elevation-legend-item">
                    <div class="elevation-legend-dot complete"></div>
                    <span>ÏôÑÎ£å</span>
                </div>
                <div class="elevation-legend-item">
                    <div class="elevation-legend-dot in-progress"></div>
                    <span>ÏßÑÌñâÏ§ë</span>
                </div>
                <div class="elevation-legend-item">
                    <div class="elevation-legend-dot has-issue"></div>
                    <span>Ïù¥Ïäà</span>
                </div>
                <div class="elevation-legend-item">
                    <div class="elevation-legend-dot pending"></div>
                    <span>ÎåÄÍ∏∞</span>
                </div>
            </div>

            <!-- ÏÑ†ÌÉùÎêú Ï∏µ-Ï†àÏ£º Ï†ïÎ≥¥ -->
            <div class="elevation-info" x-show="selectedJeolju || selectedFloor" style="margin-top:12px; padding:12px; background:#0d1117; border-radius:8px;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                    <span style="font-size:12px; font-weight:600; color:#fff;" 
                          x-text="(floors.find(f => f.floorId === selectedFloor)?.label || 'Ï†ÑÏ≤¥') + ' / ' + (getSelectedJeoljuLabel() || 'Ï†ÑÏ≤¥')"></span>
                    <button class="btn" style="font-size:10px; padding:4px 8px;" 
                            @click="selectedJeolju = null; selectedFloor = 'F01'">Ï¥àÍ∏∞Ìôî</button>
                </div>
                <div style="display:flex; gap:16px;">
                    <div style="text-align:center;">
                        <div style="font-size:18px; font-weight:bold; color:#58a6ff;" 
                             x-text="getJeoljuColumnCount(selectedJeolju) || totalColumns"></div>
                        <div style="font-size:10px; color:#8b949e;">Í∏∞Îë•</div>
                    </div>
                    <div style="text-align:center;">
                        <div style="font-size:18px; font-weight:bold; color:#238636;" 
                             x-text="(getJeoljuProgressPercent(selectedJeolju) || getOverallProgress()) + '%'"></div>
                        <div style="font-size:10px; color:#8b949e;">ÏßÑÌñâÎ•†</div>
                    </div>
                    <div style="text-align:center;">
                        <div style="font-size:18px; font-weight:bold; color:#da3633;" 
                             x-text="getJeoljuIssueCount(selectedJeolju) || issues.filter(i => i.status === 'open').length"></div>
                        <div style="font-size:10px; color:#8b949e;">Ïù¥Ïäà</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Î∑∞Ïñ¥ Ï†ëÌûå ÏÉÅÌÉú -->
        <div class="elevation-collapsed" x-show="!elevationViewOpen" @click="elevationViewOpen = true">
            <span>üìê Ï†àÏ£º Î∑∞Ïñ¥ ÌéºÏπòÍ∏∞</span>
        </div>
    </aside>

    <!-- Canvas Area -->
    <div class="canvas-area" id="main-content" role="main" aria-label="Ïù¥Ïäà Í∑∏Î¶¨Îìú">
        <!-- Zone Indicator Bar -->
        <div class="zone-indicator-bar">
            <template x-for="zone in zones" :key="zone.id">
                <div class="zone-segment" :style="`background: ${zone.style.backgroundColor}; color: ${zone.style.primaryColor}`">
                    <span x-text="zone.name + ' (' + zone.displayName + ')'"></span>
                </div>
            </template>
        </div>

        <!-- Selection Banner (shown when items selected) -->
        <div class="selection-banner" x-show="selectedCells.length > 0" x-cloak>
            <div>
                <span class="count" x-text="selectedCells.length"></span> columns selected
                <span style="color:#8b949e; margin-left:10px;">
                    (Shift+Click or Drag to multi-select)
                </span>
            </div>
            <div style="display:flex; gap:10px;">
                <button class="btn btn-primary" @click="openBulkEdit()">‚úèÔ∏è Bulk Edit</button>
                <button class="btn" @click="clearSelection()">‚úï Clear</button>
            </div>
        </div>

        <!-- Grid with Virtual Scrolling -->
        <div class="grid-scroll-view"
             x-ref="gridScrollView"
             x-init="$nextTick(() => initVirtualScroll($refs.gridScrollView))"
             @scroll.passive="handleVirtualScroll($event)"
             @mousedown="startDragSelect($event)"
             @mousemove="updateDragSelect($event)"
             @mouseup="endDragSelect()"
             @mouseleave="endDragSelect()"
             @touchstart.passive="startTouchDragSelect($event)"
             @touchmove.passive="updateTouchDragSelect($event)"
             @touchend="endTouchDragSelect($event)"
             @touchcancel="endTouchDragSelect($event)">

            <!-- Virtual Scroll Spacer (maintains scroll area size) -->
            <div x-show="virtualScroll.enabled"
                 class="virtual-grid-spacer"
                 :style="`width: ${totalGridWidth}px; height: ${totalGridHeight}px;`"></div>

            <div class="grid-container"
                 :style="virtualScroll.enabled
                     ? `--cols: ${visibleColCount}; --rows: ${visibleRowCount}; transform: translate(${virtualScroll.visibleColStart * virtualScroll.cellWidth}px, ${virtualScroll.visibleRowStart * virtualScroll.cellHeight}px);`
                     : `--cols: ${gridConfig.cols}; --rows: ${gridConfig.rows}`"
                 id="gridMap"
                 role="grid"
                 aria-label="Íµ¨Ï°∞ Ïù¥Ïäà Í¥ÄÎ¶¨ Í∑∏Î¶¨Îìú">

                <!-- Cells: Virtual or Full rendering based on grid size -->
                <template x-for="cell in (virtualScroll.enabled ? visibleCells : gridCells)" :key="cell.key">
                    <div :class="cell.isHeader ? 'grid-cell-header' : 'grid-cell'"
                         :role="cell.isHeader ? 'columnheader' : 'gridcell'"
                         :aria-label="cell.isHeader ? cell.label : (cell.row + '-X' + cell.col + ' Í∏∞Îë• ÏÖÄ')"
                         :style="!cell.isHeader && isSelected(cell.row, cell.col) ? 'background: rgba(31, 111, 235, 0.3); border-color: #1f6feb;' : ''"
                         @click="!cell.isHeader && handleCellClick($event, cell.row, cell.col)"
                         @dblclick="!cell.isHeader && openDetail(cell.row, cell.col)">
                        <template x-if="cell.isHeader">
                            <span x-text="cell.label"></span>
                        </template>
                        <template x-if="!cell.isHeader">
                            <!-- Phase 6: 2x3 Stage Grid Indicator -->
                            <div class="stage-grid"
                                 :class="{
                                     'locked': isLocked(cell.row, cell.col),
                                     'workflow-filtered': isCellFilteredByWorkflow(cell.row, cell.col),
                                     'jeolju-filtered': !isInSelectedJeolju(cell.col),
                                     'has-issue': hasIssue(cell),
                                     'has-issue-critical': hasIssue(cell) && getIssueForCell(cell)?.severity === 'critical'
                                 }"
                                 :data-uid="cell.row + '-X' + cell.col"
                                 :title="hasIssue(cell) ? getIssueTitle(cell) : getStageTooltip(cell.row, cell.col)"
                                 :data-jeolju="getJeoljuForColumn(cell.col)">
                                <!-- Row 1: hmb_fab, pre_assem, main_assem -->
                                <div class="stage-cell" data-stage="hmb_fab"
                                     :class="'st-' + getStageStatus(cell.row, cell.col, 'hmb_fab')"></div>
                                <div class="stage-cell" data-stage="pre_assem"
                                     :class="'st-' + getStageStatus(cell.row, cell.col, 'pre_assem')"></div>
                                <div class="stage-cell" data-stage="main_assem"
                                     :class="'st-' + getStageStatus(cell.row, cell.col, 'main_assem')"></div>
                                <!-- Row 2: hmb_psrc, form, embed -->
                                <div class="stage-cell" data-stage="hmb_psrc"
                                     :class="'st-' + getStageStatus(cell.row, cell.col, 'hmb_psrc')"></div>
                                <div class="stage-cell" data-stage="form"
                                     :class="'st-' + getStageStatus(cell.row, cell.col, 'form')"></div>
                                <div class="stage-cell" data-stage="embed"
                                     :class="'st-' + getStageStatus(cell.row, cell.col, 'embed')"></div>

                                <!-- WP-2: Issue Pin Overlay -->
                                <template x-if="hasIssue(cell)">
                                    <div class="issue-pin"
                                         :class="getIssueSeverityClass(cell)"
                                         :title="getIssueTitle(cell)"
                                         @click.stop="openIssueDetail(cell)">
                                        üìç
                                    </div>
                                </template>
                                <!-- WP-2: Multiple Issues Badge -->
                                <template x-if="getIssuesForCell(cell).length > 1">
                                    <div class="issue-count-badge"
                                         :title="getIssuesForCell(cell).length + 'Í∞ú Ïù¥Ïäà'"
                                         x-text="getIssuesForCell(cell).length">
                                    </div>
                                </template>
                            </div>
                        </template>
                    </div>
                </template>
            </div>
        </div>

        <!-- Virtual Scroll Position Indicator -->
        <div class="virtual-scroll-indicator"
             :class="{ 'visible': virtualScroll.isScrolling && virtualScroll.enabled }"
             x-text="scrollPositionInfo"></div>
    </div>

    <!-- Detail Panel -->
    <div class="detail-panel" :class="{ 'open': detailPanelOpen }" role="complementary" aria-label="Ïù¥Ïäà ÏÉÅÏÑ∏Ï†ïÎ≥¥">
        <div class="panel-header">
            <div style="display:flex; align-items:center; gap:8px;">
                <h2 x-text="currentColumn?.uid || 'Select a column'"></h2>
                <span x-show="currentColumn?.status?.isLocked"
                      class="lock-badge"
                      title="This column is locked - AI cannot override">üîí</span>
            </div>
            <button @click="detailPanelOpen = false"
                    style="background:none; border:none; color:#8b949e; cursor:pointer; font-size:18px;">‚úï</button>
        </div>
        <div class="panel-content" x-show="currentColumn">
            <!-- Location Info -->
            <div class="prop-row">
                <span>Zone</span>
                <span class="prop-val" x-text="getZoneName(currentColumn?.location?.zoneId)"></span>
            </div>
            <div class="prop-row">
                <span>Position</span>
                <span class="prop-val" x-text="currentColumn?.uid"></span>
            </div>

            <hr style="border-color:#30363d; margin: 15px 0;">

            <!-- Status Editor -->
            <div class="form-group">
                <label>Status</label>
                <select x-model="editForm.status" @change="markDirty()">
                    <template x-for="(status, code) in statusCodes" :key="code">
                        <option :value="code" x-text="status.label"></option>
                    </template>
                </select>
            </div>

            <!-- Lock Toggle -->
            <div class="checkbox-row">
                <input type="checkbox" id="lockToggle" x-model="editForm.isLocked" @change="markDirty()">
                <label for="lockToggle">üîí Lock (Prevent AI Override)</label>
            </div>

            <hr style="border-color:#30363d; margin: 15px 0;">

            <!-- Member Info -->
            <div class="form-group">
                <label>Member Type</label>
                <select x-model="editForm.memberType" @change="markDirty()">
                    <option value="SRC Column">SRC Column</option>
                    <option value="Steel Beam">Steel Beam</option>
                    <option value="PC Girder">PC Girder</option>
                </select>
            </div>

            <div class="form-group">
                <label>Section</label>
                <input type="text" x-model="editForm.section" @input="markDirty()">
            </div>

            <!-- Save Button -->
            <div style="margin-top: 20px; display: flex; gap: 10px;">
                <button class="btn" style="flex:1" @click="cancelEdit()">Cancel</button>
                <button class="btn btn-success" style="flex:1" 
                        :disabled="!isDirty"
                        @click="saveColumn()">üíæ Save</button>
            </div>
        </div>
    </div>
</div>

<!-- Phase 6: Workflow Footer -->
<footer class="workflow-footer" role="contentinfo">
    <span class="workflow-title">Production Flow</span>

    <svg class="workflow-svg" viewBox="0 0 700 50" preserveAspectRatio="xMidYMid meet">
        <!-- Arrow Marker Definition -->
        <defs>
            <marker id="arrowhead" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
                <polygon points="0 0, 8 3, 0 6" fill="#30363d"/>
            </marker>
        </defs>

        <!-- Connection Arrows -->
        <path class="workflow-arrow" d="M 105 25 L 130 25"/>
        <path class="workflow-arrow" d="M 220 25 L 245 25"/>
        <path class="workflow-arrow" d="M 335 25 L 360 25"/>
        <path class="workflow-arrow" d="M 450 25 L 475 25"/>
        <path class="workflow-arrow" d="M 565 25 L 590 25"/>

        <!-- Stage Nodes -->
        <g class="workflow-node"
           :class="{ 'active': workflowFilter === 'hmb_fab', 'filtered': workflowFilter && workflowFilter !== 'hmb_fab' }"
           @click="toggleWorkflowFilter('hmb_fab')"
           style="color: #1f6feb;">
            <rect x="10" y="5" width="90" height="40" fill="#1f6feb" stroke="#1f6feb"/>
            <text x="55" y="20">HMBÏ†úÏûë</text>
            <text class="node-count" x="55" y="35" x-text="getStageCount('hmb_fab')"></text>
        </g>

        <g class="workflow-node"
           :class="{ 'active': workflowFilter === 'pre_assem', 'filtered': workflowFilter && workflowFilter !== 'pre_assem' }"
           @click="toggleWorkflowFilter('pre_assem')"
           style="color: #8957e5;">
            <rect x="135" y="5" width="80" height="40" fill="#8957e5" stroke="#8957e5"/>
            <text x="175" y="20">Î©¥Ï°∞Î¶Ω</text>
            <text class="node-count" x="175" y="35" x-text="getStageCount('pre_assem')"></text>
        </g>

        <g class="workflow-node"
           :class="{ 'active': workflowFilter === 'main_assem', 'filtered': workflowFilter && workflowFilter !== 'main_assem' }"
           @click="toggleWorkflowFilter('main_assem')"
           style="color: #d29922;">
            <rect x="250" y="5" width="80" height="40" fill="#d29922" stroke="#d29922"/>
            <text x="290" y="20">ÎåÄÏ°∞Î¶Ω</text>
            <text class="node-count" x="290" y="35" x-text="getStageCount('main_assem')"></text>
        </g>

        <g class="workflow-node"
           :class="{ 'active': workflowFilter === 'hmb_psrc', 'filtered': workflowFilter && workflowFilter !== 'hmb_psrc' }"
           @click="toggleWorkflowFilter('hmb_psrc')"
           style="color: #238636;">
            <rect x="365" y="5" width="80" height="40" fill="#238636" stroke="#238636"/>
            <text x="405" y="20">HMB+PSRC</text>
            <text class="node-count" x="405" y="35" x-text="getStageCount('hmb_psrc')"></text>
        </g>

        <g class="workflow-node"
           :class="{ 'active': workflowFilter === 'form', 'filtered': workflowFilter && workflowFilter !== 'form' }"
           @click="toggleWorkflowFilter('form')"
           style="color: #da3633;">
            <rect x="480" y="5" width="80" height="40" fill="#da3633" stroke="#da3633"/>
            <text x="520" y="20">FORM</text>
            <text class="node-count" x="520" y="35" x-text="getStageCount('form')"></text>
        </g>

        <g class="workflow-node"
           :class="{ 'active': workflowFilter === 'embed', 'filtered': workflowFilter && workflowFilter !== 'embed' }"
           @click="toggleWorkflowFilter('embed')"
           style="color: #f85149;">
            <rect x="595" y="5" width="80" height="40" fill="#f85149" stroke="#f85149"/>
            <text x="635" y="20">Ïï∞Î≤†Îìú</text>
            <text class="node-count" x="635" y="35" x-text="getStageCount('embed')"></text>
        </g>
    </svg>

    <!-- Legend / Clear Filter -->
    <div class="workflow-legend">
        <div class="workflow-legend-item"
             :class="{ 'active': !workflowFilter }"
             @click="clearWorkflowFilter()">
            <span>üîÑ All Stages</span>
        </div>
        <div class="workflow-legend-item" x-show="workflowFilter">
            <span style="color:#58a6ff">üìç Filtering: </span>
            <span x-text="getStageLabel(workflowFilter)"></span>
        </div>
    </div>
</footer>

<!-- Bulk Edit Panel -->
<div class="bulk-edit-panel" x-show="bulkEditOpen" x-cloak>
    <span class="label">ÏùºÍ¥Ñ Ìé∏Ïßë <strong x-text="selectedCells.length"></strong>Í∞ú:</span>

    <!-- Lock Status Summary -->
    <div class="lock-status-summary" style="display:flex; align-items:center; gap:6px; background:#21262d; padding:4px 8px; border-radius:4px; font-size:11px;">
        <span>üîí</span>
        <span x-text="getSelectedLockCount() + '/' + selectedCells.length + ' Ïû†Í∏à'"></span>
    </div>

    <div style="display:flex; align-items:center; gap:8px;">
        <label style="font-size:12px; color:#8b949e;">ÏÉÅÌÉú:</label>
        <select x-model="bulkEditForm.status">
            <option value="">-- Î≥ÄÍ≤Ω ÏóÜÏùå --</option>
            <template x-for="(status, code) in statusCodes" :key="code">
                <option :value="code" x-text="status.label"></option>
            </template>
        </select>
    </div>

    <!-- Lock Quick Actions -->
    <div style="display:flex; gap:4px;">
        <button class="btn btn-lock" @click="bulkLockSelected(true)"
                title="Lock all selected columns (prevent AI override)"
                style="padding:4px 8px; font-size:11px; background:#2d333b; border:1px solid #444c56;">
            üîí Ï†ÑÏ≤¥ Ïû†Í∏à
        </button>
        <button class="btn btn-unlock" @click="bulkLockSelected(false)"
                title="Unlock all selected columns (allow AI updates)"
                style="padding:4px 8px; font-size:11px; background:#2d333b; border:1px solid #444c56;">
            üîì Ï†ÑÏ≤¥ Ìï¥Ï†ú
        </button>
    </div>

    <div style="flex:1;"></div>

    <button class="btn" @click="closeBulkEdit()">Ï∑®ÏÜå</button>
    <button class="btn btn-success" @click="applyBulkEdit()">‚úÖ Ï†ÑÏ≤¥ Ï†ÅÏö©</button>
</div>

<!-- Issue Panel (Right Sidebar) -->
<div class="issue-panel" :class="{ 'open': issuePanelOpen }">
    <div class="issue-panel-header">
        <h3>üö® Issues <span style="color:#8b949e; font-weight:normal;" x-text="`(${openIssues.length})`"></span></h3>
        <div style="display:flex; gap:8px;">
            <button class="btn btn-primary" style="padding:4px 8px; font-size:11px;" @click="openNewIssueModal()">+ New</button>
            <button @click="issuePanelOpen = false" style="background:none; border:none; color:#8b949e; cursor:pointer; font-size:16px;">‚úï</button>
        </div>
    </div>
    
    <!-- Filter Tabs -->
    <div style="display:flex; border-bottom:1px solid #30363d; padding:0 10px;">
        <button class="btn" style="border:none; border-radius:0; padding:8px 12px;" 
                :style="issueFilter === 'all' ? 'border-bottom:2px solid #1f6feb; color:#fff;' : ''"
                @click="issueFilter = 'all'">All</button>
        <button class="btn" style="border:none; border-radius:0; padding:8px 12px;"
                :style="issueFilter === 'open' ? 'border-bottom:2px solid #1f6feb; color:#fff;' : ''"
                @click="issueFilter = 'open'">Open</button>
        <button class="btn" style="border:none; border-radius:0; padding:8px 12px;"
                :style="issueFilter === 'resolved' ? 'border-bottom:2px solid #1f6feb; color:#fff;' : ''"
                @click="issueFilter = 'resolved'">Resolved</button>
    </div>
    
    <!-- Issue List -->
    <div class="issue-list">
        <template x-if="filteredIssues.length === 0">
            <div style="text-align:center; color:#8b949e; padding:20px; font-size:12px;">
                No issues found
            </div>
        </template>
        
        <template x-for="issue in filteredIssues" :key="issue.id">
            <div class="issue-card" 
                 :class="{ 'active': selectedIssue?.id === issue.id }"
                 @click="selectIssue(issue)">
                <div class="issue-card-header">
                    <div class="issue-severity" :class="issue.severity"></div>
                    <span class="issue-title" x-text="issue.title"></span>
                    <span class="issue-type-badge" :class="issue.type" x-text="issue.type.toUpperCase()"></span>
                </div>
                <div class="issue-meta">
                    <span x-text="issue.id"></span>
                    <span class="issue-status-badge" :class="issue.status.replace('-', '_')" x-text="issue.status"></span>
                </div>
                <div class="issue-affected">
                    üìç <span x-text="(issue.affectedColumns?.length || 0) + ' columns affected'"></span>
                </div>
            </div>
        </template>
    </div>
</div>

<!-- Issue Overlays (rendered on grid) -->
<template x-for="issue in activeIssueOverlays" :key="'overlay-' + issue.id">
    <div class="issue-overlay" 
         :class="issue.type"
         :style="getOverlayStyle(issue)"
         x-text="issue.overlay?.label || issue.title">
    </div>
</template>

<!-- New Issue Modal -->
<div class="issue-modal" x-show="newIssueModalOpen" x-cloak @click.self="newIssueModalOpen = false"
     role="dialog" aria-modal="true" aria-labelledby="new-issue-modal-title">
    <div class="issue-modal-content">
        <div class="issue-modal-header">
            <h3 id="new-issue-modal-title">‚ûï New Issue</h3>
            <button @click="newIssueModalOpen = false"
                    style="background:none; border:none; color:#8b949e; cursor:pointer; font-size:18px;"
                    aria-label="ÏÉà Ïù¥Ïäà Î™®Îã¨ Îã´Í∏∞">‚úï</button>
        </div>
        <div class="issue-modal-body">
            <div class="form-group">
                <label>Issue Type</label>
                <select x-model="newIssueForm.type">
                    <option value="tc">T/C Í∞ÑÏÑ≠</option>
                    <option value="design">ÏÑ§Í≥Ñ Î≥ÄÍ≤Ω</option>
                    <option value="material">ÏûêÏû¨ Ïù¥Ïäà</option>
                    <option value="safety">ÏïàÏ†Ñ Ïù¥Ïäà</option>
                </select>
            </div>

            <div class="form-group">
                <label>Title</label>
                <input type="text" x-model="newIssueForm.title" placeholder="Ïù¥Ïäà Ï†úÎ™© ÏûÖÎ†•...">
            </div>

            <div class="form-group">
                <label>Severity</label>
                <select x-model="newIssueForm.severity">
                    <option value="critical">Critical (Ï¶âÏãú Ï°∞Ïπò ÌïÑÏöî)</option>
                    <option value="high">High (24ÏãúÍ∞Ñ ÎÇ¥ Ï°∞Ïπò)</option>
                    <option value="medium">Medium (ÏùºÏ£ºÏùº ÎÇ¥ Ï°∞Ïπò)</option>
                    <option value="low">Low (Î™®ÎãàÌÑ∞ÎßÅ)</option>
                </select>
            </div>

            <div class="form-group">
                <label>Description</label>
                <textarea x-model="newIssueForm.description" rows="3" 
                          style="width:100%; padding:8px; background:#0d1117; border:1px solid #30363d; border-radius:4px; color:#c9d1d9; font-size:12px; resize:vertical;"
                          placeholder="ÏÉÅÏÑ∏ ÎÇ¥Ïö© ÏûÖÎ†•..."></textarea>
            </div>

            <div class="form-group">
                <label>Affected Columns (<span x-text="selectedCells.length"></span> selected)</label>
                <div style="font-size:11px; color:#8b949e; padding:8px; background:#0d1117; border:1px solid #30363d; border-radius:4px; max-height:60px; overflow-y:auto;">
                    <template x-if="selectedCells.length > 0">
                        <span x-text="selectedCells.slice(0, 20).join(', ') + (selectedCells.length > 20 ? '...' : '')"></span>
                    </template>
                    <template x-if="selectedCells.length === 0">
                        <span style="color:#f85149;">‚ö†Ô∏è Í∑∏Î¶¨ÎìúÏóêÏÑú ÏòÅÌñ•Î∞õÎäî Í∏∞Îë•ÏùÑ Î®ºÏ†Ä ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</span>
                    </template>
                </div>
            </div>

            <div class="form-group">
                <label>Expected Resolution Date</label>
                <input type="date" x-model="newIssueForm.expectedResolution"
                       style="width:100%; padding:8px; background:#0d1117; border:1px solid #30363d; border-radius:4px; color:#c9d1d9; font-size:12px;">
            </div>
        </div>
        <div class="issue-modal-footer">
            <button class="btn" @click="newIssueModalOpen = false">Cancel</button>
            <button class="btn btn-success" @click="createIssue()" :disabled="!newIssueForm.title || selectedCells.length === 0">
                ‚úÖ Create Issue
            </button>
        </div>
    </div>
</div>

<!-- Admin Modal -->
<div class="admin-modal" x-show="showAdminPanel" x-cloak @click.self="showAdminPanel = false"
     role="dialog" aria-modal="true" aria-labelledby="dashboard-settings-title">
    <div class="admin-modal-content">
        <div class="admin-modal-header">
            <h2 id="dashboard-settings-title">‚öôÔ∏è Dashboard Settings</h2>
            <button @click="showAdminPanel = false"
                    style="background:none; border:none; color:#8b949e; cursor:pointer; font-size:20px;"
                    aria-label="ÏÑ§Ï†ï Ï∞Ω Îã´Í∏∞">‚úï</button>
        </div>

        <!-- Tabs -->
        <div class="admin-tabs" role="tablist" aria-label="ÏÑ§Ï†ï ÌÉ≠ Î™©Î°ù">
            <button class="admin-tab" :class="{ 'active': adminTab === 'zones' }" @click="adminTab = 'zones'" role="tab" :aria-selected="adminTab === 'zones'">üìç Zones</button>
            <button class="admin-tab" :class="{ 'active': adminTab === 'status' }" @click="adminTab = 'status'" role="tab" :aria-selected="adminTab === 'status'">üé® Status Codes</button>
            <button class="admin-tab" :class="{ 'active': adminTab === 'import' }" @click="adminTab = 'import'" role="tab" :aria-selected="adminTab === 'import'">üì• Import/Export</button>
            <button class="admin-tab" :class="{ 'active': adminTab === 'api' }" @click="adminTab = 'api'" role="tab" :aria-selected="adminTab === 'api'">üîó API Config</button>
            <button class="admin-tab" :class="{ 'active': adminTab === 'slack' }" @click="adminTab = 'slack'; loadSlackSettings()" role="tab" :aria-selected="adminTab === 'slack'">üîî Slack</button>
            <button class="admin-tab" :class="{ 'active': adminTab === 'email' }" @click="adminTab = 'email'; loadEmailSettings()" role="tab" :aria-selected="adminTab === 'email'">üìß Email</button>
        </div>
        
        <div class="admin-modal-body">
            <!-- Zone Manager Tab -->
            <div x-show="adminTab === 'zones'">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                    <h3 style="margin:0; font-size:14px; color:#fff;">Zone Configuration</h3>
                    <button class="btn btn-primary" style="padding:6px 12px; font-size:11px;" @click="addNewZone()">+ Add Zone</button>
                </div>
                
                <div class="zone-manager-list">
                    <template x-for="(zone, index) in zones" :key="zone.id">
                        <div class="zone-item">
                            <div class="zone-color-preview" :style="`background: ${zone.style.backgroundColor}; color: ${zone.style.primaryColor};`">
                                <span x-text="zone.name.substring(5, 6)"></span>
                            </div>
                            <div class="zone-info">
                                <h4 x-text="zone.name + ' - ' + zone.displayName"></h4>
                                <p x-text="zone.description"></p>
                            </div>
                            <div class="zone-range" x-text="`X${zone.range.startColumn} ~ X${zone.range.endColumn}`"></div>
                            <div class="zone-actions">
                                <button class="btn" style="padding:4px 8px; font-size:11px;" @click="editZone(zone)">Edit</button>
                                <input type="color" :value="zone.style.primaryColor" 
                                       @change="updateZoneColor(zone.id, $event.target.value)"
                                       style="width:28px; height:28px; border:none; cursor:pointer;">
                            </div>
                        </div>
                    </template>
                </div>
            </div>
            
            <!-- Status Codes Tab -->
            <div x-show="adminTab === 'status'">
                <div style="margin-bottom:15px;">
                    <h3 style="margin:0 0 8px 0; font-size:14px; color:#fff;">Status Code Settings</h3>
                    <p style="margin:0; font-size:11px; color:#8b949e;">Í∞Å ÏÉÅÌÉúÏùò ÎùºÎ≤®Í≥º ÏÉâÏÉÅÏùÑ ÏàòÏ†ïÌï† Ïàò ÏûàÏäµÎãàÎã§.</p>
                </div>
                
                <div class="status-code-grid">
                    <template x-for="(status, code) in statusCodes" :key="code">
                        <div class="status-code-item">
                            <div class="status-dot-preview" :style="`background: ${status.color}`"></div>
                            <div class="status-info">
                                <input type="text" :value="status.label" 
                                       @change="updateStatusLabel(code, $event.target.value)"
                                       :placeholder="code">
                                <div style="font-size:10px; color:#484f58;" x-text="code"></div>
                            </div>
                            <input type="color" :value="status.color" class="status-color-input"
                                   @change="updateStatusColor(code, $event.target.value)">
                        </div>
                    </template>
                </div>
                
                <div style="margin-top:20px; text-align:right;">
                    <button class="btn" @click="resetStatusCodes()">Reset to Default</button>
                    <button class="btn btn-success" @click="saveSettings()">üíæ Save Changes</button>
                </div>
            </div>
            
            <!-- Import/Export Tab -->
            <div x-show="adminTab === 'import'">
                <div class="import-export-section">
                    <div>
                        <h3 style="margin:0 0 12px 0; font-size:14px; color:#fff;">üì§ Export Data</h3>
                        <div class="export-options">
                            <button class="export-btn" @click="exportData()">
                                <span class="export-btn-icon">üìÑ</span>
                                <span class="export-btn-label">JSON</span>
                                <span class="export-btn-hint">Full data backup</span>
                            </button>
                            <button class="export-btn" @click="exportToCSV()">
                                <span class="export-btn-icon">üìä</span>
                                <span class="export-btn-label">CSV</span>
                                <span class="export-btn-hint">Column data only</span>
                            </button>
                            <!-- Excel Export with Dropdown Options -->
                            <div class="export-btn-wrapper" x-data="{ excelMenuOpen: false }" @click.outside="excelMenuOpen = false">
                                <button class="export-btn" @click="excelMenuOpen = !excelMenuOpen" style="position:relative;">
                                    <span class="export-btn-icon">üìó</span>
                                    <span class="export-btn-label">Excel <span style="font-size:10px;">‚ñº</span></span>
                                    <span class="export-btn-hint">With formatting</span>
                                </button>
                                <!-- Excel Export Dropdown Menu -->
                                <div class="excel-export-menu" x-show="excelMenuOpen" x-transition style="display:none;">
                                    <div class="excel-menu-item" @click="exportToExcel({ scope: 'all' }); excelMenuOpen = false;">
                                        <span class="excel-menu-icon">üìã</span>
                                        <div class="excel-menu-content">
                                            <span class="excel-menu-label">Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞</span>
                                            <span class="excel-menu-hint">Î™®Îì† Í∏∞Îë• Î∞è Ïù¥Ïäà ÎÇ¥Î≥¥ÎÇ¥Í∏∞</span>
                                        </div>
                                    </div>
                                    <div class="excel-menu-item" @click="exportToExcel({ scope: 'filtered' }); excelMenuOpen = false;">
                                        <span class="excel-menu-icon">üîç</span>
                                        <div class="excel-menu-content">
                                            <span class="excel-menu-label">ÌïÑÌÑ∞Îêú Îç∞Ïù¥ÌÑ∞</span>
                                            <span class="excel-menu-hint">ÌòÑÏû¨ ÌïÑÌÑ∞ Ï°∞Í±¥Îßå ÎÇ¥Î≥¥ÎÇ¥Í∏∞</span>
                                        </div>
                                    </div>
                                    <div class="excel-menu-item"
                                         :class="{ 'disabled': selectedCells.length === 0 }"
                                         @click="selectedCells.length > 0 && (exportToExcel({ scope: 'selected' }), excelMenuOpen = false)">
                                        <span class="excel-menu-icon">‚úì</span>
                                        <div class="excel-menu-content">
                                            <span class="excel-menu-label">ÏÑ†ÌÉùÎêú Ìï≠Î™©</span>
                                            <span class="excel-menu-hint" x-text="selectedCells.length > 0 ? selectedCells.length + 'Í∞ú ÏÑ†ÌÉùÎê®' : 'ÏÑ†ÌÉùÎêú Ìï≠Î™© ÏóÜÏùå'"></span>
                                        </div>
                                    </div>
                                    <div class="excel-menu-divider"></div>
                                    <div class="excel-menu-item" @click="exportToExcel({ scope: 'floor', floorId: selectedFloor }); excelMenuOpen = false;">
                                        <span class="excel-menu-icon">üè¢</span>
                                        <div class="excel-menu-content">
                                            <span class="excel-menu-label">ÌòÑÏû¨ Ï∏µÎßå</span>
                                            <span class="excel-menu-hint" x-text="currentFloorLabel + ' Îç∞Ïù¥ÌÑ∞Îßå ÎÇ¥Î≥¥ÎÇ¥Í∏∞'"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- PDF Export with Dropdown Options -->
                            <div class="export-btn-wrapper" x-data="{ pdfMenuOpen: false }" @click.outside="pdfMenuOpen = false">
                                <button class="export-btn" @click="pdfMenuOpen = !pdfMenuOpen" style="position:relative;">
                                    <span class="export-btn-icon">üìï</span>
                                    <span class="export-btn-label">PDF <span style="font-size:10px;">‚ñº</span></span>
                                    <span class="export-btn-hint">Report format</span>
                                </button>
                                <!-- PDF Export Dropdown Menu -->
                                <div class="excel-export-menu" x-show="pdfMenuOpen" x-transition style="display:none;">
                                    <div class="excel-menu-item" @click="generatePDFReport('summary'); pdfMenuOpen = false;">
                                        <span class="excel-menu-icon">üìã</span>
                                        <div class="excel-menu-content">
                                            <span class="excel-menu-label">ÏöîÏïΩ Î≥¥Í≥†ÏÑú</span>
                                            <span class="excel-menu-hint">ÌïµÏã¨ ÏßÄÌëú Î∞è ÏßÑÌñâÎ•† (2-3ÌéòÏù¥ÏßÄ)</span>
                                        </div>
                                    </div>
                                    <div class="excel-menu-item" @click="generatePDFReport('detailed'); pdfMenuOpen = false;">
                                        <span class="excel-menu-icon">üìö</span>
                                        <div class="excel-menu-content">
                                            <span class="excel-menu-label">ÏÉÅÏÑ∏ Î≥¥Í≥†ÏÑú</span>
                                            <span class="excel-menu-hint">Ï∏µÎ≥Ñ ÏÉÅÏÑ∏ ÌòÑÌô© Ìè¨Ìï® (11+ ÌéòÏù¥ÏßÄ)</span>
                                        </div>
                                    </div>
                                    <div class="excel-menu-item" @click="generatePDFReport('issues'); pdfMenuOpen = false;">
                                        <span class="excel-menu-icon">üö®</span>
                                        <div class="excel-menu-content">
                                            <span class="excel-menu-label">Ïù¥Ïäà Î≥¥Í≥†ÏÑú</span>
                                            <span class="excel-menu-hint">ÎØ∏Ìï¥Í≤∞ Ïù¥Ïäà Î∞è ÌÜµÍ≥Ñ</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <hr style="border-color:#30363d; margin:10px 0;">

                    <div>
                        <h3 style="margin:0 0 12px 0; font-size:14px; color:#fff;">üì• Import Data</h3>
                        <div class="import-box" 
                             @click="$refs.importFile.click()"
                             @dragover.prevent="$event.target.classList.add('dragover')"
                             @dragleave="$event.target.classList.remove('dragover')"
                             @drop.prevent="handleFileDrop($event)">
                            <div class="import-box-icon">üìÅ</div>
                            <div class="import-box-text">Drop JSON/CSV file here or click to browse</div>
                            <div class="import-box-hint">Supports: .json, .csv (max 5MB)</div>
                        </div>
                        <input type="file" x-ref="importFile" accept=".json,.csv" style="display:none;" 
                               @change="handleFileImport($event)">
                    </div>
                    
                    <hr style="border-color:#30363d; margin:15px 0;">
                    
                    <!-- MGT Import Section -->
                    <div>
                        <h3 style="margin:0 0 12px 0; font-size:14px; color:#fff;">üèóÔ∏è MGT Ìï¥ÏÑùÎ™®Îç∏ Í∞ÄÏ†∏Ïò§Í∏∞</h3>
                        <p style="margin:0 0 12px 0; font-size:11px; color:#8b949e;">
                            MIDAS Gen/Civil MGT ÌååÏùºÏóêÏÑú ÌèâÎ©¥ Íµ¨Ï°∞Î•º ÏûêÎèôÏúºÎ°ú ÏÉùÏÑ±Ìï©ÎãàÎã§.
                        </p>
                        <div class="import-box" 
                             style="border-color: #8957e5; background: rgba(137, 87, 229, 0.05);"
                             @click="$refs.mgtFile.click()"
                             @dragover.prevent="$event.target.classList.add('dragover')"
                             @dragleave="$event.target.classList.remove('dragover')"
                             @drop.prevent="handleMgtDrop($event)">
                            <div class="import-box-icon">üìê</div>
                            <div class="import-box-text">MGT ÌååÏùºÏùÑ Ïó¨Í∏∞Ïóê ÎìúÎûòÍ∑∏ÌïòÍ±∞ÎÇò ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî</div>
                            <div class="import-box-hint">*.mgt (MIDAS Ìï¥ÏÑùÎ™®Îç∏)</div>
                        </div>
                        <input type="file" x-ref="mgtFile" accept=".mgt" style="display:none;" 
                               @change="handleMgtImport($event)">
                        
                        <!-- MGT Import Progress -->
                        <div x-show="mgtImportStatus.loading" style="margin-top:12px; padding:12px; background:#0d1117; border:1px solid #30363d; border-radius:8px;">
                            <div style="display:flex; align-items:center; gap:10px;">
                                <div class="loading-spinner"></div>
                                <span style="font-size:12px; color:#8b949e;" x-text="mgtImportStatus.message"></span>
                            </div>
                        </div>
                        
                        <!-- MGT Import Result -->
                        <div x-show="mgtImportStatus.success" style="margin-top:12px; padding:12px; background:#0d1117; border:1px solid #238636; border-radius:8px;">
                            <div style="display:flex; align-items:center; gap:10px; color:#3fb950; margin-bottom:8px;">
                                <span>‚úÖ</span>
                                <span style="font-size:12px; font-weight:600;">MGT ÌååÏã± ÏôÑÎ£å</span>
                            </div>
                            <div style="font-size:11px; color:#8b949e;">
                                <div>ÎÖ∏Îìú: <span x-text="mgtImportStatus.nodes"></span>Í∞ú | ÏöîÏÜå: <span x-text="mgtImportStatus.elements"></span>Í∞ú</div>
                                <div>Í∑∏Î¶¨Îìú: <span x-text="mgtImportStatus.cols"></span>Ïó¥ √ó <span x-text="mgtImportStatus.rows"></span>Ìñâ</div>
                                <div style="color:#58a6ff;">üè¢ Ï∏µ Ïàò: <span x-text="mgtImportStatus.floors"></span>Í∞ú (ZÏ¢åÌëú Í∏∞Î∞ò)</div>
                                <div x-show="mgtImportStatus.excludedCols.length > 0" style="color:#d29922;">
                                    ‚ö†Ô∏è Ï†úÏô∏ Ïó¥: <span x-text="mgtImportStatus.excludedCols.join(', ')"></span>
                                </div>
                            </div>
                            <div style="margin-top:10px; display:flex; gap:8px;">
                                <button class="btn btn-success" style="font-size:11px; padding:6px 12px;" @click="applyMgtConfig()">
                                    ‚úÖ ÏÑ§Ï†ï Ï†ÅÏö©
                                </button>
                                <button class="btn" style="font-size:11px; padding:6px 12px;" @click="mgtImportStatus.success = false">
                                    Ï∑®ÏÜå
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- API Config Tab -->
            <div x-show="adminTab === 'api'">
                <div style="margin-bottom:20px;">
                    <h3 style="margin:0 0 8px 0; font-size:14px; color:#fff;">üîó Google Apps Script API</h3>
                    <p style="margin:0; font-size:11px; color:#8b949e;">
                        ÏõπÏï± URLÏùÑ ÏûÖÎ†•ÌïòÎ©¥ Google SheetÍ≥º ÏûêÎèô ÎèôÍ∏∞ÌôîÎê©ÎãàÎã§.
                    </p>
                </div>
                
                <div class="form-group">
                    <label>API Endpoint URL</label>
                    <input type="text" x-model="apiUrl" 
                           placeholder="https://script.google.com/macros/s/YOUR_DEPLOYMENT_ID/exec">
                </div>
                
                <div style="display:flex; gap:10px; margin-top:15px;">
                    <button class="btn" @click="testApiConnection()" :disabled="!apiUrl">
                        üß™ Test Connection
                    </button>
                    <button class="btn btn-success" @click="enableSync()" :disabled="!apiUrl">
                        ‚úÖ Enable Sync
                    </button>
                </div>
                
                <div x-show="syncEnabled" style="margin-top:20px; padding:15px; background:#0d1117; border:1px solid #238636; border-radius:8px;">
                    <div style="display:flex; align-items:center; gap:10px; color:#3fb950;">
                        <span>‚úÖ</span>
                        <span style="font-size:12px; font-weight:600;">Sync Enabled</span>
                    </div>
                    <div style="font-size:11px; color:#8b949e; margin-top:8px;">
                        Last sync: <span x-text="syncStatus.lastSync || 'Never'"></span>
                    </div>
                    <div style="margin-top:10px;">
                        <button class="btn" style="font-size:11px; padding:4px 8px;" @click="syncNow()">
                            üîÑ Sync Now (<span x-text="syncStatus.pending"></span> pending)
                        </button>
                        <button class="btn" style="font-size:11px; padding:4px 8px; margin-left:8px;" @click="disableSync()">
                            Disable
                        </button>
                    </div>
                </div>
            </div>

            <!-- Slack Integration Tab (Phase 11) -->
            <div x-show="adminTab === 'slack'">
                <div style="margin-bottom:20px;">
                    <h3 style="margin:0 0 8px 0; font-size:14px; color:#fff;">üîî Slack Webhook Integration</h3>
                    <p style="margin:0; font-size:11px; color:#8b949e;">
                        Slack WebhookÏùÑ ÏÑ§Ï†ïÌïòÏó¨ ÎåÄÏãúÎ≥¥Îìú Ïù¥Î≤§Ìä∏ ÏïåÎ¶ºÏùÑ Î∞õÏúºÏÑ∏Ïöî.
                    </p>
                </div>

                <!-- Webhook URL Input -->
                <div class="form-group">
                    <label>Webhook URL</label>
                    <div style="position: relative;">
                        <input :type="slackSettings.showWebhookUrl ? 'text' : 'password'"
                               x-model="slackSettings.webhookUrl"
                               placeholder="https://hooks.slack.com/services/T00000000/B00000000/XXXXXXX"
                               style="padding-right: 80px;">
                        <button class="btn"
                                style="position:absolute; right:4px; top:50%; transform:translateY(-50%); padding:4px 8px; font-size:10px;"
                                @click="slackSettings.showWebhookUrl = !slackSettings.showWebhookUrl">
                            <span x-text="slackSettings.showWebhookUrl ? 'Ïà®Í∏∞Í∏∞' : 'Î≥¥Í∏∞'"></span>
                        </button>
                    </div>
                    <div x-show="slackSettings.webhookConfigured && !slackSettings.webhookUrl"
                         style="font-size:11px; color:#8b949e; margin-top:4px;">
                        ÌòÑÏû¨ ÏÑ§Ï†ïÎê®: <span x-text="slackSettings.webhookUrlMasked"></span>
                    </div>
                </div>

                <!-- Notification Settings -->
                <div style="margin-top:20px;">
                    <h4 style="margin:0 0 12px 0; font-size:13px; color:#fff;">ÏïåÎ¶º ÏÑ§Ï†ï</h4>

                    <div class="slack-notification-toggles" style="display:flex; flex-direction:column; gap:12px;">
                        <!-- Critical Issue -->
                        <label class="slack-toggle-item" style="display:flex; align-items:center; justify-content:space-between; padding:10px 12px; background:#0d1117; border:1px solid var(--border-color); border-radius:6px; cursor:pointer;">
                            <div>
                                <div style="font-size:12px; color:#fff;">üö® Critical Ïù¥Ïäà ÏÉùÏÑ±</div>
                                <div style="font-size:10px; color:#8b949e;">Ïã¨Í∞ÅÎèÑÍ∞Ä CriticalÏù∏ Ïù¥ÏäàÍ∞Ä Îì±Î°ùÎê† Îïå</div>
                            </div>
                            <input type="checkbox" x-model="slackSettings.notifications.criticalIssue"
                                   style="width:18px; height:18px; cursor:pointer;">
                        </label>

                        <!-- Status Delay -->
                        <label class="slack-toggle-item" style="display:flex; align-items:center; justify-content:space-between; padding:10px 12px; background:#0d1117; border:1px solid var(--border-color); border-radius:6px; cursor:pointer;">
                            <div>
                                <div style="font-size:12px; color:#fff;">‚è≥ ÏßÄÏó∞ ÏÉÅÌÉú Î≥ÄÍ≤Ω</div>
                                <div style="font-size:10px; color:#8b949e;">Í∏∞Îë• ÏÉÅÌÉúÍ∞Ä "delay"Î°ú Î≥ÄÍ≤ΩÎê† Îïå</div>
                            </div>
                            <input type="checkbox" x-model="slackSettings.notifications.statusDelay"
                                   style="width:18px; height:18px; cursor:pointer;">
                        </label>

                        <!-- Status Blocked/Hold -->
                        <label class="slack-toggle-item" style="display:flex; align-items:center; justify-content:space-between; padding:10px 12px; background:#0d1117; border:1px solid var(--border-color); border-radius:6px; cursor:pointer;">
                            <div>
                                <div style="font-size:12px; color:#fff;">üõë Hold ÏÉÅÌÉú Î≥ÄÍ≤Ω</div>
                                <div style="font-size:10px; color:#8b949e;">Í∏∞Îë• ÏÉÅÌÉúÍ∞Ä "blocked" ÎòêÎäî "hold"Î°ú Î≥ÄÍ≤ΩÎê† Îïå</div>
                            </div>
                            <input type="checkbox" x-model="slackSettings.notifications.statusBlocked"
                                   style="width:18px; height:18px; cursor:pointer;">
                        </label>

                        <!-- Bulk Update -->
                        <label class="slack-toggle-item" style="display:flex; align-items:center; justify-content:space-between; padding:10px 12px; background:#0d1117; border:1px solid var(--border-color); border-radius:6px; cursor:pointer;">
                            <div>
                                <div style="font-size:12px; color:#fff;">üì¶ ÎåÄÎüâ ÏóÖÎç∞Ïù¥Ìä∏</div>
                                <div style="font-size:10px; color:#8b949e;">10Í∞ú Ïù¥ÏÉÅÏùò Í∏∞Îë•Ïù¥ Ìïú Î≤àÏóê Î≥ÄÍ≤ΩÎê† Îïå</div>
                            </div>
                            <input type="checkbox" x-model="slackSettings.notifications.bulkUpdate"
                                   style="width:18px; height:18px; cursor:pointer;">
                        </label>

                        <!-- Daily Summary -->
                        <label class="slack-toggle-item" style="display:flex; align-items:center; justify-content:space-between; padding:10px 12px; background:#0d1117; border:1px solid var(--border-color); border-radius:6px; cursor:pointer;">
                            <div>
                                <div style="font-size:12px; color:#fff;">üìä ÏùºÏùº ÏßÑÌñâÎ•† ÏöîÏïΩ</div>
                                <div style="font-size:10px; color:#8b949e;">Îß§Ïùº ÏßÄÏ†ïÎêú ÏãúÍ∞ÑÏóê ÏßÑÌñâÎ•† ÏöîÏïΩ Ï†ÑÏÜ° (Ìä∏Î¶¨Í±∞ ÏÑ§Ï†ï ÌïÑÏöî)</div>
                            </div>
                            <input type="checkbox" x-model="slackSettings.notifications.dailySummary"
                                   style="width:18px; height:18px; cursor:pointer;">
                        </label>

                        <!-- Issue Resolved -->
                        <label class="slack-toggle-item" style="display:flex; align-items:center; justify-content:space-between; padding:10px 12px; background:#0d1117; border:1px solid var(--border-color); border-radius:6px; cursor:pointer;">
                            <div>
                                <div style="font-size:12px; color:#fff;">‚úÖ Ïù¥Ïäà Ìï¥Í≤∞</div>
                                <div style="font-size:10px; color:#8b949e;">Ïù¥ÏäàÍ∞Ä Ìï¥Í≤∞ ÏÉÅÌÉúÎ°ú Î≥ÄÍ≤ΩÎê† Îïå</div>
                            </div>
                            <input type="checkbox" x-model="slackSettings.notifications.issueResolved"
                                   style="width:18px; height:18px; cursor:pointer;">
                        </label>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div style="display:flex; gap:10px; margin-top:20px; flex-wrap:wrap;">
                    <button class="btn btn-success" @click="saveSlackSettings()" :disabled="slackSettings.saving">
                        <span x-show="!slackSettings.saving">üíæ ÏÑ§Ï†ï Ï†ÄÏû•</span>
                        <span x-show="slackSettings.saving">Ï†ÄÏû• Ï§ë...</span>
                    </button>
                    <button class="btn" @click="testSlackNotification()"
                            :disabled="slackSettings.testing || (!slackSettings.webhookUrl && !slackSettings.webhookConfigured)">
                        <span x-show="!slackSettings.testing">üß™ ÌÖåÏä§Ìä∏ ÏïåÎ¶º Ï†ÑÏÜ°</span>
                        <span x-show="slackSettings.testing">Ï†ÑÏÜ° Ï§ë...</span>
                    </button>
                    <button class="btn" @click="clearSlackWebhook()"
                            x-show="slackSettings.webhookConfigured || slackSettings.webhookUrl"
                            style="color:#da3633;">
                        üóëÔ∏è Webhook ÏÇ≠Ï†ú
                    </button>
                </div>

                <!-- Status Message -->
                <div x-show="slackSettings.message"
                     :class="{'success': slackSettings.messageType === 'success', 'error': slackSettings.messageType === 'error'}"
                     style="margin-top:15px; padding:10px 12px; border-radius:6px; font-size:12px;"
                     :style="slackSettings.messageType === 'success' ? 'background:#0d1117; border:1px solid #238636; color:#3fb950;' : 'background:#0d1117; border:1px solid #da3633; color:#f85149;'">
                    <span x-text="slackSettings.message"></span>
                </div>

                <!-- Help Section -->
                <div style="margin-top:20px; padding:15px; background:#0d1117; border:1px solid var(--border-color); border-radius:8px;">
                    <h4 style="margin:0 0 10px 0; font-size:12px; color:#fff;">üìñ Slack Webhook ÏÑ§Ï†ï Î∞©Î≤ï</h4>
                    <ol style="margin:0; padding-left:20px; font-size:11px; color:#8b949e; line-height:1.8;">
                        <li>Slack ÏõåÌÅ¨Ïä§ÌéòÏù¥Ïä§ÏóêÏÑú <a href="https://api.slack.com/apps" target="_blank" style="color:#58a6ff;">Slack App</a>ÏùÑ ÏÉùÏÑ±Ìï©ÎãàÎã§.</li>
                        <li>"Incoming Webhooks" Í∏∞Îä•ÏùÑ ÌôúÏÑ±ÌôîÌï©ÎãàÎã§.</li>
                        <li>ÏïåÎ¶ºÏùÑ Î∞õÏùÑ Ï±ÑÎÑêÏùÑ ÏÑ†ÌÉùÌïòÍ≥† Webhook URLÏùÑ ÏÉùÏÑ±Ìï©ÎãàÎã§.</li>
                        <li>ÏÉùÏÑ±Îêú URLÏùÑ ÏúÑ ÏûÖÎ†•ÎûÄÏóê Î∂ôÏó¨ÎÑ£Í≥† Ï†ÄÏû•Ìï©ÎãàÎã§.</li>
                        <li>"ÌÖåÏä§Ìä∏ ÏïåÎ¶º Ï†ÑÏÜ°" Î≤ÑÌäºÏúºÎ°ú Ïó∞ÎèôÏùÑ ÌôïÏù∏Ìï©ÎãàÎã§.</li>
                    </ol>
                </div>
            </div>

            <!-- Email Integration Tab (Phase 12) -->
            <div x-show="adminTab === 'email'">
                <div style="margin-bottom:20px;">
                    <h3 style="margin:0 0 8px 0; font-size:14px; color:#fff;">üìß Email ÏïåÎ¶º Integration</h3>
                    <p style="margin:0; font-size:11px; color:#8b949e;">
                        Ïù¥Î©îÏùº ÏàòÏã†ÏûêÎ•º ÏÑ§Ï†ïÌïòÏó¨ ÎåÄÏãúÎ≥¥Îìú Ïù¥Î≤§Ìä∏ ÏïåÎ¶ºÏùÑ Î∞õÏúºÏÑ∏Ïöî.
                    </p>
                </div>

                <!-- Email Recipients Management -->
                <div class="form-group">
                    <label>ÏàòÏã†Ïûê Ïù¥Î©îÏùº Î™©Î°ù</label>
                    <div style="margin-bottom:12px;">
                        <div style="display:flex; gap:8px;">
                            <input type="email"
                                   x-model="emailSettings.newRecipient"
                                   placeholder="email@example.com"
                                   @keydown.enter="addEmailRecipient()"
                                   style="flex:1;">
                            <button class="btn btn-primary"
                                    style="padding:8px 16px; white-space:nowrap;"
                                    @click="addEmailRecipient()"
                                    :disabled="!emailSettings.newRecipient">
                                + Ï∂îÍ∞Ä
                            </button>
                        </div>
                    </div>

                    <!-- Recipients List -->
                    <div x-show="emailSettings.recipients.length > 0"
                         style="max-height:150px; overflow-y:auto; background:#0d1117; border:1px solid var(--border-color); border-radius:6px; padding:8px;">
                        <template x-for="(email, index) in emailSettings.recipients" :key="index">
                            <div style="display:flex; align-items:center; justify-content:space-between; padding:6px 8px; border-bottom:1px solid #21262d;">
                                <span style="font-size:12px; color:#c9d1d9; font-family:monospace;" x-text="email"></span>
                                <button class="btn"
                                        style="padding:2px 8px; font-size:10px; color:#f85149;"
                                        @click="removeEmailRecipient(index)">
                                    ‚úï
                                </button>
                            </div>
                        </template>
                    </div>
                    <div x-show="emailSettings.recipients.length === 0"
                         style="padding:20px; text-align:center; background:#0d1117; border:1px solid var(--border-color); border-radius:6px;">
                        <span style="font-size:12px; color:#8b949e;">Îì±Î°ùÎêú ÏàòÏã†ÏûêÍ∞Ä ÏóÜÏäµÎãàÎã§</span>
                    </div>
                    <div style="font-size:11px; color:#8b949e; margin-top:8px;">
                        ÌòÑÏû¨ <span x-text="emailSettings.recipients.length"></span>Î™ÖÏùò ÏàòÏã†ÏûêÍ∞Ä Îì±Î°ùÎêòÏñ¥ ÏûàÏäµÎãàÎã§.
                    </div>
                </div>

                <!-- Notification Settings -->
                <div style="margin-top:20px;">
                    <h4 style="margin:0 0 12px 0; font-size:13px; color:#fff;">ÏïåÎ¶º ÏÑ§Ï†ï</h4>

                    <div class="email-notification-toggles" style="display:flex; flex-direction:column; gap:12px;">
                        <!-- Critical Issue -->
                        <label class="email-toggle-item" style="display:flex; align-items:center; justify-content:space-between; padding:10px 12px; background:#0d1117; border:1px solid var(--border-color); border-radius:6px; cursor:pointer;">
                            <div>
                                <div style="font-size:12px; color:#fff;">üö® Critical Ïù¥Ïäà ÏÉùÏÑ±</div>
                                <div style="font-size:10px; color:#8b949e;">Ïã¨Í∞ÅÎèÑÍ∞Ä CriticalÏù∏ Ïù¥ÏäàÍ∞Ä Îì±Î°ùÎê† Îïå</div>
                            </div>
                            <input type="checkbox" x-model="emailSettings.notifications.criticalIssue"
                                   style="width:18px; height:18px; cursor:pointer;">
                        </label>

                        <!-- Status Delay -->
                        <label class="email-toggle-item" style="display:flex; align-items:center; justify-content:space-between; padding:10px 12px; background:#0d1117; border:1px solid var(--border-color); border-radius:6px; cursor:pointer;">
                            <div>
                                <div style="font-size:12px; color:#fff;">‚è≥ ÏßÄÏó∞ ÏÉÅÌÉú Î≥ÄÍ≤Ω</div>
                                <div style="font-size:10px; color:#8b949e;">Í∏∞Îë• ÏÉÅÌÉúÍ∞Ä "delay"Î°ú Î≥ÄÍ≤ΩÎê† Îïå</div>
                            </div>
                            <input type="checkbox" x-model="emailSettings.notifications.statusDelay"
                                   style="width:18px; height:18px; cursor:pointer;">
                        </label>

                        <!-- Status Blocked/Hold -->
                        <label class="email-toggle-item" style="display:flex; align-items:center; justify-content:space-between; padding:10px 12px; background:#0d1117; border:1px solid var(--border-color); border-radius:6px; cursor:pointer;">
                            <div>
                                <div style="font-size:12px; color:#fff;">üö´ Ï§ëÎã®/Î≥¥Î•ò ÏÉÅÌÉú Î≥ÄÍ≤Ω</div>
                                <div style="font-size:10px; color:#8b949e;">Í∏∞Îë• ÏÉÅÌÉúÍ∞Ä "blocked" ÎòêÎäî "hold"Î°ú Î≥ÄÍ≤ΩÎê† Îïå</div>
                            </div>
                            <input type="checkbox" x-model="emailSettings.notifications.statusBlocked"
                                   style="width:18px; height:18px; cursor:pointer;">
                        </label>

                        <!-- Bulk Update -->
                        <label class="email-toggle-item" style="display:flex; align-items:center; justify-content:space-between; padding:10px 12px; background:#0d1117; border:1px solid var(--border-color); border-radius:6px; cursor:pointer;">
                            <div>
                                <div style="font-size:12px; color:#fff;">üì¶ ÎåÄÎüâ ÏÉÅÌÉú Î≥ÄÍ≤Ω</div>
                                <div style="font-size:10px; color:#8b949e;">10Í∞ú Ïù¥ÏÉÅÏùò Í∏∞Îë•Ïù¥ ÏùºÍ¥Ñ Î≥ÄÍ≤ΩÎê† Îïå</div>
                            </div>
                            <input type="checkbox" x-model="emailSettings.notifications.bulkUpdate"
                                   style="width:18px; height:18px; cursor:pointer;">
                        </label>

                        <!-- Weekly Summary -->
                        <label class="email-toggle-item" style="display:flex; align-items:center; justify-content:space-between; padding:10px 12px; background:#0d1117; border:1px solid var(--border-color); border-radius:6px; cursor:pointer;">
                            <div>
                                <div style="font-size:12px; color:#fff;">üìä Ï£ºÍ∞Ñ ÏßÑÌñâÎ•† ÏöîÏïΩ</div>
                                <div style="font-size:10px; color:#8b949e;">Ï£ºÍ∞Ñ ÏßÑÌñâÎ•† ÏöîÏïΩ Î¶¨Ìè¨Ìä∏ (Ìä∏Î¶¨Í±∞ ÌïÑÏöî)</div>
                            </div>
                            <input type="checkbox" x-model="emailSettings.notifications.weeklySummary"
                                   style="width:18px; height:18px; cursor:pointer;">
                        </label>

                        <!-- Issue Resolved -->
                        <label class="email-toggle-item" style="display:flex; align-items:center; justify-content:space-between; padding:10px 12px; background:#0d1117; border:1px solid var(--border-color); border-radius:6px; cursor:pointer;">
                            <div>
                                <div style="font-size:12px; color:#fff;">‚úÖ Ïù¥Ïäà Ìï¥Í≤∞</div>
                                <div style="font-size:10px; color:#8b949e;">Ïù¥ÏäàÍ∞Ä Ìï¥Í≤∞ ÏÉÅÌÉúÎ°ú Î≥ÄÍ≤ΩÎê† Îïå</div>
                            </div>
                            <input type="checkbox" x-model="emailSettings.notifications.issueResolved"
                                   style="width:18px; height:18px; cursor:pointer;">
                        </label>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div style="display:flex; gap:10px; margin-top:20px; flex-wrap:wrap;">
                    <button class="btn btn-success" @click="saveEmailSettings()" :disabled="emailSettings.saving">
                        <span x-show="!emailSettings.saving">üíæ ÏÑ§Ï†ï Ï†ÄÏû•</span>
                        <span x-show="emailSettings.saving">Ï†ÄÏû• Ï§ë...</span>
                    </button>
                    <button class="btn" @click="testEmailNotification()"
                            :disabled="emailSettings.testing || emailSettings.recipients.length === 0">
                        <span x-show="!emailSettings.testing">üß™ ÌÖåÏä§Ìä∏ Ïù¥Î©îÏùº Ï†ÑÏÜ°</span>
                        <span x-show="emailSettings.testing">Ï†ÑÏÜ° Ï§ë...</span>
                    </button>
                    <button class="btn" @click="clearAllEmailRecipients()"
                            x-show="emailSettings.recipients.length > 0"
                            style="color:#da3633;">
                        üóëÔ∏è Ï†ÑÏ≤¥ ÏÇ≠Ï†ú
                    </button>
                </div>

                <!-- Status Message -->
                <div x-show="emailSettings.message"
                     :class="{'success': emailSettings.messageType === 'success', 'error': emailSettings.messageType === 'error'}"
                     style="margin-top:15px; padding:10px 12px; border-radius:6px; font-size:12px;"
                     :style="emailSettings.messageType === 'success' ? 'background:#0d1117; border:1px solid #238636; color:#3fb950;' : 'background:#0d1117; border:1px solid #da3633; color:#f85149;'">
                    <span x-text="emailSettings.message"></span>
                </div>

                <!-- Help Section -->
                <div style="margin-top:20px; padding:15px; background:#0d1117; border:1px solid var(--border-color); border-radius:8px;">
                    <h4 style="margin:0 0 10px 0; font-size:12px; color:#fff;">üìñ Email ÏïåÎ¶º ÏÑ§Ï†ï ÏïàÎÇ¥</h4>
                    <ul style="margin:0; padding-left:20px; font-size:11px; color:#8b949e; line-height:1.8;">
                        <li>ÏàòÏã†Ïûê Ïù¥Î©îÏùº Ï£ºÏÜåÎ•º Ï∂îÍ∞ÄÌïòÎ©¥ Ìï¥Îãπ Ïù¥Î©îÏùºÎ°ú ÏïåÎ¶ºÏù¥ Î∞úÏÜ°Îê©ÎãàÎã§.</li>
                        <li>Google Apps ScriptÏùò MailAppÏùÑ ÌÜµÌï¥ Î∞úÏÜ°ÎêòÎ©∞, Î∞úÏã†ÏûêÎäî Ïä§ÌÅ¨Î¶ΩÌä∏ ÏÜåÏú†ÏûêÏûÖÎãàÎã§.</li>
                        <li>Ï£ºÍ∞Ñ ÏöîÏïΩ Î¶¨Ìè¨Ìä∏Îäî Apps Script Ìä∏Î¶¨Í±∞ ÏÑ§Ï†ïÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.</li>
                        <li>"ÌÖåÏä§Ìä∏ Ïù¥Î©îÏùº Ï†ÑÏÜ°" Î≤ÑÌäºÏúºÎ°ú Ïù¥Î©îÏùº ÏàòÏã†ÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Phase 9: History Panel -->
<div class="history-panel" :class="{'open': historyPanelOpen}" x-cloak>
    <div class="history-panel-header">
        <h3>üìú Î≥ÄÍ≤Ω Ïù¥Î†•</h3>
        <div class="history-controls">
            <select x-model="historyFilter" class="history-filter-select">
                <option value="all">Ï†ÑÏ≤¥</option>
                <option value="status">ÏÉÅÌÉú Î≥ÄÍ≤Ω</option>
                <option value="issue">Ïù¥Ïäà Í¥ÄÎ†®</option>
                <option value="lock">Ïû†Í∏à/Ìï¥Ï†ú</option>
                <option value="import">Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞</option>
            </select>
            <button class="btn" style="padding:4px 8px;" @click="historyPanelOpen = false">‚úï</button>
        </div>
    </div>
    <div class="history-panel-body">
        <template x-if="filteredHistory.length === 0">
            <div class="history-empty">
                <span>üìã</span>
                <p>Î≥ÄÍ≤Ω Ïù¥Î†•Ïù¥ ÏóÜÏäµÎãàÎã§</p>
            </div>
        </template>
        <template x-for="group in groupedHistory" :key="group.date">
            <div class="history-date-group">
                <div class="history-date-label" x-text="group.dateLabel"></div>
                <template x-for="item in group.items" :key="item.id">
                    <div class="history-item" @click="openHistoryDetail(item)">
                        <div class="history-item-icon" :class="item.type" x-text="getHistoryIcon(item.type)"></div>
                        <div class="history-item-content">
                            <div class="history-item-title" x-text="item.title"></div>
                            <div class="history-item-meta">
                                <span x-text="item.user || 'System'"></span>
                                <span>‚Ä¢</span>
                                <span x-text="formatHistoryTime(item.timestamp)"></span>
                            </div>
                        </div>
                        <div class="history-item-badge" :class="item.type" x-text="item.affectedCount || 1"></div>
                    </div>
                </template>
            </div>
        </template>
    </div>
    <div class="history-panel-footer">
        <button class="btn" @click="loadMoreHistory()" x-show="hasMoreHistory">Îçî Î≥¥Í∏∞</button>
        <button class="btn" @click="exportHistory()">üì• CSV ÎÇ¥Î≥¥ÎÇ¥Í∏∞</button>
    </div>
</div>

<!-- WP-4: Report Panel -->
<div class="report-panel-overlay" x-show="showReportPanel" x-cloak @click.self="showReportPanel = false"
     role="dialog" aria-modal="true" aria-labelledby="report-panel-title">
    <div class="report-panel">
        <div class="report-panel-header">
            <h2 id="report-panel-title">üìä Í≥†Í∏â Î¶¨Ìè¨Ìä∏</h2>
            <button class="btn" @click="showReportPanel = false" aria-label="Î¶¨Ìè¨Ìä∏ Ìå®ÎÑê Îã´Í∏∞">‚úï</button>
        </div>

        <!-- Report Tabs -->
        <div class="report-tabs" role="tablist" aria-label="Î≥¥Í≥†ÏÑú ÌÉ≠" style="padding: 0 20px;">
            <button class="report-tab" role="tab"
                    :class="{ 'active': reportTab === 'overview' }"
                    :aria-selected="reportTab === 'overview'"
                    :tabindex="reportTab === 'overview' ? 0 : -1"
                    @click="reportTab = 'overview'">
                üìà Í∞úÏöî
            </button>
            <button class="report-tab" role="tab"
                    :class="{ 'active': reportTab === 'zones' }"
                    :aria-selected="reportTab === 'zones'"
                    :tabindex="reportTab === 'zones' ? 0 : -1"
                    @click="reportTab = 'zones'">
                üóÇÔ∏è ZoneÎ≥Ñ ÌòÑÌô©
            </button>
            <button class="report-tab" role="tab"
                    :class="{ 'active': reportTab === 'issues' }"
                    :aria-selected="reportTab === 'issues'"
                    :tabindex="reportTab === 'issues' ? 0 : -1"
                    @click="reportTab = 'issues'">
                üö® Ïù¥Ïäà ÌÜµÍ≥Ñ
            </button>
            <button class="report-tab" role="tab"
                    :class="{ 'active': reportTab === 'trend' }"
                    :aria-selected="reportTab === 'trend'"
                    :tabindex="reportTab === 'trend' ? 0 : -1"
                    @click="reportTab = 'trend'">
                üìâ Ìä∏Î†åÎìú
            </button>
        </div>

        <div class="report-panel-body">
            <!-- Overview Tab -->
            <template x-if="reportTab === 'overview'">
                <div>
                    <!-- Stats Grid -->
                    <div class="stats-grid">
                        <div class="stat-card success">
                            <div class="stat-value" x-text="getOverallProgress() + '%'"></div>
                            <div class="stat-label">Ï†ÑÏ≤¥ ÏßÑÌñâÎ•†</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" x-text="Object.keys(columns).length.toLocaleString()"></div>
                            <div class="stat-label">Ï¥ù Í∏∞Îë• Ïàò</div>
                        </div>
                        <div class="stat-card critical">
                            <div class="stat-value" x-text="openIssues.length"></div>
                            <div class="stat-label">ÎØ∏Ìï¥Í≤∞ Ïù¥Ïäà</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" x-text="Object.values(columns).filter(c => c.status?.code === 'complete').length"></div>
                            <div class="stat-label">ÏôÑÎ£å Í∏∞Îë•</div>
                        </div>
                    </div>

                    <!-- Stage Progress -->
                    <div class="chart-container">
                        <div class="chart-title">
                            <span class="chart-icon">üîß</span>
                            Í≥µÏ†ïÎ≥Ñ ÏßÑÌñâ ÌòÑÌô©
                        </div>
                        <div class="progress-list">
                            <template x-for="stage in stageConfigs" :key="stage.code">
                                <div class="progress-item">
                                    <div class="progress-item-label" x-text="stage.label"></div>
                                    <div class="progress-item-bar">
                                        <div class="progress-item-fill"
                                             :style="`width: ${getStageProgress(stage.code)}%; background: ${stage.color};`"></div>
                                    </div>
                                    <div class="progress-item-value" x-text="getStageProgress(stage.code) + '%'"></div>
                                </div>
                            </template>
                        </div>
                    </div>

                    <!-- Status Distribution Donut -->
                    <div class="chart-container">
                        <div class="chart-title">
                            <span class="chart-icon">üç©</span>
                            ÏÉÅÌÉúÎ≥Ñ Î∂ÑÌè¨
                        </div>
                        <div class="donut-chart-container">
                            <svg class="donut-chart-svg" viewBox="0 0 150 150" width="150" height="150"
                                 x-html="getStatusDonutSVG()">
                            </svg>
                            <div class="donut-legend">
                                <template x-for="(item, code) in statusCodes" :key="code">
                                    <div class="donut-legend-item">
                                        <div class="donut-legend-dot" :style="`background: ${item.color}`"></div>
                                        <span x-text="item.label"></span>
                                        <span class="donut-legend-value"
                                              x-text="Object.values(columns).filter(c => c.status?.code === code).length"></span>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>
            </template>

            <!-- Zones Tab -->
            <template x-if="reportTab === 'zones'">
                <div>
                    <div class="chart-container">
                        <div class="chart-title">
                            <span class="chart-icon">üóÇÔ∏è</span>
                            ZoneÎ≥Ñ ÏßÑÌñâÎ•†
                        </div>
                        <div class="progress-list">
                            <template x-for="zone in zones" :key="zone.id">
                                <div class="progress-item">
                                    <div class="progress-item-label" x-text="zone.name"></div>
                                    <div class="progress-item-bar">
                                        <div class="progress-item-fill"
                                             :style="`width: ${getZoneProgress(zone)}%; background: ${zone.color || '#238636'};`"></div>
                                    </div>
                                    <div class="progress-item-value" x-text="getZoneProgress(zone) + '%'"></div>
                                </div>
                            </template>
                        </div>
                    </div>

                    <!-- Zone Detail Table -->
                    <div class="chart-container">
                        <div class="chart-title">
                            <span class="chart-icon">üìã</span>
                            ZoneÎ≥Ñ ÏÉÅÏÑ∏ ÌòÑÌô©
                        </div>
                        <table class="issue-table">
                            <thead>
                                <tr>
                                    <th>Zone</th>
                                    <th>Ï†ÑÏ≤¥</th>
                                    <th>ÏôÑÎ£å</th>
                                    <th>ÏßÑÌñâÏ§ë</th>
                                    <th>ÎØ∏Ï∞©Ïàò</th>
                                    <th>ÏßÑÌñâÎ•†</th>
                                </tr>
                            </thead>
                            <tbody>
                                <template x-for="zone in zones" :key="zone.id">
                                    <tr>
                                        <td x-text="zone.name"></td>
                                        <td x-text="getZoneColumnCount(zone)"></td>
                                        <td x-text="getZoneStatusCount(zone, 'complete')"></td>
                                        <td x-text="getZoneStatusCount(zone, 'in_progress')"></td>
                                        <td x-text="getZoneStatusCount(zone, 'not_started')"></td>
                                        <td><span class="severity-badge low" x-text="getZoneProgress(zone) + '%'"></span></td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </template>

            <!-- Issues Tab -->
            <template x-if="reportTab === 'issues'">
                <div>
                    <!-- Issue Stats -->
                    <div class="stats-grid">
                        <div class="stat-card critical">
                            <div class="stat-value" x-text="issues.filter(i => i.severity === 'critical' && i.status === 'open').length"></div>
                            <div class="stat-label">Critical Ïù¥Ïäà</div>
                        </div>
                        <div class="stat-card high">
                            <div class="stat-value" x-text="issues.filter(i => i.severity === 'high' && i.status === 'open').length"></div>
                            <div class="stat-label">High Ïù¥Ïäà</div>
                        </div>
                        <div class="stat-card medium">
                            <div class="stat-value" x-text="issues.filter(i => i.severity === 'medium' && i.status === 'open').length"></div>
                            <div class="stat-label">Medium Ïù¥Ïäà</div>
                        </div>
                        <div class="stat-card success">
                            <div class="stat-value" x-text="issues.filter(i => i.status === 'resolved').length"></div>
                            <div class="stat-label">Ìï¥Í≤∞Îê®</div>
                        </div>
                    </div>

                    <!-- Issue Severity Donut -->
                    <div class="chart-container">
                        <div class="chart-title">
                            <span class="chart-icon">üéØ</span>
                            Ïã¨Í∞ÅÎèÑÎ≥Ñ Ïù¥Ïäà Î∂ÑÌè¨
                        </div>
                        <div class="donut-chart-container">
                            <svg class="donut-chart-svg" viewBox="0 0 150 150" width="150" height="150"
                                 x-html="getIssueSeverityDonutSVG()">
                            </svg>
                            <div class="donut-legend">
                                <div class="donut-legend-item">
                                    <div class="donut-legend-dot" style="background: #f85149;"></div>
                                    <span>Critical</span>
                                    <span class="donut-legend-value" x-text="issues.filter(i => i.severity === 'critical').length"></span>
                                </div>
                                <div class="donut-legend-item">
                                    <div class="donut-legend-dot" style="background: #f97316;"></div>
                                    <span>High</span>
                                    <span class="donut-legend-value" x-text="issues.filter(i => i.severity === 'high').length"></span>
                                </div>
                                <div class="donut-legend-item">
                                    <div class="donut-legend-dot" style="background: #d29922;"></div>
                                    <span>Medium</span>
                                    <span class="donut-legend-value" x-text="issues.filter(i => i.severity === 'medium').length"></span>
                                </div>
                                <div class="donut-legend-item">
                                    <div class="donut-legend-dot" style="background: #238636;"></div>
                                    <span>Low</span>
                                    <span class="donut-legend-value" x-text="issues.filter(i => i.severity === 'low').length"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Issues -->
                    <div class="chart-container">
                        <div class="chart-title">
                            <span class="chart-icon">üìã</span>
                            ÏµúÍ∑º Ïù¥Ïäà Î™©Î°ù
                        </div>
                        <table class="issue-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Ï†úÎ™©</th>
                                    <th>Ïã¨Í∞ÅÎèÑ</th>
                                    <th>ÏÉÅÌÉú</th>
                                    <th>Î≥¥Í≥†Ïùº</th>
                                </tr>
                            </thead>
                            <tbody>
                                <template x-for="issue in issues.slice(0, 10)" :key="issue.id">
                                    <tr>
                                        <td x-text="issue.id"></td>
                                        <td x-text="issue.title.substring(0, 30) + (issue.title.length > 30 ? '...' : '')"></td>
                                        <td>
                                            <span class="severity-badge" :class="issue.severity" x-text="issue.severity"></span>
                                        </td>
                                        <td x-text="issue.status === 'open' ? 'ÎØ∏Ìï¥Í≤∞' : 'Ìï¥Í≤∞Îê®'"></td>
                                        <td x-text="issue.reportedAt ? new Date(issue.reportedAt).toLocaleDateString('ko-KR') : '-'"></td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </template>

            <!-- Trend Tab -->
            <template x-if="reportTab === 'trend'">
                <div>
                    <div class="chart-container">
                        <div class="chart-title">
                            <span class="chart-icon">üìâ</span>
                            ÏùºÎ≥Ñ ÏûëÏóÖ ÌòÑÌô© (ÏµúÍ∑º 14Ïùº)
                        </div>
                        <div class="trend-chart-container" style="height: 200px; position: relative;">
                            <svg class="chart-svg" viewBox="0 0 600 180" preserveAspectRatio="xMidYMid meet" style="width: 100%; height: 100%;">
                                <!-- Grid lines -->
                                <line x1="40" y1="20" x2="580" y2="20" class="chart-grid-line"/>
                                <line x1="40" y1="60" x2="580" y2="60" class="chart-grid-line"/>
                                <line x1="40" y1="100" x2="580" y2="100" class="chart-grid-line"/>
                                <line x1="40" y1="140" x2="580" y2="140" class="chart-grid-line"/>

                                <!-- Trend Line - simplified for Vite compatibility -->
                                <g x-show="getTrendData().length > 0">
                                    <path :d="getTrendLinePath()" class="chart-area" fill="#238636"/>
                                    <path :d="getTrendLinePath(false)" class="chart-line" stroke="#238636" fill="none"/>
                                </g>
                            </svg>
                            <!-- Trend data labels rendered separately -->
                            <div style="display:flex; justify-content:space-between; padding: 0 40px; margin-top: 8px;">
                                <template x-for="(point, idx) in getTrendData()" :key="'label-' + idx">
                                    <span x-show="idx % 2 === 0 || idx === getTrendData().length - 1"
                                          class="chart-axis-label" style="font-size: 10px; color: var(--text-muted);"
                                          x-text="point.label"></span>
                                </template>
                            </div>
                        </div>
                    </div>

                    <!-- History Summary -->
                    <div class="chart-container">
                        <div class="chart-title">
                            <span class="chart-icon">üìú</span>
                            ÏµúÍ∑º ÌôúÎèô ÏöîÏïΩ
                        </div>
                        <div class="stats-grid" style="grid-template-columns: repeat(3, 1fr);">
                            <div class="stat-card">
                                <div class="stat-value" x-text="getTrendData().reduce((sum, d) => sum + d.changes, 0)"></div>
                                <div class="stat-label">Ï¥ù Î≥ÄÍ≤Ω (14Ïùº)</div>
                            </div>
                            <div class="stat-card success">
                                <div class="stat-value" x-text="getTrendData().reduce((sum, d) => sum + d.completions, 0)"></div>
                                <div class="stat-label">ÏôÑÎ£å Í±¥Ïàò</div>
                            </div>
                            <div class="stat-card critical">
                                <div class="stat-value" x-text="getTrendData().reduce((sum, d) => sum + d.issues, 0)"></div>
                                <div class="stat-label">Ïã†Í∑ú Ïù¥Ïäà</div>
                            </div>
                        </div>
                    </div>
                </div>
            </template>
        </div>

        <!-- Report Actions -->
        <div class="report-actions">
            <button class="report-btn" @click="exportReportToCSV()">
                üìä CSV ÎÇ¥Î≥¥ÎÇ¥Í∏∞
            </button>
            <button class="report-btn" @click="generatePDFReport('detailed')">
                üìï PDF Î≥¥Í≥†ÏÑú
            </button>
            <button class="report-btn primary" @click="showReportPanel = false">
                Îã´Í∏∞
            </button>
        </div>
    </div>
</div>

<!-- WP-1: FAB (Floating Action Button) -->
<div class="fab-container" x-data="{ fabOpen: false }" @click.outside="fabOpen = false">
    <!-- FAB Action Buttons -->
    <div class="fab-actions" :class="{ 'open': fabOpen }">
        <div class="fab-action">
            <span class="fab-action-label">Ïù¥Ïäà ÏÉùÏÑ±</span>
            <button class="fab-action-btn warning"
                    @click="fabOpen = false; openIssueForm()"
                    aria-label="ÏÉà Ïù¥Ïäà ÏÉùÏÑ±">
                üö®
            </button>
        </div>
        <div class="fab-action" x-show="selectedCells.length > 0">
            <span class="fab-action-label">ÏùºÍ¥Ñ Ìé∏Ïßë</span>
            <button class="fab-action-btn"
                    @click="fabOpen = false; openBulkEdit()"
                    aria-label="ÏÑ†ÌÉù Ìï≠Î™© ÏùºÍ¥Ñ Ìé∏Ïßë">
                ‚úèÔ∏è
            </button>
        </div>
        <div class="fab-action">
            <span class="fab-action-label">Îπ†Î•∏ ÎèôÍ∏∞Ìôî</span>
            <button class="fab-action-btn success"
                    @click="fabOpen = false; syncNow()"
                    aria-label="Google Sheet ÎèôÍ∏∞Ìôî">
                üîÑ
            </button>
        </div>
        <div class="fab-action">
            <span class="fab-action-label">PDF Î¶¨Ìè¨Ìä∏</span>
            <button class="fab-action-btn"
                    @click="fabOpen = false; generatePDFReport()"
                    aria-label="PDF Î¶¨Ìè¨Ìä∏ ÏÉùÏÑ±">
                üìÑ
            </button>
        </div>
    </div>

    <!-- Main FAB Button -->
    <button class="fab-main touch-target"
            :class="{ 'open': fabOpen }"
            @click="fabOpen = !fabOpen"
            aria-label="Îπ†Î•∏ ÏûëÏóÖ Î©îÎâ¥"
            aria-expanded="fabOpen">
        ‚ûï
    </button>
</div>

<!-- WP-1: Touch Drag Selection Overlay -->
<div class="touch-drag-overlay"
     x-show="touchDragActive"
     x-cloak
     role="region"
     aria-label="ÌÑ∞Ïπò ÎìúÎûòÍ∑∏ ÏÑ†ÌÉù ÏòÅÏó≠"
     aria-hidden="!touchDragActive">
    <div class="touch-drag-rect"
         :style="`
             left: ${Math.min(touchDragStart.x, touchDragEnd.x)}px;
             top: ${Math.min(touchDragStart.y, touchDragEnd.y)}px;
             width: ${Math.abs(touchDragEnd.x - touchDragStart.x)}px;
             height: ${Math.abs(touchDragEnd.y - touchDragStart.y)}px;
         `"
         role="presentation">
    </div>
</div>

<!-- WP-1: Touch Selection Hint -->
<div class="touch-select-hint"
     x-show="touchDragActive && touchDragCellCount > 0"
     x-cloak
     role="status"
     aria-live="polite"
     aria-atomic="true">
    <span aria-hidden="true">üì±</span>
    <span x-text="touchDragCellCount + 'Í∞ú ÏÖÄ ÏÑ†ÌÉù Ï§ë...'"></span>
</div>

<!-- Mobile Bottom Navigation -->
<nav class="mobile-nav" x-cloak>
    <div class="mobile-nav-item" :class="{'active': mobileNavTab === 'grid'}" @click="mobileNavTab = 'grid'; sidebarOpen = false">
        <span class="nav-icon">üìä</span>
        <span>Í∑∏Î¶¨Îìú</span>
    </div>
    <div class="mobile-nav-item" :class="{'active': issuePanelOpen}" @click="toggleIssuePanel(); mobileNavTab = 'issues'">
        <span class="nav-icon">üö®</span>
        <span>Ïù¥Ïäà</span>
        <template x-if="openIssues.length > 0">
            <span class="nav-badge" x-text="openIssues.length > 9 ? '9+' : openIssues.length"></span>
        </template>
    </div>
    <div class="mobile-nav-item" :class="{'active': notificationPanelOpen}" @click="toggleNotificationPanel(); mobileNavTab = 'notifications'">
        <span class="nav-icon">üîî</span>
        <span>ÏïåÎ¶º</span>
        <template x-if="unreadNotificationCount > 0">
            <span class="nav-badge" x-text="unreadNotificationCount > 9 ? '9+' : unreadNotificationCount"></span>
        </template>
    </div>
    <div class="mobile-nav-item" :class="{'active': sidebarOpen}" @click="sidebarOpen = !sidebarOpen; mobileNavTab = sidebarOpen ? 'menu' : 'grid'">
        <span class="nav-icon">‚ò∞</span>
        <span>Î©îÎâ¥</span>
    </div>
</nav>

<!-- Sidebar Backdrop (Mobile Only) -->
<div class="sidebar-backdrop" :class="{'open': sidebarOpen}" @click="sidebarOpen = false" x-cloak></div>

<!-- Toast Notification -->
<template x-if="toast.show">
    <div class="toast" :class="toast.type" x-show="toast.show" x-cloak>
        <span x-text="toast.message"></span>
    </div>
</template>

<script>
// ===== Security Utilities (Phase 10) =====

/**
 * HTML ÌäπÏàòÎ¨∏Ïûê Ïù¥Ïä§ÏºÄÏù¥ÌîÑ (XSS Î∞©ÏßÄ)
 * @param {string} str - Ïù¥Ïä§ÏºÄÏù¥ÌîÑÌï† Î¨∏ÏûêÏó¥
 * @returns {string} ÏïàÏ†ÑÌïú Î¨∏ÏûêÏó¥
 */
function escapeHtml(str) {
    if (!str || typeof str !== 'string') return '';
    const div = document.createElement('div');
    div.textContent = str;
    return div.innerHTML;
}

/**
 * URL ÏïàÏ†ÑÏÑ± Í≤ÄÏ¶ù
 * @param {string} url - Í≤ÄÏ¶ùÌï† URL
 * @returns {boolean} ÏïàÏ†ÑÌïú URLÏù∏ÏßÄ Ïó¨Î∂Ä
 */
function isSafeUrl(url) {
    if (!url || typeof url !== 'string') return false;
    try {
        const parsed = new URL(url, window.location.origin);
        // http:, https:, data:Îßå ÌóàÏö©
        return ['http:', 'https:', 'data:'].includes(parsed.protocol);
    } catch {
        return false;
    }
}

/**
 * ÏûÖÎ†• Í∏∏Ïù¥ Ï†úÌïú
 * @param {string} input - ÏûÖÎ†•Í∞í
 * @param {number} maxLength - ÏµúÎåÄ Í∏∏Ïù¥ (Í∏∞Î≥∏ 500)
 * @returns {string} Ï†úÌïúÎêú Î¨∏ÏûêÏó¥
 */
function limitInput(input, maxLength = 500) {
    if (!input || typeof input !== 'string') return '';
    return input.substring(0, maxLength);
}

// ===== Data Store =====
const P5Store = {
    STORAGE_KEY: 'p5_dashboard_data',
    
    getDefaultData() {
        return {
            zones: [
                {
                    id: 'zone_a',
                    name: 'ZONE A',
                    displayName: 'FAB',
                    description: 'Utility Support',
                    range: { startColumn: 1, endColumn: 23, startRow: 0, endRow: 11 },
                    style: { primaryColor: '#238636', backgroundColor: 'rgba(35,134,54,0.1)', progressPercent: 0 },
                    contractor: 'ÏÇºÏÑ±E&A',
                    supervisor: '',
                    targetDate: '',
                    metadata: { createdAt: '2025-12-01', updatedAt: '2025-12-01', createdBy: 'system' }
                },
                {
                    id: 'zone_b',
                    name: 'ZONE B',
                    displayName: 'CUB',
                    description: 'Main Link',
                    range: { startColumn: 24, endColumn: 45, startRow: 0, endRow: 11 },
                    style: { primaryColor: '#1f6feb', backgroundColor: 'rgba(31,111,235,0.1)', progressPercent: 0 },
                    contractor: 'ÏÇºÏÑ±E&A',
                    supervisor: '',
                    targetDate: '',
                    metadata: { createdAt: '2025-12-01', updatedAt: '2025-12-01', createdBy: 'system' }
                },
                {
                    id: 'zone_c',
                    name: 'ZONE C',
                    displayName: 'COMPLEX',
                    description: 'Office/Amenity',
                    range: { startColumn: 46, endColumn: 69, startRow: 0, endRow: 11 },
                    style: { primaryColor: '#d29922', backgroundColor: 'rgba(210,153,34,0.1)', progressPercent: 0 },
                    contractor: 'ÏÇºÏÑ±E&A',
                    supervisor: '',
                    targetDate: '',
                    metadata: { createdAt: '2025-12-01', updatedAt: '2025-12-01', createdBy: 'system' }
                }
            ],
            columns: {},
            statusCodes: {
                pending: { label: 'ÎåÄÍ∏∞', color: '#484f58', shape: 'circle' },
                active: { label: 'ÏßÑÌñâÏ§ë', color: '#1f6feb', shape: 'circle' },
                installed: { label: 'ÏÑ§ÏπòÏôÑÎ£å', color: '#238636', shape: 'circle' },
                hold_tc: { label: 'T/C Hold', color: '#da3633', shape: 'square' },
                hold_design: { label: 'ÏÑ§Í≥Ñ Î≥ÄÍ≤Ω', color: '#d29922', shape: 'circle' },
                hold_material: { label: 'ÏûêÏû¨ ÎåÄÍ∏∞', color: '#8957e5', shape: 'circle' }
            },
            // H-4 Fix: productionStagesÎ•º P5StoreÎ°ú Ïù¥Îèô (master_config.jsonÍ≥º ÎèôÍ∏∞Ìôî)
            productionStages: [
                { code: 'hmb_fab', label: 'HMBÏ†úÏûë', labelEn: 'HMB Fabrication', order: 1, color: '#1f6feb' },
                { code: 'pre_assem', label: 'Î©¥Ï°∞Î¶Ω', labelEn: 'Pre-Assembly', order: 2, color: '#8957e5' },
                { code: 'main_assem', label: 'ÎåÄÏ°∞Î¶Ω', labelEn: 'Main Assembly', order: 3, color: '#d29922' },
                { code: 'hmb_psrc', label: 'HMB+PSRC', labelEn: 'HMB+PSRC Insert', order: 4, color: '#238636' },
                { code: 'form', label: 'FORM', labelEn: 'Formwork', order: 5, color: '#da3633' },
                { code: 'embed', label: 'Ïï∞Î≤†Îìú', labelEn: 'Embed', order: 6, color: '#f85149' }
            ]
        };
    },
    
    load() {
        try {
            const saved = localStorage.getItem(this.STORAGE_KEY);
            if (saved) {
                return JSON.parse(saved);
            }
        } catch (e) {
            console.error('Failed to load data:', e);
        }
        return this.getDefaultData();
    },
    
    save(data) {
        try {
            localStorage.setItem(this.STORAGE_KEY, JSON.stringify(data));
            return true;
        } catch (e) {
            console.error('Failed to save data:', e);
            return false;
        }
    },
    
    // ‚òÖ ÌîÑÎ°úÏ†ùÌä∏ Ïä§ÎÉÖÏÉ∑ ÎÇ¥Î≥¥ÎÇ¥Í∏∞ (Î™®Îì† ÏÑ§Ï†ï + ÎÖ∏Îìú + ÏÉÅÌÉú Ìè¨Ìï®)
    exportSnapshot(app) {
        const snapshot = {
            projectInfo: {
                name: "P5 Dashboard Project",
                exportDate: new Date().toISOString(),
                version: "1.0.0"
            },
            configurations: {
                floors: app.floors,
                jeoljuConfig: app.jeoljuConfig,
                columnSegments: app.columnSegments,
                zones: app.zones,
                statusCodes: app.statusCodes,
                productionStages: app.productionStages
            },
            mgt_grid: app.gridConfig,
            data: {
                columns: app.columns,
                issues: app.issues,
                history: app.history
            }
        };
        
        const blob = new Blob([JSON.stringify(snapshot, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `P5_Snapshot_${new Date().toISOString().slice(0,10)}.json`;
        a.click();
        URL.revokeObjectURL(url);
    },

    // ‚òÖ ÌîÑÎ°úÏ†ùÌä∏ Ïä§ÎÉÖÏÉ∑ Î∂àÎü¨Ïò§Í∏∞
    async importSnapshot(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const snapshot = JSON.parse(e.target.result);
                    resolve(snapshot);
                } catch (err) {
                    reject(err);
                }
            };
            reader.onerror = reject;
            reader.readAsText(file);
        });
    }
};

// ===== Alpine.js Application =====
function dashboard() {
    // ‚òÖ MGT Grid Config from column_data_generator.js (197,835 columns support)
    const MGT_CONFIG = (typeof COLUMN_CONFIG !== 'undefined') ? COLUMN_CONFIG : null;

    return {
        // Grid Config - MGT Í∑úÍ≤© (327 cols √ó 55 rows) or fallback to legacy
        gridConfig: MGT_CONFIG
            ? { cols: MGT_CONFIG.columnRange.end - MGT_CONFIG.columnRange.start + 1, rows: MGT_CONFIG.rowLabels.length }
            : { cols: 69, rows: 12 },
        rowLabels: MGT_CONFIG
            ? MGT_CONFIG.rowLabels
            : ['A','B','C','D','E','F','G','H','I','J','K','L'],

        // Virtual Scrolling State
        virtualScroll: {
            enabled: true,
            scrollTop: 0,
            scrollLeft: 0,
            viewportWidth: 800,
            viewportHeight: 600,
            cellWidth: 28,    // 26px + 2px gap
            cellHeight: 28,   // 26px + 2px gap
            headerWidth: 37,  // 35px + 2px gap
            headerHeight: 27, // 25px + 2px gap
            bufferCells: 5,   // Extra cells to render outside viewport
            visibleColStart: 0,
            visibleColEnd: 30,
            visibleRowStart: 0,
            visibleRowEnd: 20,
            isScrolling: false,
            scrollTimeout: null
        },
        
        // Data
        zones: [],
        columns: {},
        statusCodes: {},
        
        // UI State
        selectedCells: [],
        detailPanelOpen: false,
        currentColumn: null,
        bulkEditOpen: false,
        showAdminPanel: false,
        adminTab: 'zones',
        // WP-4: Report Panel State
        showReportPanel: false,
        reportTab: 'overview',
        reportData: null,
        showZoneEditor: false,
        editingZone: null,
        zoneForm: {
            id: '', name: '', displayName: '', description: '',
            startColumn: 1, endColumn: 10, startRow: 0, endRow: 11, color: '#238636',
            contractor: '', supervisor: '', targetDate: ''
        },
        showIssueEditor: false,
        issueFilter: 'all',

        // ‚òÖ ÌîÑÎ°úÏ†ùÌä∏ Ïä§ÎÉÖÏÉ∑ ÎÇ¥Î≥¥ÎÇ¥Í∏∞/Î∂àÎü¨Ïò§Í∏∞ Í∏∞Îä•
        exportProjectSnapshot() {
            P5Store.exportSnapshot(this);
            this.showToast('Project Snapshot exported successfully', 'success');
        },

        async importProjectSnapshot(event) {
            const file = event.target.files[0];
            if (!file) return;

            try {
                const snapshot = await P5Store.importSnapshot(file);
                
                // Îç∞Ïù¥ÌÑ∞ Ï†ÅÏö©
                if (snapshot.configurations) {
                    this.floors = snapshot.configurations.floors || this.floors;
                    this.jeoljuConfig = snapshot.configurations.jeoljuConfig || this.jeoljuConfig;
                    this.columnSegments = snapshot.configurations.columnSegments || this.columnSegments;
                    this.zones = snapshot.configurations.zones || this.zones;
                    this.statusCodes = snapshot.configurations.statusCodes || this.statusCodes;
                    this.productionStages = snapshot.configurations.productionStages || this.productionStages;
                }

                if (snapshot.mgt_grid) {
                    this.gridConfig = snapshot.mgt_grid;
                }

                if (snapshot.data) {
                    this.columns = snapshot.data.columns || {};
                    this.issues = snapshot.data.issues || [];
                    this.history = snapshot.data.history || [];
                }

                this.saveData();
                this.showToast('Project Snapshot loaded and applied', 'success');
                
                // ÌéòÏù¥ÏßÄ ÏÉàÎ°úÍ≥†Ïπ®ÌïòÏó¨ Îç∞Ïù¥ÌÑ∞ Ï∫êÏãú Îì± Ï¥àÍ∏∞Ìôî Í∂åÏû• (ÎòêÎäî init Ïû¨Ìò∏Ï∂ú)
                setTimeout(() => window.location.reload(), 1500);
            } catch (err) {
                console.error('Snapshot import failed:', err);
                this.showToast('Failed to import snapshot: ' + err.message, 'error');
            }
        },

        issueForm: {
            type: 'tc', title: '', description: '', severity: 'medium',
            startColumn: 1, endColumn: 10, startRow: 'A', endRow: 'L',
            assignedTo: '', expectedResolution: '',
            showOverlay: true, overlayLabel: '', overlayColor: '#da3633',
            // Phase 7+: Extended Issue Schema
            rootCause: '',           // Í∑ºÎ≥∏ ÏõêÏù∏
            mitigationPlan: '',      // ÏôÑÌôî Í≥ÑÌöç
            reportedBy: 'dashboard'  // Î≥¥Í≥†Ïûê
        },
        isDirty: false,
        
        // Drag Selection
        isDragging: false,
        dragStart: null,
        dragEnd: null,

        // WP-1: Touch Drag Selection State
        touchDragActive: false,
        touchDragStart: { x: 0, y: 0 },
        touchDragEnd: { x: 0, y: 0 },
        touchDragCellCount: 0,
        touchDragGridRect: null,

        // Edit Forms
        editForm: {
            status: 'pending',
            isLocked: false,
            memberType: 'SRC Column',
            section: 'H-500x500'
        },
        bulkEditForm: {
            status: '',
            setLock: false
        },
        
        // Toast
        toast: { show: false, message: '', type: 'success' },
        
        // Sync State
        syncEnabled: false,
        apiUrl: 'https://script.google.com/macros/s/AKfycbyzvzDbe6NQ0Ni_Fp7I0LLNlg66st7mnnLkxtqjxUTtZnA7KeGRqp2Gcb8c_rjgbm1eTg/exec',
        currentFloor: 'ALL', // Î†àÍ±∞Ïãú Ï∏µ ÏÑ†ÌÉù (F1, F2, ALL)
        
        // Issue State
        issues: [],
        issueIndexMap: null, // Performance: Map<cellUID, Issue[]> for O(1) lookup
        issuePanelOpen: false,
        issueFilter: 'all',
        selectedIssue: null,
        newIssueModalOpen: false,
        newIssueForm: {
            type: 'tc',
            title: '',
            severity: 'medium',
            description: '',
            expectedResolution: ''
        },
        
        // Admin Panel State
        adminTab: 'zones',

        // MGT Import State
        mgtImportStatus: {
            loading: false,
            success: false,
            message: '',
            nodes: 0,
            elements: 0,
            cols: 0,
            rows: 0,
            excludedCols: [],
            parsedData: null
        },

        // Phase 6: Workflow Filter
        workflowFilter: null,  // null = show all, or stage code like 'hmb_fab'

        // Phase 6: Stage Configuration (H-4 Fix: Í∏∞Î≥∏Í∞í, init()ÏóêÏÑú P5Store Îç∞Ïù¥ÌÑ∞Î°ú ÎçÆÏñ¥ÏîÄ)
        stageConfigs: [
            { code: 'hmb_fab', label: 'HMBÏ†úÏûë', color: '#1f6feb', order: 1 },
            { code: 'pre_assem', label: 'Î©¥Ï°∞Î¶Ω', color: '#8957e5', order: 2 },
            { code: 'main_assem', label: 'ÎåÄÏ°∞Î¶Ω', color: '#d29922', order: 3 },
            { code: 'hmb_psrc', label: 'HMB+PSRC', color: '#238636', order: 4 },
            { code: 'form', label: 'FORM', color: '#da3633', order: 5 },
            { code: 'embed', label: 'Ïï∞Î≤†Îìú', color: '#f85149', order: 6 }
        ],

        // Phase 5: AI Analysis State
        analysisJob: {
            status: 'idle',  // idle, pending, running, completed, failed
            jobId: null,
            startedAt: null,
            result: null
        },
        analysisPollingInterval: null,

        // Phase 7: Ï∏µ-Ï†àÏ£º Íµ¨Ï°∞
        // ‚òÖ Ï†àÏ£º = ÏàòÏßÅ Î∂ÑÏ†à (Ï∏µ Í∑∏Î£π), Ïó¥ Íµ¨Í∞Ñ = ÏàòÌèâ Î∂ÑÏ†à (Ïª¨Îüº Î≤îÏúÑ)
        floors: [],              // 11Í∞ú Ï∏µ Îç∞Ïù¥ÌÑ∞ (APIÏóêÏÑú Î°úÎìú)
        jeoljuConfig: [],        // Ï†àÏ£º = Ï∏µ Í∑∏Î£π (ÏàòÏßÅ Î∂ÑÏ†à, 1Ï†àÏ£º~4Ï†àÏ£º)
        columnSegments: [],      // Ïó¥ Íµ¨Í∞Ñ = Ïª¨Îüº Î≤îÏúÑ (ÏàòÌèâ Î∂ÑÏ†à, S1~S8)
        jeoljuList: [],          // ÌïòÏúÑ Ìò∏Ìôò: columnSegments Ï∞∏Ï°∞
        selectedFloor: 'F1',     // ÌòÑÏû¨ ÏÑ†ÌÉùÎêú Ï∏µ (F1~F10, RF Î†àÍ±∞Ïãú ÌòïÏãù)
        selectedJeolju: null,    // ÏÑ†ÌÉùÎêú Ï†àÏ£º ÌïÑÌÑ∞ (null = Ï†ÑÏ≤¥)
        elevationViewOpen: true, // ÏûÖÎ©¥ Î∑∞Ïñ¥ ÌëúÏãú Ïó¨Î∂Ä
        floorSelectorOpen: false, // Ï∏µ ÏÑ†ÌÉùÍ∏∞ ÎìúÎ°≠Îã§Ïö¥ Ïó¥Î¶º ÏÉÅÌÉú
        lastFloorLoad: null, // ÎßàÏßÄÎßâ Ï∏µ Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ï†ïÎ≥¥
        isLoading: false, // Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ï§ë ÏÉÅÌÉú
        loadingMessage: '', // Î°úÎî© Î©îÏãúÏßÄ
        grid: [], // Í∑∏Î¶¨Îìú Îç∞Ïù¥ÌÑ∞ (rows √ó cols)

        // Phase 7: Ï∏µÎ≥Ñ ÌÜµÍ≥Ñ (computed)
        get currentFloorLabel() {
            const floor = this.floors.find(f => f.floorId === this.selectedFloor);
            return floor ? floor.label : '1Ï∏µ';
        },

        // Phase 7: Ï†àÏ£ºÎ≥Ñ ÏßÑÌñâÎ•† (computed)
        get jeoljuProgress() {
            const progress = {};
            this.jeoljuList.forEach(j => {
                const cols = Object.values(this.columns).filter(c => {
                    const colNum = parseInt(c.location.column);
                    return colNum >= j.startColumn && colNum <= j.endColumn;
                });
                const total = cols.length || 1;
                const installed = cols.filter(c => c.status.code === 'installed').length;
                progress[j.jeoljuId] = Math.round((installed / total) * 100);
            });
            return progress;
        },

        // Phase 7: Ïã§ÏãúÍ∞Ñ ÏïåÎ¶º ÏãúÏä§ÌÖú
        activeNotifications: [],      // ÌòÑÏû¨ ÌôîÎ©¥Ïóê ÌëúÏãú Ï§ëÏù∏ ÏïåÎ¶º (ÏµúÎåÄ 3Í∞ú)
        notificationHistory: [],      // ÏïåÎ¶º ÌûàÏä§ÌÜ†Î¶¨ (ÏµúÎåÄ 50Í∞ú)
        notificationPanelOpen: false, // ÌûàÏä§ÌÜ†Î¶¨ Ìå®ÎÑê Ïó¥Î¶º ÏÉÅÌÉú
        notificationIdCounter: 0,     // ÏïåÎ¶º ID ÏÉùÏÑ±Ïö© Ïπ¥Ïö¥ÌÑ∞

        // Phase 7: Î™®Î∞îÏùº ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò
        mobileNavTab: 'grid',  // 'grid' | 'issues' | 'notifications' | 'menu'
        sidebarOpen: false,    // Î™®Î∞îÏùº ÏÇ¨Ïù¥ÎìúÎ∞î Ïó¥Î¶º ÏÉÅÌÉú

        // Mobile Bottom Navigation (Enhanced)
        mobileView: 'grid',
        isMobile: window.innerWidth < 768,

        // Phase 7: Ïä§ÎßàÌä∏ Í≤ÄÏÉâ
        searchQuery: '',           // Í≤ÄÏÉâÏñ¥
        searchDropdownOpen: false, // Í≤ÄÏÉâ ÎìúÎ°≠Îã§Ïö¥ ÌëúÏãú Ïó¨Î∂Ä
        searchResults: [],         // Í≤ÄÏÉâ Í≤∞Í≥º
        recentSearches: [],        // ÏµúÍ∑º Í≤ÄÏÉâÏñ¥ (ÏµúÎåÄ 5Í∞ú)
        activeFilters: [],         // ÌôúÏÑ± ÌïÑÌÑ∞ [{type, value, label}]

        // Phase 7: ÎåÄÏãúÎ≥¥Îìú ÏöîÏïΩ Ìå®ÎÑê
        summaryPanelOpen: false,   // ÏöîÏïΩ Ìå®ÎÑê Ïó¥Î¶º ÏÉÅÌÉú
        todayChanges: [],          // Ïò§Îäò Î≥ÄÍ≤Ω ÎÇ¥Ïó≠

        // Phase 7: ÌûàÏä§ÌÜ†Î¶¨ Î∑∞Ïñ¥
        historyPanelOpen: false,   // ÌûàÏä§ÌÜ†Î¶¨ Ìå®ÎÑê Ïó¥Î¶º ÏÉÅÌÉú
        historyFilter: 'all',      // 'all' | 'status' | 'stage' | 'issue'
        historyData: [],           // Ï†ÑÏ≤¥ ÌûàÏä§ÌÜ†Î¶¨ Îç∞Ïù¥ÌÑ∞

        // Phase 7: ÌÇ§Î≥¥Îìú Îã®Ï∂ïÌÇ§ Î™®Îã¨
        shortcutsModalOpen: false, // Îã®Ï∂ïÌÇ§ ÎèÑÏõÄÎßê Î™®Îã¨ Ïó¥Î¶º ÏÉÅÌÉú

        // Phase 11: Slack Integration State
        slackSettings: {
            webhookUrl: '',              // ÏÉàÎ°ú ÏûÖÎ†•Ìï† Webhook URL
            webhookConfigured: false,    // ÏÑúÎ≤ÑÏóê WebhookÏù¥ ÏÑ§Ï†ïÎêòÏñ¥ ÏûàÎäîÏßÄ
            webhookUrlMasked: '',        // ÎßàÏä§ÌÇπÎêú ÌòÑÏû¨ Webhook URL
            showWebhookUrl: false,       // URL ÌëúÏãú/Ïà®Í∏∞Í∏∞ ÌÜ†Í∏Ä
            notifications: {
                criticalIssue: true,     // Critical Ïù¥Ïäà ÏÉùÏÑ± Ïãú
                statusDelay: true,       // delay ÏÉÅÌÉú Î≥ÄÍ≤Ω Ïãú
                statusBlocked: true,     // blocked/hold ÏÉÅÌÉú Î≥ÄÍ≤Ω Ïãú
                bulkUpdate: true,        // ÎåÄÎüâ ÏóÖÎç∞Ïù¥Ìä∏ (10Í∞ú Ïù¥ÏÉÅ) Ïãú
                dailySummary: false,     // ÏùºÏùº ÏöîÏïΩ (Ìä∏Î¶¨Í±∞ ÌïÑÏöî)
                issueResolved: false     // Ïù¥Ïäà Ìï¥Í≤∞ Ïãú
            },
            saving: false,               // Ï†ÄÏû• Ï§ë ÏÉÅÌÉú
            testing: false,              // ÌÖåÏä§Ìä∏ Ï†ÑÏÜ° Ï§ë ÏÉÅÌÉú
            message: '',                 // ÏÉÅÌÉú Î©îÏãúÏßÄ
            messageType: ''              // 'success' | 'error'
        },

        // Phase 12: Email Integration State
        emailSettings: {
            recipients: [],              // ÏàòÏã†Ïûê Ïù¥Î©îÏùº Î™©Î°ù
            newRecipient: '',            // ÏÉàÎ°ú Ï∂îÍ∞ÄÌï† Ïù¥Î©îÏùº
            notifications: {
                criticalIssue: true,     // Critical Ïù¥Ïäà ÏÉùÏÑ± Ïãú
                statusDelay: true,       // delay ÏÉÅÌÉú Î≥ÄÍ≤Ω Ïãú
                statusBlocked: true,     // blocked/hold ÏÉÅÌÉú Î≥ÄÍ≤Ω Ïãú
                bulkUpdate: true,        // ÎåÄÎüâ ÏóÖÎç∞Ïù¥Ìä∏ (10Í∞ú Ïù¥ÏÉÅ) Ïãú
                weeklySummary: false,    // Ï£ºÍ∞Ñ ÏöîÏïΩ (Ìä∏Î¶¨Í±∞ ÌïÑÏöî)
                issueResolved: false     // Ïù¥Ïäà Ìï¥Í≤∞ Ïãú
            },
            saving: false,               // Ï†ÄÏû• Ï§ë ÏÉÅÌÉú
            testing: false,              // ÌÖåÏä§Ìä∏ Ï†ÑÏÜ° Ï§ë ÏÉÅÌÉú
            message: '',                 // ÏÉÅÌÉú Î©îÏãúÏßÄ
            messageType: ''              // 'success' | 'error'
        },

        // Phase 7: ÌïÑÌÑ∞ÎßÅÎêú ÌûàÏä§ÌÜ†Î¶¨ (computed)
        get filteredHistory() {
            if (this.historyFilter === 'all') {
                return this.historyData;
            }
            return this.historyData.filter(item => item.type === this.historyFilter);
        },

        // Phase 7: ÎÇ†ÏßúÎ≥Ñ Í∑∏Î£πÌïëÎêú ÌûàÏä§ÌÜ†Î¶¨ (computed)
        get groupedHistory() {
            const groups = {};
            for (const item of this.filteredHistory) {
                const date = new Date(item.timestamp).toLocaleDateString('ko-KR');
                if (!groups[date]) {
                    groups[date] = {
                        date,
                        dateLabel: this.formatDateLabel(item.timestamp),
                        items: []
                    };
                }
                groups[date].items.push(item);
            }
            return Object.values(groups).sort((a, b) => 
                new Date(b.items[0]?.timestamp) - new Date(a.items[0]?.timestamp)
            );
        },

        // Phase 7: ÏùΩÏßÄ ÏïäÏùÄ ÏïåÎ¶º Í∞úÏàò (computed)
        get unreadNotificationCount() {
            return this.notificationHistory.filter(n => !n.read).length;
        },

        // Phase 7: Í≤ÄÏÉâ Í≤∞Í≥º Í∞úÏàò (computed)
        get searchResultCount() {
            return this.searchResults.length;
        },

        // Sync Status (computed-like via getter)
        get syncStatus() {
            if (typeof SyncModule !== 'undefined' && this.syncEnabled) {
                return SyncModule.getQueueStatus();
            }
            return { pending: 0, failed: 0, total: 0, isSyncing: false, lastSync: null };
        },
        
        // Computed
        get totalColumns() {
            return this.gridConfig.cols * this.gridConfig.rows;
        },
        
        // Issue Computed Properties
        get openIssues() {
            return this.issues.filter(i => i.status === 'open' || i.status === 'in_progress');
        },
        
        get filteredIssues() {
            if (this.issueFilter === 'all') return this.issues;
            if (this.issueFilter === 'open') return this.issues.filter(i => i.status === 'open' || i.status === 'in_progress');
            if (this.issueFilter === 'resolved') return this.issues.filter(i => i.status === 'resolved');
            return this.issues;
        },
        
        get activeIssueOverlays() {
            return this.openIssues.filter(i => i.overlay?.show !== false);
        },
        
        // WP-2: Issue Pin Helper Methods (Optimized with O(1) Map lookup)
        
        /**
         * Build issue index map for O(1) cell lookup
         * Call this when issues array changes
         */
        buildIssueIndex() {
            const map = new Map();
            
            for (const issue of this.openIssues) {
                if (!issue.startColumn || !issue.endColumn) continue;
                
                const startRow = this.rowLabels.indexOf(issue.startRow);
                const endRow = this.rowLabels.indexOf(issue.endRow);
                if (startRow < 0 || endRow < 0) continue;
                
                // Populate map with all affected cell UIDs
                for (let r = startRow; r <= endRow; r++) {
                    const rowLabel = this.rowLabels[r];
                    if (!rowLabel) continue;
                    
                    for (let c = issue.startColumn; c <= issue.endColumn; c++) {
                        const uid = `${rowLabel}-X${c}`;
                        if (!map.has(uid)) {
                            map.set(uid, []);
                        }
                        map.get(uid).push(issue);
                    }
                }
            }
            
            this.issueIndexMap = map;
            console.log(`[Performance] Issue index built: ${map.size} cells indexed`);
        },
        
        /**
         * Check if a cell has any open issues - O(1)
         */
        hasIssue(cell) {
            if (!cell || cell.isHeader) return false;
            if (!this.issueIndexMap) this.buildIssueIndex();
            const uid = `${cell.row}-X${cell.col}`;
            return this.issueIndexMap.has(uid);
        },
        
        /**
         * Check if cell is within issue's affected range (legacy fallback)
         */
        isCellInIssueRange(cell, issue) {
            if (!issue.startColumn || !issue.endColumn) return false;
            
            const colNum = cell.col;
            const rowIdx = this.rowLabels.indexOf(cell.row);
            const issueStartRow = this.rowLabels.indexOf(issue.startRow);
            const issueEndRow = this.rowLabels.indexOf(issue.endRow);
            
            return colNum >= issue.startColumn && 
                   colNum <= issue.endColumn &&
                   rowIdx >= issueStartRow && 
                   rowIdx <= issueEndRow;
        },
        
        /**
         * Get the first issue affecting a cell - O(1)
         */
        getIssueForCell(cell) {
            if (!cell || cell.isHeader) return null;
            if (!this.issueIndexMap) this.buildIssueIndex();
            const uid = `${cell.row}-X${cell.col}`;
            const issues = this.issueIndexMap.get(uid);
            return issues ? issues[0] : null;
        },
        
        /**
         * Get all issues affecting a cell - O(1)
         */
        getIssuesForCell(cell) {
            if (!cell || cell.isHeader) return [];
            if (!this.issueIndexMap) this.buildIssueIndex();
            const uid = `${cell.row}-X${cell.col}`;
            return this.issueIndexMap.get(uid) || [];
        },
        
        /**
         * Get CSS class based on issue severity
         */
        getIssueSeverityClass(cell) {
            const issue = this.getIssueForCell(cell);
            if (!issue) return '';
            
            const severityClasses = {
                'critical': 'issue-pin-critical',
                'high': 'issue-pin-high',
                'medium': 'issue-pin-medium',
                'low': 'issue-pin-low'
            };
            return severityClasses[issue.severity] || 'issue-pin-medium';
        },
        
        /**
         * Get issue title for tooltip
         */
        getIssueTitle(cell) {
            const issues = this.getIssuesForCell(cell);
            if (issues.length === 0) return '';
            if (issues.length === 1) return issues[0].title;
            return `${issues.length}Í∞ú Ïù¥Ïäà: ${issues.map(i => i.title).join(', ')}`;
        },

        /**
         * WP-2: Open issue detail panel when clicking issue pin
         */
        openIssueDetail(cell) {
            const issues = this.getIssuesForCell(cell);
            if (issues.length === 0) return;

            // Open issue panel
            this.issuePanelOpen = true;

            // Set active issue to the first one (most recent or highest severity)
            const sortedIssues = issues.sort((a, b) => {
                const severityOrder = { critical: 0, high: 1, medium: 2, low: 3 };
                return (severityOrder[a.severity] || 3) - (severityOrder[b.severity] || 3);
            });

            this.selectedIssue = sortedIssues[0];

            // Scroll to the issue in the panel (after DOM update)
            this.$nextTick(() => {
                const issueCard = document.querySelector(`[data-issue-id="${sortedIssues[0].id}"]`);
                if (issueCard) {
                    issueCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    issueCard.classList.add('active');
                }
            });

            // Show toast with issue count
            if (issues.length > 1) {
                this.showToast(`${issues.length}Í∞ú Ïù¥Ïäà Î∞úÍ≤¨ - Í∞ÄÏû• Ïã¨Í∞ÅÌïú Ïù¥Ïäà ÌëúÏãú Ï§ë`, 'warning');
            }

            this.announce(`Ïù¥Ïäà Ìå®ÎÑê Ïó¥Î¶º: ${sortedIssues[0].title}`);
        },

        // Generate flat grid cells array for Alpine.js compatibility
        get gridCells() {
            const cells = [];
            
            // First row: corner + X-axis headers (1-69)
            cells.push({ key: 'corner', isHeader: true, label: '' });
            for (let c = 1; c <= this.gridConfig.cols; c++) {
                cells.push({ key: 'h-' + c, isHeader: true, label: c });
            }
            
            // Data rows
            for (let r = 0; r < this.gridConfig.rows; r++) {
                const rowLabel = this.rowLabels[r];
                // Y-axis header
                cells.push({ key: 'r-' + rowLabel, isHeader: true, label: rowLabel });
                // Data cells
                for (let c = 1; c <= this.gridConfig.cols; c++) {
                    cells.push({
                        key: rowLabel + '-X' + c,
                        isHeader: false,
                        row: rowLabel,
                        col: c
                    });
                }
            }
            
            return cells;
        },

        // === Virtual Scrolling ===

        // Get total grid dimensions in pixels
        get totalGridWidth() {
            const vs = this.virtualScroll;
            return vs.headerWidth + (this.gridConfig.cols * vs.cellWidth);
        },

        get totalGridHeight() {
            const vs = this.virtualScroll;
            return vs.headerHeight + (this.gridConfig.rows * vs.cellHeight);
        },

        // Calculate visible range based on scroll position
        updateVisibleRange() {
            const vs = this.virtualScroll;

            // Calculate visible column range
            const colStart = Math.max(0, Math.floor((vs.scrollLeft - vs.headerWidth) / vs.cellWidth) - vs.bufferCells);
            const colEnd = Math.min(this.gridConfig.cols, Math.ceil((vs.scrollLeft + vs.viewportWidth - vs.headerWidth) / vs.cellWidth) + vs.bufferCells);

            // Calculate visible row range
            const rowStart = Math.max(0, Math.floor((vs.scrollTop - vs.headerHeight) / vs.cellHeight) - vs.bufferCells);
            const rowEnd = Math.min(this.gridConfig.rows, Math.ceil((vs.scrollTop + vs.viewportHeight - vs.headerHeight) / vs.cellHeight) + vs.bufferCells);

            vs.visibleColStart = colStart;
            vs.visibleColEnd = colEnd;
            vs.visibleRowStart = rowStart;
            vs.visibleRowEnd = rowEnd;
        },

        // Generate only visible cells for rendering
        get visibleCells() {
            if (!this.virtualScroll.enabled) {
                return this.gridCells;
            }

            const vs = this.virtualScroll;
            const cells = [];

            // Always include corner cell
            cells.push({ key: 'corner', isHeader: true, label: '', isCorner: true });

            // Visible column headers
            for (let c = vs.visibleColStart + 1; c <= Math.min(vs.visibleColEnd + 1, this.gridConfig.cols); c++) {
                cells.push({
                    key: 'h-' + c,
                    isHeader: true,
                    label: c,
                    isColumnHeader: true,
                    colIndex: c
                });
            }

            // Visible data rows
            for (let r = vs.visibleRowStart; r < Math.min(vs.visibleRowEnd, this.gridConfig.rows); r++) {
                const rowLabel = this.rowLabels[r] || String.fromCharCode(65 + r);

                // Row header
                cells.push({
                    key: 'r-' + rowLabel,
                    isHeader: true,
                    label: rowLabel,
                    isRowHeader: true,
                    rowIndex: r
                });

                // Visible data cells in this row
                for (let c = vs.visibleColStart + 1; c <= Math.min(vs.visibleColEnd + 1, this.gridConfig.cols); c++) {
                    cells.push({
                        key: rowLabel + '-X' + c,
                        isHeader: false,
                        row: rowLabel,
                        col: c,
                        rowIndex: r,
                        colIndex: c
                    });
                }
            }

            return cells;
        },

        // Get visible columns count for grid CSS
        get visibleColCount() {
            const vs = this.virtualScroll;
            return Math.min(vs.visibleColEnd + 1, this.gridConfig.cols) - vs.visibleColStart;
        },

        // Get visible rows count for grid CSS
        get visibleRowCount() {
            const vs = this.virtualScroll;
            return Math.min(vs.visibleRowEnd, this.gridConfig.rows) - vs.visibleRowStart;
        },

        // Handle scroll event with throttling
        handleVirtualScroll(event) {
            const vs = this.virtualScroll;
            const container = event.target;

            vs.scrollLeft = container.scrollLeft;
            vs.scrollTop = container.scrollTop;
            vs.isScrolling = true;

            // Throttled update
            if (!vs.scrollTimeout) {
                vs.scrollTimeout = requestAnimationFrame(() => {
                    this.updateVisibleRange();
                    vs.scrollTimeout = null;

                    // Hide scroll indicator after delay
                    setTimeout(() => {
                        vs.isScrolling = false;
                    }, 500);
                });
            }
        },

        // Initialize virtual scrolling
        initVirtualScroll(container) {
            if (!container) return;

            const vs = this.virtualScroll;
            vs.viewportWidth = container.clientWidth;
            vs.viewportHeight = container.clientHeight;

            // Auto-enable for large grids (>1000 cells)
            const totalCells = this.gridConfig.cols * this.gridConfig.rows;
            vs.enabled = totalCells > 1000;

            this.updateVisibleRange();

            // Add resize observer
            const resizeObserver = new ResizeObserver(entries => {
                for (const entry of entries) {
                    vs.viewportWidth = entry.contentRect.width;
                    vs.viewportHeight = entry.contentRect.height;
                    this.updateVisibleRange();
                }
            });
            resizeObserver.observe(container);

            console.log(`[VirtualScroll] Initialized: ${totalCells} cells, enabled=${vs.enabled}`);
        },

        // Get cell position for absolute positioning (virtual mode)
        getCellStyle(cell) {
            if (!this.virtualScroll.enabled || cell.isHeader) return '';

            const vs = this.virtualScroll;
            const left = vs.headerWidth + ((cell.colIndex - 1) * vs.cellWidth);
            const top = vs.headerHeight + (cell.rowIndex * vs.cellHeight);

            return `position: absolute; left: ${left}px; top: ${top}px; width: ${vs.cellWidth - 2}px; height: ${vs.cellHeight - 2}px;`;
        },

        // Get scroll position info for indicator
        get scrollPositionInfo() {
            const vs = this.virtualScroll;
            const colPercent = Math.round((vs.scrollLeft / (this.totalGridWidth - vs.viewportWidth)) * 100) || 0;
            const rowPercent = Math.round((vs.scrollTop / (this.totalGridHeight - vs.viewportHeight)) * 100) || 0;
            return `Col ${vs.visibleColStart + 1}-${vs.visibleColEnd + 1} / ${this.gridConfig.cols} | Row ${vs.visibleRowStart + 1}-${vs.visibleRowEnd} / ${this.gridConfig.rows}`;
        },

        // === Lifecycle ===
        init() {
            const data = P5Store.load();
            
            // ‚òÖ Floor Plan Fix: MGT_CONFIG zones Ï†ÅÏö© (P5 Î≥µÌï©Îèô Ïã§Ï†ú Í∑úÍ≤©)
            // LocalStorageÏóê Ï†ÄÏû•Îêú ÌÖåÏä§Ìä∏ Îç∞Ïù¥ÌÑ∞(1-69Ïó¥)Í∞Ä ÏïÑÎãå 
            // COLUMN_CONFIG(3-329Ïó¥, 327 cols)ÏùÑ Ï†ÅÏö©
            if (typeof MGT_CONFIG !== 'undefined' && MGT_CONFIG && MGT_CONFIG.zones) {
                // MGT_CONFIG zonesÎ•º Alpine.js ÌòïÏãùÏúºÎ°ú Î≥ÄÌôò
                this.zones = MGT_CONFIG.zones.map(zone => ({
                    id: zone.id,
                    name: zone.name,
                    displayName: zone.name,
                    description: '',
                    startColumn: zone.startCol,
                    endColumn: zone.endCol,
                    startRow: 0,
                    endRow: this.rowLabels.length - 1,
                    color: zone.id === 'zone_a' ? '#238636' : 
                           zone.id === 'zone_b' ? '#1f6feb' : '#d29922',
                    contractor: '', supervisor: '', targetDate: ''
                }));
                console.log('[FloorPlan Fix] Applied COLUMN_CONFIG zones:', this.zones.length, 'zones');
            } else {
                this.zones = data.zones || [];
            }
            
            this.columns = data.columns || {};
            this.statusCodes = data.statusCodes;

            // H-4 Fix: stageConfigsÎ•º P5StoreÏóêÏÑú Î°úÎìú (master_config.jsonÍ≥º ÎèôÍ∏∞Ìôî)
            if (data.productionStages) {
                this.stageConfigs = data.productionStages.map(stage => ({
                    code: stage.code,
                    label: stage.label,
                    color: stage.color,
                    order: stage.order
                }));
            }

            // Phase 7: Ï∏µ-Ï†àÏ£º Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî
            this.initFloorJeoljuData();

            // Initialize columns if empty
            if (Object.keys(this.columns).length === 0) {
                this.initializeColumns();
            }

            // ‚òÖ PSRC Ï†úÏûëÌòÑÌô© Îç∞Ïù¥ÌÑ∞ Î°úÎìú (production_status_import.js)
            this.loadProductionStatusData();

            // Initialize sample issues for demo
            this.initSampleIssues();

            // Phase 7: Í∏ÄÎ°úÎ≤å ÌÇ§Î≥¥Îìú Îã®Ï∂ïÌÇ§ Îì±Î°ù
            this.registerKeyboardShortcuts();

            // Mobile resize listener
            window.addEventListener('resize', () => {
                this.isMobile = window.innerWidth < 768;
            });

            // Log grid configuration
            const totalCells = this.gridConfig.cols * this.gridConfig.rows;
            console.log(`[Dashboard] Grid: ${this.gridConfig.cols}x${this.gridConfig.rows} = ${totalCells.toLocaleString()} cells`);
            console.log(`[Dashboard] Virtual Scrolling: ${this.virtualScroll.enabled ? 'ENABLED' : 'disabled'} (threshold: 1,000 cells)`);
            console.log(`[Dashboard] Columns loaded: ${Object.keys(this.columns).length.toLocaleString()}`);
            console.log(`[Dashboard] Issues: ${this.issues.length}`);

            if (totalCells > 1000) {
                console.log(`[Dashboard] ‚ö° Large grid detected - Virtual Scrolling active for performance`);
            }
        },

        // Phase 7: Ï∏µ-Ï†àÏ£º Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî
        // ‚ö†Ô∏è Ï§ëÏöî: "Ï†àÏ£º" = ÏàòÏßÅ Î∂ÑÏ†à (Ï∏µ Í∑∏Î£π), "Ïó¥ Íµ¨Í∞Ñ" = ÏàòÌèâ Î∂ÑÏ†à (Ïª¨Îüº Î≤îÏúÑ)
        initFloorJeoljuData() {
            // Í∏∞Î≥∏ Ï∏µ Îç∞Ïù¥ÌÑ∞ (11Í∞ú Ï∏µ) - Î†àÍ±∞Ïãú ID ÌòïÏãù (F1, F2, ...)
            this.floors = [
                { floorId: 'F1', label: '1Ï∏µ', order: 1, hasVariation: false },
                { floorId: 'F2', label: '2Ï∏µ', order: 2, hasVariation: false },
                { floorId: 'F3', label: '3Ï∏µ', order: 3, hasVariation: false },
                { floorId: 'F4', label: '4Ï∏µ', order: 4, hasVariation: false },
                { floorId: 'F5', label: '5Ï∏µ', order: 5, hasVariation: true, variationNote: 'Î∂ÄÎ∂Ñ Ï∞®Ïù¥' },
                { floorId: 'F6', label: '6Ï∏µ', order: 6, hasVariation: false },
                { floorId: 'F7', label: '7Ï∏µ', order: 7, hasVariation: false },
                { floorId: 'F8', label: '8Ï∏µ', order: 8, hasVariation: true, variationNote: 'Î∂ÄÎ∂Ñ Ï∞®Ïù¥' },
                { floorId: 'F9', label: '9Ï∏µ', order: 9, hasVariation: false },
                { floorId: 'F10', label: '10Ï∏µ', order: 10, hasVariation: false },
                { floorId: 'RF', label: 'RFÏ∏µ', order: 11, hasVariation: true, variationNote: 'ÏßÄÎ∂ïÏ∏µ' }
            ];

            // ‚òÖ Ï†àÏ£º (ÏàòÏßÅ Î∂ÑÏ†à - Ï∏µ Í∑∏Î£π) - floor_jeolju_implementation_plan.md Í∏∞Ï§Ä
            // Ï†àÏ£º = Í∏∞Îë• ÏàòÏßÅÎ∂ÑÏ†à Í≥ÑÌöçÏóê Îî∞Î•∏ Ï∏µ Í∑∏Î£π (8Í∞ú Ï†àÏ£º)
            this.jeoljuConfig = [
                { jeoljuId: '1Ï†àÏ£º', label: '1Ï†àÏ£º', floors: ['F1', 'F2'], heightRange: '1F~2F', length: 15.2, columnSize: '1600x1600', description: '1Ï†àÏ£º Ï†úÏûë ÌòÑÌô©' },
                { jeoljuId: '2Ï†àÏ£º', label: '2Ï†àÏ£º', floors: ['F3'], heightRange: '3F', length: 10.5, columnSize: '1600x1600', description: '2Ï†àÏ£º Ï†úÏûë ÌòÑÌô©' },
                { jeoljuId: '3Ï†àÏ£º', label: '3Ï†àÏ£º', floors: ['F4'], heightRange: '4F', length: 7.75, columnSize: '1500x1500', description: '3Ï†àÏ£º Ï†úÏûë ÌòÑÌô©' },
                { jeoljuId: '4Ï†àÏ£º', label: '4Ï†àÏ£º', floors: ['F5'], heightRange: '5F', length: 15.4, columnSize: '1500x1500', description: '4Ï†àÏ£º Ï†úÏûë ÌòÑÌô©' },
                { jeoljuId: '5Ï†àÏ£º', label: '5Ï†àÏ£º', floors: ['F6', 'F7'], heightRange: '6F~7F', length: 16.2, columnSize: '1300x1300', description: '5Ï†àÏ£º Ï†úÏûë ÌòÑÌô©' },
                { jeoljuId: '6Ï†àÏ£º', label: '6Ï†àÏ£º', floors: ['F8'], heightRange: '8F', length: 11.75, columnSize: '1300x1300', description: '6Ï†àÏ£º Ï†úÏûë ÌòÑÌô©' },
                { jeoljuId: '7Ï†àÏ£º', label: '7Ï†àÏ£º', floors: ['F9'], heightRange: '9F', length: 7.95, columnSize: '1300x1300', description: '7Ï†àÏ£º Ï†úÏûë ÌòÑÌô©' },
                { jeoljuId: '8Ï†àÏ£º', label: '8Ï†àÏ£º', floors: ['F10', 'RF'], heightRange: '10F~RF', length: 14.45, columnSize: '1200x1200', description: '8Ï†àÏ£º Ï†úÏûë ÌòÑÌô©' }
            ];

            // ‚òÖ Ïó¥ Íµ¨Í∞Ñ (ÏàòÌèâ Î∂ÑÏ†à - Ïª¨Îüº Î≤îÏúÑ) - Í∏∞Ï°¥ jeoljuListÎ•º Î™ÖÏπ≠ Î≥ÄÍ≤Ω
            // Í∑∏Î¶¨Îìú Î∑∞Ïñ¥ÏóêÏÑú Ïª¨Îüº Î≤îÏúÑÎ≥Ñ ÌïÑÌÑ∞ÎßÅ/ÌïòÏù¥ÎùºÏù¥Ìä∏ Ïö©ÎèÑ
            this.columnSegments = [
                { segmentId: 'S1', label: '1Íµ¨Í∞Ñ', startColumn: 1, endColumn: 9, columnCount: 9, priority: 1 },
                { segmentId: 'S2', label: '2Íµ¨Í∞Ñ', startColumn: 10, endColumn: 18, columnCount: 9, priority: 2 },
                { segmentId: 'S3', label: '3Íµ¨Í∞Ñ', startColumn: 19, endColumn: 27, columnCount: 9, priority: 3 },
                { segmentId: 'S4', label: '4Íµ¨Í∞Ñ', startColumn: 28, endColumn: 36, columnCount: 9, priority: 4 },
                { segmentId: 'S5', label: '5Íµ¨Í∞Ñ', startColumn: 37, endColumn: 45, columnCount: 9, priority: 5 },
                { segmentId: 'S6', label: '6Íµ¨Í∞Ñ', startColumn: 46, endColumn: 54, columnCount: 9, priority: 6 },
                { segmentId: 'S7', label: '7Íµ¨Í∞Ñ', startColumn: 55, endColumn: 62, columnCount: 8, priority: 7 },
                { segmentId: 'S8', label: '8Íµ¨Í∞Ñ', startColumn: 63, endColumn: 69, columnCount: 7, priority: 8 }
            ];

            // ÌïòÏúÑ Ìò∏ÌôòÏÑ±: jeoljuListÎ•º columnSegmentsÎ°ú Îß§Ìïë (Í∏∞Ï°¥ ÏΩîÎìú Ìò∏Ìôò)
            this.jeoljuList = this.columnSegments;

            console.log('[Phase 7] Floor-Jeolju data initialized:', this.floors.length, 'floors,', this.jeoljuConfig.length, 'jeolju(ÏàòÏßÅ),', this.columnSegments.length, 'segments(ÏàòÌèâ)');
            
            // Ï∏µÎ≥Ñ ÌÜµÍ≥Ñ Ï¥àÍ∏∞Ìôî (API Ìò∏Ï∂ú Ï†Ñ Í∏∞Î≥∏Í∞í)
            this.floorStats = {};
            this.floors.forEach(f => {
                this.floorStats[f.floorId] = { progress: 0, columnCount: 0, issueCount: 0 };
            });
            
            // APIÏóêÏÑú Ïã§Ï†ú ÌÜµÍ≥Ñ Î°úÎìú (ÎπÑÎèôÍ∏∞)
            if (this.syncEnabled && this.apiUrl) {
                this.loadAllFloorStats();
            }
        },

        // Phase 9: Ï†ÑÏ≤¥ Ï∏µ ÌÜµÍ≥Ñ Î°úÎìú (ÏûÖÎ©¥ Î∑∞Ïñ¥Ïö©)
        async loadAllFloorStats() {
            try {
                const apiUrl = this.apiUrl || this.apiBase;
                if (!apiUrl) return;

                const response = await fetch(`${apiUrl}?action=getFloorStats`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);

                const result = await response.json();
                if (result.success && result.floors) {
                    this.floorStats = result.floors;
                    console.log('[Phase 9] Floor stats loaded:', Object.keys(this.floorStats).length, 'floors');
                }
            } catch (error) {
                console.warn('[Phase 9] Floor stats load failed (using defaults):', error.message);
            }
        },

        // ‚òÖ PSRC Ï†úÏûëÌòÑÌô© Îç∞Ïù¥ÌÑ∞ Î°úÎìú (production_status_import.jsÏóêÏÑú Í∞ÄÏ†∏Ïò® Îç∞Ïù¥ÌÑ∞ Ï†ÅÏö©)
        loadProductionStatusData() {
            // production_status_import.jsÍ∞Ä Î°úÎìúÎêòÏóàÎäîÏßÄ ÌôïÏù∏
            if (typeof PRODUCTION_STATUS_1JEOL === 'undefined' || typeof PRODUCTION_STATUS_2JEOL === 'undefined') {
                console.warn('[Production] production_status_import.js not loaded');
                return;
            }

            let updated = 0;
            
            // Ìó¨Ìçº Ìï®Ïàò: Îç∞Ïù¥ÌÑ∞ ÏÑ∏Ìä∏ Ï≤òÎ¶¨
            const processDataSet = (dataSet, floorId) => {
                for (const uid in dataSet) {
                    // UIDÍ∞Ä Ïù¥ÎØ∏ Ï°¥Ïû¨ÌïòÎ©¥ stages ÏóÖÎç∞Ïù¥Ìä∏
                    if (this.columns[uid]) {
                        this.columns[uid].stages = { ...dataSet[uid] };
                        this.columns[uid].location.floorId = floorId; // Ï∏µ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
                        updated++;
                    } else {
                        // ÏÉà Í∏∞Îë• ÏÉùÏÑ± (UID ÌòïÏãù: "A-X36")
                        const [row, colPart] = uid.split('-');
                        const col = parseInt(colPart.replace('X', ''));
                        
                        // Zone Í≤∞Ï†ï
                        let zoneId = 'zone_c';
                        if (col <= 25) zoneId = 'zone_a';
                        else if (col <= 47) zoneId = 'zone_b';

                        this.columns[uid] = {
                            uid,
                            location: {
                                row: this.rowLabels.indexOf(row),
                                column: col,
                                zoneId,
                                floorId: floorId, // Ïò¨Î∞îÎ•∏ Ï∏µ ID Ìï†Îãπ (F1 or F2)
                                x: 0,
                                y: 0,
                                z: 0
                            },
                            status: {
                                code: 'active',
                                source: 'production_import',
                                isLocked: false,
                                updatedAt: new Date().toISOString()
                            },
                            stages: { ...dataSet[uid] }
                        };
                        updated++;
                    }
                }
            };

            // 1Ï†àÏ£º (F1) Ï≤òÎ¶¨
            processDataSet(PRODUCTION_STATUS_1JEOL, 'F1');
            
            // 2Ï†àÏ£º (F2) Ï≤òÎ¶¨
            processDataSet(PRODUCTION_STATUS_2JEOL, 'F2');

            console.log(`[Production] ${updated} columns loaded from production_status_import.js`);
            console.log(`[Production] 1Ï†àÏ£º(F1): ${Object.keys(PRODUCTION_STATUS_1JEOL).length}Í∞ú, 2Ï†àÏ£º(F2): ${Object.keys(PRODUCTION_STATUS_2JEOL).length}Í∞ú`);
            
            // ÌÜµÍ≥Ñ Í≥ÑÏÇ∞
            if (typeof getProductionStats === 'function') {
                const stats = getProductionStats();
                console.log('[Production] Stats:', stats);
            }

            // Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
            this.saveData();
        },

        // Phase 7: Ï∏µ ÏÑ†ÌÉù
        selectFloor(floorId) {
            const previousFloor = this.selectedFloor;
            this.selectedFloor = floorId;
            this.floorSelectorOpen = false;
            console.log('[Phase 7] Floor selected:', floorId);

            // Ï∏µ Î≥ÄÍ≤Ω Ïãú APIÏóêÏÑú Ìï¥Îãπ Ï∏µ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
            if (previousFloor !== floorId) {
                this.loadFloorData(floorId);
            }
        },

        // Phase 7: Ï∏µÎ≥Ñ Îç∞Ïù¥ÌÑ∞ Î°úÎìú (Ïã§Ï†ú API Ïó∞Í≤∞)
        async loadFloorData(floorId) {
            console.log('[Phase 7] Loading floor data:', floorId);
            this.showLoading(`${floorId} Ï∏µ Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ï§ë...`);

            try {
                // Î°úÎî© ÏïåÎ¶º
                this.addNotification({
                    id: 'floor-loading-' + Date.now(),
                    type: 'info',
                    title: 'Ï∏µ Îç∞Ïù¥ÌÑ∞ Î°úÎî©',
                    message: `${floorId} Ï∏µ Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...`,
                    timestamp: new Date().toISOString(),
                    autoDismiss: true,
                    dismissAfter: 2000
                });

                // API Ìò∏Ï∂ú (getFloorData endpoint)
                const apiUrl = this.apiUrl || this.apiBase;
                if (!apiUrl) {
                    throw new Error('API URL not configured');
                }

                const response = await fetch(`${apiUrl}?action=getFloorData&floorId=${floorId}`);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const result = await response.json();

                if (result.success) {
                    console.log('[Phase 7] Floor data loaded:', {
                        floor: result.floor,
                        columnCount: result.columnCount,
                        issueCount: result.issueCount
                    });

                    // 1. Í∏∞Îë• Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏ (Ìï¥Îãπ Ï∏µ Îç∞Ïù¥ÌÑ∞Î°ú ÍµêÏ≤¥)
                    if (result.columns) {
                        // Í∏∞Ï°¥ columnsÎ•º Ìï¥Îãπ Ï∏µ Îç∞Ïù¥ÌÑ∞Î°ú ÏóÖÎç∞Ïù¥Ìä∏
                        this.columns = result.columns;
                        console.log(`[Phase 7] Columns updated: ${Object.keys(this.columns).length} columns`);
                    }

                    // 2. Ï†àÏ£ºÎ≥Ñ ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
                    if (result.stats?.byJeolju) {
                        this.jeoljuList = this.jeoljuList.map(j => {
                            const stats = result.stats.byJeolju[j.jeoljuId];
                            if (stats) {
                                return {
                                    ...j,
                                    issueCount: stats.hold || 0,
                                    total: stats.total || 0,
                                    pending: stats.pending || 0,
                                    active: stats.active || 0,
                                    installed: stats.installed || 0
                                };
                            }
                            return j;
                        });
                    }

                    // 3. Ïù¥Ïäà Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏ (Ìï¥Îãπ Ï∏µ Í¥ÄÎ†® Ïù¥ÏäàÎßå)
                    if (result.issues) {
                        this.issues = result.issues;
                        console.log(`[Phase 7] Issues updated: ${this.issues.length} issues`);
                    }

                    // 4. Í∑∏Î¶¨Îìú Îç∞Ïù¥ÌÑ∞ Ïû¨ÏÉùÏÑ±
                    this.updateGridData();

                    // ÏÑ±Í≥µ ÏïåÎ¶º
                    this.addNotification({
                        id: 'floor-loaded-' + Date.now(),
                        type: 'success',
                        title: 'Ï∏µ Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏôÑÎ£å',
                        message: `${result.floor?.label || floorId}: ${result.columnCount || 0}Í∞ú Í∏∞Îë•, ${result.issueCount || 0}Í∞ú Ïù¥Ïäà`,
                        timestamp: new Date().toISOString(),
                        autoDismiss: true,
                        dismissAfter: 3000
                    });

                    // ÎßàÏßÄÎßâ Î°úÎìú ÏãúÍ∞Ñ Í∏∞Î°ù
                    this.lastFloorLoad = {
                        floorId,
                        timestamp: result.timestamp,
                        columnCount: result.columnCount
                    };

                } else {
                    throw new Error(result.error || 'Unknown error');
                }
            } catch (error) {
                console.warn('[Phase 7] Floor data load error (using local data):', error.message);

                // ÏóêÎü¨ ÏïåÎ¶º (Ïã¨Í∞ÅÌïòÏßÄ ÏïäÏùå - Î°úÏª¨ Îç∞Ïù¥ÌÑ∞Î°ú Í≥ÑÏÜç ÏûëÎèô)
                this.addNotification({
                    id: 'floor-error-' + Date.now(),
                    type: 'warning',
                    title: 'Ï∏µ Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®',
                    message: `${floorId}: ${error.message}. Î°úÏª¨ Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïö© Ï§ë.`,
                    timestamp: new Date().toISOString(),
                    autoDismiss: true,
                    dismissAfter: 5000
                });
            } finally {
                this.hideLoading();
            }
        },

        // Phase 7+: Í∑∏Î¶¨Îìú Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏ (columns ‚Üí grid Î≥ÄÌôò)
        updateGridData() {
            // grid Îç∞Ïù¥ÌÑ∞ Ïû¨ÏÉùÏÑ± (rows √ó cols Íµ¨Ï°∞)
            const rowLabels = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L'];

            this.grid = rowLabels.map((rowLabel, rowIndex) => {
                const cells = [];
                for (let col = 1; col <= 69; col++) {
                    // UID ÌòïÏãù: "A-X1" ÎòêÎäî "F01-A-X1"
                    const simpleUid = `${rowLabel}-X${col}`;
                    const floorUid = `${this.selectedFloor}-${rowLabel}-X${col}`;

                    // Îëê Í∞ÄÏßÄ UID ÌòïÏãù Î™®Îëê ÌôïÏù∏
                    const column = this.columns[floorUid] || this.columns[simpleUid];

                    cells.push({
                        row: rowIndex,
                        col: col,
                        uid: column?.uid || simpleUid,
                        status: column?.status?.code || 'pending',
                        stages: column?.stages || {},
                        issueId: column?.issueId || null,
                        isLocked: column?.status?.isLocked || false
                    });
                }
                return { label: rowLabel, cells };
            });

            console.log('[Phase 7+] Grid data updated:', this.grid.length, 'rows');
        },

        // Phase 9: ÏûÖÎ©¥ Î∑∞Ïñ¥ ÏÖÄ ÌÅ¥ÎûòÏä§ Í≤∞Ï†ï
        getElevationCellClass(floorId, jeoljuId) {
            const classes = [];
            
            // ÌòÑÏû¨ ÏÑ†ÌÉùÎêú Ï∏µ/Ï†àÏ£ºÏù¥Î©¥ selected
            if (this.selectedFloor === floorId && this.selectedJeolju === jeoljuId) {
                classes.push('selected');
            }
            
            // ÏßÑÌñâÎ•† Í∏∞Î∞ò ÌÅ¥ÎûòÏä§
            const progress = this.getFloorJeoljuProgress(floorId, jeoljuId);
            if (progress >= 100) {
                classes.push('complete');
            } else if (progress > 0) {
                classes.push('in-progress');
            }
            
            // Ïù¥Ïäà Ïó¨Î∂Ä (Ìï¥Îãπ Ï∏µ-Ï†àÏ£ºÏóê Ïù¥ÏäàÍ∞Ä ÏûàÏúºÎ©¥)
            const hasIssue = this.issues.some(issue => 
                issue.status === 'open' && 
                issue.affectedColumns?.some(uid => {
                    const jeolju = this.getJeoljuForColumn(parseInt(uid.split('-X')[1]) || 1);
                    return jeolju?.jeoljuId === jeoljuId;
                })
            );
            if (hasIssue) {
                classes.push('has-issue');
            }
            
            return classes.join(' ');
        },

        // Phase 9: Ï∏µ-Ï†àÏ£º ÎèôÏãú ÏÑ†ÌÉù
        selectFloorAndJeolju(floorId, jeoljuId) {
            const previousFloor = this.selectedFloor; // Î≥ÄÍ≤Ω Ï†Ñ Ï∏µ Ï†ÄÏû•
            
            // ÌÜ†Í∏Ä Î°úÏßÅ: Ïù¥ÎØ∏ ÏÑ†ÌÉùÎêú ÏÖÄÏù¥Î©¥ Ï†àÏ£ºÎßå Ìï¥Ï†ú
            if (this.selectedFloor === floorId && this.selectedJeolju === jeoljuId) {
                this.selectedJeolju = null;
            } else {
                this.selectedFloor = floorId;
                this.selectedJeolju = jeoljuId;
            }
            
            // Ï∏µÏù¥ Î≥ÄÍ≤ΩÎêòÏóàÏúºÎ©¥ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
            if (previousFloor !== floorId) {
                this.loadFloorData(floorId);
            }
            
            const floorLabel = this.floors.find(f => f.floorId === floorId)?.label || floorId;
            const jeoljuLabel = this.jeoljuList.find(j => j.jeoljuId === jeoljuId)?.label || jeoljuId;
            this.showToast(`${floorLabel} / ${jeoljuLabel} ÏÑ†ÌÉùÎê®`, 'info');
        },

        // Phase 9: Ï∏µ-Ï†àÏ£º Ï°∞Ìï©Ïùò ÏßÑÌñâÎ•† Í≥ÑÏÇ∞ (0-100)
        getFloorJeoljuProgress(floorId, jeoljuId) {
            // ÌòÑÏû¨ Ï∏µÏù¥ ÏÑ†ÌÉùÎêú Ï∏µÏù¥Î©¥ Ïã§Ï†ú Îç∞Ïù¥ÌÑ∞ Í∏∞Î∞ò Í≥ÑÏÇ∞
            if (this.selectedFloor === floorId && this.columns) {
                const jeolju = this.jeoljuList.find(j => j.jeoljuId === jeoljuId);
                if (!jeolju) return 0;
                
                let total = 0, installed = 0;
                
                Object.values(this.columns).forEach(col => {
                    const colNum = parseInt(col.location?.column) || 0;
                    if (colNum >= jeolju.startColumn && colNum <= jeolju.endColumn) {
                        total++;
                        if (col.status?.code === 'installed') {
                            installed++;
                        }
                    }
                });
                
                return total > 0 ? Math.round((installed / total) * 100) : 0;
            }
            
            // APIÏóêÏÑú Î°úÎìúÌïú Ï∏µÎ≥Ñ ÌÜµÍ≥Ñ ÏÇ¨Ïö©
            if (this.floorStats && this.floorStats[floorId]) {
                return this.floorStats[floorId].progress || 0;
            }
            
            // ÌÜµÍ≥Ñ ÏóÜÏúºÎ©¥ 0 Î∞òÌôò
            return 0;
        },

        // Phase 9: Ï†àÏ£º ÌïÑÌÑ∞
        filterByJeolju(jeoljuId) {
            if (this.selectedJeolju === jeoljuId) {
                this.selectedJeolju = null; // ÌÜ†Í∏Ä Ìï¥Ï†ú
                this.showToast('Ï†àÏ£º ÌïÑÌÑ∞ Ìï¥Ï†ú', 'info');
            } else {
                this.selectedJeolju = jeoljuId;
                const jeolju = this.jeoljuList.find(j => j.jeoljuId === jeoljuId);
                this.showToast(`${jeolju?.label || jeoljuId} ÌïÑÌÑ∞ Ï†ÅÏö©`, 'info');
            }
        },

        // Phase 9: Ïª¨Îüº Î≤àÌò∏Î°ú Ï†àÏ£º Ï∞æÍ∏∞
        getJeoljuForColumn(colNum) {
            return this.jeoljuList.find(j => colNum >= j.startColumn && colNum <= j.endColumn);
        },

        // Phase 7: Ï∏µ Ïù¥Îèô (Î∞©Ìñ•: -1 = ÏÉÅÏúÑ, +1 = ÌïòÏúÑ)
        navigateFloor(direction) {
            if (!this.floors || this.floors.length === 0) return;

            const currentIndex = this.floors.findIndex(f => f.floorId === this.selectedFloor);
            if (currentIndex === -1) return;

            const newIndex = Math.max(0, Math.min(this.floors.length - 1, currentIndex + direction));
            if (newIndex !== currentIndex) {
                this.selectFloor(this.floors[newIndex].floorId);
                this.showToast(`${this.floors[newIndex].label} ÏÑ†ÌÉùÎê®`, 'info');
            }
        },

        // Phase 7: Ï†àÏ£º ÌïÑÌÑ∞ ÏàúÌôò
        cycleJeoljuFilter() {
            if (!this.jeoljuList || this.jeoljuList.length === 0) return;

            if (!this.selectedJeolju) {
                // ÌïÑÌÑ∞ ÏóÜÏùå ‚Üí Ï≤´ Î≤àÏß∏ Ï†àÏ£º
                this.selectedJeolju = this.jeoljuList[0].jeoljuId;
            } else {
                const currentIndex = this.jeoljuList.findIndex(j => j.jeoljuId === this.selectedJeolju);
                if (currentIndex === this.jeoljuList.length - 1) {
                    // ÎßàÏßÄÎßâ ‚Üí ÌïÑÌÑ∞ Ìï¥Ï†ú
                    this.selectedJeolju = null;
                    this.showToast('Ï†àÏ£º ÌïÑÌÑ∞ Ìï¥Ï†ú', 'info');
                    return;
                } else {
                    // Îã§Ïùå Ï†àÏ£º
                    this.selectedJeolju = this.jeoljuList[currentIndex + 1].jeoljuId;
                }
            }

            const jeolju = this.jeoljuList.find(j => j.jeoljuId === this.selectedJeolju);
            if (jeolju) {
                this.showToast(`${jeolju.label} ÌïÑÌÑ∞ Ï†ÅÏö©`, 'info');
            }
        },

        // Phase 7: Ìï¥Îãπ Í∏∞Îë•Ïù¥ ÏÑ†ÌÉùÎêú Ï†àÏ£ºÏóê ÏÜçÌïòÎäîÏßÄ ÌôïÏù∏
        isInSelectedJeolju(columnNumber) {
            if (!this.selectedJeolju) return true;
            const jeolju = this.jeoljuList.find(j => j.jeoljuId === this.selectedJeolju);
            if (!jeolju) return true;
            return columnNumber >= jeolju.startColumn && columnNumber <= jeolju.endColumn;
        },

        // Phase 7: Ï†àÏ£ºÎ≥Ñ Ïù¥Ïäà Ïàò Í≥ÑÏÇ∞
        getJeoljuIssueCount(jeoljuId) {
            if (!jeoljuId) return 0;
            const jeolju = this.jeoljuList.find(j => j.jeoljuId === jeoljuId);
            if (!jeolju) return 0;

            return this.issues.filter(issue => {
                if (issue.status === 'resolved') return false;
                // affectedColumnsÏóêÏÑú Ï†àÏ£º Î≤îÏúÑ ÎÇ¥ Í∏∞Îë• ÌôïÏù∏
                const affected = issue.affectedColumns || [];
                return affected.some(uid => {
                    const match = uid.match(/X(\d+)/);
                    if (!match) return false;
                    const colNum = parseInt(match[1]);
                    return colNum >= jeolju.startColumn && colNum <= jeolju.endColumn;
                });
            }).length;
        },

        // Phase 7: Ï†àÏ£ºÎ≥Ñ ÏßÑÌñâÎ•† Í≥ÑÏÇ∞ (%)
        getJeoljuProgressPercent(jeoljuId) {
            if (!jeoljuId) return 0;
            const jeolju = this.jeoljuList.find(j => j.jeoljuId === jeoljuId);
            if (!jeolju) return 0;

            let total = 0;
            let completed = 0;

            Object.values(this.columns).forEach(col => {
                const colNum = col.location?.column;
                if (colNum >= jeolju.startColumn && colNum <= jeolju.endColumn) {
                    total++;
                    // installed ÏÉÅÌÉúÎ•º ÏôÑÎ£åÎ°ú Í∞ÑÏ£º
                    const lastStage = col.stages?.embed || col.stages?.form;
                    if (lastStage === 'installed') {
                        completed++;
                    } else if (col.status?.code === 'installed') {
                        completed++;
                    }
                }
            });

            return total > 0 ? Math.round((completed / total) * 100) : 0;
        },

        // Phase 7: ÏÑ†ÌÉùÎêú Ï†àÏ£º ÎùºÎ≤® Î∞òÌôò
        getSelectedJeoljuLabel() {
            if (!this.selectedJeolju) return '';
            const jeolju = this.jeoljuList.find(j => j.jeoljuId === this.selectedJeolju);
            return jeolju ? `${jeolju.label} (X${jeolju.startColumn}~X${jeolju.endColumn})` : '';
        },

        // Phase 7: Ï†àÏ£ºÎ≥Ñ Í∏∞Îë• Ïàò Í≥ÑÏÇ∞
        getJeoljuColumnCount(jeoljuId) {
            if (!jeoljuId) return 0;
            const jeolju = this.jeoljuList.find(j => j.jeoljuId === jeoljuId);
            if (!jeolju) return 0;

            let count = 0;
            Object.values(this.columns).forEach(col => {
                const colNum = col.location?.column;
                if (colNum >= jeolju.startColumn && colNum <= jeolju.endColumn) {
                    count++;
                }
            });
            return count;
        },

        initializeColumns() {
            for (let r = 0; r < this.gridConfig.rows; r++) {
                for (let c = 1; c <= this.gridConfig.cols; c++) {
                    const uid = `${this.rowLabels[r]}-X${c}`;
                    const zone = this.getZoneForColumn(c);

                    this.columns[uid] = {
                        uid,
                        location: {
                            row: this.rowLabels[r],
                            rowIndex: r,
                            column: c,
                            zoneId: zone?.id || null
                        },
                        status: {
                            code: 'pending',
                            source: 'system',
                            isLocked: false,
                            updatedAt: new Date().toISOString()
                        },
                        member: {
                            type: 'SRC Column',
                            section: 'H-500x500',
                            material: 'SM490'
                        },
                        // Phase 6: 6Îã®Í≥Ñ Í≥µÏ†ï ÏÉÅÌÉú
                        stages: {
                            hmb_fab: 'pending',
                            pre_assem: 'pending',
                            main_assem: 'pending',
                            hmb_psrc: 'pending',
                            form: 'pending',
                            embed: 'pending'
                        }
                    };
                }
            }
        },
        
        // === Zone Helpers ===
        getZoneForColumn(col) {
            return this.zones.find(z => col >= z.range.startColumn && col <= z.range.endColumn);
        },
        
        getZoneName(zoneId) {
            const zone = this.zones.find(z => z.id === zoneId);
            return zone ? `${zone.name} (${zone.displayName})` : '-';
        },
        
        getZoneProgress(zoneId) {
            const zone = this.zones.find(z => z.id === zoneId);
            if (!zone) return 0;
            
            let total = 0, installed = 0;
            for (const uid in this.columns) {
                const col = this.columns[uid];
                if (col.location.zoneId === zoneId) {
                    total++;
                    if (col.status.code === 'installed') installed++;
                }
            }
            return total > 0 ? Math.round((installed / total) * 100) : 0;
        },
        
        // === Admin Panel Functions ===
        getZoneProgress(zoneId) {
            const zone = this.zones.find(z => z.id === zoneId);
            if (!zone) return 0;
            
            let total = 0, installed = 0;
            for (const uid in this.columns) {
                const col = this.columns[uid];
                if (col?.location?.zoneId === zoneId && col?.status) {
                    total++;
                    if (col.status.code === 'installed') installed++;
                }
            }
            return total > 0 ? Math.round((installed / total) * 100) : 0;
        },

        openZoneEditor(zone) {
            if (zone) {
                // Ìé∏Ïßë Î™®Îìú
                this.editingZone = zone;
                this.zoneForm = {
                    id: zone.id,
                    name: zone.name,
                    displayName: zone.displayName,
                    description: zone.description || '',
                    startColumn: zone.range?.startColumn || zone.startColumn || 1,
                    endColumn: zone.range?.endColumn || zone.endColumn || 10,
                    startRow: zone.range?.startRow || 0,
                    endRow: zone.range?.endRow || 11,
                    color: zone.style?.primaryColor || zone.color || '#238636',
                    contractor: zone.contractor || '',
                    supervisor: zone.supervisor || '',
                    targetDate: zone.targetDate || ''
                };
            } else {
                // ÏÉà Zone Ï∂îÍ∞Ä Î™®Îìú
                this.editingZone = null;
                this.zoneForm = {
                    id: '', name: '', displayName: '', description: '',
                    startColumn: 1, endColumn: 10, startRow: 0, endRow: 11,
                    color: '#238636', contractor: '', supervisor: '', targetDate: ''
                };
            }
            this.showZoneEditor = true;
        },

        saveZone() {
            // Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨
            if (!this.zoneForm.id || !this.zoneForm.name) {
                this.showToast('Zone IDÏôÄ Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî', 'error');
                this.announceError('Ïò§Î•ò: Zone IDÏôÄ Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî');
                return;
            }
            if (this.zoneForm.startColumn > this.zoneForm.endColumn) {
                this.showToast('ÏãúÏûë Ïª¨ÎüºÏù¥ ÎÅù Ïª¨ÎüºÎ≥¥Îã§ ÌÅ¥ Ïàò ÏóÜÏäµÎãàÎã§', 'error');
                this.announceError('Ïò§Î•ò: ÏãúÏûë Ïª¨ÎüºÏù¥ ÎÅù Ïª¨ÎüºÎ≥¥Îã§ ÌÅ¥ Ïàò ÏóÜÏäµÎãàÎã§');
                return;
            }

            const now = new Date().toISOString().slice(0, 10);

            if (this.editingZone) {
                // Í∏∞Ï°¥ Zone ÏàòÏ†ï
                const idx = this.zones.findIndex(z => z.id === this.editingZone.id);
                if (idx >= 0) {
                    this.zones[idx] = {
                        ...this.zones[idx],
                        name: this.zoneForm.name,
                        displayName: this.zoneForm.displayName,
                        description: this.zoneForm.description,
                        range: {
                            startColumn: this.zoneForm.startColumn,
                            endColumn: this.zoneForm.endColumn,
                            startRow: this.zoneForm.startRow || 0,
                            endRow: this.zoneForm.endRow || 11
                        },
                        style: {
                            ...this.zones[idx].style,
                            primaryColor: this.zoneForm.color,
                            backgroundColor: this.zoneForm.color + '20'
                        },
                        contractor: this.zoneForm.contractor,
                        supervisor: this.zoneForm.supervisor,
                        targetDate: this.zoneForm.targetDate,
                        metadata: {
                            ...this.zones[idx].metadata,
                            updatedAt: now
                        }
                    };
                    this.showToast('ZoneÏù¥ ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§', 'success');
                }
            } else {
                // ÏÉà Zone Ï∂îÍ∞Ä
                const newZone = {
                    id: this.zoneForm.id,
                    name: this.zoneForm.name,
                    displayName: this.zoneForm.displayName,
                    description: this.zoneForm.description,
                    range: {
                        startColumn: this.zoneForm.startColumn,
                        endColumn: this.zoneForm.endColumn,
                        startRow: this.zoneForm.startRow || 0,
                        endRow: this.zoneForm.endRow || 11
                    },
                    style: {
                        primaryColor: this.zoneForm.color,
                        backgroundColor: this.zoneForm.color + '20',
                        progressPercent: 0
                    },
                    contractor: this.zoneForm.contractor,
                    supervisor: this.zoneForm.supervisor,
                    targetDate: this.zoneForm.targetDate,
                    metadata: {
                        createdAt: now,
                        updatedAt: now,
                        createdBy: 'admin'
                    }
                };
                this.zones.push(newZone);
                this.showToast('ÏÉà ZoneÏù¥ Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§', 'success');
            }

            this.isDirty = true;
            this.showZoneEditor = false;
            this.saveToLocalStorage(); // ÏûêÎèô Ï†ÄÏû•
        },

        deleteZone(zoneId) {
            if (confirm('Ï†ïÎßê Ïù¥ ZoneÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                this.zones = this.zones.filter(z => z.id !== zoneId);
                this.showToast('ZoneÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§', 'success');
                this.isDirty = true;
                this.saveToLocalStorage(); // ÏûêÎèô Ï†ÄÏû•
            }
        },

        openNewIssueModal() {
            this.issueForm = { 
                type: 'tc', title: '', description: '', severity: 'medium', 
                startColumn: 1, endColumn: 10, startRow: 'A', endRow: 'L',
                assignedTo: '', expectedResolution: '',
                showOverlay: true, overlayLabel: '', overlayColor: '#da3633'
            };
            this.showIssueEditor = true;
        },

        get filteredIssues() {
            if (this.issueFilter === 'all') return this.issues;
            return this.issues.filter(i => i.status === this.issueFilter);
        },

        saveIssue() {
            if (!this.issueForm.title) {
                this.showToast('Ïù¥Ïäà Ï†úÎ™©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî', 'error');
                this.announceError('Ïò§Î•ò: Ïù¥Ïäà Ï†úÎ™©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî');
                return;
            }

            // ÏòÅÌñ•Î∞õÎäî Í∏∞Îë• Í≥ÑÏÇ∞
            const affectedColumns = [];
            const startRowIdx = this.rowLabels.indexOf(this.issueForm.startRow);
            const endRowIdx = this.rowLabels.indexOf(this.issueForm.endRow);
            for (let r = startRowIdx; r <= endRowIdx; r++) {
                for (let c = this.issueForm.startColumn; c <= this.issueForm.endColumn; c++) {
                    affectedColumns.push(`${this.rowLabels[r]}-X${c}`);
                }
            }

            const timestamp = new Date().toISOString();
            const newIssue = {
                id: `ISS-${Date.now()}`,
                type: this.issueForm.type,
                title: this.issueForm.title,
                description: this.issueForm.description,
                severity: this.issueForm.severity,
                status: 'open',
                affectedColumns: affectedColumns,
                affectedArea: {
                    range: {
                        startColumn: this.issueForm.startColumn,
                        endColumn: this.issueForm.endColumn,
                        startRow: this.rowLabels.indexOf(this.issueForm.startRow),
                        endRow: this.rowLabels.indexOf(this.issueForm.endRow)
                    }
                },
                assignedTo: this.issueForm.assignedTo || null,
                expectedResolution: this.issueForm.expectedResolution || null,
                actualResolution: null,  // Phase 7+: Ïã§Ï†ú Ìï¥Í≤∞Ïùº (Ìï¥Í≤∞ Ïãú ÏÑ§Ï†ï)
                overlay: this.issueForm.showOverlay ? {
                    show: true,
                    label: this.issueForm.overlayLabel || `‚õî ${this.issueForm.title}`,
                    borderColor: this.issueForm.overlayColor
                } : { show: false },
                // Phase 7+: Extended Issue Schema
                detail: {
                    rootCause: this.issueForm.rootCause || null,
                    mitigationPlan: this.issueForm.mitigationPlan || null
                },
                reportedBy: this.issueForm.reportedBy || 'dashboard',
                reportedAt: timestamp,
                createdAt: timestamp,
                updatedAt: timestamp,
                comments: []  // ÏΩîÎ©òÌä∏ Î∞∞Ïó¥ Ï¥àÍ∏∞Ìôî
            };

            this.issues.push(newIssue);
            this.showToast(`Ïù¥Ïäà "${newIssue.title}"Ïù¥ Îì±Î°ùÎêòÏóàÏäµÎãàÎã§`, 'success');
            this.isDirty = true;
            this.showIssueEditor = false;
            this.saveToLocalStorage(); // ÏûêÎèô Ï†ÄÏû•
        },

        resolveIssue(issueId) {
            const issue = this.issues.find(i => i.id === issueId);
            if (issue && confirm(`"${issue.title}" Ïù¥ÏäàÎ•º Ìï¥Í≤∞ Ï≤òÎ¶¨ÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)) {
                const timestamp = new Date().toISOString();
                issue.status = 'resolved';
                issue.resolvedAt = timestamp;
                issue.actualResolution = timestamp;  // Phase 7+: Ïã§Ï†ú Ìï¥Í≤∞Ïùº
                issue.updatedAt = timestamp;         // Phase 7+: ÏàòÏ†ï ÏãúÍ∞Ñ
                this.showToast('Ïù¥ÏäàÍ∞Ä Ìï¥Í≤∞ÎêòÏóàÏäµÎãàÎã§', 'success');
                this.isDirty = true;
                this.saveToLocalStorage(); // ÏûêÎèô Ï†ÄÏû•
            }
        },

        clearAllData() {
            if (confirm('‚ö†Ô∏è Î™®Îì† Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÇ≠Ï†úÎê©ÎãàÎã§. Í≥ÑÏÜçÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                localStorage.removeItem(P5Store.STORAGE_KEY);
                location.reload();
            }
        },
        
        // === Column Helpers ===
        getColumnStatus(row, col) {
            const uid = `${row}-X${col}`;
            return this.columns[uid]?.status?.code || 'pending';
        },

        isLocked(row, col) {
            const uid = `${row}-X${col}`;
            return this.columns[uid]?.status?.isLocked || false;
        },

        // === Phase 6: Stage Helpers ===
        getStageStatus(row, col, stageCode) {
            const uid = `${row}-X${col}`;
            const column = this.columns[uid];
            if (!column?.stages) return 'pending';
            return column.stages[stageCode] || 'pending';
        },

        getStageTooltip(row, col) {
            const uid = `${row}-X${col}`;
            const column = this.columns[uid];
            if (!column?.stages) return uid;

            const stageLabels = {
                hmb_fab: 'HMBÏ†úÏûë',
                pre_assem: 'Î©¥Ï°∞Î¶Ω',
                main_assem: 'ÎåÄÏ°∞Î¶Ω',
                hmb_psrc: 'HMB+PSRC',
                form: 'FORM',
                embed: 'Ïï∞Î≤†Îìú'
            };

            const parts = [uid];
            let installed = 0;
            for (const [code, label] of Object.entries(stageLabels)) {
                const status = column.stages[code] || 'pending';
                if (status === 'installed') installed++;
            }
            parts.push(`${installed}/6 ÏôÑÎ£å`);
            return parts.join(' | ');
        },

        getOverallProgress(row, col) {
            const uid = `${row}-X${col}`;
            const column = this.columns[uid];
            if (!column?.stages) return 0;

            const stageCodes = ['hmb_fab', 'pre_assem', 'main_assem', 'hmb_psrc', 'form', 'embed'];
            let installed = 0;
            for (const code of stageCodes) {
                if (column.stages[code] === 'installed') installed++;
            }
            return Math.round((installed / 6) * 100);
        },

        // Ï†ÑÏ≤¥ ÌîÑÎ°úÏ†ùÌä∏Ïùò ÌäπÏ†ï Í≥µÏ†ï Îã®Í≥Ñ ÏßÑÌñâÎ•† Í≥ÑÏÇ∞
        getStageProgress(stageCode) {
            let total = 0;
            let installed = 0;

            for (const uid in this.columns) {
                const column = this.columns[uid];
                if (column?.stages) {
                    total++;
                    if (column.stages[stageCode] === 'installed') {
                        installed++;
                    }
                }
            }

            return total > 0 ? Math.round((installed / total) * 100) : 0;
        },

        // Ï†ÑÏ≤¥ ÌîÑÎ°úÏ†ùÌä∏ ÏßÑÌñâÎ•† (Î™®Îì† Í≥µÏ†ï Îã®Í≥ÑÏùò ÌèâÍ∑†)
        getTotalProgress() {
            const stageCodes = ['hmb_fab', 'pre_assem', 'main_assem', 'hmb_psrc', 'form', 'embed'];
            let totalInstalled = 0;
            let totalCount = 0;

            for (const uid in this.columns) {
                const column = this.columns[uid];
                if (column?.stages) {
                    for (const code of stageCodes) {
                        totalCount++;
                        if (column.stages[code] === 'installed') {
                            totalInstalled++;
                        }
                    }
                }
            }

            return totalCount > 0 ? Math.round((totalInstalled / totalCount) * 100) : 0;
        },

        // === WP-4: Report Panel Functions ===
        openReportPanel() {
            this.showReportPanel = true;
            this.reportTab = 'overview';
        },

        getStatusDonutData() {
            const statusCounts = {};
            const statusColors = {
                'not_started': '#6e7681',
                'in_progress': '#3b82f6',
                'complete': '#238636',
                'delayed': '#f85149',
                'installed': '#22c55e'
            };

            for (const uid in this.columns) {
                const col = this.columns[uid];
                const status = col?.status?.code || 'not_started';
                statusCounts[status] = (statusCounts[status] || 0) + 1;
            }

            const total = Object.values(statusCounts).reduce((a, b) => a + b, 0);
            if (total === 0) return [];

            const segments = [];
            let currentAngle = 0;
            const cx = 75, cy = 75, outerR = 60, innerR = 40;

            for (const [status, count] of Object.entries(statusCounts)) {
                if (count === 0) continue;
                const percentage = count / total;
                const angle = percentage * 360;
                const startAngle = currentAngle;
                const endAngle = currentAngle + angle;
                const startRad = (startAngle - 90) * Math.PI / 180;
                const endRad = (endAngle - 90) * Math.PI / 180;
                const x1 = cx + outerR * Math.cos(startRad);
                const y1 = cy + outerR * Math.sin(startRad);
                const x2 = cx + outerR * Math.cos(endRad);
                const y2 = cy + outerR * Math.sin(endRad);
                const x3 = cx + innerR * Math.cos(endRad);
                const y3 = cy + innerR * Math.sin(endRad);
                const x4 = cx + innerR * Math.cos(startRad);
                const y4 = cy + innerR * Math.sin(startRad);
                const largeArc = angle > 180 ? 1 : 0;
                const path = `M ${x1} ${y1} A ${outerR} ${outerR} 0 ${largeArc} 1 ${x2} ${y2} L ${x3} ${y3} A ${innerR} ${innerR} 0 ${largeArc} 0 ${x4} ${y4} Z`;
                segments.push({ path, color: statusColors[status] || '#888', status, count, percentage: Math.round(percentage * 100) });
                currentAngle = endAngle;
            }
            return segments;
        },

        getStatusDonutSVG() {
            const segments = this.getStatusDonutData();
            const progress = this.getTotalProgress();
            let svg = segments.map(s => `<path class="donut-segment" d="${s.path}" fill="${s.color}"/>`).join('');
            svg += `<text x="75" y="72" text-anchor="middle" class="donut-center-text">${progress}%</text>`;
            svg += `<text x="75" y="88" text-anchor="middle" class="donut-center-label">ÏôÑÎ£åÏú®</text>`;
            return svg;
        },

        getIssueSeverityDonutData() {
            const severityCounts = { critical: 0, high: 0, medium: 0, low: 0 };
            const severityColors = { critical: '#f85149', high: '#f97316', medium: '#d29922', low: '#238636' };

            for (const issue of this.issues) {
                if (issue.severity && severityCounts.hasOwnProperty(issue.severity)) {
                    severityCounts[issue.severity]++;
                }
            }

            const total = Object.values(severityCounts).reduce((a, b) => a + b, 0);
            if (total === 0) return [];

            const segments = [];
            let currentAngle = 0;
            const cx = 75, cy = 75, outerR = 60, innerR = 40;

            for (const [severity, count] of Object.entries(severityCounts)) {
                if (count === 0) continue;
                const percentage = count / total;
                const angle = percentage * 360;
                const startAngle = currentAngle;
                const endAngle = currentAngle + angle;
                const startRad = (startAngle - 90) * Math.PI / 180;
                const endRad = (endAngle - 90) * Math.PI / 180;
                const x1 = cx + outerR * Math.cos(startRad);
                const y1 = cy + outerR * Math.sin(startRad);
                const x2 = cx + outerR * Math.cos(endRad);
                const y2 = cy + outerR * Math.sin(endRad);
                const x3 = cx + innerR * Math.cos(endRad);
                const y3 = cy + innerR * Math.sin(endRad);
                const x4 = cx + innerR * Math.cos(startRad);
                const y4 = cy + innerR * Math.sin(startRad);
                const largeArc = angle > 180 ? 1 : 0;
                const path = `M ${x1} ${y1} A ${outerR} ${outerR} 0 ${largeArc} 1 ${x2} ${y2} L ${x3} ${y3} A ${innerR} ${innerR} 0 ${largeArc} 0 ${x4} ${y4} Z`;
                segments.push({ path, color: severityColors[severity], severity, count, percentage: Math.round(percentage * 100) });
                currentAngle = endAngle;
            }
            return segments;
        },

        getIssueSeverityDonutSVG() {
            const segments = this.getIssueSeverityDonutData();
            const openCount = this.openIssues.length;
            let svg = segments.map(s => `<path class="donut-segment" d="${s.path}" fill="${s.color}"/>`).join('');
            svg += `<text x="75" y="72" text-anchor="middle" class="donut-center-text">${openCount}</text>`;
            svg += `<text x="75" y="88" text-anchor="middle" class="donut-center-label">ÎØ∏Ìï¥Í≤∞</text>`;
            return svg;
        },

        getTrendData() {
            const days = 14;
            const trend = [];
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            for (let i = days - 1; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                const label = `${date.getMonth() + 1}/${date.getDate()}`;

                let changes = 0, completions = 0, issues = 0;

                // Count history events for this day
                if (this.history && Array.isArray(this.history)) {
                    for (const event of this.history) {
                        const eventDate = new Date(event.timestamp);
                        eventDate.setHours(0, 0, 0, 0);
                        if (eventDate.getTime() === date.getTime()) {
                            changes++;
                            if (event.type === 'status_change' && (event.title?.includes('ÏôÑÎ£å') || event.title?.includes('complete'))) {
                                completions++;
                            }
                            if (event.type === 'issue_create') {
                                issues++;
                            }
                        }
                    }
                }

                trend.push({ date: dateStr, label, changes, completions, issues });
            }

            return trend;
        },

        getTrendLinePath(isArea = true) {
            const data = this.getTrendData();
            if (data.length === 0) return '';

            const maxChanges = Math.max(...data.map(d => d.changes), 1);
            const chartWidth = 540;
            const chartHeight = 120;
            const baseY = 140;
            const minY = 20;

            const points = data.map((d, i) => {
                const x = 40 + (i * (chartWidth / (data.length - 1 || 1)));
                const y = baseY - ((d.changes / maxChanges) * chartHeight);
                return { x, y: Math.max(y, minY) };
            });

            if (points.length === 0) return '';

            let path = `M ${points[0].x} ${points[0].y}`;
            for (let i = 1; i < points.length; i++) {
                path += ` L ${points[i].x} ${points[i].y}`;
            }

            if (isArea) {
                // Close the area path
                path += ` L ${points[points.length - 1].x} ${baseY} L ${points[0].x} ${baseY} Z`;
            }

            return path;
        },

        getZoneColumnCount(zone) {
            let count = 0;
            const zoneId = zone?.id || zone;

            for (const uid in this.columns) {
                const col = this.columns[uid];
                if (col?.location?.zoneId === zoneId) {
                    count++;
                }
            }
            return count;
        },

        getZoneStatusCount(zone, statusCode) {
            let count = 0;
            const zoneId = zone?.id || zone;

            for (const uid in this.columns) {
                const col = this.columns[uid];
                if (col?.location?.zoneId === zoneId && col?.status?.code === statusCode) {
                    count++;
                }
            }
            return count;
        },

        exportReportToCSV() {
            // Generate report data
            const reportData = {
                generatedAt: new Date().toISOString(),
                overallProgress: this.getTotalProgress(),
                totalColumns: Object.keys(this.columns).length,
                completedColumns: Object.values(this.columns).filter(c => c.status?.code === 'complete').length,
                inProgressColumns: Object.values(this.columns).filter(c => c.status?.code === 'in_progress').length,
                notStartedColumns: Object.values(this.columns).filter(c => c.status?.code === 'not_started').length,
                openIssues: this.openIssues.length,
                criticalIssues: this.issues.filter(i => i.severity === 'critical' && i.status === 'open').length
            };

            // Generate zone progress data
            const zoneData = this.zones.map(zone => ({
                name: zone.name,
                total: this.getZoneColumnCount(zone),
                complete: this.getZoneStatusCount(zone, 'complete'),
                inProgress: this.getZoneStatusCount(zone, 'in_progress'),
                notStarted: this.getZoneStatusCount(zone, 'not_started'),
                progress: this.getZoneProgress(zone) + '%'
            }));

            // Generate stage progress data
            const stageData = this.stageConfigs.map(stage => ({
                stage: stage.label,
                progress: this.getStageProgress(stage.code) + '%'
            }));

            // Build CSV content
            let csv = 'P5 Î≥µÌï©Îèô ÏßÑÌñâ ÌòÑÌô© Î≥¥Í≥†ÏÑú\n';
            csv += `ÏÉùÏÑ±Ïùº: ${new Date().toLocaleDateString('ko-KR')}\n\n`;

            csv += '=== Ï†ÑÏ≤¥ ÏöîÏïΩ ===\n';
            csv += `Ï†ÑÏ≤¥ ÏßÑÌñâÎ•†,${reportData.overallProgress}%\n`;
            csv += `Ï¥ù Í∏∞Îë• Ïàò,${reportData.totalColumns}\n`;
            csv += `ÏôÑÎ£å,${reportData.completedColumns}\n`;
            csv += `ÏßÑÌñâÏ§ë,${reportData.inProgressColumns}\n`;
            csv += `ÎØ∏Ï∞©Ïàò,${reportData.notStartedColumns}\n`;
            csv += `ÎØ∏Ìï¥Í≤∞ Ïù¥Ïäà,${reportData.openIssues}\n`;
            csv += `Critical Ïù¥Ïäà,${reportData.criticalIssues}\n\n`;

            csv += '=== ZoneÎ≥Ñ ÌòÑÌô© ===\n';
            csv += 'Zone,Ï†ÑÏ≤¥,ÏôÑÎ£å,ÏßÑÌñâÏ§ë,ÎØ∏Ï∞©Ïàò,ÏßÑÌñâÎ•†\n';
            for (const z of zoneData) {
                csv += `${z.name},${z.total},${z.complete},${z.inProgress},${z.notStarted},${z.progress}\n`;
            }
            csv += '\n';

            csv += '=== Í≥µÏ†ïÎ≥Ñ ÏßÑÌñâÎ•† ===\n';
            csv += 'Í≥µÏ†ï,ÏßÑÌñâÎ•†\n';
            for (const s of stageData) {
                csv += `${s.stage},${s.progress}\n`;
            }

            // Download CSV file
            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `P5_Report_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();

            this.showToast('Î≥¥Í≥†ÏÑúÍ∞Ä Îã§Ïö¥Î°úÎìúÎêòÏóàÏäµÎãàÎã§', 'success');
        },

        // === Phase 6: Workflow Filter Functions ===
        toggleWorkflowFilter(stageCode) {
            if (this.workflowFilter === stageCode) {
                this.workflowFilter = null;  // Toggle off
            } else {
                this.workflowFilter = stageCode;  // Set filter
            }
        },

        clearWorkflowFilter() {
            this.workflowFilter = null;
        },

        getStageCount(stageCode) {
            let count = 0;
            for (const uid in this.columns) {
                const column = this.columns[uid];
                if (column?.stages) {
                    const status = column.stages[stageCode] || 'pending';
                    // Count columns that are currently at this stage (active or installed)
                    if (status === 'active' || status === 'installed') {
                        count++;
                    }
                }
            }
            return count;
        },

        getStageLabel(stageCode) {
            const stage = this.stageConfigs.find(s => s.code === stageCode);
            return stage ? stage.label : stageCode;
        },

        // Check if a cell should be visible based on workflow filter
        isCellFilteredByWorkflow(row, col) {
            if (!this.workflowFilter) return false;  // No filter = all visible

            const uid = `${row}-X${col}`;
            const column = this.columns[uid];
            if (!column?.stages) return true;  // No stages = filtered out

            const stageStatus = column.stages[this.workflowFilter] || 'pending';
            // Show only columns where this stage is active or installed
            return !(stageStatus === 'active' || stageStatus === 'installed');
        },

        // === Phase 7: Ïä§ÎßàÌä∏ Í≤ÄÏÉâ & ÌïÑÌÑ∞ ===

        /**
         * Í≤ÄÏÉâ Ïã§Ìñâ
         * Í∏∞Îë• UID, Zone, ÏÉÅÌÉú Îì±ÏùÑ Í≤ÄÏÉâ
         */
        performSearch() {
            const query = this.searchQuery.trim().toLowerCase();
            
            if (!query) {
                this.searchResults = [];
                this.searchDropdownOpen = false;
                return;
            }

            const results = [];
            
            // 1. Í∏∞Îë• UID Í≤ÄÏÉâ (Ïòà: "C-X30", "X30", "30")
            const uidPattern = query.replace(/[^a-z0-9\-]/gi, '');
            for (const uid in this.columns) {
                if (uid.toLowerCase().includes(uidPattern)) {
                    const column = this.columns[uid];
                    results.push({
                        id: uid,
                        type: 'column',
                        uid,
                        icon: 'üìç',
                        text: uid,
                        hint: this.statusCodes[column.status.code]?.label || column.status.code
                    });
                }
                if (results.length >= 10) break;  // ÏµúÎåÄ 10Í∞ú
            }

            // 2. Zone Í≤ÄÏÉâ
            for (const zone of this.zones) {
                if (zone.name.toLowerCase().includes(query) || 
                    zone.id.toLowerCase().includes(query)) {
                    results.push({
                        id: zone.id,
                        type: 'zone',
                        zoneId: zone.id,
                        icon: 'üèóÔ∏è',
                        text: zone.name,
                        hint: `Zone ID: ${zone.id}`
                    });
                }
            }

            // 3. ÏÉÅÌÉú Í≤ÄÏÉâ
            for (const [code, status] of Object.entries(this.statusCodes)) {
                if (status.label.toLowerCase().includes(query) || 
                    code.toLowerCase().includes(query)) {
                    results.push({
                        id: code,
                        type: 'status',
                        statusCode: code,
                        icon: 'üîµ',
                        text: status.label,
                        hint: `ÏÉÅÌÉú ÏΩîÎìú: ${code}`
                    });
                }
            }

            // 4. Ïù¥Ïäà Í≤ÄÏÉâ
            for (const issue of this.issues) {
                if (issue.title?.toLowerCase().includes(query) ||
                    issue.id?.toLowerCase().includes(query)) {
                    results.push({
                        id: issue.id || 'issue-'+Math.random(),
                        type: 'issue',
                        issueId: issue.id,
                        icon: 'üö®',
                        text: issue.title || issue.id,
                        hint: issue.status
                    });
                }
            }

            this.searchResults = results.slice(0, 15);  // ÏµúÎåÄ 15Í∞ú
            this.searchDropdownOpen = results.length > 0;
        },

        /**
         * Í≤ÄÏÉâÏñ¥Î•º ÏµúÍ∑º Í≤ÄÏÉâÏóê Ï∂îÍ∞Ä
         */
        addToRecentSearches(query) {
            if (!query.trim()) return;
            
            // Ï§ëÎ≥µ Ï†úÍ±∞ ÌõÑ Îß® ÏïûÏóê Ï∂îÍ∞Ä
            this.recentSearches = this.recentSearches.filter(s => s !== query);
            this.recentSearches.unshift(query);
            
            // ÏµúÎåÄ 5Í∞ú Ïú†ÏßÄ
            if (this.recentSearches.length > 5) {
                this.recentSearches = this.recentSearches.slice(0, 5);
            }

            // LocalStorageÏóê Ï†ÄÏû•
            try {
                localStorage.setItem('p5_recent_searches', JSON.stringify(this.recentSearches));
            } catch (e) {
                // Ï†ÄÏû• Ïã§Ìå® Î¨¥Ïãú
            }
        },

        /**
         * Í≤ÄÏÉâ Í≤∞Í≥º ÏÑ†ÌÉù
         */
        selectSearchResult(result) {
            this.addToRecentSearches(this.searchQuery);
            this.searchDropdownOpen = false;

            switch (result.type) {
                case 'column':
                    // Ìï¥Îãπ Í∏∞Îë• ÏÑ†ÌÉù Î∞è Ïä§ÌÅ¨Î°§
                    this.selectedCells = [result.uid];
                    this.scrollToColumn(result.uid);
                    this.showToast(`${result.uid} Í∏∞Îë•ÏúºÎ°ú Ïù¥Îèô`, 'success');
                    break;

                case 'zone':
                    // Zone ÌïÑÌÑ∞ ÌôúÏÑ±Ìôî
                    this.addFilter('zone', result.zoneId, result.text);
                    break;

                case 'status':
                    // ÏÉÅÌÉú ÌïÑÌÑ∞ ÌôúÏÑ±Ìôî
                    this.addFilter('status', result.statusCode, result.text);
                    break;

                case 'issue':
                    // Ïù¥Ïäà Ìå®ÎÑê Ïó¥Í≥† Ìï¥Îãπ Ïù¥Ïäà ÏÑ†ÌÉù
                    this.selectedIssue = this.issues.find(i => i.id === result.issueId);
                    this.issuePanelOpen = true;
                    break;
            }

            this.searchQuery = '';
        },

        /**
         * Í∏∞Îë•ÏúºÎ°ú Ïä§ÌÅ¨Î°§
         */
        scrollToColumn(uid) {
            // UID ÌååÏã± (Ïòà: "C-X30" -> row=C, col=30)
            const match = uid.match(/([A-L])-X(\d+)/);
            if (!match) return;

            const rowLetter = match[1];
            const col = parseInt(match[2]);
            const rowIndex = rowLetter.charCodeAt(0) - 65;  // A=0, B=1, ...

            // Ìï¥Îãπ ÏÖÄ ÏöîÏÜå Ï∞æÍ∏∞
            const cell = document.querySelector(`[data-row="${rowLetter}"][data-col="${col}"]`);
            if (cell) {
                cell.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'center' });
            }
        },

        /**
         * ÌïÑÌÑ∞ Ï∂îÍ∞Ä
         */
        addFilter(type, value, label) {
            // Ï§ëÎ≥µ ÌïÑÌÑ∞ Î∞©ÏßÄ
            const exists = this.activeFilters.find(f => f.type === type && f.value === value);
            if (exists) {
                this.showToast('Ïù¥ÎØ∏ Ï†ÅÏö©Îêú ÌïÑÌÑ∞ÏûÖÎãàÎã§', 'info');
                return;
            }

            this.activeFilters.push({ type, value, label });
            this.applyFilters();
            this.showToast(`${label} ÌïÑÌÑ∞ Ï†ÅÏö©Îê®`, 'success');
            this.announce('ÌïÑÌÑ∞ Ï†ÅÏö©Îê®');
        },

        /**
         * ÌïÑÌÑ∞ Ï†úÍ±∞
         */
        removeFilter(index) {
            const removed = this.activeFilters.splice(index, 1)[0];
            this.applyFilters();
            this.showToast(`${removed.label} ÌïÑÌÑ∞ Ìï¥Ï†úÎê®`, 'info');
            this.announce('ÌïÑÌÑ∞ Ìï¥Ï†úÎê®');
        },

        /**
         * ÌïÑÌÑ∞ Ï†ÅÏö©
         * TODO: Ïã§Ï†ú ÌïÑÌÑ∞ÎßÅ Î°úÏßÅ Íµ¨ÌòÑ
         */
        applyFilters() {
            console.log('[Search] Applying filters:', this.activeFilters);
            // ÌïÑÌÑ∞ÎßÅ Î°úÏßÅÏùÄ Í∏∞Ï°¥ columns Î†åÎçîÎßÅÍ≥º ÌÜµÌï© ÌïÑÏöî
        },

        /**
         * Î™®Îì† ÌïÑÌÑ∞ Ï¥àÍ∏∞Ìôî
         */
        clearAllFilters() {
            this.activeFilters = [];
            this.applyFilters();
            this.showToast('Î™®Îì† ÌïÑÌÑ∞Í∞Ä Ìï¥Ï†úÎêòÏóàÏäµÎãàÎã§', 'info');
        },

        /**
         * Í≤ÄÏÉâ ÏûÖÎ†• Ï¥àÍ∏∞Ìôî
         */
        clearSearch() {
            this.searchQuery = '';
            this.searchResults = [];
            this.searchDropdownOpen = false;
        },

        /**
         * Í≤ÄÏÉâ ÏûÖÎ†•Ï∞Ω ÌÇ§Î≥¥Îìú Ïù¥Î≤§Ìä∏
         */
        handleSearchKeydown(event) {
            if (event.key === 'Enter' && this.searchResults.length > 0) {
                this.selectSearchResult(this.searchResults[0]);
            } else if (event.key === 'Escape') {
                this.clearSearch();
            }
        },

        // === Phase 7: Îπ†Î•∏ ÏÉÅÌÉú Î≥ÄÍ≤Ω (Quick Actions) ===

        /**
         * ÏÑ†ÌÉùÎêú Í∏∞Îë•Îì§Ïùò ÏÉÅÌÉúÎ•º ÏùºÍ¥Ñ Î≥ÄÍ≤Ω
         */
        quickChangeStatus(statusCode) {
            if (this.selectedCells.length === 0) return;

            const statusLabel = this.statusCodes[statusCode]?.label || statusCode;
            const count = this.selectedCells.length;

            // ÌôïÏù∏ Î©îÏãúÏßÄ (5Í∞ú Ïù¥ÏÉÅÏùº ÎïåÎßå)
            if (count >= 5 && !confirm(`${count}Í∞ú Í∏∞Îë•Ïùò ÏÉÅÌÉúÎ•º "${statusLabel}"(Ïúº)Î°ú Î≥ÄÍ≤ΩÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)) {
                return;
            }

            // ÏÉÅÌÉú Î≥ÄÍ≤Ω Ï†ÅÏö©
            for (const uid of this.selectedCells) {
                if (this.columns[uid]) {
                    this.columns[uid].status = {
                        code: statusCode,
                        updatedAt: new Date().toISOString()
                    };
                }
            }

            this.showNotification(
                '‚úÖ ÏÉÅÌÉú Î≥ÄÍ≤Ω ÏôÑÎ£å',
                `${count}Í∞ú Í∏∞Îë• ‚Üí ${statusLabel}`,
                'success'
            );

            // ÏÑ†ÌÉù Ïú†ÏßÄ (Ïó∞ÏÜç ÏûëÏóÖ Í∞ÄÎä•)
            console.log(`[QuickAction] Status changed to ${statusCode} for ${count} columns`);
        },

        /**
         * ÏÑ†ÌÉùÎêú Í∏∞Îë•Îì§Ïùò Í≥µÏ†ï ÏÉÅÌÉúÎ•º ÏùºÍ¥Ñ Î≥ÄÍ≤Ω
         */
        quickChangeStage(stageCode, stageStatus = 'active') {
            if (this.selectedCells.length === 0) return;

            const stageLabel = this.getStageLabel(stageCode);
            const count = this.selectedCells.length;

            for (const uid of this.selectedCells) {
                if (this.columns[uid]) {
                    if (!this.columns[uid].stages) {
                        this.columns[uid].stages = {};
                    }
                    this.columns[uid].stages[stageCode] = stageStatus;
                }
            }

            this.showNotification(
                'üîß Í≥µÏ†ï Î≥ÄÍ≤Ω ÏôÑÎ£å',
                `${count}Í∞ú Í∏∞Îë• ‚Üí ${stageLabel} (${stageStatus})`,
                'success'
            );

            console.log(`[QuickAction] Stage ${stageCode} set to ${stageStatus} for ${count} columns`);
        },

        /**
         * ÌòÑÏû¨ ÌôúÏÑ± Í≥µÏ†ïÏùÑ ÏôÑÎ£å Ï≤òÎ¶¨
         */
        quickMarkStageComplete() {
            if (this.selectedCells.length === 0) return;

            const count = this.selectedCells.length;
            let completedStages = {};

            for (const uid of this.selectedCells) {
                const column = this.columns[uid];
                if (!column?.stages) continue;

                // ÌòÑÏû¨ activeÏù∏ Í≥µÏ†ïÏùÑ installedÎ°ú Î≥ÄÍ≤Ω
                for (const [stageCode, status] of Object.entries(column.stages)) {
                    if (status === 'active') {
                        column.stages[stageCode] = 'installed';
                        completedStages[stageCode] = (completedStages[stageCode] || 0) + 1;
                    }
                }
            }

            const stageNames = Object.keys(completedStages)
                .map(code => this.getStageLabel(code))
                .join(', ');

            if (Object.keys(completedStages).length > 0) {
                this.showNotification(
                    '‚úÖ Í≥µÏ†ï ÏôÑÎ£å Ï≤òÎ¶¨',
                    `${count}Í∞ú Í∏∞Îë•Ïùò ${stageNames} ÏôÑÎ£å`,
                    'success'
                );
            } else {
                this.showToast('ÏôÑÎ£åÌï† ÌôúÏÑ± Í≥µÏ†ïÏù¥ ÏóÜÏäµÎãàÎã§', 'info');
            }
        },

        /**
         * ÏÑ†ÌÉùÎêú Í∏∞Îë•ÏúºÎ°ú Ïù¥Ïäà Îì±Î°ù Î™®Îã¨ Ïó¥Í∏∞
         */
        openNewIssueModalWithSelected() {
            if (this.selectedCells.length === 0) return;

            // Ïù¥Ïäà Ìèº Ï¥àÍ∏∞Ìôî Î∞è ÏòÅÌñ• Í∏∞Îë• ÏÑ§Ï†ï
            this.newIssueForm = {
                type: 'tc',
                title: '',
                severity: 'medium',
                description: '',
                expectedResolution: '',
                affectedColumns: [...this.selectedCells]
            };

            this.newIssueModalOpen = true;
            this.showToast(`${this.selectedCells.length}Í∞ú Í∏∞Îë•Ïù¥ Ïù¥ÏäàÏóê Ï∂îÍ∞ÄÎê©ÎãàÎã§`, 'info');
        },

        /**
         * ÌÇ§Î≥¥Îìú Îã®Ï∂ïÌÇ§ Ï≤òÎ¶¨
         */
        handleGlobalKeydown(event) {
            // ÏûÖÎ†• ÌïÑÎìú ÎÇ¥ÏóêÏÑúÎäî Î¨¥Ïãú
            if (['INPUT', 'TEXTAREA', 'SELECT'].includes(event.target.tagName)) return;

            // ÏÑ†ÌÉùÎêú Í∏∞Îë•Ïù¥ ÏûàÏùÑ ÎïåÎßå ÎèôÏûë
            if (this.selectedCells.length === 0) return;

            switch (event.key.toLowerCase()) {
                case 'escape':
                    this.clearSelection();
                    break;
                case 's':
                    // TODO: ÏÉÅÌÉú Î≥ÄÍ≤Ω Î©îÎâ¥ ÌÜ†Í∏Ä
                    break;
                case 'p':
                    // TODO: Í≥µÏ†ï Î≥ÄÍ≤Ω Î©îÎâ¥ ÌÜ†Í∏Ä
                    break;
                case 'i':
                    event.preventDefault();
                    this.openNewIssueModalWithSelected();
                    break;
            }
        },

        // === Phase 7: ÌûàÏä§ÌÜ†Î¶¨ Î∑∞Ïñ¥ Ìï®Ïàò ===

        /**
         * ÌûàÏä§ÌÜ†Î¶¨ ÏïÑÏù¥ÏΩò Î∞òÌôò
         */
        getHistoryIcon(type) {
            const icons = {
                status: 'üîÑ',
                stage: 'üîß',
                issue: 'üö®',
                create: '‚ûï'
            };
            return icons[type] || 'üìã';
        },

        /**
         * ÌûàÏä§ÌÜ†Î¶¨ ÏãúÍ∞Ñ Ìè¨Îß∑
         */
        formatHistoryTime(timestamp) {
            if (!timestamp) return '';
            const date = new Date(timestamp);
            return date.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
        },

        /**
         * ÎÇ†Ïßú ÎùºÎ≤® Ìè¨Îß∑ (Ïò§Îäò, Ïñ¥Ï†ú, ÎÇ†Ïßú)
         */
        formatDateLabel(timestamp) {
            const date = new Date(timestamp);
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);

            if (date.toDateString() === today.toDateString()) {
                return 'Ïò§Îäò';
            } else if (date.toDateString() === yesterday.toDateString()) {
                return 'Ïñ¥Ï†ú';
            } else {
                return date.toLocaleDateString('ko-KR', { month: 'short', day: 'numeric' });
            }
        },

        /**
         * ÌûàÏä§ÌÜ†Î¶¨ Ìï≠Î™© ÌÅ¥Î¶≠ Ï≤òÎ¶¨
         */
        onHistoryItemClick(item) {
            // Ìï¥Îãπ Í∏∞Îë•ÏúºÎ°ú Ïù¥Îèô
            if (item.targetId && this.columns[item.targetId]) {
                this.selectedCells = [item.targetId];
                this.scrollToColumn(item.targetId);
                this.historyPanelOpen = false;
                this.showToast(`${item.targetId}Î°ú Ïù¥Îèô`, 'info');
            } else if (item.type === 'issue' && item.issueId) {
                // Ïù¥Ïäà ÏÉÅÏÑ∏ Ïó¥Í∏∞
                this.selectedIssue = this.issues.find(i => i.id === item.issueId);
                if (this.selectedIssue) {
                    this.issuePanelOpen = true;
                    this.historyPanelOpen = false;
                }
            }
        },

        /**
         * ÏÉÅÌÉú Î≥ÄÍ≤ΩÏùÑ ÌûàÏä§ÌÜ†Î¶¨Ïóê Í∏∞Î°ù
         */
        recordHistory(type, targetId, description, data = {}) {
            const entry = {
                id: Date.now(),
                type,
                targetId,
                description,
                timestamp: new Date().toISOString(),
                user: 'Current User',  // TODO: Ïã§Ï†ú ÏÇ¨Ïö©Ïûê Ïó∞Îèô
                data
            };

            this.historyData.unshift(entry);

            // ÏµúÎåÄ 500Í∞ú Ïú†ÏßÄ
            if (this.historyData.length > 500) {
                this.historyData = this.historyData.slice(0, 500);
            }

            // Î°úÏª¨ Ï†ÄÏû•
            try {
                localStorage.setItem('p5_history', JSON.stringify(this.historyData.slice(0, 100)));
            } catch (e) {
                // Ï†ÄÏû• Ïã§Ìå® Î¨¥Ïãú
            }
        },

        // === Phase 7: Floor Data Loading (Legacy wrapper) ===
        loadFloorDataLegacy() {
            // Î†àÍ±∞Ïãú currentFloor Í∞íÏùÑ ÏÉà selectedFloor ÌòïÏãùÏúºÎ°ú Î≥ÄÌôò
            const floorMapping = {
                'F1': 'F01',
                'F2': 'F02',
                'ALL': null  // Ï†ÑÏ≤¥Îäî ÌïÑÌÑ∞ ÏóÜÏùå
            };

            const floorId = floorMapping[this.currentFloor] || this.selectedFloor || 'F01';
            const floorName = this.currentFloor === 'F1' ? '1Ï∏µ' :
                              this.currentFloor === 'F2' ? '2Ï∏µ' : 'Ï†ÑÏ≤¥';
            console.log(`[Floor Legacy] Loading data for: ${floorName} (${floorId})`);

            // Ï∏µ Î≥ÄÍ≤Ω Ïãú ÏÑ†ÌÉù Ï¥àÍ∏∞Ìôî
            this.selectedCells = [];

            // Phase 7+ async loadFloorData Ìò∏Ï∂ú
            if (floorId && this.syncEnabled && this.apiUrl) {
                this.loadFloorData(floorId);
            } else {
                this.showToast(`${floorName} Îç∞Ïù¥ÌÑ∞ (Î°úÏª¨)`, 'info');
            }
        },

        // === Phase 7: ÎåÄÏãúÎ≥¥Îìú ÏöîÏïΩ Ìå®ÎÑê Ìï®Ïàò ===

        /**
         * Ï†ÑÏ≤¥ ÏßÑÌñâÎ•† Í≥ÑÏÇ∞
         */
        getTotalProgress() {
            const totalColumns = Object.keys(this.columns).length;
            if (totalColumns === 0) return 0;
            
            const completed = this.getCompletedColumnsCount();
            return Math.round((completed / totalColumns) * 100);
        },

        /**
         * ÏôÑÎ£åÎêú Í∏∞Îë• Ïàò Í≥ÑÏÇ∞
         */
        getCompletedColumnsCount() {
            let count = 0;
            for (const uid in this.columns) {
                const column = this.columns[uid];
                // ÎßàÏßÄÎßâ Í≥µÏ†ï(Ïï∞Î≤†Îìú)Ïù¥ ÏôÑÎ£åÎêú Í≤ΩÏö∞Î•º ÏôÑÎ£åÎ°ú Í∞ÑÏ£º
                if (column.stages?.embed === 'installed') {
                    count++;
                }
            }
            return count;
        },

        /**
         * Ïù¥Ïäà Ïã¨Í∞ÅÎèÑ Ïù¥Î™®ÏßÄ
         */
        getSeverityEmoji(severity) {
            const emojis = {
                high: 'üî¥',
                medium: 'üü°',
                low: 'üü¢'
            };
            return emojis[severity] || '‚ö™';
        },

        /**
         * ZoneÎ≥Ñ ÏßÑÌñâÎ•† Í≥ÑÏÇ∞
         */
        getZoneProgress(zoneId) {
            const zone = this.zones.find(z => z.id === zoneId);
            if (!zone || !zone.columns?.length) return 0;

            let completed = 0;
            for (const uid of zone.columns) {
                const column = this.columns[uid];
                if (column?.stages?.embed === 'installed') {
                    completed++;
                }
            }
            return Math.round((completed / zone.columns.length) * 100);
        },

        /**
         * Zone ÏÉâÏÉÅ Î∞òÌôò
         */
        getZoneColor(zoneId) {
            const zone = this.zones.find(z => z.id === zoneId);
            return zone?.color || '#1f6feb';
        },

        /**
         * Ïò§Îäò Î≥ÄÍ≤Ω ÎÇ¥Ïó≠ ÏóÖÎç∞Ïù¥Ìä∏ (ÌûàÏä§ÌÜ†Î¶¨ÏóêÏÑú Ï∂îÏ∂ú)
         */
        updateTodayChanges() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            this.todayChanges = this.notificationHistory
                .filter(n => new Date(n.timestamp) >= today)
                .slice(0, 10)
                .map((n, idx) => ({
                    id: n.id || idx,
                    time: this.formatNotificationTime(n.timestamp),
                    description: `${n.title}: ${n.message}`
                }));
        },

        // === Phase 7: Ïã§ÏãúÍ∞Ñ ÏïåÎ¶º ÏãúÏä§ÌÖú ===
        
        /**
         * ÏïåÎ¶º ÌëúÏãú (Toast)
         * @param {string} title - ÏïåÎ¶º Ï†úÎ™©
         * @param {string} message - ÏïåÎ¶º Î©îÏãúÏßÄ
         * @param {string} type - 'success' | 'info' | 'warning' | 'error' | 'critical'
         * @param {Object} options - { duration, action, data }
         */
        showNotification(title, message, type = 'info', options = {}) {
            const id = ++this.notificationIdCounter;
            const notification = {
                id,
                title,
                message,
                type,
                timestamp: new Date(),
                read: false,
                closing: false,
                action: options.action || null,
                data: options.data || null
            };

            // ÌôúÏÑ± ÏïåÎ¶ºÏóê Ï∂îÍ∞Ä (ÏµúÎåÄ 3Í∞ú Ïú†ÏßÄ)
            this.activeNotifications.unshift(notification);
            if (this.activeNotifications.length > 3) {
                this.activeNotifications.pop();
            }

            // ÌûàÏä§ÌÜ†Î¶¨Ïóê Ï∂îÍ∞Ä (ÏµúÎåÄ 50Í∞ú Ïú†ÏßÄ)
            this.notificationHistory.unshift({ ...notification });
            if (this.notificationHistory.length > 50) {
                this.notificationHistory.pop();
            }

            // Í∏¥Í∏â ÏïåÎ¶º Ïãú ÏÜåÎ¶¨ Î∞è ÏßÑÎèô
            if (type === 'critical' || type === 'error') {
                this.playNotificationSound(type);
            }

            // ÏûêÎèô Îã´Í∏∞ (Í∏∞Î≥∏ 5Ï¥à, criticalÏùÄ 10Ï¥à)
            const duration = options.duration || (type === 'critical' ? 10000 : 5000);
            setTimeout(() => {
                this.dismissNotification(id);
            }, duration);

            console.log(`[Notification] ${type.toUpperCase()}: ${title}`);
            return id;
        },

        /**
         * Í∞ÑÌé∏ ÏïåÎ¶º (Í∏∞Ï°¥ showToast ÎåÄÏ≤¥)
         */
        showToast(message, type = 'info') {
            const titles = {
                success: '‚úÖ ÏôÑÎ£å',
                info: '‚ÑπÔ∏è ÏïàÎÇ¥',
                warning: '‚ö†Ô∏è Ï£ºÏùò',
                error: '‚ùå Ïò§Î•ò',
                critical: 'üö® Í∏¥Í∏â'
            };
            return this.showNotification(titles[type] || titles.info, message, type);
        },

        /**
         * Screen reader announcement (polite)
         */
        announce(message) {
            const el = document.getElementById('sr-announcements');
            if (el) {
                el.textContent = '';
                setTimeout(() => { el.textContent = message; }, 100);
            }
        },

        /**
         * Screen reader error announcement (assertive)
         */
        announceError(message) {
            const el = document.getElementById('sr-errors');
            if (el) {
                el.textContent = '';
                setTimeout(() => { el.textContent = message; }, 100);
            }
        },

        /**
         * ÏïåÎ¶º Îã´Í∏∞ (Ïï†ÎãàÎ©îÏù¥ÏÖò Ìè¨Ìï®)
         */
        dismissNotification(id) {
            const notification = this.activeNotifications.find(n => n.id === id);
            if (notification) {
                notification.closing = true;
                setTimeout(() => {
                    this.activeNotifications = this.activeNotifications.filter(n => n.id !== id);
                }, 300);
            }
        },

        /**
         * ÏïåÎ¶º ÌÅ¥Î¶≠ Ìï∏Îì§Îü¨
         */
        handleNotificationClick(notification) {
            // ÏïåÎ¶ºÏùÑ ÏùΩÏùå Ï≤òÎ¶¨
            const historyItem = this.notificationHistory.find(n => n.id === notification.id);
            if (historyItem) {
                historyItem.read = true;
            }

            // Ïï°ÏÖòÏù¥ ÏûàÏúºÎ©¥ Ïã§Ìñâ
            if (notification.action && typeof notification.action === 'function') {
                notification.action(notification.data);
            }

            // ÏïåÎ¶º Îã´Í∏∞
            this.dismissNotification(notification.id);
        },

        /**
         * ÌûàÏä§ÌÜ†Î¶¨ ÏïÑÏù¥ÌÖú ÌÅ¥Î¶≠ Ìï∏Îì§Îü¨
         */
        handleHistoryItemClick(notification) {
            notification.read = true;

            // Í¥ÄÎ†® Ïù¥ÏäàÎ°ú Ïù¥Îèô Îì±Ïùò Ïï°ÏÖò
            if (notification.data?.issueId) {
                this.selectedIssue = this.issues.find(i => i.id === notification.data.issueId);
                this.issuePanelOpen = true;
                this.notificationPanelOpen = false;
            }
        },

        /**
         * ÏïåÎ¶º ÌûàÏä§ÌÜ†Î¶¨ Ìå®ÎÑê ÌÜ†Í∏Ä
         */
        toggleNotificationPanel() {
            this.notificationPanelOpen = !this.notificationPanelOpen;
            
            // Ìå®ÎÑêÏùÑ Ïó¥ Îïå Ïù¥Ïäà Ìå®ÎÑêÏùÄ Îã´Í∏∞
            if (this.notificationPanelOpen) {
                this.issuePanelOpen = false;
            }
        },

        /**
         * Î™®Îì† ÏïåÎ¶º ÏùΩÏùå Ï≤òÎ¶¨
         */
        markAllNotificationsRead() {
            this.notificationHistory.forEach(n => n.read = true);
            this.showToast('Î™®Îì† ÏïåÎ¶ºÏùÑ ÏùΩÏùå Ï≤òÎ¶¨ÌñàÏäµÎãàÎã§', 'success');
        },

        /**
         * ÏïåÎ¶º ÌûàÏä§ÌÜ†Î¶¨ Ï†ÑÏ≤¥ ÏÇ≠Ï†ú
         */
        clearNotificationHistory() {
            if (confirm('Î™®Îì† ÏïåÎ¶º ÌûàÏä§ÌÜ†Î¶¨Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                this.notificationHistory = [];
                this.showToast('ÏïåÎ¶º ÌûàÏä§ÌÜ†Î¶¨Í∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§', 'info');
            }
        },

        /**
         * ÏïåÎ¶º ÏïÑÏù¥ÏΩò Î∞òÌôò
         */
        getNotificationIcon(type) {
            const icons = {
                success: '‚úÖ',
                info: '‚ÑπÔ∏è',
                warning: '‚ö†Ô∏è',
                error: '‚ùå',
                critical: 'üö®'
            };
            return icons[type] || icons.info;
        },

        /**
         * ÏïåÎ¶º ÏãúÍ∞Ñ Ìè¨Îß∑ (ÌïúÍµ≠Ïñ¥)
         */
        formatNotificationTime(timestamp) {
            const now = new Date();
            const diff = now - new Date(timestamp);
            const seconds = Math.floor(diff / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);

            if (seconds < 60) return 'Î∞©Í∏à Ï†Ñ';
            if (minutes < 60) return `${minutes}Î∂Ñ Ï†Ñ`;
            if (hours < 24) return `${hours}ÏãúÍ∞Ñ Ï†Ñ`;
            if (days < 7) return `${days}Ïùº Ï†Ñ`;
            
            // ÏùºÏ£ºÏùº Ïù¥ÏÉÅ ÏßÄÎÇú Í≤ΩÏö∞ ÎÇ†Ïßú ÌëúÏãú
            const date = new Date(timestamp);
            return `${date.getMonth() + 1}Ïõî ${date.getDate()}Ïùº`;
        },

        /**
         * ÏïåÎ¶º ÏÇ¨Ïö¥Îìú Ïû¨ÏÉù (Ïõπ API ÏÇ¨Ïö©)
         */
        playNotificationSound(type) {
            try {
                // Î∏åÎùºÏö∞Ï†Ä ÏßÑÎèô API (Î™®Î∞îÏùº)
                if ('vibrate' in navigator) {
                    if (type === 'critical') {
                        navigator.vibrate([200, 100, 200, 100, 200]);
                    } else {
                        navigator.vibrate(200);
                    }
                }

                // ÏãúÏä§ÌÖú ÏïåÎ¶ºÏùå (Í∞ÄÎä•Ìïú Í≤ΩÏö∞)
                if ('Notification' in window && Notification.permission === 'granted') {
                    // ÏãúÏä§ÌÖú ÏïåÎ¶ºÏùÑ ÌÜµÌïú ÏÜåÎ¶¨ (ÏÑ†ÌÉùÏÇ¨Ìï≠)
                }
            } catch (e) {
                // Ïò§Î•ò Î¨¥Ïãú (ÏÇ¨Ïö¥ÎìúÎäî ÏÑ†ÌÉù Í∏∞Îä•)
            }
        },

        // === Phase 9: History Panel Methods ===

        /**
         * Ïù¥Î†• ÏïÑÏù¥ÏΩò Î∞òÌôò
         */
        getHistoryIcon(type) {
            const icons = {
                status: 'üîÑ',
                issue: 'üö®',
                lock: 'üîí',
                import: 'üì•',
                stage: 'üìä'
            };
            return icons[type] || 'üìã';
        },

        /**
         * Ïù¥Î†• ÏãúÍ∞Ñ Ìè¨Îß∑ (ÌïúÍµ≠Ïñ¥)
         */
        formatHistoryTime(timestamp) {
            const now = new Date();
            const diff = now - new Date(timestamp);
            const seconds = Math.floor(diff / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            
            if (seconds < 60) return 'Î∞©Í∏à Ï†Ñ';
            if (minutes < 60) return `${minutes}Î∂Ñ Ï†Ñ`;
            if (hours < 24) return `${hours}ÏãúÍ∞Ñ Ï†Ñ`;
            
            // ÌïòÎ£® Ïù¥ÏÉÅ ÏßÄÎÇú Í≤ΩÏö∞ ÏãúÍ∞Ñ ÌëúÏãú
            const date = new Date(timestamp);
            return `${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
        },

        /**
         * ÎÇ†Ïßú ÎùºÎ≤® Ìè¨Îß∑ (Ïò§Îäò, Ïñ¥Ï†ú, ÎÇ†Ïßú)
         */
        formatDateLabel(timestamp) {
            const date = new Date(timestamp);
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);

            if (date.toDateString() === today.toDateString()) {
                return 'Ïò§Îäò';
            } else if (date.toDateString() === yesterday.toDateString()) {
                return 'Ïñ¥Ï†ú';
            } else {
                return `${date.getMonth() + 1}Ïõî ${date.getDate()}Ïùº`;
            }
        },

        /**
         * Ïù¥Î†• ÏÉÅÏÑ∏ Ïó¥Í∏∞
         */
        openHistoryDetail(item) {
            // Ìï¥Îãπ Ìï≠Î™© Í¥ÄÎ†® Í∏∞Îë•ÏúºÎ°ú Ïù¥Îèô
            if (item.affectedColumns && item.affectedColumns.length > 0) {
                this.selectedCells = [...item.affectedColumns];
                const firstCol = item.affectedColumns[0];
                this.openDetail(null, firstCol);
            }
            this.showToast(`"${item.title}" Ìï≠Î™© ÏÑ†ÌÉùÎê®`, 'info');
        },

        /**
         * Îçî ÎßéÏùÄ Ïù¥Î†• Î°úÎìú
         */
        loadMoreHistory() {
            // TODO: Î∞±ÏóîÎìú API Ïó∞Îèô Ïãú ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò Íµ¨ÌòÑ
            this.showToast('Ï∂îÍ∞Ä Ïù¥Î†• Î°úÎìú Ï§ë...', 'info');
        },

        /**
         * Ïù¥Î†• CSV ÎÇ¥Î≥¥ÎÇ¥Í∏∞
         */
        exportHistory() {
            const headers = ['ID', 'Type', 'Title', 'User', 'Timestamp', 'Affected Count'];
            const rows = this.filteredHistory.map(item => [
                item.id,
                item.type,
                item.title,
                item.user || 'System',
                item.timestamp,
                item.affectedCount || 1
            ]);
            
            const csv = [headers.join(','), ...rows.map(r => r.join(','))].join('\n');
            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `p5_history_${new Date().toISOString().slice(0,10)}.csv`;
            a.click();
            URL.revokeObjectURL(url);
            
            this.showToast('Ïù¥Î†• CSV Îã§Ïö¥Î°úÎìú ÏôÑÎ£å', 'success');
        },

        /**
         * Ïù¥Î†• Ìï≠Î™© Ï∂îÍ∞Ä (ÎÇ¥Î∂Ä Ïú†Ìã∏Î¶¨Ìã∞)
         */
        addHistoryItem(type, title, affectedColumns = [], user = 'dashboard') {
            const historyId = `HIST-${Date.now()}`;
            const item = {
                id: historyId,
                type: type,
                title: title,
                user: user,
                timestamp: new Date().toISOString(),
                affectedColumns: affectedColumns,
                affectedCount: affectedColumns.length || 1
            };
            
            // ÌûàÏä§ÌÜ†Î¶¨ ÏïûÏóê Ï∂îÍ∞Ä (ÏµúÏã†Ïàú)
            this.historyData.unshift(item);
            
            // ÏµúÎåÄ 100Í∞ú Ïú†ÏßÄ
            if (this.historyData.length > 100) {
                this.historyData = this.historyData.slice(0, 100);
            }
            
            // Ïò§Îäò Î≥ÄÍ≤Ω ÎÇ¥Ïó≠ÏóêÎèÑ Ï∂îÍ∞Ä
            const today = new Date().toDateString();
            if (new Date(item.timestamp).toDateString() === today) {
                this.todayChanges.unshift(item);
                if (this.todayChanges.length > 20) {
                    this.todayChanges = this.todayChanges.slice(0, 20);
                }
            }
            
            return item;
        },

        /**
         * Îçî ÎßéÏùÄ Ïù¥Î†• ÏûàÎäîÏßÄ ÌôïÏù∏
         */
        get hasMoreHistory() {
            // TODO: Î∞±ÏóîÎìú Ïó∞Îèô Ïãú Ïã§Ï†ú ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò ÏÉÅÌÉú Î∞òÌôò
            return false;
        },

        // === Selection ===
        isSelected(row, col) {
            const uid = `${row}-X${col}`;
            return this.selectedCells.includes(uid);
        },
        
        handleCellClick(event, row, col) {
            const uid = `${row}-X${col}`;
            
            if (event.shiftKey && this.selectedCells.length > 0) {
                // Shift+Click: Range select
                const lastSelected = this.selectedCells[this.selectedCells.length - 1];
                const [lastRow, lastColStr] = lastSelected.split('-X');
                const lastCol = parseInt(lastColStr);
                const currentCol = col;
                
                const startCol = Math.min(lastCol, currentCol);
                const endCol = Math.max(lastCol, currentCol);
                const startRowIdx = Math.min(this.rowLabels.indexOf(lastRow), this.rowLabels.indexOf(row));
                const endRowIdx = Math.max(this.rowLabels.indexOf(lastRow), this.rowLabels.indexOf(row));
                
                for (let r = startRowIdx; r <= endRowIdx; r++) {
                    for (let c = startCol; c <= endCol; c++) {
                        const cellUid = `${this.rowLabels[r]}-X${c}`;
                        if (!this.selectedCells.includes(cellUid)) {
                            this.selectedCells.push(cellUid);
                        }
                    }
                }
            } else if (event.ctrlKey || event.metaKey) {
                // Ctrl+Click: Toggle single
                const idx = this.selectedCells.indexOf(uid);
                if (idx === -1) {
                    this.selectedCells.push(uid);
                } else {
                    this.selectedCells.splice(idx, 1);
                }
            } else {
                // Normal click: Single select
                this.selectedCells = [uid];
            }
        },
        
        clearSelection() {
            this.selectedCells = [];
            this.bulkEditOpen = false;
        },

        bulkChangeStatus(newStatus) {
            const count = this.selectedCells.length;
            if (count === 0) return;

            const statusLabel = this.statusCodes[newStatus]?.label || newStatus;
            const updatedUids = [];

            // 1. Î°úÏª¨ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ (Optimistic UI)
            this.selectedCells.forEach(uid => {
                if (this.columns[uid]) {
                    this.columns[uid].status = {
                        ...this.columns[uid].status,
                        code: newStatus,
                        updatedAt: new Date().toISOString(),
                        source: 'admin'
                    };
                    updatedUids.push(uid);
                }
            });

            // 2. Sync QueueÏóê Ï∂îÍ∞Ä (Sheet Ïó∞Îèô - Bulk)
            if (this.syncEnabled && typeof SyncModule !== 'undefined' && updatedUids.length > 0) {
                SyncModule.queueChange('bulkUpdateColumns', {
                    updates: updatedUids.map(uid => ({
                        uid: uid,
                        status: newStatus
                    })),
                    user: 'dashboard'
                });
            }

            this.showToast(`${count}Í∞ú Í∏∞Îë•Ïù¥ "${statusLabel}"ÏúºÎ°ú Î≥ÄÍ≤ΩÎêòÏóàÏäµÎãàÎã§`, 'success');
            this.isDirty = true;
            this.clearSelection();
        },
        
        selectByStatus(status) {
            this.selectedCells = [];
            for (const uid in this.columns) {
                if (this.columns[uid].status.code === status) {
                    this.selectedCells.push(uid);
                }
            }
            this.showToast(`Selected ${this.selectedCells.length} ${status} columns`);
        },
        
        selectByZone(zoneId) {
            this.selectedCells = [];
            for (const uid in this.columns) {
                if (this.columns[uid].location.zoneId === zoneId) {
                    this.selectedCells.push(uid);
                }
            }
            this.showToast(`Selected ${this.selectedCells.length} columns in zone`);
        },
        
        // === Drag Selection ===
        startDragSelect(event) {
            // Prevent drag if clicking on stage-grid or its children
            if (event.target.classList.contains('stage-grid') ||
                event.target.classList.contains('stage-cell') ||
                event.target.classList.contains('dot')) return;
            this.isDragging = true;
            this.dragStart = { x: event.offsetX, y: event.offsetY };
            this.dragEnd = { x: event.offsetX, y: event.offsetY };
        },
        
        updateDragSelect(event) {
            if (!this.isDragging) return;
            this.dragEnd = { x: event.offsetX, y: event.offsetY };
        },
        
        endDragSelect() {
            if (!this.isDragging) return;
            this.isDragging = false;
            // In a full implementation, we'd calculate which cells are in the rect
            this.dragStart = null;
            this.dragEnd = null;
        },
        
        isInDragRect(row, col) {
            // Placeholder for drag rectangle detection
            return false;
        },

        // === WP-1: Touch Drag Selection ===
        startTouchDragSelect(event) {
            // Ignore multi-touch (pinch zoom)
            if (event.touches.length > 1) return;

            // Prevent if touching stage-grid elements
            const target = event.target;
            if (target.classList.contains('stage-grid') ||
                target.classList.contains('stage-cell') ||
                target.classList.contains('dot')) return;

            const touch = event.touches[0];
            const gridScrollView = this.$refs.gridScrollView;

            if (gridScrollView) {
                this.touchDragGridRect = gridScrollView.getBoundingClientRect();
                this.touchDragActive = true;
                this.touchDragStart = { x: touch.clientX, y: touch.clientY };
                this.touchDragEnd = { x: touch.clientX, y: touch.clientY };
                this.touchDragCellCount = 0;

                // Haptic feedback (if available)
                if ('vibrate' in navigator) {
                    navigator.vibrate(10);
                }
            }
        },

        updateTouchDragSelect(event) {
            // Cancel pending RAF if multi-touch or inactive
            if (!this.touchDragActive || event.touches.length > 1) {
                if (this._touchDragRAFId) {
                    cancelAnimationFrame(this._touchDragRAFId);
                    this._touchDragRAFId = null;
                }
                this._touchDragRAFPending = false;
                return;
            }

            // Performance: Throttle with requestAnimationFrame
            if (this._touchDragRAFPending) return;
            this._touchDragRAFPending = true;

            // Store RAF ID for cleanup
            this._touchDragRAFId = requestAnimationFrame(() => {
                this._touchDragRAFPending = false;
                this._touchDragRAFId = null;
                if (!this.touchDragActive) return;

                const touch = event.touches[0];
                if (!touch) return;

                this.touchDragEnd = { x: touch.clientX, y: touch.clientY };

                // Calculate selected cell count (approximation based on drag rect size)
                const cellWidth = this.virtualScroll.enabled ? this.virtualScroll.cellWidth : 28;
                const cellHeight = this.virtualScroll.enabled ? this.virtualScroll.cellHeight : 30;

                const width = Math.abs(this.touchDragEnd.x - this.touchDragStart.x);
                const height = Math.abs(this.touchDragEnd.y - this.touchDragStart.y);

                const colCount = Math.max(1, Math.floor(width / cellWidth));
                const rowCount = Math.max(1, Math.floor(height / cellHeight));
                this.touchDragCellCount = colCount * rowCount;
            });
        },

        endTouchDragSelect(event) {
            if (!this.touchDragActive) return;

            // Cleanup any pending RAF to prevent memory leak
            if (this._touchDragRAFId) {
                cancelAnimationFrame(this._touchDragRAFId);
                this._touchDragRAFId = null;
            }
            this._touchDragRAFPending = false;

            // Calculate which cells are in the drag rectangle
            const selectedCells = this.getCellsInTouchDragRect();

            if (selectedCells.length > 0) {
                // Add to selection (or replace if not holding shift equivalent)
                this.selectedCells = [...new Set([...this.selectedCells, ...selectedCells])];
                this.showToast(`${selectedCells.length}Í∞ú ÏÖÄ ÏÑ†ÌÉùÎê®`, 'success');

                // Haptic feedback for selection complete
                if ('vibrate' in navigator) {
                    navigator.vibrate([20, 50, 20]);
                }
            }

            // Reset state
            this.touchDragActive = false;
            this.touchDragStart = { x: 0, y: 0 };
            this.touchDragEnd = { x: 0, y: 0 };
            this.touchDragCellCount = 0;
            this.touchDragGridRect = null;
        },

        getCellsInTouchDragRect() {
            if (!this.touchDragGridRect) return [];

            const cells = [];
            const gridScrollView = this.$refs.gridScrollView;
            if (!gridScrollView) return [];

            const scrollLeft = gridScrollView.scrollLeft;
            const scrollTop = gridScrollView.scrollTop;
            const gridRect = this.touchDragGridRect;

            // Convert screen coordinates to grid coordinates
            const startX = Math.min(this.touchDragStart.x, this.touchDragEnd.x) - gridRect.left + scrollLeft;
            const startY = Math.min(this.touchDragStart.y, this.touchDragEnd.y) - gridRect.top + scrollTop;
            const endX = Math.max(this.touchDragStart.x, this.touchDragEnd.x) - gridRect.left + scrollLeft;
            const endY = Math.max(this.touchDragStart.y, this.touchDragEnd.y) - gridRect.top + scrollTop;

            // Cell dimensions (including gap)
            const cellWidth = this.virtualScroll.enabled ? this.virtualScroll.cellWidth : 28;
            const cellHeight = this.virtualScroll.enabled ? this.virtualScroll.cellHeight : 30;

            // Account for header row
            const headerHeight = cellHeight;

            // Calculate row/col range
            const startCol = Math.max(1, Math.floor(startX / cellWidth));
            const endCol = Math.min(this.gridConfig.cols, Math.ceil(endX / cellWidth));
            const startRow = Math.max(0, Math.floor((startY - headerHeight) / cellHeight));
            const endRow = Math.min(this.gridConfig.rows - 1, Math.ceil((endY - headerHeight) / cellHeight));

            // Generate UIDs for selected cells
            for (let r = startRow; r <= endRow; r++) {
                const rowLabel = this.rowLabels[r];
                if (!rowLabel) continue;

                for (let c = startCol; c <= endCol; c++) {
                    const uid = `${rowLabel}-X${c}`;
                    if (this.columns[uid]) {
                        cells.push(uid);
                    }
                }
            }

            return cells;
        },

        // === Detail Panel ===
        openDetail(row, col) {
            const uid = `${row}-X${col}`;
            this.currentColumn = this.columns[uid];
            
            // Populate edit form
            this.editForm.status = this.currentColumn.status.code;
            this.editForm.isLocked = this.currentColumn.status.isLocked || false;
            this.editForm.memberType = this.currentColumn.member?.type || 'SRC Column';
            this.editForm.section = this.currentColumn.member?.section || 'H-500x500';
            
            this.isDirty = false;
            this.detailPanelOpen = true;
        },
        
        markDirty() {
            this.isDirty = true;
        },
        
        cancelEdit() {
            this.detailPanelOpen = false;
            this.isDirty = false;
        },
        
        saveColumn() {
            if (!this.currentColumn) return;

            const uid = this.currentColumn.uid;
            const changes = {
                status: this.editForm.status,
                isLocked: this.editForm.isLocked,
                memberType: this.editForm.memberType,
                section: this.editForm.section
            };

            // 1. Î°úÏª¨ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ (Optimistic UI)
            this.columns[uid].status.code = changes.status;
            this.columns[uid].status.isLocked = changes.isLocked;
            this.columns[uid].status.source = 'admin';
            this.columns[uid].status.updatedAt = new Date().toISOString();
            this.columns[uid].member.type = changes.memberType;
            this.columns[uid].member.section = changes.section;

            // 2. Sync QueueÏóê Ï∂îÍ∞Ä (Sheet Ïó∞Îèô)
            if (this.syncEnabled && typeof SyncModule !== 'undefined') {
                SyncModule.queueChange('updateColumn', {
                    uid: uid,
                    data: changes,
                    user: 'dashboard'
                });
            }

            this.isDirty = false;
            this.showToast(`Saved: ${uid}`, 'success');
            this.announce('Ï†ÄÏû• ÏôÑÎ£å');
        },

        // === Bulk Edit ===
        openBulkEdit() {
            this.bulkEditForm.status = '';
            this.bulkEditForm.setLock = false;
            this.bulkEditOpen = true;
        },
        
        closeBulkEdit() {
            this.bulkEditOpen = false;
        },

        getSelectedLockCount() {
            return this.selectedCells.filter(uid =>
                this.columns[uid]?.status?.isLocked
            ).length;
        },

        bulkLockSelected(lockState) {
            const updates = [];

            // 1. Î°úÏª¨ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ (Optimistic UI)
            for (const uid of this.selectedCells) {
                if (this.columns[uid]) {
                    this.columns[uid].status.isLocked = lockState;
                    updates.push({ uid, isLocked: lockState });
                }
            }

            // 2. Sync QueueÏóê Ï∂îÍ∞Ä (Sheet Ïó∞Îèô)
            if (this.syncEnabled && typeof SyncModule !== 'undefined' && updates.length > 0) {
                SyncModule.queueChange('bulkUpdateColumns', {
                    updates: updates,
                    user: 'dashboard'
                });
            }

            const action = lockState ? 'Locked' : 'Unlocked';
            this.showToast(`üîí ${action} ${updates.length} columns`, 'success');
            this.saveToLocalStorage();
        },

        applyBulkEdit() {
            const updates = [];

            // 1. Î°úÏª¨ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ (Optimistic UI)
            for (const uid of this.selectedCells) {
                const updateData = {};
                if (this.bulkEditForm.status) {
                    this.columns[uid].status.code = this.bulkEditForm.status;
                    this.columns[uid].status.source = 'admin';
                    this.columns[uid].status.updatedAt = new Date().toISOString();
                    updateData.status = this.bulkEditForm.status;
                }
                if (this.bulkEditForm.setLock) {
                    this.columns[uid].status.isLocked = true;
                    updateData.isLocked = true;
                }
                if (Object.keys(updateData).length > 0) {
                    updates.push({ uid, ...updateData });
                }
            }

            // 2. Sync QueueÏóê Ï∂îÍ∞Ä (Sheet Ïó∞Îèô - Bulk)
            if (this.syncEnabled && typeof SyncModule !== 'undefined' && updates.length > 0) {
                SyncModule.queueChange('bulkUpdateColumns', {
                    updates: updates,
                    user: 'dashboard'
                });
            }

            this.showToast(`Updated ${updates.length} columns`, 'success');
            this.closeBulkEdit();
            this.clearSelection();
        },
        
        // === Storage ===
        saveToLocalStorage() {
            const data = {
                zones: this.zones,
                columns: this.columns,
                issues: this.issues,
                statusCodes: this.statusCodes,
                savedAt: new Date().toISOString()
            };
            
            if (P5Store.save(data)) {
                this.showToast('Saved to LocalStorage', 'success');
            } else {
                this.showToast('Failed to save', 'error');
            }
        },
        
        exportData() {
            const data = {
                zones: this.zones,
                columns: this.columns,
                statusCodes: this.statusCodes,
                exportedAt: new Date().toISOString()
            };
            P5Store.export(data);
            this.showToast('Exported to JSON file', 'success');
        },
        
        // === Toast ===
        showToast(message, type = 'success') {
            this.toast = { show: true, message, type };
            setTimeout(() => { this.toast.show = false; }, 3000);
        },
        
        // === Sync Operations ===
        
        /**
         * Configure API sync
         * @param {string} url - Apps Script Web App URL
         */
        configureSync(url) {
            if (!url || typeof SyncModule === 'undefined') {
                console.warn('SyncModule not available or URL not provided');
                return;
            }
            
            this.apiUrl = url;
            this.syncEnabled = true;
            
            SyncModule.configure({
                apiUrl: url,
                onSyncComplete: (results) => {
                    this.showToast(`Synced: ${results.success}, Conflicts: ${results.conflicts}`, 
                                   results.conflicts > 0 ? 'error' : 'success');
                },
                onConflict: (item, result) => {
                    console.warn('Sync conflict:', item.payload.uid, result);
                },
                onSyncError: (item, error) => {
                    console.error('Sync error:', item.payload.uid, error);
                }
            });
            
            // Start auto-sync
            SyncModule.startAutoSync();
            this.showToast('Sync enabled', 'success');
        },

        /**
         * Show loading overlay with message
         */
        showLoading(message = 'Î°úÎî© Ï§ë...') {
            this.loadingMessage = message;
            this.isLoading = true;
        },

        /**
         * Hide loading overlay
         */
        hideLoading() {
            this.isLoading = false;
            this.loadingMessage = '';
        },

        /**
         * Force sync now
         */
        async syncNow() {
            if (!this.syncEnabled) {
                this.showToast('Sync not configured', 'error');
                return;
            }

            try {
                this.showLoading('Îç∞Ïù¥ÌÑ∞ ÎèôÍ∏∞Ìôî Ï§ë...');
                const result = await SyncModule.syncNow();

                if (result.success) {
                    this.showToast(`Sync complete: ${result.success || 0} items`, 'success');
                    this.announce('ÎèôÍ∏∞Ìôî ÏôÑÎ£å');
                } else {
                    this.showToast('Sync failed', 'error');
                    this.announceError('Ïò§Î•ò: ÎèôÍ∏∞Ìôî Ïã§Ìå®');
                }
            } finally {
                this.hideLoading();
            }
        },

        // === Phase 5: AI Analysis Methods ===

        /**
         * Trigger AI email analysis
         */
        async triggerAnalysis() {
            if (!this.syncEnabled) {
                this.showToast('Sync not configured. Enable sync first.', 'error');
                return;
            }

            try {
                this.showLoading('AI Î∂ÑÏÑù ÏãúÏûë Ï§ë...');
                this.analysisJob.status = 'pending';

                const response = await fetch(this.apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'triggerAnalysis',
                        user: 'dashboard'
                    })
                });

                const result = await response.json();

                if (result.success) {
                    this.analysisJob.status = 'running';
                    this.analysisJob.jobId = result.jobId;
                    this.analysisJob.startedAt = Date.now();
                    this.showToast(`Analysis job started: ${result.jobId}`, 'success');

                    // Start polling for status
                    this.startAnalysisPolling();
                } else {
                    this.analysisJob.status = 'idle';
                    this.showToast(result.error || 'Failed to start analysis', 'error');
                }
            } catch (e) {
                this.analysisJob.status = 'idle';
                this.showToast('Analysis request failed: ' + e.message, 'error');
            } finally {
                this.hideLoading();
            }
        },

        /**
         * Start polling for analysis job status
         */
        startAnalysisPolling() {
            // Clear any existing polling
            if (this.analysisPollingInterval) {
                clearInterval(this.analysisPollingInterval);
            }

            // Poll every 5 seconds
            this.analysisPollingInterval = setInterval(async () => {
                await this.checkAnalysisStatus();
            }, 5000);
        },

        /**
         * Check analysis job status
         */
        async checkAnalysisStatus() {
            if (!this.syncEnabled) return;

            try {
                const response = await fetch(this.apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'getAnalysisStatus'
                    })
                });

                const result = await response.json();

                if (result.success && result.job) {
                    const job = result.job;

                    if (job.status === 'completed') {
                        this.analysisJob.status = 'completed';
                        this.analysisJob.result = job.result;
                        this.showToast(`Analysis complete! ${job.result?.processed || 0} emails processed.`, 'success');
                        this.stopAnalysisPolling();

                        // Refresh data to show new issues
                        await this.loadFromServer();
                    } else if (job.status === 'failed') {
                        this.analysisJob.status = 'failed';
                        this.showToast('Analysis failed: ' + (job.error || 'Unknown error'), 'error');
                        this.stopAnalysisPolling();
                    }
                    // If still running, continue polling
                } else if (!result.job) {
                    // No active job, stop polling
                    this.analysisJob.status = 'idle';
                    this.stopAnalysisPolling();
                }
            } catch (e) {
                console.error('Failed to check analysis status:', e);
            }
        },

        /**
         * Stop analysis status polling
         */
        stopAnalysisPolling() {
            if (this.analysisPollingInterval) {
                clearInterval(this.analysisPollingInterval);
                this.analysisPollingInterval = null;
            }
        },

        /**
         * Save column change and queue for sync
         */
        saveColumnWithSync(uid, changes) {
            // Update local state
            if (this.columns[uid]) {
                Object.assign(this.columns[uid].status, changes);
                this.columns[uid].status.updatedAt = new Date().toISOString();
                this.columns[uid].status.source = 'admin';
            }
            
            // Save to localStorage
            this.saveToLocalStorage();
            
            // Queue for sync if enabled
            if (this.syncEnabled && typeof SyncModule !== 'undefined') {
                SyncModule.queueChange('updateColumn', {
                    uid,
                    data: changes,
                    user: 'dashboard'
                });
            }
        },
        
        /**
         * Bulk save with sync
         */
        bulkSaveWithSync(uids, changes) {
            // Update local state
            for (const uid of uids) {
                if (this.columns[uid]) {
                    Object.assign(this.columns[uid].status, changes);
                    this.columns[uid].status.updatedAt = new Date().toISOString();
                    this.columns[uid].status.source = 'admin';
                }
            }
            
            // Save to localStorage
            this.saveToLocalStorage();
            
            // Queue for sync if enabled
            if (this.syncEnabled && typeof SyncModule !== 'undefined') {
                SyncModule.queueChange('bulkUpdate', {
                    uids,
                    data: changes,
                    user: 'dashboard'
                });
            }
        },
        
        // === Issue Management ===
        
        /**
         * Initialize sample issues (for demo)
         */
        initSampleIssues() {
            this.issues = [
                {
                    id: 'ISS-2025-0042',
                    type: 'tc',
                    title: 'T/C #5 Í∞ÑÏÑ≠',
                    affectedColumns: ['C-X30', 'C-X31', 'C-X32', 'D-X30', 'D-X31', 'D-X32'],
                    zoneId: 'zone_b',
                    severity: 'critical',
                    description: 'ÌÉÄÏõåÌÅ¨Î†àÏù∏ #5 Ìï¥Ï≤¥ Ï†ÑÍπåÏßÄ ÏûëÏóÖ Î∂àÍ∞Ä',
                    expectedResolution: '2025-11-15',
                    status: 'open',
                    reportedBy: 'site_manager',
                    reportedAt: '2025-12-20T09:00:00',
                    overlay: {
                        show: true,
                        label: '‚õî T/C #5\nInterference',
                        range: { startColumn: 30, endColumn: 35, startRow: 2, endRow: 7 }
                    }
                },
                {
                    id: 'ISS-2025-0045',
                    type: 'design',
                    title: 'Rev.D ÏÑ§Í≥Ñ Î≥ÄÍ≤Ω (Mega Truss)',
                    affectedColumns: ['E-X55', 'E-X56', 'F-X55', 'F-X56'],
                    zoneId: 'zone_c',
                    severity: 'high',
                    description: 'Mega Truss ÌïòÏ§ë Î≥ÄÍ≤ΩÏúºÎ°ú Ïù∏Ìïú Í∏∞Îë• Îã®Î©¥ Î≥ÄÍ≤Ω',
                    expectedResolution: '2025-12-30',
                    status: 'in_progress',
                    reportedBy: 'structural_eng',
                    reportedAt: '2025-12-22T11:00:00',
                    overlay: {
                        show: true,
                        label: '‚ö†Ô∏è Design\nMega Truss',
                        range: { startColumn: 55, endColumn: 60, startRow: 4, endRow: 7 }
                    }
                }
            ];
        },

        // === Phase 7: ÌÇ§Î≥¥Îìú Îã®Ï∂ïÌÇ§ ÏãúÏä§ÌÖú ===

        /**
         * Í∏ÄÎ°úÎ≤å ÌÇ§Î≥¥Îìú Îã®Ï∂ïÌÇ§ Îì±Î°ù
         */
        registerKeyboardShortcuts() {
            // DOMÏóêÏÑú Alpine Ïª¥Ìè¨ÎÑåÌä∏ Ï∞∏Ï°∞Î•º Í∞ÄÏ†∏Ïò§Îäî Ìó¨Ìçº Ìï®Ïàò
            const getAlpineData = () => {
                const el = document.querySelector('[x-data]');
                return el && el._x_dataStack ? el._x_dataStack[0] : null;
            };

            document.addEventListener('keydown', (e) => {
                const self = getAlpineData();
                if (!self) return;

                // ÏûÖÎ†• ÌïÑÎìúÏóêÏÑúÎäî Îã®Ï∂ïÌÇ§ Î¨¥Ïãú
                const isInputFocused = ['INPUT', 'TEXTAREA', 'SELECT'].includes(document.activeElement?.tagName);
                if (isInputFocused && e.key !== 'Escape') return;

                // Escape: Î™®Îã¨/Ìå®ÎÑê Îã´Í∏∞
                if (e.key === 'Escape') {
                    self.handleEscapeKey();
                    return;
                }

                // ? ÎòêÎäî /: Îã®Ï∂ïÌÇ§ ÎèÑÏõÄÎßê
                if ((e.key === '?' && e.shiftKey) || e.key === '/') {
                    if (!isInputFocused) {
                        e.preventDefault();
                        self.shortcutsModalOpen = !self.shortcutsModalOpen;
                    }
                    return;
                }

                // ÎÇòÎ®∏ÏßÄ Îã®Ï∂ïÌÇ§Îäî ÏûÖÎ†• ÌïÑÎìúÏóêÏÑú Î¨¥Ïãú
                if (isInputFocused) return;

                // S: ÏÉÅÌÉú Î≥ÄÍ≤Ω (Í∏∞Îë• ÏÑ†ÌÉù Ïãú)
                if (e.key === 's' || e.key === 'S') {
                    if (self.selectedCells.length > 0) {
                        e.preventDefault();
                        self.openBulkStatusModal();
                    }
                    return;
                }

                // P: Í≥µÏ†ï Î≥ÄÍ≤Ω (Í∏∞Îë• ÏÑ†ÌÉù Ïãú)
                if (e.key === 'p' || e.key === 'P') {
                    if (self.selectedCells.length > 0) {
                        e.preventDefault();
                        self.openBulkStageModal();
                    }
                    return;
                }

                // I: Ïù¥Ïäà Îì±Î°ù (Í∏∞Îë• ÏÑ†ÌÉù Ïãú)
                if (e.key === 'i' || e.key === 'I') {
                    if (self.selectedCells.length > 0) {
                        e.preventDefault();
                        self.openNewIssueModal();
                    }
                    return;
                }

                // L: Lock ÌÜ†Í∏Ä (Í∏∞Îë• ÏÑ†ÌÉù Ïãú)
                if (e.key === 'l' || e.key === 'L') {
                    if (self.selectedCells.length > 0) {
                        e.preventDefault();
                        // ÌòÑÏû¨ Ïû†Í∏à ÏÉÅÌÉúÏóê Îî∞Îùº ÌÜ†Í∏Ä
                        const lockedCount = self.getSelectedLockCount();
                        const shouldLock = lockedCount < self.selectedCells.length;
                        self.bulkLockSelected(shouldLock);
                    }
                    return;
                }

                // A: Ï†ÑÏ≤¥ ÏÑ†ÌÉù
                if ((e.key === 'a' || e.key === 'A') && (e.ctrlKey || e.metaKey)) {
                    e.preventDefault();
                    self.selectAllColumns();
                    return;
                }

                // D: ÏÑ†ÌÉù Ìï¥Ï†ú
                if (e.key === 'd' || e.key === 'D') {
                    e.preventDefault();
                    self.clearSelection();
                    return;
                }

                // N: ÏïåÎ¶º Ìå®ÎÑê ÌÜ†Í∏Ä
                if (e.key === 'n' || e.key === 'N') {
                    e.preventDefault();
                    self.notificationPanelOpen = !self.notificationPanelOpen;
                    return;
                }

                // H: ÌûàÏä§ÌÜ†Î¶¨ Ìå®ÎÑê ÌÜ†Í∏Ä
                if (e.key === 'h' || e.key === 'H') {
                    e.preventDefault();
                    self.historyPanelOpen = !self.historyPanelOpen;
                    return;
                }

                // G: ÏöîÏïΩ Ìå®ÎÑê ÌÜ†Í∏Ä
                if (e.key === 'g' || e.key === 'G') {
                    e.preventDefault();
                    self.summaryPanelOpen = !self.summaryPanelOpen;
                    return;
                }

                // E: Ïù¥Ïäà Ìå®ÎÑê ÌÜ†Í∏Ä
                if (e.key === 'e' || e.key === 'E') {
                    e.preventDefault();
                    self.issuePanelOpen = !self.issuePanelOpen;
                    return;
                }

                // 1-6: Í≥µÏ†ïÎ≥Ñ ÌïÑÌÑ∞
                if (['1', '2', '3', '4', '5', '6'].includes(e.key)) {
                    e.preventDefault();
                    const stageIndex = parseInt(e.key) - 1;
                    if (self.stageConfigs[stageIndex]) {
                        const stageCode = self.stageConfigs[stageIndex].code;
                        self.workflowFilter = self.workflowFilter === stageCode ? null : stageCode;
                    }
                    return;
                }

                // 0: ÌïÑÌÑ∞ Ï¥àÍ∏∞Ìôî
                if (e.key === '0') {
                    e.preventDefault();
                    self.workflowFilter = null;
                    self.activeFilters = [];
                    return;
                }

                // R: ÏÉàÎ°úÍ≥†Ïπ® (Sync)
                if (e.key === 'r' || e.key === 'R') {
                    if (!e.ctrlKey && !e.metaKey) {
                        e.preventDefault();
                        if (typeof SyncModule !== 'undefined' && self.syncEnabled) {
                            SyncModule.fullSync();
                            self.showToast('ÎèôÍ∏∞Ìôî ÏãúÏûë...', 'info');
                        }
                    }
                    return;
                }

                // Phase 7: Ï∏µ Ïù¥Îèô Îã®Ï∂ïÌÇ§
                // Page Up: ÏÉÅÏúÑ Ï∏µÏúºÎ°ú Ïù¥Îèô
                if (e.key === 'PageUp') {
                    e.preventDefault();
                    self.navigateFloor(-1);
                    return;
                }

                // Page Down: ÌïòÏúÑ Ï∏µÏúºÎ°ú Ïù¥Îèô
                if (e.key === 'PageDown') {
                    e.preventDefault();
                    self.navigateFloor(1);
                    return;
                }

                // F: Ï∏µ ÏÑ†ÌÉùÍ∏∞ ÌÜ†Í∏Ä
                if (e.key === 'f' || e.key === 'F') {
                    if (!e.ctrlKey && !e.metaKey) {
                        e.preventDefault();
                        self.floorSelectorOpen = !self.floorSelectorOpen;
                    }
                    return;
                }

                // J: Ï†àÏ£º ÌïÑÌÑ∞ ÏàúÌôò
                if (e.key === 'j' || e.key === 'J') {
                    e.preventDefault();
                    self.cycleJeoljuFilter();
                    return;
                }
            });
        },

        /**
         * Escape ÌÇ§ Ï≤òÎ¶¨ (Ïö∞ÏÑ†ÏàúÏúÑÏóê Îî∞Îùº Î™®Îã¨/Ìå®ÎÑê Îã´Í∏∞)
         */
        handleEscapeKey() {
            // Ïö∞ÏÑ†ÏàúÏúÑ: Î™®Îã¨ > ÎîîÌÖåÏùº Ìå®ÎÑê > ÏÇ¨Ïù¥Îìú Ìå®ÎÑê > ÏÑ†ÌÉù Ìï¥Ï†ú
            if (this.shortcutsModalOpen) {
                this.shortcutsModalOpen = false;
                return;
            }
            if (this.newIssueModalOpen) {
                this.newIssueModalOpen = false;
                return;
            }
            if (this.bulkEditOpen) {
                this.bulkEditOpen = false;
                return;
            }
            if (this.detailPanelOpen) {
                this.detailPanelOpen = false;
                return;
            }
            if (this.summaryPanelOpen) {
                this.summaryPanelOpen = false;
                return;
            }
            if (this.notificationPanelOpen) {
                this.notificationPanelOpen = false;
                return;
            }
            if (this.historyPanelOpen) {
                this.historyPanelOpen = false;
                return;
            }
            if (this.issuePanelOpen) {
                this.issuePanelOpen = false;
                return;
            }
            // ÎßàÏßÄÎßâ: ÏÑ†ÌÉù Ìï¥Ï†ú
            if (this.selectedCells.length > 0) {
                this.clearSelection();
            }
        },

        /**
         * Ï†ÑÏ≤¥ Í∏∞Îë• ÏÑ†ÌÉù
         */
        selectAllColumns() {
            this.selectedCells = Object.keys(this.columns);
            this.showToast(`${this.selectedCells.length}Í∞ú Í∏∞Îë• ÏÑ†ÌÉùÎê®`, 'info');
            this.announce(this.selectedCells.length + 'Í∞ú Ìï≠Î™© ÏÑ†ÌÉùÎê®');
        },

        /**
         * ÏÉÅÌÉú Î≥ÄÍ≤Ω Î™®Îã¨ Ïó¥Í∏∞ (Quick Action)
         */
        openBulkStatusModal() {
            this.bulkEditForm.status = '';
            this.bulkEditOpen = true;
        },

        /**
         * Í≥µÏ†ï Î≥ÄÍ≤Ω Î™®Îã¨ Ïó¥Í∏∞ (Quick Action)
         */
        openBulkStageModal() {
            // TODO: Í≥µÏ†ï Î≥ÄÍ≤Ω Î™®Îã¨ Íµ¨ÌòÑ
            this.showToast('Í≥µÏ†ï Î≥ÄÍ≤Ω Í∏∞Îä• Ï§ÄÎπÑ Ï§ë', 'info');
        },

        /**
         * Open new issue modal
         */
        openNewIssueModal() {
            this.newIssueForm = {
                type: 'tc',
                title: '',
                severity: 'medium',
                description: '',
                expectedResolution: ''
            };
            this.newIssueModalOpen = true;
        },
        
        /**
         * Create new issue
         */
        createIssue() {
            if (!this.newIssueForm.title || this.selectedCells.length === 0) {
                this.showToast('Title and affected columns required', 'error');
                return;
            }
            
            const issueId = `ISS-${new Date().getFullYear()}-${String(this.issues.length + 1).padStart(4, '0')}`;
            const timestamp = new Date().toISOString();
            
            // Calculate overlay range from selected cells
            let minCol = Infinity, maxCol = 0, minRow = Infinity, maxRow = 0;
            for (const uid of this.selectedCells) {
                const [row, colStr] = uid.split('-X');
                const col = parseInt(colStr);
                const rowIdx = this.rowLabels.indexOf(row);
                minCol = Math.min(minCol, col);
                maxCol = Math.max(maxCol, col);
                minRow = Math.min(minRow, rowIdx);
                maxRow = Math.max(maxRow, rowIdx);
            }
            
            const newIssue = {
                id: issueId,
                type: this.newIssueForm.type,
                title: this.newIssueForm.title,
                affectedColumns: [...this.selectedCells],
                zoneId: this.getZoneForColumn(minCol)?.id || 'zone_a',
                severity: this.newIssueForm.severity,
                description: this.newIssueForm.description,
                expectedResolution: this.newIssueForm.expectedResolution,
                status: 'open',
                reportedBy: 'dashboard',
                reportedAt: timestamp,
                overlay: {
                    show: true,
                    label: this.getIssueTypeIcon(this.newIssueForm.type) + ' ' + this.newIssueForm.title.substring(0, 15),
                    range: { startColumn: minCol, endColumn: maxCol, startRow: minRow, endRow: maxRow }
                }
            };
            
            this.issues.push(newIssue);

            // Update affected columns status
            const holdStatus = this.newIssueForm.type === 'tc' ? 'hold_tc' :
                               this.newIssueForm.type === 'design' ? 'hold_design' : 'hold_material';

            for (const uid of this.selectedCells) {
                if (this.columns[uid]) {
                    this.columns[uid].status.code = holdStatus;
                    this.columns[uid].status.updatedAt = timestamp;
                    this.columns[uid].status.source = 'issue';
                    this.columns[uid].issueId = issueId;
                }
            }

            // Sync QueueÏóê Ï∂îÍ∞Ä (Sheet Ïó∞Îèô - Issue ÏÉùÏÑ±)
            if (this.syncEnabled && typeof SyncModule !== 'undefined') {
                SyncModule.queueChange('createIssue', {
                    issueData: newIssue,
                    user: 'dashboard'
                });
                // Ïó∞Í¥Ä Í∏∞Îë• ÏÉÅÌÉúÎèÑ ÏùºÍ¥Ñ ÏóÖÎç∞Ïù¥Ìä∏
                SyncModule.queueChange('bulkUpdateColumns', {
                    updates: this.selectedCells.map(uid => ({
                        uid: uid,
                        status: holdStatus,
                        issueId: issueId
                    })),
                    user: 'dashboard'
                });
            }

            this.saveToLocalStorage();
            this.newIssueModalOpen = false;
            this.clearSelection();
            this.showToast(`Issue ${issueId} created`, 'success');
        },
        
        /**
         * Get issue type icon
         */
        getIssueTypeIcon(type) {
            const icons = { tc: '‚õî', design: '‚ö†Ô∏è', material: 'üì¶', safety: 'üõë' };
            return icons[type] || '‚ö†Ô∏è';
        },
        
        /**
         * Select an issue
         */
        selectIssue(issue) {
            this.selectedIssue = issue;
            
            // Highlight affected columns
            this.clearSelection();
            this.selectedCells = [...(issue.affectedColumns || [])];
        },
        
        /**
         * Resolve an issue
         */
        resolveIssue(issueId, restoreStatus = 'active') {
            const issue = this.issues.find(i => i.id === issueId);
            if (!issue) return;

            const timestamp = new Date().toISOString();
            issue.status = 'resolved';
            issue.actualResolution = timestamp;
            issue.overlay.show = false;

            // Restore affected columns
            const affectedUids = issue.affectedColumns || [];
            for (const uid of affectedUids) {
                if (this.columns[uid]) {
                    this.columns[uid].status.code = restoreStatus;
                    this.columns[uid].status.updatedAt = timestamp;
                    this.columns[uid].status.source = 'admin';
                    this.columns[uid].issueId = null;
                }
            }

            // Sync QueueÏóê Ï∂îÍ∞Ä (Sheet Ïó∞Îèô - Issue Ìï¥Í≤∞)
            if (this.syncEnabled && typeof SyncModule !== 'undefined') {
                SyncModule.queueChange('resolveIssue', {
                    issueId: issueId,
                    resolution: timestamp,
                    user: 'dashboard'
                });
                // Ïó∞Í¥Ä Í∏∞Îë• ÏÉÅÌÉúÎèÑ ÏùºÍ¥Ñ ÏóÖÎç∞Ïù¥Ìä∏
                if (affectedUids.length > 0) {
                    SyncModule.queueChange('bulkUpdateColumns', {
                        updates: affectedUids.map(uid => ({
                            uid: uid,
                            status: restoreStatus,
                            issueId: null
                        })),
                        user: 'dashboard'
                    });
                }
            }

            this.saveToLocalStorage();
            this.showToast(`Issue ${issueId} resolved`, 'success');
        },
        
        /**
         * Calculate overlay position and size
         */
        getOverlayStyle(issue) {
            if (!issue.overlay?.range) return 'display: none;';
            
            const range = issue.overlay.range;
            const cellSize = 28;  // Grid cell size (26px + 2px gap)
            const headerOffset = 65;  // Header row offset
            const rowHeaderWidth = 37;  // Row label width
            const gridPadding = 30;  // Grid container padding
            const sidebarWidth = 260;  // Sidebar width
            
            const left = sidebarWidth + gridPadding + rowHeaderWidth + (range.startColumn - 1) * cellSize;
            const top = 55 + 30 + headerOffset + gridPadding + range.startRow * cellSize;  // header + zone bar + grid header
            const width = (range.endColumn - range.startColumn + 1) * cellSize;
            const height = (range.endRow - range.startRow + 1) * cellSize;
            
            return `left: ${left}px; top: ${top}px; width: ${width}px; height: ${height}px;`;
        },
        
        /**
         * Toggle issue panel
         */
        toggleIssuePanel() {
            this.issuePanelOpen = !this.issuePanelOpen;
        },
        
        // === Admin Panel Methods ===
        
        /**
         * Update zone color
         */
        updateZoneColor(zoneId, color) {
            const zone = this.zones.find(z => z.id === zoneId);
            if (zone) {
                zone.style.primaryColor = color;
                zone.style.backgroundColor = color + '1a';  // Add transparency
                this.saveToLocalStorage();
                this.showToast(`Zone color updated`, 'success');
            }
        },
        
        /**
         * Edit zone (placeholder - in production would open modal)
         */
        editZone(zone) {
            const newName = prompt('Display Name:', zone.displayName);
            if (newName && newName !== zone.displayName) {
                zone.displayName = newName;
                this.saveToLocalStorage();
                this.showToast(`Zone updated`, 'success');
            }
        },
        
        /**
         * Add new zone
         */
        addNewZone() {
            const lastZone = this.zones[this.zones.length - 1];
            const newZone = {
                id: 'zone_' + String.fromCharCode(65 + this.zones.length).toLowerCase(),
                name: 'ZONE ' + String.fromCharCode(65 + this.zones.length),
                displayName: 'New Zone',
                description: 'Description',
                range: {
                    startColumn: (lastZone?.range?.endColumn || 0) + 1,
                    endColumn: Math.min((lastZone?.range?.endColumn || 0) + 10, 69),
                    startRow: 0,
                    endRow: 11
                },
                style: {
                    primaryColor: '#' + Math.floor(Math.random()*16777215).toString(16),
                    backgroundColor: 'rgba(100,100,100,0.1)',
                    progressPercent: 0
                }
            };
            this.zones.push(newZone);
            this.saveToLocalStorage();
            this.showToast('New zone added', 'success');
        },
        
        /**
         * Update status label
         */
        updateStatusLabel(code, label) {
            if (this.statusCodes[code]) {
                this.statusCodes[code].label = label;
            }
        },
        
        /**
         * Update status color
         */
        updateStatusColor(code, color) {
            if (this.statusCodes[code]) {
                this.statusCodes[code].color = color;
            }
        },
        
        /**
         * Reset status codes to default
         */
        resetStatusCodes() {
            const defaults = P5Store.getDefaultData().statusCodes;
            this.statusCodes = { ...defaults };
            this.saveToLocalStorage();
            this.showToast('Status codes reset', 'success');
        },
        
        /**
         * Save all settings
         */
        saveSettings() {
            this.saveToLocalStorage();
            this.showToast('Settings saved', 'success');
        },

        // ===== Phase 11: Slack Integration Methods =====

        /**
         * Load Slack settings from API
         */
        async loadSlackSettings() {
            if (!this.apiUrl) {
                this.slackSettings.message = 'API URLÏù¥ ÏÑ§Ï†ïÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.';
                this.slackSettings.messageType = 'error';
                return;
            }

            try {
                const response = await fetch(`${this.apiUrl}?action=getSlackSettings`);
                const data = await response.json();

                if (data.success) {
                    this.slackSettings.webhookConfigured = data.webhookConfigured;
                    this.slackSettings.webhookUrlMasked = data.webhookUrlMasked || '';
                    if (data.settings) {
                        this.slackSettings.notifications = {
                            ...this.slackSettings.notifications,
                            ...data.settings
                        };
                    }
                    // Clear any new input - show masked URL instead
                    this.slackSettings.webhookUrl = '';
                    this.slackSettings.message = '';
                } else {
                    console.warn('[Slack] Failed to load settings:', data.error);
                }
            } catch (error) {
                console.error('[Slack] Error loading settings:', error);
                this.slackSettings.message = 'ÏÑ§Ï†ïÏùÑ Î∂àÎü¨Ïò§Îäî Îç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.';
                this.slackSettings.messageType = 'error';
            }
        },

        /**
         * Save Slack settings to API
         */
        async saveSlackSettings() {
            if (!this.apiUrl) {
                this.slackSettings.message = 'API URLÏù¥ ÏÑ§Ï†ïÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.';
                this.slackSettings.messageType = 'error';
                return;
            }

            this.slackSettings.saving = true;
            this.slackSettings.message = '';

            try {
                const payload = {
                    action: 'saveSlackSettings',
                    settings: this.slackSettings.notifications
                };

                // Only include webhookUrl if user entered a new one
                if (this.slackSettings.webhookUrl) {
                    payload.webhookUrl = this.slackSettings.webhookUrl;
                }

                const response = await fetch(this.apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();

                if (data.success) {
                    this.slackSettings.message = 'Slack ÏÑ§Ï†ïÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.';
                    this.slackSettings.messageType = 'success';
                    // Reload settings to get updated masked URL
                    await this.loadSlackSettings();
                    this.showToast('Slack ÏÑ§Ï†ï Ï†ÄÏû• ÏôÑÎ£å', 'success');
                } else {
                    this.slackSettings.message = data.error || 'ÏÑ§Ï†ï Ï†ÄÏû•Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.';
                    this.slackSettings.messageType = 'error';
                }
            } catch (error) {
                console.error('[Slack] Error saving settings:', error);
                this.slackSettings.message = 'Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message;
                this.slackSettings.messageType = 'error';
            } finally {
                this.slackSettings.saving = false;
            }
        },

        /**
         * Send Slack test notification
         */
        async testSlackNotification() {
            if (!this.apiUrl) {
                this.slackSettings.message = 'API URLÏù¥ ÏÑ§Ï†ïÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.';
                this.slackSettings.messageType = 'error';
                return;
            }

            // Must have webhook configured or entered
            if (!this.slackSettings.webhookConfigured && !this.slackSettings.webhookUrl) {
                this.slackSettings.message = 'Webhook URLÏùÑ Î®ºÏ†Ä Ï†ÄÏû•Ìï¥Ï£ºÏÑ∏Ïöî.';
                this.slackSettings.messageType = 'error';
                return;
            }

            this.slackSettings.testing = true;
            this.slackSettings.message = '';

            try {
                // If user entered new URL, save it first
                if (this.slackSettings.webhookUrl) {
                    await this.saveSlackSettings();
                }

                const response = await fetch(this.apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'testSlackNotification' })
                });

                const data = await response.json();

                if (data.success) {
                    this.slackSettings.message = 'ÌÖåÏä§Ìä∏ ÏïåÎ¶ºÏù¥ Ï†ÑÏÜ°ÎêòÏóàÏäµÎãàÎã§. Slack Ï±ÑÎÑêÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.';
                    this.slackSettings.messageType = 'success';
                    this.showToast('Slack ÌÖåÏä§Ìä∏ ÏïåÎ¶º Ï†ÑÏÜ° ÏôÑÎ£å', 'success');
                } else {
                    this.slackSettings.message = data.error || 'ÌÖåÏä§Ìä∏ ÏïåÎ¶º Ï†ÑÏÜ°Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.';
                    this.slackSettings.messageType = 'error';
                }
            } catch (error) {
                console.error('[Slack] Error sending test notification:', error);
                this.slackSettings.message = 'ÌÖåÏä§Ìä∏ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message;
                this.slackSettings.messageType = 'error';
            } finally {
                this.slackSettings.testing = false;
            }
        },

        /**
         * Clear Slack webhook URL
         */
        async clearSlackWebhook() {
            if (!confirm('Slack Webhook URLÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\nÏÇ≠Ï†ú ÌõÑÏóêÎäî ÏïåÎ¶ºÏù¥ Ï†ÑÏÜ°ÎêòÏßÄ ÏïäÏäµÎãàÎã§.')) {
                return;
            }

            this.slackSettings.saving = true;

            try {
                const response = await fetch(this.apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'saveSlackSettings',
                        webhookUrl: ''  // Empty string to delete
                    })
                });

                const data = await response.json();

                if (data.success) {
                    this.slackSettings.webhookUrl = '';
                    this.slackSettings.webhookConfigured = false;
                    this.slackSettings.webhookUrlMasked = '';
                    this.slackSettings.message = 'Webhook URLÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.';
                    this.slackSettings.messageType = 'success';
                    this.showToast('Slack Webhook ÏÇ≠Ï†ú ÏôÑÎ£å', 'success');
                } else {
                    this.slackSettings.message = data.error || 'Webhook ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.';
                    this.slackSettings.messageType = 'error';
                }
            } catch (error) {
                console.error('[Slack] Error clearing webhook:', error);
                this.slackSettings.message = 'ÏÇ≠Ï†ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.';
                this.slackSettings.messageType = 'error';
            } finally {
                this.slackSettings.saving = false;
            }
        },

        // ===== Phase 12: Email Integration Methods =====

        /**
         * Load email settings from server
         */
        async loadEmailSettings() {
            if (!this.apiUrl) {
                this.emailSettings.message = 'API URLÏù¥ ÏÑ§Ï†ïÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.';
                this.emailSettings.messageType = 'error';
                return;
            }

            try {
                const response = await fetch(`${this.apiUrl}?action=getEmailSettings`);
                const data = await response.json();

                if (data.success) {
                    this.emailSettings.recipients = data.recipients || [];
                    if (data.settings) {
                        this.emailSettings.notifications = {
                            ...this.emailSettings.notifications,
                            ...data.settings
                        };
                    }
                    this.emailSettings.message = '';
                } else {
                    console.warn('[Email] Failed to load settings:', data.error);
                }
            } catch (error) {
                console.error('[Email] Error loading settings:', error);
                this.emailSettings.message = 'ÏÑ§Ï†ïÏùÑ Î∂àÎü¨Ïò§Îäî Îç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.';
                this.emailSettings.messageType = 'error';
            }
        },

        /**
         * Add email recipient
         */
        addEmailRecipient() {
            const email = this.emailSettings.newRecipient.trim().toLowerCase();

            // Basic email validation
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                this.emailSettings.message = 'Ïò¨Î∞îÎ•∏ Ïù¥Î©îÏùº ÌòïÏãùÏù¥ ÏïÑÎãôÎãàÎã§.';
                this.emailSettings.messageType = 'error';
                return;
            }

            // Check for duplicates
            if (this.emailSettings.recipients.includes(email)) {
                this.emailSettings.message = 'Ïù¥ÎØ∏ Îì±Î°ùÎêú Ïù¥Î©îÏùºÏûÖÎãàÎã§.';
                this.emailSettings.messageType = 'error';
                return;
            }

            this.emailSettings.recipients.push(email);
            this.emailSettings.newRecipient = '';
            this.emailSettings.message = `${email} Ï∂îÍ∞ÄÎê® (Ï†ÄÏû• Î≤ÑÌäºÏùÑ ÎàåÎü¨Ï£ºÏÑ∏Ïöî)`;
            this.emailSettings.messageType = 'success';
        },

        /**
         * Remove email recipient by index
         */
        removeEmailRecipient(index) {
            const removed = this.emailSettings.recipients.splice(index, 1);
            this.emailSettings.message = `${removed[0]} Ï†úÍ±∞Îê® (Ï†ÄÏû• Î≤ÑÌäºÏùÑ ÎàåÎü¨Ï£ºÏÑ∏Ïöî)`;
            this.emailSettings.messageType = 'success';
        },

        /**
         * Clear all email recipients
         */
        async clearAllEmailRecipients() {
            if (!confirm('Î™®Îì† Ïù¥Î©îÏùº ÏàòÏã†ÏûêÎ•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\nÏÇ≠Ï†ú ÌõÑÏóêÎäî Ïù¥Î©îÏùº ÏïåÎ¶ºÏù¥ Ï†ÑÏÜ°ÎêòÏßÄ ÏïäÏäµÎãàÎã§.')) {
                return;
            }

            this.emailSettings.recipients = [];
            this.emailSettings.message = 'Î™®Îì† ÏàòÏã†ÏûêÍ∞Ä Ï†úÍ±∞ÎêòÏóàÏäµÎãàÎã§. Ï†ÄÏû• Î≤ÑÌäºÏùÑ ÎàåÎü¨Ï£ºÏÑ∏Ïöî.';
            this.emailSettings.messageType = 'success';
        },

        /**
         * Save email settings to server
         */
        async saveEmailSettings() {
            if (!this.apiUrl) {
                this.emailSettings.message = 'API URLÏù¥ ÏÑ§Ï†ïÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.';
                this.emailSettings.messageType = 'error';
                return;
            }

            this.emailSettings.saving = true;
            this.emailSettings.message = '';

            try {
                const payload = {
                    action: 'saveEmailSettings',
                    recipients: this.emailSettings.recipients,
                    settings: this.emailSettings.notifications
                };

                const response = await fetch(this.apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();

                if (data.success) {
                    this.emailSettings.message = `Ïù¥Î©îÏùº ÏÑ§Ï†ïÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§. (${data.recipientCount}Î™Ö)`;
                    this.emailSettings.messageType = 'success';
                    this.showToast('Ïù¥Î©îÏùº ÏÑ§Ï†ï Ï†ÄÏû• ÏôÑÎ£å', 'success');
                } else {
                    this.emailSettings.message = data.error || 'ÏÑ§Ï†ï Ï†ÄÏû•Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.';
                    this.emailSettings.messageType = 'error';
                }
            } catch (error) {
                console.error('[Email] Error saving settings:', error);
                this.emailSettings.message = 'Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message;
                this.emailSettings.messageType = 'error';
            } finally {
                this.emailSettings.saving = false;
            }
        },

        /**
         * Send email test notification
         */
        async testEmailNotification() {
            if (!this.apiUrl) {
                this.emailSettings.message = 'API URLÏù¥ ÏÑ§Ï†ïÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.';
                this.emailSettings.messageType = 'error';
                return;
            }

            if (this.emailSettings.recipients.length === 0) {
                this.emailSettings.message = 'Î®ºÏ†Ä ÏàòÏã†ÏûêÎ•º Ï∂îÍ∞ÄÌïòÍ≥† Ï†ÄÏû•Ìï¥Ï£ºÏÑ∏Ïöî.';
                this.emailSettings.messageType = 'error';
                return;
            }

            this.emailSettings.testing = true;
            this.emailSettings.message = '';

            try {
                // First save current settings
                await this.saveEmailSettings();

                const response = await fetch(this.apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'testEmailNotification' })
                });

                const data = await response.json();

                if (data.success) {
                    this.emailSettings.message = `ÌÖåÏä§Ìä∏ Ïù¥Î©îÏùºÏù¥ Ï†ÑÏÜ°ÎêòÏóàÏäµÎãàÎã§. (${data.sentCount}Î™ÖÏóêÍ≤å Î∞úÏÜ°)`;
                    this.emailSettings.messageType = 'success';
                    this.showToast('ÌÖåÏä§Ìä∏ Ïù¥Î©îÏùº Ï†ÑÏÜ° ÏôÑÎ£å', 'success');
                } else {
                    this.emailSettings.message = data.error || 'ÌÖåÏä§Ìä∏ Ïù¥Î©îÏùº Ï†ÑÏÜ°Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.';
                    this.emailSettings.messageType = 'error';
                }
            } catch (error) {
                console.error('[Email] Error sending test notification:', error);
                this.emailSettings.message = 'ÌÖåÏä§Ìä∏ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message;
                this.emailSettings.messageType = 'error';
            } finally {
                this.emailSettings.testing = false;
            }
        },

        /**
         * Export to CSV
         */
        exportToCSV() {
            const headers = ['UID', 'Zone', 'Row', 'Column', 'Status', 'IsLocked', 'UpdatedAt'];
            const rows = Object.values(this.columns).map(col => [
                col.uid,
                col.zone?.name || '',
                col.location?.row || '',
                col.location?.column || '',
                col.status?.code || 'pending',
                col.status?.isLocked || false,
                col.status?.updatedAt || ''
            ]);
            
            const csv = [headers.join(','), ...rows.map(r => r.join(','))].join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `p5_columns_${new Date().toISOString().slice(0,10)}.csv`;
            a.click();
            URL.revokeObjectURL(url);
            
            this.showToast('Exported to CSV', 'success');
        },
        
        /**
         * Export to Excel with SheetJS
         * @param {Object} options - Export options
         * @param {string} options.scope - 'all' | 'filtered' | 'selected' | 'floor' | 'zone'
         * @param {string} options.floorId - Floor ID for floor-specific export
         * @param {string} options.zoneId - Zone ID for zone-specific export
         */
        exportToExcel(options = { scope: 'all' }) {
            // Check if SheetJS is loaded
            if (typeof XLSX === 'undefined') {
                this.showToast('Excel ÎùºÏù¥Î∏åÎü¨Î¶¨ Î°úÎìú Ï§ë... Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.', 'error');
                return;
            }

            try {
                // Show loading state
                this.isLoading = true;
                this.loadingMessage = 'Excel ÌååÏùº ÏÉùÏÑ± Ï§ë...';

                // Generate filename with timestamp
                const now = new Date();
                const timestamp = now.toISOString().replace(/[-:]/g, '').slice(0, 15);
                const filename = `P5_Dashboard_Export_${timestamp}.xlsx`;

                // Create workbook
                const wb = XLSX.utils.book_new();

                // Get data based on scope
                const columnsData = this.getExportColumnsData(options);
                const issuesData = this.getExportIssuesData(options);
                const summaryData = this.getExportSummaryData(columnsData, issuesData);

                // Sheet 1: Columns (Í∏∞Îë• ÌòÑÌô©)
                const columnsSheet = this.createColumnsSheet(columnsData);
                XLSX.utils.book_append_sheet(wb, columnsSheet, 'Í∏∞Îë• ÌòÑÌô©');

                // Sheet 2: Issues (Ïù¥Ïäà Î™©Î°ù)
                const issuesSheet = this.createIssuesSheet(issuesData);
                XLSX.utils.book_append_sheet(wb, issuesSheet, 'Ïù¥Ïäà Î™©Î°ù');

                // Sheet 3: Summary (ÏöîÏïΩ ÌÜµÍ≥Ñ)
                const summarySheet = this.createSummarySheet(summaryData);
                XLSX.utils.book_append_sheet(wb, summarySheet, 'ÏöîÏïΩ ÌÜµÍ≥Ñ');

                // Sheet 4: Stage Progress (Í≥µÏ†ïÎ≥Ñ ÏßÑÌñâÎ•†) - optional
                const stageSheet = this.createStageProgressSheet(columnsData);
                XLSX.utils.book_append_sheet(wb, stageSheet, 'Í≥µÏ†ïÎ≥Ñ ÏßÑÌñâÎ•†');

                // Download file
                XLSX.writeFile(wb, filename);

                this.showToast(`Excel ÌååÏùºÏù¥ Îã§Ïö¥Î°úÎìúÎêòÏóàÏäµÎãàÎã§: ${filename}`, 'success');
                console.log('[Excel Export] Success:', { scope: options.scope, columns: columnsData.length, issues: issuesData.length });

            } catch (error) {
                console.error('[Excel Export] Error:', error);
                this.showToast('Excel ÎÇ¥Î≥¥ÎÇ¥Í∏∞ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message, 'error');
            } finally {
                this.isLoading = false;
                this.loadingMessage = '';
            }
        },

        /**
         * Get columns data based on export scope
         */
        getExportColumnsData(options) {
            let columns = Object.values(this.columns);

            switch (options.scope) {
                case 'selected':
                    // Export only selected cells
                    const selectedUids = new Set(this.selectedCells.map(c => c.uid));
                    columns = columns.filter(c => selectedUids.has(c.uid));
                    break;

                case 'filtered':
                    // Export based on current filters (jeolju, workflow, search)
                    if (this.selectedJeolju) {
                        const jeolju = this.jeoljuList.find(j => j.jeoljuId === this.selectedJeolju);
                        if (jeolju) {
                            columns = columns.filter(c => {
                                const colNum = parseInt(c.location?.column);
                                return colNum >= jeolju.startColumn && colNum <= jeolju.endColumn;
                            });
                        }
                    }
                    if (this.workflowFilter) {
                        columns = columns.filter(c => c.stage?.code === this.workflowFilter);
                    }
                    break;

                case 'floor':
                    // Export specific floor
                    const floorId = options.floorId || this.selectedFloor;
                    columns = columns.filter(c => c.floor === floorId || c.floorId === floorId);
                    break;

                case 'zone':
                    // Export specific zone
                    if (options.zoneId) {
                        columns = columns.filter(c => c.zone?.id === options.zoneId);
                    }
                    break;

                case 'all':
                default:
                    // All columns - no filtering
                    break;
            }

            return columns;
        },

        /**
         * Get issues data based on export scope
         */
        getExportIssuesData(options) {
            let issues = [...this.issues];

            if (options.scope === 'selected' && this.selectedCells.length > 0) {
                const selectedUids = new Set(this.selectedCells.map(c => c.uid));
                issues = issues.filter(i =>
                    i.affectedColumns?.some(uid => selectedUids.has(uid)) ||
                    selectedUids.has(i.columnUid)
                );
            }

            return issues;
        },

        /**
         * Get summary statistics
         */
        getExportSummaryData(columnsData, issuesData) {
            const statusCounts = {};
            const stageCounts = {};

            columnsData.forEach(col => {
                const status = col.status?.code || 'pending';
                const stage = col.stage?.code || 'none';

                statusCounts[status] = (statusCounts[status] || 0) + 1;
                stageCounts[stage] = (stageCounts[stage] || 0) + 1;
            });

            const completedCount = statusCounts['installed'] || statusCounts['completed'] || 0;
            const progressRate = columnsData.length > 0
                ? Math.round((completedCount / columnsData.length) * 100)
                : 0;

            return {
                totalColumns: columnsData.length,
                statusCounts,
                stageCounts,
                progressRate,
                openIssues: issuesData.filter(i => i.status === 'open' || i.status === 'in_progress').length,
                resolvedIssues: issuesData.filter(i => i.status === 'resolved').length,
                criticalIssues: issuesData.filter(i => i.severity === 'critical').length,
                exportedAt: new Date().toISOString(),
                selectedFloor: this.selectedFloor,
                selectedJeolju: this.selectedJeolju
            };
        },

        /**
         * Create Columns sheet with formatting
         */
        createColumnsSheet(columnsData) {
            // Prepare data rows
            const rows = columnsData.map(col => ({
                'UID': col.uid || '',
                'Ï∏µ': col.floor || col.floorId || this.selectedFloor || '',
                'Ìñâ(Row)': col.location?.row || '',
                'Ïó¥(Column)': col.location?.column || '',
                'Zone': col.zone?.name || col.zone?.displayName || '',
                'ÏÉÅÌÉú(Status)': this.getStatusLabel(col.status?.code),
                'Í≥µÏ†ï(Stage)': this.getStageLabel(col.stage?.code),
                'ÏßÑÌñâÎ•†(%)': col.progress || 0,
                'Ïû†Í∏à': col.status?.isLocked ? 'Y' : 'N',
                'ÏµúÏ¢ÖÏàòÏ†ï': col.status?.updatedAt || col.updatedAt || ''
            }));

            // Create worksheet
            const ws = XLSX.utils.json_to_sheet(rows);

            // Apply column widths
            ws['!cols'] = [
                { wch: 20 },  // UID
                { wch: 8 },   // Ï∏µ
                { wch: 6 },   // Ìñâ
                { wch: 8 },   // Ïó¥
                { wch: 15 },  // Zone
                { wch: 12 },  // ÏÉÅÌÉú
                { wch: 12 },  // Í≥µÏ†ï
                { wch: 10 },  // ÏßÑÌñâÎ•†
                { wch: 6 },   // Ïû†Í∏à
                { wch: 20 }   // ÏµúÏ¢ÖÏàòÏ†ï
            ];

            // Apply header styling (SheetJS community edition - basic styling)
            this.applyHeaderStyle(ws, 10);

            return ws;
        },

        /**
         * Create Issues sheet with formatting
         */
        createIssuesSheet(issuesData) {
            const rows = issuesData.map(issue => ({
                'Issue ID': issue.id || '',
                'Í∏∞Îë• UID': issue.columnUid || (issue.affectedColumns?.join(', ') || ''),
                'Ïú†Ìòï': this.getIssueTypeLabel(issue.type),
                'Ïã¨Í∞ÅÎèÑ': this.getSeverityLabel(issue.severity),
                'ÏÉÅÌÉú': this.getIssueStatusLabel(issue.status),
                'Ï†úÎ™©': issue.title || '',
                'ÏÑ§Î™Ö': issue.description || '',
                'Îã¥ÎãπÏûê': issue.assignedTo || '',
                'ÏÉùÏÑ±Ïùº': issue.createdAt || '',
                'Ìï¥Í≤∞Ïùº': issue.resolvedAt || '',
                'Í∑ºÎ≥∏ÏõêÏù∏': issue.rootCause || '',
                'Ï°∞ÏπòÍ≥ÑÌöç': issue.mitigationPlan || ''
            }));

            const ws = XLSX.utils.json_to_sheet(rows);

            // Apply column widths
            ws['!cols'] = [
                { wch: 15 },  // Issue ID
                { wch: 25 },  // Í∏∞Îë• UID
                { wch: 10 },  // Ïú†Ìòï
                { wch: 10 },  // Ïã¨Í∞ÅÎèÑ
                { wch: 10 },  // ÏÉÅÌÉú
                { wch: 30 },  // Ï†úÎ™©
                { wch: 40 },  // ÏÑ§Î™Ö
                { wch: 12 },  // Îã¥ÎãπÏûê
                { wch: 18 },  // ÏÉùÏÑ±Ïùº
                { wch: 18 },  // Ìï¥Í≤∞Ïùº
                { wch: 30 },  // Í∑ºÎ≥∏ÏõêÏù∏
                { wch: 30 }   // Ï°∞ÏπòÍ≥ÑÌöç
            ];

            this.applyHeaderStyle(ws, 12);

            return ws;
        },

        /**
         * Create Summary sheet
         */
        createSummarySheet(summaryData) {
            const rows = [
                { 'Ìï≠Î™©': 'Ï†ÑÏ≤¥ Í∏∞Îë• Ïàò', 'Í∞í': summaryData.totalColumns },
                { 'Ìï≠Î™©': 'ÏßÑÌñâÎ•† (%)', 'Í∞í': summaryData.progressRate + '%' },
                { 'Ìï≠Î™©': '', 'Í∞í': '' },
                { 'Ìï≠Î™©': '=== ÏÉÅÌÉúÎ≥Ñ ÌòÑÌô© ===', 'Í∞í': '' }
            ];

            // Add status counts
            Object.entries(summaryData.statusCounts).forEach(([status, count]) => {
                rows.push({ 'Ìï≠Î™©': this.getStatusLabel(status), 'Í∞í': count });
            });

            rows.push({ 'Ìï≠Î™©': '', 'Í∞í': '' });
            rows.push({ 'Ìï≠Î™©': '=== Í≥µÏ†ïÎ≥Ñ ÌòÑÌô© ===', 'Í∞í': '' });

            // Add stage counts
            Object.entries(summaryData.stageCounts).forEach(([stage, count]) => {
                rows.push({ 'Ìï≠Î™©': this.getStageLabel(stage), 'Í∞í': count });
            });

            rows.push({ 'Ìï≠Î™©': '', 'Í∞í': '' });
            rows.push({ 'Ìï≠Î™©': '=== Ïù¥Ïäà ÌòÑÌô© ===', 'Í∞í': '' });
            rows.push({ 'Ìï≠Î™©': 'ÏßÑÌñâÏ§ë Ïù¥Ïäà', 'Í∞í': summaryData.openIssues });
            rows.push({ 'Ìï≠Î™©': 'Ìï¥Í≤∞Îêú Ïù¥Ïäà', 'Í∞í': summaryData.resolvedIssues });
            rows.push({ 'Ìï≠Î™©': 'Critical Ïù¥Ïäà', 'Í∞í': summaryData.criticalIssues });

            rows.push({ 'Ìï≠Î™©': '', 'Í∞í': '' });
            rows.push({ 'Ìï≠Î™©': '=== ÎÇ¥Î≥¥ÎÇ¥Í∏∞ Ï†ïÎ≥¥ ===', 'Í∞í': '' });
            rows.push({ 'Ìï≠Î™©': 'ÎÇ¥Î≥¥ÎÇ¥Í∏∞ ÏãúÍ∞Ñ', 'Í∞í': new Date(summaryData.exportedAt).toLocaleString('ko-KR') });
            rows.push({ 'Ìï≠Î™©': 'ÏÑ†ÌÉùÎêú Ï∏µ', 'Í∞í': summaryData.selectedFloor || 'ALL' });
            rows.push({ 'Ìï≠Î™©': 'ÏÑ†ÌÉùÎêú Ï†àÏ£º', 'Í∞í': summaryData.selectedJeolju || 'ALL' });

            const ws = XLSX.utils.json_to_sheet(rows);

            ws['!cols'] = [
                { wch: 25 },  // Ìï≠Î™©
                { wch: 30 }   // Í∞í
            ];

            this.applyHeaderStyle(ws, 2);

            return ws;
        },

        /**
         * Create Stage Progress sheet
         */
        createStageProgressSheet(columnsData) {
            const stageProgress = {};

            // Calculate progress per stage
            this.stageConfigs.forEach(stage => {
                const stageColumns = columnsData.filter(c => c.stage?.code === stage.code);
                const total = stageColumns.length;
                const completed = stageColumns.filter(c =>
                    c.status?.code === 'installed' || c.status?.code === 'completed'
                ).length;

                stageProgress[stage.code] = {
                    label: stage.label,
                    total,
                    completed,
                    rate: total > 0 ? Math.round((completed / total) * 100) : 0
                };
            });

            const rows = Object.entries(stageProgress).map(([code, data]) => ({
                'Í≥µÏ†ïÏΩîÎìú': code,
                'Í≥µÏ†ïÎ™Ö': data.label,
                'Ï†ÑÏ≤¥': data.total,
                'ÏôÑÎ£å': data.completed,
                'ÏßÑÌñâÎ•†(%)': data.rate
            }));

            const ws = XLSX.utils.json_to_sheet(rows);

            ws['!cols'] = [
                { wch: 15 },  // Í≥µÏ†ïÏΩîÎìú
                { wch: 15 },  // Í≥µÏ†ïÎ™Ö
                { wch: 10 },  // Ï†ÑÏ≤¥
                { wch: 10 },  // ÏôÑÎ£å
                { wch: 12 }   // ÏßÑÌñâÎ•†
            ];

            this.applyHeaderStyle(ws, 5);

            return ws;
        },

        /**
         * Apply header styling (basic - SheetJS community edition)
         */
        applyHeaderStyle(ws, numCols) {
            // Get header range
            const range = XLSX.utils.decode_range(ws['!ref']);

            // Note: Full styling requires SheetJS Pro or xlsx-style
            // For community edition, we can set basic properties
            // Styling will be applied when the user opens in Excel

            // Add autofilter to header row
            ws['!autofilter'] = { ref: ws['!ref'] };
        },

        /**
         * Get human-readable status label
         */
        getStatusLabel(code) {
            const labels = {
                'pending': 'ÎåÄÍ∏∞',
                'in_progress': 'ÏßÑÌñâÏ§ë',
                'completed': 'ÏôÑÎ£å',
                'installed': 'ÏÑ§ÏπòÏôÑÎ£å',
                'delay': 'ÏßÄÏó∞',
                'blocked': 'Ï∞®Îã®',
                'hold': 'Î≥¥Î•ò',
                'tc_hold': 'TC Î≥¥Î•ò',
                'ok': 'Ï†ïÏÉÅ',
                'shipping': 'Ï∂úÌïòÏ§ë',
                'design': 'ÏÑ§Í≥ÑÏ§ë'
            };
            return labels[code] || code || '-';
        },

        /**
         * Get human-readable stage label
         */
        getStageLabel(code) {
            const stage = this.stageConfigs.find(s => s.code === code);
            return stage?.label || code || '-';
        },

        /**
         * Get human-readable issue type label
         */
        getIssueTypeLabel(type) {
            const labels = {
                'tc': 'TC Ïù¥Ïäà',
                'design': 'ÏÑ§Í≥Ñ Ïù¥Ïäà',
                'delay': 'ÏßÄÏó∞',
                'quality': 'ÌíàÏßà',
                'safety': 'ÏïàÏ†Ñ',
                'other': 'Í∏∞ÌÉÄ'
            };
            return labels[type] || type || '-';
        },

        /**
         * Get human-readable severity label
         */
        getSeverityLabel(severity) {
            const labels = {
                'critical': 'Ïã¨Í∞Å',
                'high': 'ÎÜíÏùå',
                'medium': 'Î≥¥ÌÜµ',
                'low': 'ÎÇÆÏùå'
            };
            return labels[severity] || severity || '-';
        },

        /**
         * Get human-readable issue status label
         */
        getIssueStatusLabel(status) {
            const labels = {
                'open': 'ÏßÑÌñâÏ§ë',
                'in_progress': 'Ï≤òÎ¶¨Ï§ë',
                'resolved': 'Ìï¥Í≤∞Îê®',
                'closed': 'Ï¢ÖÎ£å'
            };
            return labels[status] || status || '-';
        },

        /**
         * Export with specific options - UI helper
         */
        exportExcelWithOptions(scope) {
            this.exportToExcel({ scope });
        },

        // ===== PDF Report Generation =====

        /**
         * PDF Report Modal State
         */
        pdfReportModalOpen: false,
        pdfReportType: 'summary', // 'summary' | 'detailed' | 'issues'
        pdfGenerating: false,

        /**
         * Open PDF Report Modal
         */
        openPdfReportModal() {
            this.pdfReportModalOpen = true;
            this.pdfReportType = 'summary';
        },

        /**
         * Close PDF Report Modal
         */
        closePdfReportModal() {
            this.pdfReportModalOpen = false;
        },

        /**
         * Generate PDF Report
         * @param {string} type - Report type: 'summary' | 'detailed' | 'issues'
         */
        async generatePDFReport(type = 'summary') {
            // Check if jsPDF is loaded
            if (typeof window.jspdf === 'undefined') {
                this.showToast('PDF ÎùºÏù¥Î∏åÎü¨Î¶¨ Î°úÎìú Ï§ë... Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.', 'error');
                return;
            }

            this.pdfGenerating = true;
            this.showToast('PDF Î≥¥Í≥†ÏÑú ÏÉùÏÑ± Ï§ë...', 'info');

            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('p', 'mm', 'a4');
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                const margin = 15;
                const contentWidth = pageWidth - (margin * 2);

                // Generate timestamp
                const now = new Date();
                const timestamp = now.toLocaleString('ko-KR', {
                    year: 'numeric', month: '2-digit', day: '2-digit',
                    hour: '2-digit', minute: '2-digit'
                });
                const fileTimestamp = now.toISOString().replace(/[-:]/g, '').slice(0, 15);

                // === Page 1: Cover Page ===
                this.addPdfCoverPage(doc, timestamp, type);

                // === Page 2: Summary Dashboard ===
                doc.addPage();
                this.addPdfSummaryPage(doc, margin, contentWidth);

                // === Detailed Report: Floor-by-Floor Pages ===
                if (type === 'detailed') {
                    this.addPdfDetailedPages(doc, margin, contentWidth);
                }

                // === Issues Report ===
                if (type === 'issues' || type === 'detailed') {
                    doc.addPage();
                    this.addPdfIssuesPage(doc, margin, contentWidth);
                }

                // Add page numbers to all pages
                this.addPdfPageNumbers(doc);

                // Generate filename and save
                const reportTypeLabel = {
                    'summary': 'ÏöîÏïΩ',
                    'detailed': 'ÏÉÅÏÑ∏',
                    'issues': 'Ïù¥Ïäà'
                }[type] || 'ÏöîÏïΩ';

                const filename = `P5_Íµ¨Ï°∞Í¥ÄÎ¶¨_${reportTypeLabel}_Î≥¥Í≥†ÏÑú_${fileTimestamp}.pdf`;
                doc.save(filename);

                this.showToast(`PDF Î≥¥Í≥†ÏÑúÍ∞Ä ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§: ${filename}`, 'success');
                this.pdfReportModalOpen = false;

            } catch (error) {
                console.error('[PDF Report] Error:', error);
                this.showToast('PDF ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message, 'error');
            } finally {
                this.pdfGenerating = false;
            }
        },

        /**
         * Add Cover Page to PDF
         */
        addPdfCoverPage(doc, timestamp, reportType) {
            const pageWidth = doc.internal.pageSize.getWidth();
            const pageHeight = doc.internal.pageSize.getHeight();
            const centerX = pageWidth / 2;

            // Background header bar
            doc.setFillColor(31, 111, 235); // Primary blue
            doc.rect(0, 0, pageWidth, 60, 'F');

            // Project badge
            doc.setFillColor(35, 134, 54); // Green
            doc.roundedRect(centerX - 30, 15, 60, 12, 3, 3, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(10);
            doc.text('P5 FAB PROJECT', centerX, 23, { align: 'center' });

            // Main title
            doc.setFontSize(24);
            doc.setTextColor(255, 255, 255);
            doc.text('P5 Î≥µÌï©Îèô Íµ¨Ï°∞ ÌÜµÌï© Í¥ÄÎ¶¨', centerX, 45, { align: 'center' });

            // Subtitle with report type
            const reportTypeLabels = {
                'summary': 'ÏöîÏïΩ Î≥¥Í≥†ÏÑú',
                'detailed': 'ÏÉÅÏÑ∏ Î≥¥Í≥†ÏÑú',
                'issues': 'Ïù¥Ïäà Î≥¥Í≥†ÏÑú'
            };
            doc.setFontSize(16);
            doc.text(reportTypeLabels[reportType] || 'ÏöîÏïΩ Î≥¥Í≥†ÏÑú', centerX, 55, { align: 'center' });

            // Project info section
            doc.setTextColor(100, 100, 100);
            doc.setFontSize(11);

            const infoY = 90;
            const lineHeight = 10;

            // Statistics summary box
            const totalColumns = Object.keys(this.columns).length;
            const completedCount = Object.values(this.columns).filter(c => c.status === 'installed').length;
            const progressRate = totalColumns > 0 ? ((completedCount / totalColumns) * 100).toFixed(1) : 0;
            const openIssues = this.issues.filter(i => i.status === 'open' || i.status === 'in_progress').length;

            // Info box
            doc.setDrawColor(200, 200, 200);
            doc.setFillColor(248, 249, 250);
            doc.roundedRect(30, infoY - 5, pageWidth - 60, 55, 3, 3, 'FD');

            doc.setTextColor(60, 60, 60);
            doc.setFontSize(10);
            doc.text('ÌîÑÎ°úÏ†ùÌä∏ Ï†ïÎ≥¥', 40, infoY + 5);

            doc.setTextColor(100, 100, 100);
            doc.setFontSize(9);
            doc.text(`Ï¥ù Í∏∞Îë• Ïàò: ${totalColumns.toLocaleString()}Í∞ú (11Í∞ú Ï∏µ x 828Í∞ú Í∏∞Îë•/Ï∏µ)`, 40, infoY + 15);
            doc.text(`Ï†ÑÏ≤¥ ÏßÑÌñâÎ•†: ${progressRate}%`, 40, infoY + 23);
            doc.text(`ÏôÑÎ£å: ${completedCount.toLocaleString()}Í∞ú | ÎØ∏Ìï¥Í≤∞ Ïù¥Ïäà: ${openIssues}Í±¥`, 40, infoY + 31);
            doc.text(`Î≥¥Í≥†ÏÑú ÏÉùÏÑ±ÏùºÏãú: ${timestamp}`, 40, infoY + 39);

            // Floor and Jeolju context
            const floorContext = this.selectedFloor || 'ALL';
            const jeoljuContext = this.selectedJeolju || 'Ï†ÑÏ≤¥';
            doc.text(`ÌòÑÏû¨ Ï°∞Ìöå Î≤îÏúÑ: ${floorContext}Ï∏µ / ${jeoljuContext}Ï†àÏ£º`, 40, infoY + 47);

            // Footer
            doc.setFontSize(8);
            doc.setTextColor(150, 150, 150);
            doc.text('Generated by P5 Live Grid Dashboard v2.3', centerX, pageHeight - 20, { align: 'center' });
            doc.text('PSRC/HMB Í≥µÎ≤ï Í∏∞Î∞ò Î∞òÎèÑÏ≤¥ FAB Íµ¨Ï°∞ Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú', centerX, pageHeight - 14, { align: 'center' });
        },

        /**
         * Add Summary Dashboard Page to PDF
         */
        addPdfSummaryPage(doc, margin, contentWidth) {
            const pageWidth = doc.internal.pageSize.getWidth();
            let yPos = 20;

            // Page header
            doc.setFillColor(31, 111, 235);
            doc.rect(0, 0, pageWidth, 15, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(12);
            doc.text('ÏöîÏïΩ ÎåÄÏãúÎ≥¥Îìú', margin, 10);

            yPos = 25;

            // === Key Metrics Section ===
            doc.setTextColor(60, 60, 60);
            doc.setFontSize(11);
            doc.text('ÌïµÏã¨ ÏßÄÌëú', margin, yPos);
            yPos += 8;

            // Calculate metrics
            const totalColumns = Object.keys(this.columns).length;
            const statusCounts = {};
            Object.values(this.columns).forEach(col => {
                const status = col.status || 'pending';
                statusCounts[status] = (statusCounts[status] || 0) + 1;
            });

            const completedCount = statusCounts['installed'] || 0;
            const activeCount = statusCounts['active'] || 0;
            const holdCount = (statusCounts['hold_tc'] || 0) + (statusCounts['hold_design'] || 0);
            const progressRate = totalColumns > 0 ? ((completedCount / totalColumns) * 100).toFixed(1) : 0;

            // Metrics table
            const metricsData = [
                ['Ï†ÑÏ≤¥ Í∏∞Îë•', totalColumns.toLocaleString() + 'Í∞ú'],
                ['ÏÑ§Ïπò ÏôÑÎ£å', completedCount.toLocaleString() + 'Í∞ú (' + progressRate + '%)'],
                ['ÏßÑÌñâÏ§ë', activeCount.toLocaleString() + 'Í∞ú'],
                ['Hold (TC/ÏÑ§Í≥Ñ)', holdCount.toLocaleString() + 'Í∞ú'],
                ['ÎØ∏Ìï¥Í≤∞ Ïù¥Ïäà', this.issues.filter(i => i.status !== 'resolved' && i.status !== 'closed').length + 'Í±¥']
            ];

            doc.autoTable({
                startY: yPos,
                head: [['Ìï≠Î™©', 'Í∞í']],
                body: metricsData,
                margin: { left: margin, right: margin },
                headStyles: { fillColor: [31, 111, 235], fontSize: 9 },
                bodyStyles: { fontSize: 9 },
                columnStyles: { 0: { cellWidth: 60 }, 1: { cellWidth: 60 } },
                tableWidth: 130
            });

            yPos = doc.lastAutoTable.finalY + 15;

            // === Floor Progress Section ===
            doc.setTextColor(60, 60, 60);
            doc.setFontSize(11);
            doc.text('Ï∏µÎ≥Ñ ÏßÑÌñâÎ•†', margin, yPos);
            yPos += 8;

            // Calculate floor progress
            const floorProgress = this.calculateFloorProgress();
            const floorData = Object.entries(floorProgress).map(([floorId, data]) => [
                floorId,
                data.total.toString(),
                data.completed.toString(),
                data.active.toString(),
                data.hold.toString(),
                data.progress + '%'
            ]);

            doc.autoTable({
                startY: yPos,
                head: [['Ï∏µ', 'Ï†ÑÏ≤¥', 'ÏôÑÎ£å', 'ÏßÑÌñâÏ§ë', 'Hold', 'ÏßÑÌñâÎ•†']],
                body: floorData,
                margin: { left: margin, right: margin },
                headStyles: { fillColor: [31, 111, 235], fontSize: 8 },
                bodyStyles: { fontSize: 8 },
                alternateRowStyles: { fillColor: [248, 249, 250] },
                columnStyles: {
                    0: { cellWidth: 20 },
                    1: { cellWidth: 25, halign: 'right' },
                    2: { cellWidth: 25, halign: 'right' },
                    3: { cellWidth: 25, halign: 'right' },
                    4: { cellWidth: 25, halign: 'right' },
                    5: { cellWidth: 25, halign: 'right' }
                }
            });

            yPos = doc.lastAutoTable.finalY + 15;

            // === Status Distribution Section ===
            doc.setTextColor(60, 60, 60);
            doc.setFontSize(11);
            doc.text('ÏÉÅÌÉúÎ≥Ñ Î∂ÑÌè¨', margin, yPos);
            yPos += 8;

            const statusData = Object.entries(this.statusCodes).map(([code, info]) => {
                const count = statusCounts[code] || 0;
                const percent = totalColumns > 0 ? ((count / totalColumns) * 100).toFixed(1) : 0;
                return [info.label || code, count.toString(), percent + '%'];
            });

            doc.autoTable({
                startY: yPos,
                head: [['ÏÉÅÌÉú', 'Í∞úÏàò', 'ÎπÑÏú®']],
                body: statusData,
                margin: { left: margin, right: margin },
                headStyles: { fillColor: [31, 111, 235], fontSize: 8 },
                bodyStyles: { fontSize: 8 },
                alternateRowStyles: { fillColor: [248, 249, 250] }
            });
        },

        /**
         * Calculate floor progress data
         */
        calculateFloorProgress() {
            const floorIds = ['F01', 'F02', 'F03', 'F04', 'F05', 'F06', 'F07', 'F08', 'F09', 'F10', 'RF'];
            const progress = {};

            floorIds.forEach(floorId => {
                const floorColumns = Object.values(this.columns).filter(c =>
                    c.floor === floorId || c.floorId === floorId
                );

                const total = floorColumns.length || 828; // Default expected count
                const completed = floorColumns.filter(c => c.status === 'installed').length;
                const active = floorColumns.filter(c => c.status === 'active').length;
                const hold = floorColumns.filter(c =>
                    c.status === 'hold_tc' || c.status === 'hold_design'
                ).length;

                progress[floorId] = {
                    total,
                    completed,
                    active,
                    hold,
                    progress: total > 0 ? ((completed / total) * 100).toFixed(1) : '0.0'
                };
            });

            return progress;
        },

        /**
         * Add Detailed Floor Pages to PDF
         */
        addPdfDetailedPages(doc, margin, contentWidth) {
            const floorIds = ['F01', 'F02', 'F03', 'F04', 'F05', 'F06', 'F07', 'F08', 'F09', 'F10', 'RF'];
            const pageWidth = doc.internal.pageSize.getWidth();

            floorIds.forEach(floorId => {
                doc.addPage();
                let yPos = 20;

                // Page header
                doc.setFillColor(31, 111, 235);
                doc.rect(0, 0, pageWidth, 15, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(12);
                doc.text(`${floorId} Ï∏µ ÏÉÅÏÑ∏ ÌòÑÌô©`, margin, 10);

                yPos = 25;

                // Get floor columns
                const floorColumns = Object.values(this.columns).filter(c =>
                    c.floor === floorId || c.floorId === floorId
                );

                // Zone-based summary
                doc.setTextColor(60, 60, 60);
                doc.setFontSize(10);
                doc.text('ZoneÎ≥Ñ ÌòÑÌô©', margin, yPos);
                yPos += 6;

                const zoneData = this.zones.map(zone => {
                    const zoneCols = floorColumns.filter(c => c.zone?.id === zone.id || c.zoneId === zone.id);
                    const completed = zoneCols.filter(c => c.status === 'installed').length;
                    const active = zoneCols.filter(c => c.status === 'active').length;
                    const hold = zoneCols.filter(c => c.status === 'hold_tc' || c.status === 'hold_design').length;
                    const blocked = zoneCols.filter(c => c.status === 'hold_tc').length;

                    return [
                        zone.name || zone.id,
                        zoneCols.length.toString(),
                        completed.toString(),
                        active.toString(),
                        hold.toString(),
                        blocked.toString()
                    ];
                });

                doc.autoTable({
                    startY: yPos,
                    head: [['Zone', 'Ï†ÑÏ≤¥', 'ÏôÑÎ£å', 'ÏßÑÌñâÏ§ë', 'ÏßÄÏó∞', 'Î∏îÎ°ù']],
                    body: zoneData,
                    margin: { left: margin, right: margin },
                    headStyles: { fillColor: [31, 111, 235], fontSize: 8 },
                    bodyStyles: { fontSize: 8 },
                    alternateRowStyles: { fillColor: [248, 249, 250] }
                });

                yPos = doc.lastAutoTable.finalY + 12;

                // Stage-based progress
                doc.setTextColor(60, 60, 60);
                doc.setFontSize(10);
                doc.text('Í≥µÏ†ï(Stage)Î≥Ñ ÏßÑÌñâÎ•†', margin, yPos);
                yPos += 6;

                const stages = ['FA', 'SB', 'TC', 'TB', 'WD', 'CP'];
                const stageLabels = {
                    'FA': 'Ï≤†Í≥®(FA)',
                    'SB': 'Îç∞ÌÅ¨(SB)',
                    'TC': 'T/C ÏÑ§Ïπò(TC)',
                    'TB': 'T/B ÏÑ§Ïπò(TB)',
                    'WD': 'Ïö©Ï†ë(WD)',
                    'CP': 'ÏôÑÎ£å(CP)'
                };

                const stageData = stages.map(stage => {
                    const stageComplete = floorColumns.filter(c => {
                        const stageStatus = c.stages?.[stage];
                        return stageStatus === 'complete' || stageStatus === 'installed';
                    }).length;
                    const progress = floorColumns.length > 0
                        ? ((stageComplete / floorColumns.length) * 100).toFixed(1)
                        : '0.0';
                    return [stageLabels[stage] || stage, stageComplete.toString(), progress + '%'];
                });

                doc.autoTable({
                    startY: yPos,
                    head: [['Í≥µÏ†ï', 'ÏôÑÎ£å', 'ÏßÑÌñâÎ•†']],
                    body: stageData,
                    margin: { left: margin, right: margin },
                    headStyles: { fillColor: [35, 134, 54], fontSize: 8 },
                    bodyStyles: { fontSize: 8 },
                    alternateRowStyles: { fillColor: [248, 249, 250] },
                    tableWidth: 100
                });

                // Floor Issues Summary
                const floorIssues = this.issues.filter(issue =>
                    issue.floorId === floorId || issue.floor === floorId
                );

                if (floorIssues.length > 0) {
                    yPos = doc.lastAutoTable.finalY + 12;
                    doc.setTextColor(60, 60, 60);
                    doc.setFontSize(10);
                    doc.text(`Ïù¥Ïäà ÌòÑÌô© (${floorIssues.length}Í±¥)`, margin, yPos);
                    yPos += 6;

                    const issueData = floorIssues.slice(0, 10).map(issue => [
                        issue.id?.slice(-6) || '-',
                        this.getSeverityLabel(issue.severity),
                        (issue.title || issue.description || '-').slice(0, 30),
                        this.getIssueStatusLabel(issue.status)
                    ]);

                    doc.autoTable({
                        startY: yPos,
                        head: [['ID', 'Ïã¨Í∞ÅÎèÑ', 'Ï†úÎ™©', 'ÏÉÅÌÉú']],
                        body: issueData,
                        margin: { left: margin, right: margin },
                        headStyles: { fillColor: [218, 54, 51], fontSize: 8 },
                        bodyStyles: { fontSize: 7 },
                        alternateRowStyles: { fillColor: [248, 249, 250] }
                    });
                }
            });
        },

        /**
         * Add Issues Page to PDF
         */
        addPdfIssuesPage(doc, margin, contentWidth) {
            const pageWidth = doc.internal.pageSize.getWidth();
            let yPos = 20;

            // Page header
            doc.setFillColor(218, 54, 51); // Red for issues
            doc.rect(0, 0, pageWidth, 15, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(12);
            doc.text('Ïù¥Ïäà ÏöîÏïΩ', margin, 10);

            yPos = 25;

            // Issue statistics
            const openIssues = this.issues.filter(i => i.status === 'open');
            const inProgressIssues = this.issues.filter(i => i.status === 'in_progress');
            const resolvedIssues = this.issues.filter(i => i.status === 'resolved');
            const criticalIssues = this.issues.filter(i => i.severity === 'critical');
            const highIssues = this.issues.filter(i => i.severity === 'high');

            doc.setTextColor(60, 60, 60);
            doc.setFontSize(10);
            doc.text('Ïù¥Ïäà ÌÜµÍ≥Ñ', margin, yPos);
            yPos += 6;

            const statsData = [
                ['Ï†ÑÏ≤¥ Ïù¥Ïäà', this.issues.length.toString()],
                ['ÎØ∏Ìï¥Í≤∞ (Open)', openIssues.length.toString()],
                ['Ï≤òÎ¶¨Ï§ë (In Progress)', inProgressIssues.length.toString()],
                ['Ìï¥Í≤∞Îê® (Resolved)', resolvedIssues.length.toString()],
                ['Critical Îì±Í∏â', criticalIssues.length.toString()],
                ['High Îì±Í∏â', highIssues.length.toString()]
            ];

            doc.autoTable({
                startY: yPos,
                head: [['Ìï≠Î™©', 'Í±¥Ïàò']],
                body: statsData,
                margin: { left: margin, right: margin },
                headStyles: { fillColor: [218, 54, 51], fontSize: 9 },
                bodyStyles: { fontSize: 9 },
                tableWidth: 100
            });

            yPos = doc.lastAutoTable.finalY + 15;

            // Severity distribution
            doc.setTextColor(60, 60, 60);
            doc.setFontSize(10);
            doc.text('Ïã¨Í∞ÅÎèÑÎ≥Ñ Î∂ÑÌè¨', margin, yPos);
            yPos += 6;

            const severityCounts = {};
            this.issues.forEach(issue => {
                const sev = issue.severity || 'low';
                severityCounts[sev] = (severityCounts[sev] || 0) + 1;
            });

            const severityData = [
                ['Critical (Í∏¥Í∏â)', (severityCounts['critical'] || 0).toString()],
                ['High (ÎÜíÏùå)', (severityCounts['high'] || 0).toString()],
                ['Medium (Î≥¥ÌÜµ)', (severityCounts['medium'] || 0).toString()],
                ['Low (ÎÇÆÏùå)', (severityCounts['low'] || 0).toString()]
            ];

            doc.autoTable({
                startY: yPos,
                head: [['Ïã¨Í∞ÅÎèÑ', 'Í±¥Ïàò']],
                body: severityData,
                margin: { left: margin, right: margin },
                headStyles: { fillColor: [210, 153, 34], fontSize: 9 },
                bodyStyles: { fontSize: 9 },
                tableWidth: 100
            });

            yPos = doc.lastAutoTable.finalY + 15;

            // Unresolved issues list
            const unresolvedIssues = this.issues.filter(i =>
                i.status !== 'resolved' && i.status !== 'closed'
            );

            if (unresolvedIssues.length > 0) {
                doc.setTextColor(60, 60, 60);
                doc.setFontSize(10);
                doc.text(`ÎØ∏Ìï¥Í≤∞ Ïù¥Ïäà Î™©Î°ù (${unresolvedIssues.length}Í±¥)`, margin, yPos);
                yPos += 6;

                const issueTableData = unresolvedIssues.slice(0, 20).map(issue => [
                    issue.id?.slice(-8) || '-',
                    issue.floorId || issue.floor || '-',
                    this.getSeverityLabel(issue.severity),
                    (issue.title || issue.description || '-').slice(0, 25),
                    this.getIssueStatusLabel(issue.status),
                    issue.createdAt ? new Date(issue.createdAt).toLocaleDateString('ko-KR') : '-'
                ]);

                doc.autoTable({
                    startY: yPos,
                    head: [['ID', 'Ï∏µ', 'Ïã¨Í∞ÅÎèÑ', 'Ï†úÎ™©', 'ÏÉÅÌÉú', 'ÏÉùÏÑ±Ïùº']],
                    body: issueTableData,
                    margin: { left: margin, right: margin },
                    headStyles: { fillColor: [218, 54, 51], fontSize: 7 },
                    bodyStyles: { fontSize: 7 },
                    alternateRowStyles: { fillColor: [248, 249, 250] },
                    columnStyles: {
                        0: { cellWidth: 22 },
                        1: { cellWidth: 15 },
                        2: { cellWidth: 20 },
                        3: { cellWidth: 50 },
                        4: { cellWidth: 20 },
                        5: { cellWidth: 25 }
                    }
                });

                if (unresolvedIssues.length > 20) {
                    const remaining = unresolvedIssues.length - 20;
                    doc.setFontSize(8);
                    doc.setTextColor(100, 100, 100);
                    doc.text(`... Ïô∏ ${remaining}Í±¥`, margin, doc.lastAutoTable.finalY + 8);
                }
            }
        },

        /**
         * Get severity label in Korean
         */
        getSeverityLabel(severity) {
            const labels = {
                'critical': 'Í∏¥Í∏â',
                'high': 'ÎÜíÏùå',
                'medium': 'Î≥¥ÌÜµ',
                'low': 'ÎÇÆÏùå'
            };
            return labels[severity] || severity || '-';
        },

        /**
         * Add page numbers to all pages
         */
        addPdfPageNumbers(doc) {
            const totalPages = doc.internal.getNumberOfPages();
            const pageHeight = doc.internal.pageSize.getHeight();
            const pageWidth = doc.internal.pageSize.getWidth();

            for (let i = 1; i <= totalPages; i++) {
                doc.setPage(i);
                doc.setFontSize(8);
                doc.setTextColor(150, 150, 150);

                // Page number
                doc.text(`${i} / ${totalPages}`, pageWidth / 2, pageHeight - 8, { align: 'center' });

                // Footer line
                doc.setDrawColor(200, 200, 200);
                doc.line(15, pageHeight - 12, pageWidth - 15, pageHeight - 12);

                // Generation timestamp on first page footer
                if (i > 1) {
                    doc.text('P5 Dashboard Report', 15, pageHeight - 8);
                    doc.text(new Date().toLocaleDateString('ko-KR'), pageWidth - 15, pageHeight - 8, { align: 'right' });
                }
            }
        },

        /**
         * Handle file import
         */
        handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            this.processImportFile(file);
        },
        
        /**
         * Handle file drop
         */
        handleFileDrop(event) {
            event.target.classList.remove('dragover');
            const file = event.dataTransfer.files[0];
            if (file) this.processImportFile(file);
        },
        
        // ===== MGT Import Handlers =====
        
        /**
         * Handle MGT file input change
         */
        handleMgtImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            this.processMgtFile(file);
        },
        
        /**
         * Handle MGT file drop
         */
        handleMgtDrop(event) {
            event.target.classList.remove('dragover');
            const file = event.dataTransfer.files[0];
            if (file && file.name.endsWith('.mgt')) {
                this.processMgtFile(file);
            } else {
                this.showToast('MGT ÌååÏùºÎßå ÏßÄÏõêÎê©ÎãàÎã§', 'error');
            }
        },
        
        /**
         * Process MGT file
         */
        async processMgtFile(file) {
            this.mgtImportStatus = {
                loading: true,
                success: false,
                message: 'MGT ÌååÏùº ÏùΩÎäî Ï§ë...',
                nodes: 0,
                elements: 0,
                cols: 0,
                rows: 0,
                excludedCols: [],
                parsedData: null
            };
            
            try {
                const content = await file.text();
                this.mgtImportStatus.message = 'ÎÖ∏Îìú Îç∞Ïù¥ÌÑ∞ ÌååÏã± Ï§ë...';
                
                // Parse MGT inline (simplified version of mgt-parser.js)
                const parsed = this.parseMgtContent(content);
                
                this.mgtImportStatus = {
                    loading: false,
                    success: true,
                    message: 'ÌååÏã± ÏôÑÎ£å',
                    nodes: parsed.meta.totalNodes,
                    elements: parsed.meta.totalElements,
                    cols: parsed.gridConfig.cols,
                    rows: parsed.gridConfig.rows,
                    floors: parsed.gridConfig.floors,
                    excludedCols: parsed.gridConfig.excludedColumns,
                    parsedData: parsed
                };
                
                this.showToast(`MGT ÌååÏã± ÏôÑÎ£å: ${parsed.meta.totalNodes}Í∞ú ÎÖ∏Îìú, ${parsed.gridConfig.floors}Í∞ú Ï∏µ`, 'success');
                
            } catch (err) {
                this.mgtImportStatus.loading = false;
                this.mgtImportStatus.success = false;
                this.showToast('MGT ÌååÏã± Ïã§Ìå®: ' + err.message, 'error');
            }
        },
        
        /**
         * Parse MGT content (inline parser)
         */
        parseMgtContent(content) {
            const lines = content.split('\n');
            const nodes = [];
            const elements = [];
            let inNodeSection = false;
            let inElementSection = false;
            
            for (const line of lines) {
                const trimmed = line.trim();
                
                // Section detection
                if (trimmed.startsWith('*NODE')) {
                    inNodeSection = true;
                    inElementSection = false;
                    continue;
                }
                if (trimmed.startsWith('*ELEMENT')) {
                    inNodeSection = false;
                    inElementSection = true;
                    continue;
                }
                if (trimmed.startsWith('*') && !trimmed.startsWith(';')) {
                    inNodeSection = false;
                    inElementSection = false;
                    continue;
                }
                
                // Parse nodes
                if (inNodeSection && /^\s*\d+/.test(trimmed)) {
                    const parts = trimmed.split(',').map(p => p.trim());
                    if (parts.length >= 4) {
                        const id = parseInt(parts[0]);
                        const x = parseFloat(parts[1]);
                        const y = parseFloat(parts[2]);
                        const z = parseFloat(parts[3]);
                        if (!isNaN(id) && !isNaN(x) && !isNaN(y) && !isNaN(z)) {
                            nodes.push({ id, x, y, z });
                        }
                    }
                }
                
                // Parse elements
                if (inElementSection && /^\s*\d+/.test(trimmed)) {
                    const parts = trimmed.split(',').map(p => p.trim());
                    if (parts.length >= 6) {
                        const id = parseInt(parts[0]);
                        const type = parts[1].replace(/\s+/g, '');
                        const n1 = parseInt(parts[4]);
                        const n2 = parseInt(parts[5]);
                        if (!isNaN(id)) {
                            elements.push({ id, type, nodes: [n1, n2] });
                        }
                    }
                }
            }
            
            // Calculate grid config
            const xValues = [...new Set(nodes.map(n => n.x))].sort((a, b) => a - b);
            const yValues = [...new Set(nodes.map(n => n.y))].sort((a, b) => a - b);
            const zValues = [...new Set(nodes.map(n => n.z))].sort((a, b) => a - b);
            
            const minX = xValues[0] || 0;
            const excludedColumns = minX > 15 ? [1, 2] : [];
            
            // Generate floor mapping from Z values (F01~F10, RF)
            const floorLabels = ['F01', 'F02', 'F03', 'F04', 'F05', 'F06', 'F07', 'F08', 'F09', 'F10', 'RF'];
            const floorMapping = {};
            zValues.forEach((z, idx) => {
                // Use predefined labels for first 11 floors, then generate dynamically
                const floorId = idx < floorLabels.length ? floorLabels[idx] : `F${String(idx + 1).padStart(2, '0')}`;
                floorMapping[z] = floorId;
            });
            
            return {
                nodes,
                elements,
                gridConfig: {
                    cols: xValues.length,
                    rows: yValues.length,
                    floors: zValues.length,
                    excludedColumns,
                    xValues,
                    yValues,
                    zValues,
                    floorMapping
                },
                meta: {
                    totalNodes: nodes.length,
                    totalElements: elements.length,
                    parsedAt: new Date().toISOString()
                }
            };
        },
        
        /**
         * Apply parsed MGT config to dashboard
         */
        applyMgtConfig() {
            const parsed = this.mgtImportStatus.parsedData;
            if (!parsed) {
                this.showToast('Ï†ÅÏö©Ìï† Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§', 'error');
                return;
            }
            
            // Update grid config
            this.gridConfig.cols = parsed.gridConfig.cols;
            this.gridConfig.rows = parsed.gridConfig.rows;
            
            // Generate floors from Z values (F01~RF)
            const { zValues, floorMapping } = parsed.gridConfig;
            const floorLabels = ['F01', 'F02', 'F03', 'F04', 'F05', 'F06', 'F07', 'F08', 'F09', 'F10', 'RF'];
            this.floors = zValues.map((z, idx) => ({
                floorId: floorMapping[z],
                label: floorLabels[idx] || `F${String(idx + 1).padStart(2, '0')}`,
                zLevel: z,
                hasVariation: false,
                columnSize: '' // Can be populated later with actual section data
            }));
            
            // Update selected floor to first available
            if (this.floors.length > 0) {
                this.selectedFloor = this.floors[0].floorId;
                this.currentFloorLabel = this.floors[0].label;
            }
            
            // Generate zones from parsed data
            const totalCols = parsed.gridConfig.cols;
            const zoneSize = Math.ceil(totalCols / 3);
            
            this.zones = [
                {
                    id: 'zone_a',
                    name: 'ZONE A',
                    displayName: 'FAB',
                    description: 'Utility Support',
                    range: { startColumn: 3, endColumn: 3 + zoneSize - 1, startRow: 0, endRow: parsed.gridConfig.rows - 1 },
                    style: { primaryColor: '#238636', backgroundColor: 'rgba(35, 134, 54, 0.1)' }
                },
                {
                    id: 'zone_b',
                    name: 'ZONE B',
                    displayName: 'CUB',
                    description: 'Main Link',
                    range: { startColumn: 3 + zoneSize, endColumn: 3 + zoneSize * 2 - 1, startRow: 0, endRow: parsed.gridConfig.rows - 1 },
                    style: { primaryColor: '#1f6feb', backgroundColor: 'rgba(31, 111, 235, 0.1)' }
                },
                {
                    id: 'zone_c',
                    name: 'ZONE C',
                    displayName: 'COMPLEX',
                    description: 'Office/Amenity - Î≥µÌï©Îèô',
                    range: { startColumn: 3 + zoneSize * 2, endColumn: totalCols + 2, startRow: 0, endRow: parsed.gridConfig.rows - 1 },
                    style: { primaryColor: '#d29922', backgroundColor: 'rgba(210, 153, 34, 0.1)' }
                }
            ];
            
            // Save to local storage
            this.saveToLocalStorage();
            
            // Reset import status
            this.mgtImportStatus.success = false;
            this.mgtImportStatus.parsedData = null;
            
            // Close admin panel
            this.showAdminPanel = false;
            
            const floorCount = this.floors.length;
            this.showToast(`Í∑∏Î¶¨Îìú ÏÑ§Ï†ï Ï†ÅÏö© ÏôÑÎ£å: ${totalCols}Ïó¥ √ó ${parsed.gridConfig.rows}Ìñâ, ${floorCount}Í∞ú Ï∏µ`, 'success');
            console.log('[MGT] Config applied:', { cols: totalCols, rows: parsed.gridConfig.rows, floors: floorCount, zones: this.zones.length });
        },
        
        /**
         * Phase 8: Process imported file - shows preview before applying
         */
        processImportFile(file) {
            // File size check (5MB max)
            if (file.size > 5 * 1024 * 1024) {
                this.showToast('ÌååÏùº ÌÅ¨Í∏∞Í∞Ä 5MBÎ•º Ï¥àÍ≥ºÌï©ÎãàÎã§', 'error');
                return;
            }

            const reader = new FileReader();

            reader.onload = (e) => {
                try {
                    // Reset import preview state
                    this.importPreview = {
                        fileName: file.name,
                        fileType: file.name.endsWith('.json') ? 'json' : 'csv',
                        rawData: e.target.result,
                        parsedData: [],
                        headers: [],
                        columnMapping: { uid: '', status: '', isLocked: '' },
                        stats: { total: 0, new: 0, update: 0, errors: 0 },
                        errors: [],
                        mode: 'update'
                    };

                    if (file.name.endsWith('.json')) {
                        this.parseJsonForPreview(e.target.result);
                    } else if (file.name.endsWith('.csv')) {
                        this.parseCsvForPreview(e.target.result);
                    } else {
                        this.showToast('ÏßÄÏõêÌïòÏßÄ ÏïäÎäî ÌååÏùº ÌòïÏãùÏûÖÎãàÎã§', 'error');
                        return;
                    }

                    // Show preview modal
                    this.showImportPreview = true;
                } catch (err) {
                    this.showToast('ÌååÏùº ÌååÏã± Ïã§Ìå®: ' + err.message, 'error');
                }
            };

            reader.readAsText(file);
        },

        /**
         * Phase 8: Parse JSON data for preview
         */
        parseJsonForPreview(jsonText) {
            const data = JSON.parse(jsonText);
            this.importPreview.rawData = data;

            // Parse columns
            if (data.columns) {
                const columnData = Object.values(data.columns);
                let newCount = 0, updateCount = 0;

                this.importPreview.parsedData = columnData.map(col => {
                    const exists = this.columns[col.uid];
                    if (exists) {
                        updateCount++;
                        col._importStatus = 'update';
                    } else {
                        newCount++;
                        col._importStatus = 'new';
                    }
                    return col;
                });

                this.importPreview.stats = {
                    total: columnData.length,
                    new: newCount,
                    update: updateCount,
                    errors: 0
                };
            } else {
                this.importPreview.errors.push('JSONÏóê columns ÌïÑÎìúÍ∞Ä ÏóÜÏäµÎãàÎã§');
                this.importPreview.stats.errors = 1;
            }
        },

        /**
         * Phase 8: Parse CSV data for preview
         */
        parseCsvForPreview(csvText) {
            const lines = csvText.trim().split('\n');
            if (lines.length < 2) {
                this.importPreview.errors.push('CSVÏóê Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§');
                this.importPreview.stats.errors = 1;
                return;
            }

            // Parse headers
            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            this.importPreview.headers = headers;

            // Auto-detect column mapping
            const uidIdx = headers.findIndex(h => h.toLowerCase() === 'uid');
            const statusIdx = headers.findIndex(h => h.toLowerCase() === 'status');
            const lockIdx = headers.findIndex(h => h.toLowerCase() === 'islocked');

            this.importPreview.columnMapping = {
                uid: uidIdx >= 0 ? headers[uidIdx] : '',
                status: statusIdx >= 0 ? headers[statusIdx] : '',
                isLocked: lockIdx >= 0 ? headers[lockIdx] : ''
            };

            // Parse data rows
            let newCount = 0, updateCount = 0, errorCount = 0;
            const parsedData = [];

            for (let i = 1; i < lines.length; i++) {
                if (!lines[i].trim()) continue;

                const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
                const rowObj = {};

                headers.forEach((h, idx) => {
                    rowObj[h] = values[idx] || '';
                });

                // Determine import status
                const uid = uidIdx >= 0 ? values[uidIdx] : null;
                if (!uid) {
                    rowObj._importStatus = 'error';
                    errorCount++;
                    this.importPreview.errors.push(`Ìñâ ${i}: UIDÍ∞Ä ÏóÜÏäµÎãàÎã§`);
                } else if (this.columns[uid]) {
                    rowObj._importStatus = 'update';
                    updateCount++;
                } else {
                    rowObj._importStatus = 'new';
                    newCount++;
                }

                parsedData.push(rowObj);
            }

            this.importPreview.parsedData = parsedData;
            this.importPreview.stats = {
                total: parsedData.length,
                new: newCount,
                update: updateCount,
                errors: errorCount
            };
        },

        /**
         * Phase 8: Recalculate import stats when mapping changes
         */
        recalculateImportStats() {
            if (this.importPreview.fileType !== 'csv') return;

            const uidHeader = this.importPreview.columnMapping.uid;
            if (!uidHeader) {
                this.importPreview.stats = { total: this.importPreview.parsedData.length, new: 0, update: 0, errors: this.importPreview.parsedData.length };
                this.importPreview.errors = ['UID Ïª¨ÎüºÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî'];
                return;
            }

            let newCount = 0, updateCount = 0, errorCount = 0;
            this.importPreview.errors = [];

            this.importPreview.parsedData.forEach((row, idx) => {
                const uid = row[uidHeader];
                if (!uid) {
                    row._importStatus = 'error';
                    errorCount++;
                    if (this.importPreview.errors.length < 10) {
                        this.importPreview.errors.push(`Ìñâ ${idx + 2}: UIDÍ∞Ä ÎπÑÏñ¥ÏûàÏäµÎãàÎã§`);
                    }
                } else if (this.columns[uid]) {
                    row._importStatus = 'update';
                    updateCount++;
                } else {
                    row._importStatus = 'new';
                    newCount++;
                }
            });

            this.importPreview.stats = {
                total: this.importPreview.parsedData.length,
                new: newCount,
                update: updateCount,
                errors: errorCount
            };
        },

        /**
         * Phase 8: Execute the import based on preview settings
         */
        executeImport() {
            const mode = this.importPreview.mode;
            const fileType = this.importPreview.fileType;
            let imported = 0, created = 0;

            if (fileType === 'json') {
                const data = this.importPreview.rawData;

                if (mode === 'replace') {
                    // Replace all columns
                    this.columns = data.columns || {};
                    imported = Object.keys(this.columns).length;
                } else {
                    // Update/Merge
                    Object.entries(data.columns || {}).forEach(([uid, col]) => {
                        if (mode === 'update' && !this.columns[uid]) return;

                        if (this.columns[uid]) {
                            Object.assign(this.columns[uid], col);
                            imported++;
                        } else if (mode === 'merge') {
                            this.columns[uid] = col;
                            created++;
                        }
                    });
                }

                // Also import zones if present
                if (data.zones && (mode === 'replace' || mode === 'merge')) {
                    this.zones = data.zones;
                }
            } else if (fileType === 'csv') {
                const uidHeader = this.importPreview.columnMapping.uid;
                const statusHeader = this.importPreview.columnMapping.status;
                const lockHeader = this.importPreview.columnMapping.isLocked;

                if (!uidHeader) {
                    this.showToast('UID Ïª¨ÎüºÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî', 'error');
                    return;
                }

                this.importPreview.parsedData.forEach(row => {
                    const uid = row[uidHeader];
                    if (!uid) return;

                    if (this.columns[uid]) {
                        // Update existing
                        if (statusHeader && row[statusHeader]) {
                            this.columns[uid].status.code = row[statusHeader];
                        }
                        if (lockHeader && row[lockHeader] !== undefined) {
                            this.columns[uid].status.isLocked = row[lockHeader] === 'true' || row[lockHeader] === true;
                        }
                        this.columns[uid].status.updatedAt = new Date().toISOString();
                        imported++;
                    } else if (mode === 'merge') {
                        // Create new (basic structure)
                        const [rowLabel, colPart] = uid.split('-X');
                        const colNum = parseInt(colPart);

                        this.columns[uid] = {
                            uid: uid,
                            location: { row: rowLabel, column: colNum },
                            status: {
                                code: statusHeader && row[statusHeader] ? row[statusHeader] : 'pending',
                                isLocked: lockHeader ? (row[lockHeader] === 'true') : false,
                                updatedAt: new Date().toISOString()
                            }
                        };
                        created++;
                    }
                });
            }

            this.saveToLocalStorage();
            this.isDirty = true;
            this.showImportPreview = false;

            const message = mode === 'merge'
                ? `Í∞ÄÏ†∏Ïò§Í∏∞ ÏôÑÎ£å: ${imported}Í±¥ ÏóÖÎç∞Ïù¥Ìä∏, ${created}Í±¥ ÏÉùÏÑ±`
                : `Í∞ÄÏ†∏Ïò§Í∏∞ ÏôÑÎ£å: ${imported}Í±¥ ÏóÖÎç∞Ïù¥Ìä∏`;
            this.showToast(message, 'success');
        },

        // Legacy import functions for backward compatibility
        importJsonData(data) {
            this.importPreview.rawData = data;
            this.importPreview.mode = 'update';
            this.executeImport();
        },

        importCsvData(csvText) {
            this.parseCsvForPreview(csvText);
            this.importPreview.mode = 'update';
            this.executeImport();
        },
        
        /**
         * Test API connection
         */
        async testApiConnection() {
            if (!this.apiUrl) return;
            
            this.showToast('Testing connection...', 'success');
            
            try {
                const response = await fetch(this.apiUrl + '?action=getZones');
                const data = await response.json();
                
                if (data.success) {
                    this.showToast('Connection successful!', 'success');
                } else {
                    this.showToast('API error: ' + (data.error || 'Unknown'), 'error');
                }
            } catch (err) {
                this.showToast('Connection failed: ' + err.message, 'error');
            }
        },
        
        /**
         * Enable sync
         */
        enableSync() {
            if (!this.apiUrl) return;
            this.configureSync(this.apiUrl);
        },
        
        /**
         * Disable sync
         */
        disableSync() {
            this.syncEnabled = false;
            if (typeof SyncModule !== 'undefined') {
                SyncModule.stopAutoSync();
            }
            this.showToast('Sync disabled', 'success');
        }
    };
}
</script>

<!-- Phase 7: ÌÇ§Î≥¥Îìú Îã®Ï∂ïÌÇ§ Ï¥àÍ∏∞Ìôî (Alpine Î°úÎìú ÌõÑ Ïã§Ìñâ) -->
<script>
document.addEventListener('alpine:init', () => {
    // AlpineÏù¥ Ï¥àÍ∏∞ÌôîÎêú ÌõÑ ÌÇ§Î≥¥Îìú Îã®Ï∂ïÌÇ§ Îì±Î°ù
    setTimeout(() => {
        const el = document.querySelector('[x-data]');
        if (el && el._x_dataStack && el._x_dataStack[0]) {
            el._x_dataStack[0].registerKeyboardShortcuts();
            console.log('[Keyboard Shortcuts] Registered successfully');
        }
    }, 100);
});
</script>

<!-- Phase 7: Î™®Î∞îÏùº ÌïòÎã® ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò Î∞î -->
<nav class="mobile-nav">
    <div class="mobile-nav-item active" @click="mobileNavTab = 'grid'; issuePanelOpen = false; notificationPanelOpen = false;">
        <span class="nav-icon">üìä</span>
        <span>Í∑∏Î¶¨Îìú</span>
    </div>
    <div class="mobile-nav-item" @click="mobileNavTab = 'issues'; toggleIssuePanel();" style="position: relative;">
        <span class="nav-icon">üö®</span>
        <span>Ïù¥Ïäà</span>
        <template x-if="openIssues.length > 0">
            <span class="nav-badge" x-text="openIssues.length > 9 ? '9+' : openIssues.length"></span>
        </template>
    </div>
    <div class="mobile-nav-item" @click="mobileNavTab = 'notifications'; toggleNotificationPanel();" style="position: relative;">
        <span class="nav-icon">üîî</span>
        <span>ÏïåÎ¶º</span>
        <template x-if="unreadNotificationCount > 0">
            <span class="nav-badge" x-text="unreadNotificationCount > 9 ? '9+' : unreadNotificationCount"></span>
        </template>
    </div>
    <div class="mobile-nav-item" @click="mobileNavTab = 'settings'; showAdminPanel = true;">
        <span class="nav-icon">‚öôÔ∏è</span>
        <span>ÏÑ§Ï†ï</span>
    </div>
</nav>

<!-- Phase 7: ÏöîÏïΩ Ìå®ÎÑê ÌÜ†Í∏Ä Î≤ÑÌäº -->
<button class="summary-toggle-btn" @click="summaryPanelOpen = !summaryPanelOpen" title="ÎåÄÏãúÎ≥¥Îìú ÏöîÏïΩ">
    üìä
</button>

<!-- Phase 7: ÏöîÏïΩ Ìå®ÎÑê Ïò§Î≤ÑÎ†àÏù¥ -->
<div class="summary-panel-overlay" :class="summaryPanelOpen ? 'open' : ''" @click="summaryPanelOpen = false"></div>

<!-- Phase 7: ÎåÄÏãúÎ≥¥Îìú ÏöîÏïΩ Ìå®ÎÑê -->
<div class="summary-panel" :class="summaryPanelOpen ? 'open' : ''">
    <div class="summary-panel-header">
        <h2>üìä ÎåÄÏãúÎ≥¥Îìú ÏöîÏïΩ</h2>
        <button class="notification-close" @click="summaryPanelOpen = false">‚úï</button>
    </div>
    <div class="summary-panel-body">
        <div class="summary-grid">
            <!-- Ï†ÑÏ≤¥ ÏßÑÌñâÎ•† -->
            <div class="summary-card">
                <div class="summary-card-header">
                    <span class="summary-card-title">Ï†ÑÏ≤¥ ÏßÑÌñâÎ•†</span>
                    <span class="summary-card-icon">üìà</span>
                </div>
                <div class="donut-chart">
                    <svg viewBox="0 0 100 100">
                        <circle class="bg" cx="50" cy="50" r="40"></circle>
                        <circle class="progress" cx="50" cy="50" r="40"
                                :stroke-dasharray="251.2"
                                :stroke-dashoffset="251.2 - (251.2 * getTotalProgress() / 100)"></circle>
                    </svg>
                    <div class="center-text">
                        <div class="donut-center-value" x-text="getTotalProgress() + '%'"></div>
                        <div class="donut-center-label">ÏôÑÎ£å</div>
                    </div>
                </div>
                <div style="text-align:center; font-size:12px; color:#8b949e;">
                    <span x-text="Object.keys(columns).length"></span>Í∞ú Ï§ë
                    <span style="color:#238636;" x-text="getCompletedColumnsCount()"></span>Í∞ú ÏôÑÎ£å
                </div>
            </div>

            <!-- Í≥µÏ†ïÎ≥Ñ ÏßÑÌñâÎ•† -->
            <div class="summary-card">
                <div class="summary-card-header">
                    <span class="summary-card-title">Í≥µÏ†ïÎ≥Ñ ÌòÑÌô©</span>
                    <span class="summary-card-icon">üîß</span>
                </div>
                <div class="stage-progress-list">
                    <template x-for="stage in stageConfigs" :key="stage.code">
                        <div class="stage-progress-item">
                            <span class="stage-progress-label" x-text="stage.label"></span>
                            <div class="stage-progress-bar">
                                <div class="stage-progress-fill"
                                     :style="'width:' + getStageProgress(stage.code) + '%; background:' + stage.color">
                                </div>
                            </div>
                            <span class="stage-progress-value" x-text="getStageProgress(stage.code) + '%'"></span>
                        </div>
                    </template>
                </div>
            </div>

            <!-- Ïò§Îäò Î≥ÄÍ≤Ω ÎÇ¥Ïó≠ -->
            <div class="summary-card">
                <div class="summary-card-header">
                    <span class="summary-card-title">Ïò§ÎäòÏùò Î≥ÄÍ≤Ω</span>
                    <span class="summary-card-icon">üìÖ</span>
                </div>
                <div class="today-timeline" x-show="todayChanges.length > 0">
                    <template x-for="change in todayChanges.slice(0, 5)" :key="change.id">
                        <div class="timeline-item">
                            <span class="timeline-time" x-text="change.time"></span>
                            <span class="timeline-content" x-text="change.description"></span>
                        </div>
                    </template>
                </div>
                <div class="timeline-empty" x-show="todayChanges.length === 0">
                    Ïò§Îäò Î≥ÄÍ≤Ω ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§
                </div>
            </div>

            <!-- TOP Ïù¥Ïäà -->
            <div class="summary-card">
                <div class="summary-card-header">
                    <span class="summary-card-title">ÎØ∏Ìï¥Í≤∞ Ïù¥Ïäà TOP 5</span>
                    <span class="summary-card-icon">üö®</span>
                </div>
                <div class="top-issues-list" x-show="openIssues.length > 0">
                    <template x-for="issue in openIssues.slice(0, 5)" :key="issue.id">
                        <div class="top-issue-item" @click="selectedIssue = issue; issuePanelOpen = true; summaryPanelOpen = false;">
                            <span class="top-issue-severity" x-text="getSeverityEmoji(issue.severity)"></span>
                            <span class="top-issue-title" x-text="issue.title"></span>
                            <span class="top-issue-count" x-text="(issue.affectedColumns?.length || 0) + 'Í∞ú Í∏∞Îë•'"></span>
                        </div>
                    </template>
                </div>
                <div class="timeline-empty" x-show="openIssues.length === 0">
                    ‚úÖ ÎØ∏Ìï¥Í≤∞ Ïù¥ÏäàÍ∞Ä ÏóÜÏäµÎãàÎã§!
                </div>
            </div>

            <!-- ZoneÎ≥Ñ ÏôÑÎ£åÏú® -->
            <div class="summary-card" style="grid-column: span 2;">
                <div class="summary-card-header">
                    <span class="summary-card-title">ZoneÎ≥Ñ ÏôÑÎ£åÏú® ÎπÑÍµê</span>
                    <span class="summary-card-icon">üèóÔ∏è</span>
                </div>
                <div class="zone-compare-chart">
                    <template x-for="zone in zones" :key="zone.id">
                        <div class="zone-bar-wrapper">
                            <div class="zone-bar-value" x-text="getZoneProgress(zone.id) + '%'"></div>
                            <div class="zone-bar" :style="'height:' + Math.max(getZoneProgress(zone.id), 10) + 'px'">
                                <div class="zone-bar-fill" 
                                     :style="'height:100%; background:' + getZoneColor(zone.id)">
                                </div>
                            </div>
                            <div class="zone-bar-label" x-text="zone.name"></div>
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Phase 7: Îπ†Î•∏ ÏÉÅÌÉú Î≥ÄÍ≤Ω Ïï°ÏÖò Î∞î -->
<div class="quick-action-bar" :class="selectedCells.length > 0 ? 'visible' : ''">
    <div class="quick-action-info">
        <span class="quick-action-count" x-text="selectedCells.length"></span>
        <span class="quick-action-label">Í∞ú Í∏∞Îë• ÏÑ†ÌÉùÎê®</span>
    </div>
    
    <div class="quick-action-buttons">
        <!-- ÏÉÅÌÉú Î≥ÄÍ≤Ω ÎìúÎ°≠Îã§Ïö¥ -->
        <div class="quick-action-dropdown">
            <button class="quick-action-btn">
                üîÑ ÏÉÅÌÉú Î≥ÄÍ≤Ω
                <span class="keyboard-hint">S</span>
            </button>
            <div class="quick-action-menu">
                <template x-for="(status, code) in statusCodes" :key="code">
                    <div class="quick-action-menu-item" @click="quickChangeStatus(code)">
                        <span :style="'color:' + status.color">‚óè</span>
                        <span x-text="status.label"></span>
                    </div>
                </template>
            </div>
        </div>

        <!-- Í≥µÏ†ï ÏÉÅÌÉú Î≥ÄÍ≤Ω ÎìúÎ°≠Îã§Ïö¥ -->
        <div class="quick-action-dropdown">
            <button class="quick-action-btn">
                üîß Í≥µÏ†ï Î≥ÄÍ≤Ω
                <span class="keyboard-hint">P</span>
            </button>
            <div class="quick-action-menu" style="min-width: 220px;">
                <div class="stage-select-grid">
                    <template x-for="stage in stageConfigs" :key="stage.code">
                        <div class="stage-select-item" @click="quickChangeStage(stage.code, 'active')">
                            <div class="stage-dot" :style="'background:' + stage.color"></div>
                            <span class="stage-name" x-text="stage.label"></span>
                        </div>
                    </template>
                </div>
                <div class="quick-action-menu-divider"></div>
                <div class="quick-action-menu-item" @click="quickMarkStageComplete()">
                    ‚úÖ ÌòÑÏû¨ Í≥µÏ†ï ÏôÑÎ£å
                </div>
            </div>
        </div>

        <!-- Ïù¥Ïäà Îì±Î°ù -->
        <button class="quick-action-btn" @click="openNewIssueModalWithSelected()">
            üö® Ïù¥Ïäà Îì±Î°ù
            <span class="keyboard-hint">I</span>
        </button>

        <!-- Lock ÌÜ†Í∏Ä -->
        <div class="quick-action-dropdown">
            <button class="quick-action-btn" :class="{ 'locked': getSelectedLockCount() > 0 }">
                <span x-text="getSelectedLockCount() > 0 ? 'üîí' : 'üîì'"></span>
                <span x-text="getSelectedLockCount() + '/' + selectedCells.length"></span>
                <span class="keyboard-hint">L</span>
            </button>
            <div class="quick-action-menu" style="min-width: 150px;">
                <div class="quick-action-menu-item" @click="bulkLockSelected(true)">
                    üîí Î™®Îëê Ïû†Í∏à
                </div>
                <div class="quick-action-menu-item" @click="bulkLockSelected(false)">
                    üîì Î™®Îëê Ìï¥Ï†ú
                </div>
            </div>
        </div>

        <!-- ÏÑ†ÌÉù Ìï¥Ï†ú -->
        <button class="quick-action-btn danger" @click="clearSelection()">
            ‚úï
            <span class="keyboard-hint">Esc</span>
        </button>
    </div>
</div>

<!-- Phase 7: ÌûàÏä§ÌÜ†Î¶¨ ÌÜ†Í∏Ä Î≤ÑÌäº -->
<button class="history-toggle-btn" @click="historyPanelOpen = !historyPanelOpen" title="Î≥ÄÍ≤Ω ÌûàÏä§ÌÜ†Î¶¨">
    üìú
</button>

<!-- Phase 7: Îç∞Ïù¥ÌÑ∞ ÌûàÏä§ÌÜ†Î¶¨ Ìå®ÎÑê -->
<div class="history-panel" :class="historyPanelOpen ? 'open' : ''">
    <div class="history-panel-header">
        <h3>üìú Î≥ÄÍ≤Ω ÌûàÏä§ÌÜ†Î¶¨</h3>
        <button class="notification-close" @click="historyPanelOpen = false">‚úï</button>
    </div>
    
    <!-- ÌïÑÌÑ∞ Î≤ÑÌäº -->
    <div class="history-filters">
        <button class="history-filter-btn" 
                :class="historyFilter === 'all' ? 'active' : ''"
                @click="historyFilter = 'all'">Ï†ÑÏ≤¥</button>
        <button class="history-filter-btn" 
                :class="historyFilter === 'status' ? 'active' : ''"
                @click="historyFilter = 'status'">ÏÉÅÌÉúÎ≥ÄÍ≤Ω</button>
        <button class="history-filter-btn" 
                :class="historyFilter === 'stage' ? 'active' : ''"
                @click="historyFilter = 'stage'">Í≥µÏ†ï</button>
        <button class="history-filter-btn" 
                :class="historyFilter === 'issue' ? 'active' : ''"
                @click="historyFilter = 'issue'">Ïù¥Ïäà</button>
    </div>

    <!-- ÌûàÏä§ÌÜ†Î¶¨ Î™©Î°ù -->
    <div class="history-list">
        <template x-if="filteredHistory.length === 0">
            <div class="history-empty">
                <div class="history-empty-icon">üì≠</div>
                <div>Î≥ÄÍ≤Ω ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§</div>
            </div>
        </template>

        <template x-for="group in groupedHistory" :key="group.date">
            <div class="history-date-group">
                <div class="history-date-label" x-text="group.dateLabel"></div>
                <template x-for="item in group.items" :key="item.id">
                    <div class="history-item" @click="onHistoryItemClick(item)">
                        <div class="history-item-icon" :class="item.type">
                            <span x-text="getHistoryIcon(item.type)"></span>
                        </div>
                        <div class="history-item-content">
                            <div class="history-item-title" x-text="item.description"></div>
                            <div class="history-item-meta">
                                <span class="history-item-column" x-text="item.targetId"></span>
                                <span x-text="formatHistoryTime(item.timestamp)"></span>
                                <template x-if="item.user">
                                    <span x-text="'by ' + item.user"></span>
                                </template>
                            </div>
                        </div>
                    </div>
                </template>
            </div>
        </template>
    </div>
</div>

<!-- Phase 7: ÌÇ§Î≥¥Îìú Îã®Ï∂ïÌÇ§ ÎèÑÏõÄÎßê Î™®Îã¨ -->
<div x-show="shortcutsModalOpen"
     x-transition:enter="transition ease-out duration-200"
     x-transition:enter-start="opacity-0"
     x-transition:enter-end="opacity-100"
     x-transition:leave="transition ease-in duration-150"
     x-transition:leave-start="opacity-100"
     x-transition:leave-end="opacity-0"
     class="shortcuts-modal-overlay"
     @click.self="shortcutsModalOpen = false"
     style="display: none;">
    <div class="shortcuts-modal">
        <div class="shortcuts-modal-header">
            <h2>‚å®Ô∏è ÌÇ§Î≥¥Îìú Îã®Ï∂ïÌÇ§</h2>
            <button class="modal-close-btn" @click="shortcutsModalOpen = false">‚úï</button>
        </div>
        <div class="shortcuts-modal-body">
            <!-- ÏùºÎ∞ò Îã®Ï∂ïÌÇ§ -->
            <div class="shortcuts-section">
                <h3>ÏùºÎ∞ò</h3>
                <div class="shortcuts-list">
                    <div class="shortcut-item">
                        <span class="shortcut-keys"><kbd>?</kbd> ÎòêÎäî <kbd>/</kbd></span>
                        <span class="shortcut-desc">Îã®Ï∂ïÌÇ§ ÎèÑÏõÄÎßê</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-keys"><kbd>Esc</kbd></span>
                        <span class="shortcut-desc">Ìå®ÎÑê/Î™®Îã¨ Îã´Í∏∞</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-keys"><kbd>R</kbd></span>
                        <span class="shortcut-desc">Îç∞Ïù¥ÌÑ∞ ÎèôÍ∏∞Ìôî</span>
                    </div>
                </div>
            </div>

            <!-- Ìå®ÎÑê Îã®Ï∂ïÌÇ§ -->
            <div class="shortcuts-section">
                <h3>Ìå®ÎÑê ÌÜ†Í∏Ä</h3>
                <div class="shortcuts-list">
                    <div class="shortcut-item">
                        <span class="shortcut-keys"><kbd>G</kbd></span>
                        <span class="shortcut-desc">ÏöîÏïΩ Ìå®ÎÑê</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-keys"><kbd>E</kbd></span>
                        <span class="shortcut-desc">Ïù¥Ïäà Ìå®ÎÑê</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-keys"><kbd>N</kbd></span>
                        <span class="shortcut-desc">ÏïåÎ¶º Ìå®ÎÑê</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-keys"><kbd>H</kbd></span>
                        <span class="shortcut-desc">ÌûàÏä§ÌÜ†Î¶¨ Ìå®ÎÑê</span>
                    </div>
                </div>
            </div>

            <!-- ÏÑ†ÌÉù Îã®Ï∂ïÌÇ§ -->
            <div class="shortcuts-section">
                <h3>ÏÑ†ÌÉù</h3>
                <div class="shortcuts-list">
                    <div class="shortcut-item">
                        <span class="shortcut-keys"><kbd>Ctrl</kbd> + <kbd>A</kbd></span>
                        <span class="shortcut-desc">Ï†ÑÏ≤¥ ÏÑ†ÌÉù</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-keys"><kbd>D</kbd></span>
                        <span class="shortcut-desc">ÏÑ†ÌÉù Ìï¥Ï†ú</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-keys"><kbd>Shift</kbd> + ÌÅ¥Î¶≠</span>
                        <span class="shortcut-desc">Î≤îÏúÑ ÏÑ†ÌÉù</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-keys">ÎìúÎûòÍ∑∏</span>
                        <span class="shortcut-desc">Îã§Ï§ë ÏÑ†ÌÉù</span>
                    </div>
                </div>
            </div>

            <!-- ÏûëÏóÖ Îã®Ï∂ïÌÇ§ -->
            <div class="shortcuts-section">
                <h3>ÏûëÏóÖ (Í∏∞Îë• ÏÑ†ÌÉù Ïãú)</h3>
                <div class="shortcuts-list">
                    <div class="shortcut-item">
                        <span class="shortcut-keys"><kbd>S</kbd></span>
                        <span class="shortcut-desc">ÏÉÅÌÉú Î≥ÄÍ≤Ω</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-keys"><kbd>P</kbd></span>
                        <span class="shortcut-desc">Í≥µÏ†ï Î≥ÄÍ≤Ω</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-keys"><kbd>I</kbd></span>
                        <span class="shortcut-desc">Ïù¥Ïäà Îì±Î°ù</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-keys"><kbd>L</kbd></span>
                        <span class="shortcut-desc">üîí Lock ÌÜ†Í∏Ä (AI ÎçÆÏñ¥Ïì∞Í∏∞ Î∞©ÏßÄ)</span>
                    </div>
                </div>
            </div>

            <!-- ÌïÑÌÑ∞ Îã®Ï∂ïÌÇ§ -->
            <div class="shortcuts-section">
                <h3>Í≥µÏ†ï ÌïÑÌÑ∞</h3>
                <div class="shortcuts-list">
                    <div class="shortcut-item">
                        <span class="shortcut-keys"><kbd>1</kbd></span>
                        <span class="shortcut-desc">HMBÏ†úÏûë</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-keys"><kbd>2</kbd></span>
                        <span class="shortcut-desc">Î©¥Ï°∞Î¶Ω</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-keys"><kbd>3</kbd></span>
                        <span class="shortcut-desc">ÎåÄÏ°∞Î¶Ω</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-keys"><kbd>4</kbd></span>
                        <span class="shortcut-desc">HMB+PSRC</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-keys"><kbd>5</kbd></span>
                        <span class="shortcut-desc">FORM</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-keys"><kbd>6</kbd></span>
                        <span class="shortcut-desc">Ïï∞Î≤†Îìú</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-keys"><kbd>0</kbd></span>
                        <span class="shortcut-desc">ÌïÑÌÑ∞ Ï¥àÍ∏∞Ìôî</span>
                    </div>
                </div>
            </div>

            <!-- Phase 7: Ï∏µ/Ï†àÏ£º Îã®Ï∂ïÌÇ§ -->
            <div class="shortcuts-section">
                <h3>Ï∏µ/Ï†àÏ£º ÌÉêÏÉâ</h3>
                <div class="shortcuts-list">
                    <div class="shortcut-item">
                        <span class="shortcut-keys"><kbd>F</kbd></span>
                        <span class="shortcut-desc">Ï∏µ ÏÑ†ÌÉùÍ∏∞ Ïó¥Í∏∞</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-keys"><kbd>PgUp</kbd></span>
                        <span class="shortcut-desc">ÏÉÅÏúÑ Ï∏µ Ïù¥Îèô</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-keys"><kbd>PgDn</kbd></span>
                        <span class="shortcut-desc">ÌïòÏúÑ Ï∏µ Ïù¥Îèô</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-keys"><kbd>J</kbd></span>
                        <span class="shortcut-desc">Ï†àÏ£º ÌïÑÌÑ∞ ÏàúÌôò</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="shortcuts-modal-footer">
            <span class="shortcuts-hint">üí° ÎåÄÎ∂ÄÎ∂ÑÏùò Îã®Ï∂ïÌÇ§Îäî ÏûÖÎ†• ÌïÑÎìúÏóêÏÑú ÎπÑÌôúÏÑ±ÌôîÎê©ÎãàÎã§</span>
        </div>
    </div>
</div>

<!-- Bulk Edit Panel (appears when cells selected) -->
<div class="bulk-edit-panel" x-show="selectedCells.length > 0" x-cloak>
    <span class="bulk-count" x-text="selectedCells.length + 'Í∞ú ÏÑ†ÌÉùÎê®'"></span>
    <div class="bulk-actions">
        <button class="bulk-status-btn installed" @click="bulkChangeStatus('installed')">‚úÖ ÏÑ§ÏπòÏôÑÎ£å</button>
        <button class="bulk-status-btn active" @click="bulkChangeStatus('active')">üîµ ÏßÑÌñâÏ§ë</button>
        <button class="bulk-status-btn pending" @click="bulkChangeStatus('pending')">‚ö™ ÎåÄÍ∏∞</button>
        <button class="bulk-status-btn hold" @click="bulkChangeStatus('hold_tc')">üî¥ Hold</button>
    </div>
    <button class="btn" @click="clearSelection()" style="font-size:11px;">‚úï Ï∑®ÏÜå</button>
</div>

<!-- Mobile Bottom Navigation -->
<nav class="bottom-nav" x-show="isMobile" role="navigation" aria-label="Î™®Î∞îÏùº ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò">
    <button class="bottom-nav-item"
            :class="{ 'active': mobileView === 'grid' }"
            @click="mobileView = 'grid'; sidebarOpen = false"
            aria-label="Í∑∏Î¶¨Îìú Î≥¥Í∏∞">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/>
        </svg>
        <span>Í∑∏Î¶¨Îìú</span>
    </button>

    <button class="bottom-nav-item"
            :class="{ 'active': sidebarOpen }"
            @click="sidebarOpen = !sidebarOpen; mobileView = 'filter'"
            aria-label="ÌïÑÌÑ∞">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/>
        </svg>
        <span>ÌïÑÌÑ∞</span>
    </button>

    <button class="bottom-nav-item"
            @click="newIssueModalOpen = true"
            aria-label="Ïù¥Ïäà Ï∂îÍ∞Ä">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
        </svg>
        <span>Ï∂îÍ∞Ä</span>
    </button>

    <button class="bottom-nav-item"
            :class="{ 'active': showNotificationPanel }"
            @click="showNotificationPanel = !showNotificationPanel"
            aria-label="ÏïåÎ¶º">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
        </svg>
        <span>ÏïåÎ¶º</span>
    </button>

    <button class="bottom-nav-item"
            :class="{ 'active': showAdminPanel }"
            @click="showAdminPanel = !showAdminPanel"
            aria-label="ÏÑ§Ï†ï">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
        </svg>
        <span>ÏÑ§Ï†ï</span>
    </button>
</nav>

</body>
</html>
